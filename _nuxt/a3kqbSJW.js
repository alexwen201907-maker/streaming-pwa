import{v as Av,_ as Cv,b as Iv,c as xd,a as Dv,d as Lv}from"./Cn7FfRuP.js";import{_ as Rv}from"./ChC8sygO.js";import{d as vg,o as wv,O as kv,c as Pv,z as Sr,i as Ou,V as Ov,y as Ks,N as Mv,u as Fv,C as wa,W as Ad,P as hi,A as or,B as Cd,M as Nv,U as Bv}from"./ZUt8waE7.js";import"./DrU7REhW.js";const pe=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},Uv=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=$v},$v=Number.MAX_SAFE_INTEGER||9007199254740991;let Te=(function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r})({}),ee=(function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",r.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",r.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.ASSET_LIST_LOAD_ERROR="assetListLoadError",r.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",r.ASSET_LIST_PARSING_ERROR="assetListParsingError",r.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.ATTACH_MEDIA_ERROR="attachMediaError",r.UNKNOWN="unknown",r})({}),I=(function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.MEDIA_ENDED="hlsMediaEnded",r.STALL_RESOLVED="hlsStallResolved",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFERED_TO_END="hlsBufferedToEnd",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r.ASSET_LIST_LOADING="hlsAssetListLoading",r.ASSET_LIST_LOADED="hlsAssetListLoaded",r.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",r.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",r.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",r.INTERSTITIAL_STARTED="hlsInterstitialStarted",r.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",r.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",r.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",r.INTERSTITIAL_ENDED="hlsInterstitialEnded",r.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",r.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",r.EVENT_CUE_ENTER="hlsEventCueEnter",r})({});var Pe={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ye={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class lr{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Vv{constructor(e,t,i,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new lr(e),this.fast_=new lr(t),this.defaultTTFB_=s,this.ttfb_=new lr(e)}update(e,t){const{slow_:i,fast_:s,ttfb_:n}=this;i.halfLife!==e&&(this.slow_=new lr(e,i.getEstimate(),i.getTotalWeight())),s.halfLife!==t&&(this.fast_=new lr(t,s.getEstimate(),s.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new lr(e,n.getEstimate(),n.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,s=e/1e3,n=i/s;this.fast_.sample(s,n),this.slow_.sample(s,n)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function Gv(r,e,t){return(e=qv(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ke(){return Ke=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},Ke.apply(null,arguments)}function Id(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,i)}return t}function He(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Id(Object(t),!0).forEach(function(i){Gv(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Id(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function Hv(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function qv(r){var e=Hv(r,"string");return typeof e=="symbol"?e:e+""}class yi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=xs,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const xs=function(){},jv={trace:xs,debug:xs,log:xs,warn:xs,info:xs,error:xs};function Mu(){return Ke({},jv)}function Kv(r,e){const t=self.console[r];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${r}] >`):xs}function Dd(r,e,t){return e[r]?e[r].bind(e):Kv(r,t)}const Fu=Mu();function Wv(r,e,t){const i=Mu();if(typeof console=="object"&&r===!0||typeof r=="object"){const s=["debug","log","info","warn","error"];s.forEach(n=>{i[n]=Dd(n,r,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Mu()}s.forEach(n=>{Fu[n]=Dd(n,r)})}else Ke(Fu,i);return i}const qe=Fu;function Ls(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function zv(r){return typeof self<"u"&&r===self.ManagedMediaSource}function Sg(r,e){const t=Object.keys(r),i=Object.keys(e),s=t.length,n=i.length;return!s||!n||s===n&&!t.some(a=>i.indexOf(a)===-1)}function si(r,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(r);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const t=r.length;let i,s,n,a="",o=0;for(;o<t;){if(i=r[o++],i===0&&e)return a;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:s=r[o++],a+=String.fromCharCode((i&31)<<6|s&63);break;case 14:s=r[o++],n=r[o++],a+=String.fromCharCode((i&15)<<12|(s&63)<<6|(n&63)<<0);break}}return a}function Lt(r){let e="";for(let t=0;t<r.length;t++){let i=r[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}function Eg(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function Yv(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Rl={exports:{}},Ld;function Xv(){return Ld||(Ld=1,(function(r,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var h=o.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");return h.path=o.normalizePath(h.path),o.buildURLFromParts(h)}var f=o.parseURL(u);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=o.normalizePath(f.path),o.buildURLFromParts(f)):u;var p=o.parseURL(l);if(!p)throw new Error("Error trying to parse base URL.");if(!p.netLoc&&p.path&&p.path[0]!=="/"){var m=s.exec(p.path);p.netLoc=m[1],p.path=m[2]}p.netLoc&&!p.path&&(p.path="/");var y={scheme:p.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(y.netLoc=p.netLoc,f.path[0]!=="/"))if(!f.path)y.path=p.path,f.params||(y.params=p.params,f.query||(y.query=p.query));else{var v=p.path,E=v.substring(0,v.lastIndexOf("/")+1)+f.path;y.path=o.normalizePath(E)}return y.path===null&&(y.path=c.alwaysNormalize?o.normalizePath(f.path):f.path),o.buildURLFromParts(y)},parseURL:function(l){var u=i.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(n,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};r.exports=o})()})(Rl)),Rl.exports}var Ic=Xv();class Dc{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ze={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class bg{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,Jv(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let s;i.length===1?s=t?.byteRangeEndOffset||0:s=parseInt(i[1]),this._byteRange=[s,parseInt(i[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ze.AUDIO]:null,[ze.VIDEO]:null,[ze.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Dc),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Ic.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ze.AUDIO]=null,e[ze.VIDEO]=null,e[ze.AUDIOVIDEO]=null}}function gt(r){return r.sn!=="initSegment"}class wl extends bg{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(pe(e)&&pe(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const i=Object.keys(t);if(i.length===1){const s=this._decryptdata=t[i[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=pe(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const i=Object.keys(this.levelkeys),s=i.length;if(s>1||s===1&&(t=this.levelkeys[i[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!pe(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return gt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var i;const s=t[e];s&&!((i=this._decryptdata)!=null&&i.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,s,n,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:i,startDTS:s,endDTS:n,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,n)}}class Qv extends bg{constructor(e,t,i,s,n){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,n),n&&(this.fragOffset=n.fragOffset+n.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function xg(r,e){const t=Object.getPrototypeOf(r);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||xg(t,e)}}function Jv(r,e){const t=xg(r,e);t&&(t.enumerable=!0,Object.defineProperty(r,e,t))}const Rd=Math.pow(2,32)-1,Zv=[].push,Ag={video:1,audio:2,id3:3,text:4};function _t(r){return String.fromCharCode.apply(null,r)}function Cg(r,e){const t=r[e]<<8|r[e+1];return t<0?65536+t:t}function Ce(r,e){const t=Ig(r,e);return t<0?4294967296+t:t}function wd(r,e){let t=Ce(r,e);return t*=Math.pow(2,32),t+=Ce(r,e+4),t}function Ig(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function eS(r){const e=r.byteLength;for(let t=0;t<e;){const i=Ce(r,t);if(i>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=i>1?t+i:e}return!1}function we(r,e){const t=[];if(!e.length)return t;const i=r.byteLength;for(let s=0;s<i;){const n=Ce(r,s),a=_t(r.subarray(s+4,s+8)),o=n>1?s+n:i;if(a===e[0])if(e.length===1)t.push(r.subarray(s+8,o));else{const l=we(r.subarray(s+8,o),e.slice(1));l.length&&Zv.apply(t,l)}s=o}return t}function tS(r){const e=[],t=r[0];let i=8;const s=Ce(r,i);i+=4;let n=0,a=0;t===0?(n=Ce(r,i),a=Ce(r,i+4),i+=8):(n=wd(r,i),a=wd(r,i+8),i+=16),i+=2;let o=r.length+a;const l=Cg(r,i);i+=2;for(let u=0;u<l;u++){let c=i;const h=Ce(r,c);c+=4;const f=h&2147483647;if((h&2147483648)>>>31===1)return qe.warn("SIDX has hierarchical references (not supported)"),null;const m=Ce(r,c);c+=4,e.push({referenceSize:f,subsegmentDuration:m,info:{duration:m/s,start:o,end:o+f-1}}),o+=f,c+=4,i=c}return{earliestPresentationTime:n,timescale:s,version:t,referencesCount:l,references:e}}function Dg(r){const e=[],t=we(r,["moov","trak"]);for(let s=0;s<t.length;s++){const n=t[s],a=we(n,["tkhd"])[0];if(a){let o=a[0];const l=Ce(a,o===0?12:20),u=we(n,["mdia","mdhd"])[0];if(u){o=u[0];const c=Ce(u,o===0?12:20),h=we(n,["mdia","hdlr"])[0];if(h){const f=_t(h.subarray(8,12)),p={soun:ze.AUDIO,vide:ze.VIDEO}[f],m=we(n,["mdia","minf","stbl","stsd"])[0],y=iS(m);p?(e[l]={timescale:c,type:p,stsd:y},e[p]=He({timescale:c,id:l},y)):e[l]={timescale:c,type:f,stsd:y}}}}}return we(r,["moov","mvex","trex"]).forEach(s=>{const n=Ce(s,4),a=e[n];a&&(a.default={duration:Ce(s,12),flags:Ce(s,20)})}),e}function iS(r){const e=r.subarray(8),t=e.subarray(86),i=_t(e.subarray(4,8));let s=i,n;const a=i==="enca"||i==="encv";if(a){const u=we(e,[i])[0].subarray(i==="enca"?28:78);we(u,["sinf"]).forEach(h=>{const f=we(h,["schm"])[0];if(f){const p=_t(f.subarray(4,8));if(p==="cbcs"||p==="cenc"){const m=we(h,["frma"])[0];m&&(s=_t(m))}}})}const o=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const l=we(t,["avcC"])[0];l&&l.length>3&&(s+="."+Pa(l[1])+Pa(l[2])+Pa(l[3]),n=ka(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=we(e,[i])[0],u=we(l.subarray(28),["esds"])[0];if(u&&u.length>7){let c=4;if(u[c++]!==3)break;c=kl(u,c),c+=2;const h=u[c++];if(h&128&&(c+=2),h&64&&(c+=u[c++]),u[c++]!==4)break;c=kl(u,c);const f=u[c++];if(f===64)s+="."+Pa(f);else break;if(c+=12,u[c++]!==5)break;c=kl(u,c);const p=u[c++];let m=(p&248)>>3;m===31&&(m+=1+((p&7)<<3)+((u[c]&224)>>5)),s+="."+m}break}case"hvc1":case"hev1":{const l=we(t,["hvcC"])[0];if(l&&l.length>12){const u=l[1],c=["","A","B","C"][u>>6],h=u&31,f=Ce(l,2),p=(u&32)>>5?"H":"L",m=l[12],y=l.subarray(6,12);s+="."+c+h,s+="."+sS(f).toString(16).toUpperCase(),s+="."+p+m;let v="";for(let E=y.length;E--;){const A=y[E];(A||v)&&(v="."+A.toString(16).toUpperCase()+v)}s+=v}n=ka(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=ka(s,t)||s;break}case"vp09":{const l=we(t,["vpcC"])[0];if(l&&l.length>6){const u=l[4],c=l[5],h=l[6]>>4&15;s+="."+Bi(u)+"."+Bi(c)+"."+Bi(h)}break}case"av01":{const l=we(t,["av1C"])[0];if(l&&l.length>2){const u=l[1]>>>5,c=l[1]&31,h=l[2]>>>7?"H":"M",f=(l[2]&64)>>6,p=(l[2]&32)>>5,m=u===2&&f?p?12:10:f?10:8,y=(l[2]&16)>>4,v=(l[2]&8)>>3,E=(l[2]&4)>>2,A=l[2]&3;s+="."+u+"."+Bi(c)+h+"."+Bi(m)+"."+y+"."+v+E+A+"."+Bi(1)+"."+Bi(1)+"."+Bi(1)+"."+0,n=ka("dav1",t)}break}}return{codec:s,encrypted:a,supplemental:n}}function ka(r,e){const t=we(e,["dvvC"]),i=t.length?t[0]:we(e,["dvcC"])[0];if(i){const s=i[2]>>1&127,n=i[2]<<5&32|i[3]>>3&31;return r+"."+Bi(s)+"."+Bi(n)}}function sS(r){let e=0;for(let t=0;t<32;t++)e|=(r>>t&1)<<31-t;return e>>>0}function kl(r,e){const t=e+5;for(;r[e++]&128&&e<t;);return e}function Pa(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function Bi(r){return(r<10?"0":"")+r}function rS(r,e){if(!r||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&Lg(r,(i,s)=>{const n=i.subarray(8,24);n.some(a=>a!==0)||(qe.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${Lt(n)} -> ${Lt(t)}`),i.set(t,8))})}function nS(r){const e=[];return Lg(r,t=>e.push(t.subarray(8,24))),e}function Lg(r,e){we(r,["moov","trak"]).forEach(i=>{const s=we(i,["mdia","minf","stbl","stsd"])[0];if(!s)return;const n=s.subarray(8);let a=we(n,["enca"]);const o=a.length>0;o||(a=we(n,["encv"])),a.forEach(l=>{const u=o?l.subarray(28):l.subarray(78);we(u,["sinf"]).forEach(h=>{const f=Rg(h);f&&e(f,o)})})})}function Rg(r){const e=we(r,["schm"])[0];if(e){const t=_t(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const i=we(r,["schi","tenc"])[0];if(i)return i}}}function aS(r,e,t){const i={},s=we(r,["moof","traf"]);for(let n=0;n<s.length;n++){const a=s[n],o=we(a,["tfhd"])[0],l=Ce(o,4),u=e[l];if(!u)continue;i[l]||(i[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const c=i[l],h=we(a,["tfdt"])[0];if(h){const x=h[0];let w=Ce(h,4);x===1&&(w===Rd?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(w*=Rd+1,w+=Ce(h,8))),pe(w)&&(!pe(c.start)||w<c.start)&&(c.start=w)}const f=u.default,p=Ce(o,0)|f?.flags;let m=f?.duration||0;p&8&&(p&2?m=Ce(o,12):m=Ce(o,8));const y=we(a,["trun"]);let v=c.start||0,E=0,A=m;for(let x=0;x<y.length;x++){const w=y[x],k=Ce(w,4),F=c.sampleCount;c.sampleCount+=k;const L=w[3]&1,M=w[3]&4,C=w[2]&1,D=w[2]&2,B=w[2]&4,H=w[2]&8;let q=8,Y=k;for(L&&(q+=4),M&&k&&(!(w[q+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=F),q+=4,C?(A=Ce(w,q),q+=4):A=m,D&&(q+=4),H&&(q+=4),v+=A,E+=A,Y--);Y--;)C?(A=Ce(w,q),q+=4):A=m,D&&(q+=4),B&&(w[q+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(Y+1),c.keyFrameStart=v),q+=4),H&&(q+=4),v+=A,E+=A;!E&&m&&(E+=m*k)}c.duration+=E}if(!Object.keys(i).some(n=>i[n].duration)){let n=1/0,a=0;const o=we(r,["sidx"]);for(let l=0;l<o.length;l++){const u=tS(o[l]);if(u!=null&&u.references){n=Math.min(n,u.earliestPresentationTime/u.timescale);const c=u.references.reduce((h,f)=>h+f.info.duration||0,0);a=Math.max(a,c+u.earliestPresentationTime/u.timescale)}}a&&pe(a)&&Object.keys(i).forEach(l=>{i[l].duration||(i[l].duration=a*i[l].timescale-i[l].start)})}return i}function oS(r){const e={valid:null,remainder:null},t=we(r,["moof"]);if(t.length<2)return e.remainder=r,e;const i=t[t.length-1];return e.valid=r.slice(0,i.byteOffset-8),e.remainder=r.slice(i.byteOffset-8),e}function pi(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function kd(r,e){const t=[],i=e.samples,s=e.timescale,n=e.id;let a=!1;return we(i,["moof"]).map(l=>{const u=l.byteOffset-8;we(l,["traf"]).map(h=>{const f=we(h,["tfdt"]).map(p=>{const m=p[0];let y=Ce(p,4);return m===1&&(y*=Math.pow(2,32),y+=Ce(p,8)),y/s})[0];return f!==void 0&&(r=f),we(h,["tfhd"]).map(p=>{const m=Ce(p,4),y=Ce(p,0)&16777215,v=(y&1)!==0,E=(y&2)!==0,A=(y&8)!==0;let x=0;const w=(y&16)!==0;let k=0;const F=(y&32)!==0;let L=8;m===n&&(v&&(L+=8),E&&(L+=4),A&&(x=Ce(p,L),L+=4),w&&(k=Ce(p,L),L+=4),F&&(L+=4),e.type==="video"&&(a=qo(e.codec)),we(h,["trun"]).map(M=>{const C=M[0],D=Ce(M,0)&16777215,B=(D&1)!==0;let H=0;const q=(D&4)!==0,Y=(D&256)!==0;let Z=0;const Q=(D&512)!==0;let K=0;const z=(D&1024)!==0,X=(D&2048)!==0;let ie=0;const W=Ce(M,4);let ae=8;B&&(H=Ce(M,ae),ae+=4),q&&(ae+=4);let de=H+u;for(let ge=0;ge<W;ge++){if(Y?(Z=Ce(M,ae),ae+=4):Z=x,Q?(K=Ce(M,ae),ae+=4):K=k,z&&(ae+=4),X&&(C===0?ie=Ce(M,ae):ie=Ig(M,ae),ae+=4),e.type===ze.VIDEO){let ce=0;for(;ce<K;){const ve=Ce(i,de);if(de+=4,lS(a,i[de])){const Me=i.subarray(de,de+ve);Lc(Me,a?2:1,r+ie/s,t)}de+=ve,ce+=ve+4}}r+=Z/s}}))})})}),t}function qo(r){if(!r)return!1;const e=r.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function lS(r,e){if(r){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Lc(r,e,t,i){const s=wg(r);let n=0;n+=e;let a=0,o=0,l=0;for(;n<s.length;){a=0;do{if(n>=s.length)break;l=s[n++],a+=l}while(l===255);o=0;do{if(n>=s.length)break;l=s[n++],o+=l}while(l===255);const u=s.length-n;let c=n;if(o<u)n+=o;else if(o>u){qe.error(`Malformed SEI payload. ${o} is too small, only ${u} bytes left to parse.`);break}if(a===4){if(s[c++]===181){const f=Cg(s,c);if(c+=2,f===49){const p=Ce(s,c);if(c+=4,p===1195456820){const m=s[c++];if(m===3){const y=s[c++],v=31&y,E=64&y,A=E?2+v*3:0,x=new Uint8Array(A);if(E){x[0]=y;for(let w=1;w<A;w++)x[w]=s[c++]}i.push({type:m,payloadType:a,pts:t,bytes:x})}}}}}else if(a===5&&o>16){const h=[];for(let m=0;m<16;m++){const y=s[c++].toString(16);h.push(y.length==1?"0"+y:y),(m===3||m===5||m===7||m===9)&&h.push("-")}const f=o-16,p=new Uint8Array(f);for(let m=0;m<f;m++)p[m]=s[c++];i.push({payloadType:a,pts:t,uuid:h.join(""),userData:si(p),userDataBytes:p})}}}function wg(r){const e=r.byteLength,t=[];let i=1;for(;i<e-2;)r[i]===0&&r[i+1]===0&&r[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return r;const s=e-t.length,n=new Uint8Array(s);let a=0;for(i=0;i<s;a++,i++)a===t[0]&&(a++,t.shift()),n[i]=r[a];return n}function uS(r){const e=r[0];let t="",i="",s=0,n=0,a=0,o=0,l=0,u=0;if(e===0){for(;_t(r.subarray(u,u+1))!=="\0";)t+=_t(r.subarray(u,u+1)),u+=1;for(t+=_t(r.subarray(u,u+1)),u+=1;_t(r.subarray(u,u+1))!=="\0";)i+=_t(r.subarray(u,u+1)),u+=1;i+=_t(r.subarray(u,u+1)),u+=1,s=Ce(r,12),n=Ce(r,16),o=Ce(r,20),l=Ce(r,24),u=28}else if(e===1){u+=4,s=Ce(r,u),u+=4;const h=Ce(r,u);u+=4;const f=Ce(r,u);for(u+=4,a=2**32*h+f,Uv(a)||(a=Number.MAX_SAFE_INTEGER,qe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Ce(r,u),u+=4,l=Ce(r,u),u+=4;_t(r.subarray(u,u+1))!=="\0";)t+=_t(r.subarray(u,u+1)),u+=1;for(t+=_t(r.subarray(u,u+1)),u+=1;_t(r.subarray(u,u+1))!=="\0";)i+=_t(r.subarray(u,u+1)),u+=1;i+=_t(r.subarray(u,u+1)),u+=1}const c=r.subarray(u,r.byteLength);return{schemeIdUri:t,value:i,timeScale:s,presentationTime:a,presentationTimeDelta:n,eventDuration:o,id:l,payload:c}}function cS(r,...e){const t=e.length;let i=8,s=t;for(;s--;)i+=e[s].byteLength;const n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=i&255,n.set(r,4),s=0,i=8;s<t;s++)n.set(e[s],i),i+=e[s].byteLength;return n}function hS(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let i,s;i=0,s=new Uint8Array;let n;i>0?(n=new Uint8Array(4),e.length>0&&new DataView(n.buffer).setUint32(0,e.length,!1)):n=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),cS([112,115,115,104],new Uint8Array([i,0,0,0]),r,n,s,a,t)}function dS(r){const e=[];if(r instanceof ArrayBuffer){const t=r.byteLength;let i=0;for(;i+32<t;){const s=new DataView(r,i),n=fS(s);e.push(n),i+=n.size}}return e}function fS(r){const e=r.getUint32(0),t=r.byteOffset,i=r.byteLength;if(i<e)return{offset:t,size:i};if(r.getUint32(4)!==1886614376)return{offset:t,size:e};const n=r.getUint32(8)>>>24;if(n!==0&&n!==1)return{offset:t,size:e};const a=r.buffer,o=Lt(new Uint8Array(a,t+12,16));let l=null,u=null,c=0;if(n===0)c=28;else{const f=r.getUint32(28);if(!f||i<32+f*16)return{offset:t,size:e};l=[];for(let p=0;p<f;p++)l.push(new Uint8Array(a,t+32+p*16,16));c=32+f*16}if(!c)return{offset:t,size:e};const h=r.getUint32(c);return e-32<h?{offset:t,size:e}:(u=new Uint8Array(a,t+c+4,h),{version:n,systemId:o,kids:l,data:u,offset:t,size:e})}const kg=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Mr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Rc(r,e){const t=Mr[e];return!!t&&!!t[r.slice(0,4)]}function Bn(r,e,t=!0){return!r.split(",").some(i=>!wc(i,e,t))}function wc(r,e,t=!0){var i;const s=Ls(t);return(i=s?.isTypeSupported(Un(r,e)))!=null?i:!1}function Un(r,e){return`${e}/mp4;codecs=${r}`}function Pd(r){if(r){const e=r.substring(0,4);return Mr.video[e]}return 2}function ho(r){const e=kg();return r.split(",").reduce((t,i)=>{const n=e&&qo(i)?9:Mr.video[i];return n?(n*2+t)/(t?3:2):(Mr.audio[i]+t)/(t?2:1)},0)}const Pl={};function pS(r,e=!0){if(Pl[r])return Pl[r];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[r];for(let s=0;s<t.length;s++){var i;if(wc(t[s],"audio",e))return Pl[r]=t[s],t[s];if(t[s]==="mp3"&&(i=Ls(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return r}const gS=/flac|opus|mp4a\.40\.34/i;function fo(r,e=!0){return r.replace(gS,t=>pS(t.toLowerCase(),e))}function mS(r,e){const t=[];if(r){const i=r.split(",");for(let s=0;s<i.length;s++)Rc(i[s],"video")||t.push(i[s])}return e&&t.push(e),t.join(",")}function eo(r,e){if(r&&(r.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(r)!==-1)&&(Od(r,"audio")||Od(r,"video")))return r;if(e){const t=e.split(",");if(t.length>1){if(r){for(let i=t.length;i--;)if(t[i].substring(0,4)===r.substring(0,4))return t[i]}return t[0]}}return e||r}function Od(r,e){return Rc(r,e)&&wc(r,e)}function yS(r){const e=r.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function TS(r){if(r.startsWith("av01.")){const e=r.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return r}function Md(r){const e=Ls(r)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Nu(r){return r.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const _S={supported:!0,powerEfficient:!0,smooth:!0},vS={supported:!1,smooth:!1,powerEfficient:!1},Pg={supported:!0,configurations:[],decodingInfoResults:[_S]};function Og(r,e){return{supported:!1,configurations:e,decodingInfoResults:[vS],error:r}}function SS(r,e,t,i,s,n){const a=r.videoCodec,o=r.audioCodec?r.audioGroups:null,l=n?.audioCodec,u=n?.channels,c=u?parseInt(u):l?1/0:2;let h=null;if(o!=null&&o.length)try{o.length===1&&o[0]?h=e.groups[o[0]].channels:h=o.reduce((f,p)=>{if(p){const m=e.groups[p];if(!m)throw new Error(`Audio track group ${p} not found`);Object.keys(m.channels).forEach(y=>{f[y]=(f[y]||0)+m.channels[y]})}return f},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(f=>qo(f))||r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(i,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(s,8e6))||!!h&&pe(c)&&Object.keys(h).some(f=>parseInt(f)>c)}function Mg(r,e,t,i={}){const s=r.videoCodec;if(!s&&!r.audioCodec||!t)return Promise.resolve(Pg);const n=[],a=ES(r),o=a.length,l=bS(r,e,o>0),u=l.length;for(let c=o||1*u||1;c--;){const h={type:"media-source"};if(o&&(h.video=a[c%o]),u){h.audio=l[c%u];const f=h.audio.bitrate;h.video&&f&&(h.video.bitrate-=f)}n.push(h)}if(s){const c=navigator.userAgent;if(s.split(",").some(h=>qo(h))&&kg())return Promise.resolve(Og(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${c})`),n))}return Promise.all(n.map(c=>{const h=AS(c);return i[h]||(i[h]=t.decodingInfo(c))})).then(c=>({supported:!c.some(h=>!h.supported),configurations:n,decodingInfoResults:c})).catch(c=>({supported:!1,configurations:n,decodingInfoResults:[],error:c}))}function ES(r){var e;const t=(e=r.videoCodec)==null?void 0:e.split(","),i=Fg(r),s=r.width||640,n=r.height||480,a=r.frameRate||30,o=r.videoRange.toLowerCase();return t?t.map(l=>{const u={contentType:Un(TS(l),"video"),width:s,height:n,bitrate:i,framerate:a};return o!=="sdr"&&(u.transferFunction=o),u}):[]}function bS(r,e,t){var i;const s=(i=r.audioCodec)==null?void 0:i.split(","),n=Fg(r);return s&&r.audioGroups?r.audioGroups.reduce((a,o)=>{var l;const u=o?(l=e.groups[o])==null?void 0:l.tracks:null;return u?u.reduce((c,h)=>{if(h.groupId===o){const f=parseFloat(h.channels||"");s.forEach(p=>{const m={contentType:Un(p,"audio"),bitrate:t?xS(p,n):n};f&&(m.channels=""+f),c.push(m)})}return c},a):a},[]):[]}function xS(r,e){if(e<=1)return 1;let t=128e3;return r==="ec-3"?t=768e3:r==="ac-3"&&(t=64e4),Math.min(e/2,t)}function Fg(r){return Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)/1e3)*1e3||1}function AS(r){let e="";const{audio:t,video:i}=r;if(i){const s=Nu(i.contentType);e+=`${s}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(t){const s=Nu(t.contentType);e+=`${i?"_":""}${s}_c${t.channels}`}return e}const Bu=["NONE","TYPE-0","TYPE-1",null];function CS(r){return Bu.indexOf(r)>-1}const po=["SDR","PQ","HLG"];function IS(r){return!!r&&po.indexOf(r)>-1}var to={No:"",Yes:"YES",v2:"v2"};function Fd(r){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=r,s=i<e/2;return e&&s?t?to.v2:to.Yes:to.No}class Nd{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class $n{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Bd(this._audioGroups,e)}hasSubtitleGroup(e){return Bd(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Bd(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function DS(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function LS(r,e){let t=!1,i=[];if(r&&(t=r!=="SDR",i=[r]),e){i=e.allowedVideoRanges||po.slice(0);const s=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&DS(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const RS=r=>{const e=new WeakSet;return(t,i)=>{if(r&&(i=r(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},Ye=(r,e)=>JSON.stringify(r,RS(e));function wS(r,e,t,i,s){const n=Object.keys(r),a=i?.channels,o=i?.audioCodec,l=s?.videoCodec,u=a&&parseInt(a)===2;let c=!1,h=!1,f=1/0,p=1/0,m=1/0,y=1/0,v=0,E=[];const{preferHDR:A,allowedVideoRanges:x}=LS(e,s);for(let M=n.length;M--;){const C=r[n[M]];c||(c=C.channels[2]>0),f=Math.min(f,C.minHeight),p=Math.min(p,C.minFramerate),m=Math.min(m,C.minBitrate),x.filter(B=>C.videoRanges[B]>0).length>0&&(h=!0)}f=pe(f)?f:0,p=pe(p)?p:0;const w=Math.max(1080,f),k=Math.max(30,p);m=pe(m)?m:t,t=Math.max(m,t),h||(e=void 0);const F=n.length>1;return{codecSet:n.reduce((M,C)=>{const D=r[C];if(C===M)return M;if(E=h?x.filter(B=>D.videoRanges[B]>0):[],F){if(D.minBitrate>t)return Mi(C,`min bitrate of ${D.minBitrate} > current estimate of ${t}`),M;if(!D.hasDefaultAudio)return Mi(C,"no renditions with default or auto-select sound found"),M;if(o&&C.indexOf(o.substring(0,4))%5!==0)return Mi(C,`audio codec preference "${o}" not found`),M;if(a&&!u){if(!D.channels[a])return Mi(C,`no renditions with ${a} channel sound found (channels options: ${Object.keys(D.channels)})`),M}else if((!o||u)&&c&&D.channels[2]===0)return Mi(C,"no renditions with stereo sound found"),M;if(D.minHeight>w)return Mi(C,`min resolution of ${D.minHeight} > maximum of ${w}`),M;if(D.minFramerate>k)return Mi(C,`min framerate of ${D.minFramerate} > maximum of ${k}`),M;if(!E.some(B=>D.videoRanges[B]>0))return Mi(C,`no variants with VIDEO-RANGE of ${Ye(E)} found`),M;if(l&&C.indexOf(l.substring(0,4))%5!==0)return Mi(C,`video codec preference "${l}" not found`),M;if(D.maxScore<v)return Mi(C,`max score of ${D.maxScore} < selected max of ${v}`),M}return M&&(ho(C)>=ho(M)||D.fragmentError>r[M].fragmentError)?M:(y=D.minIndex,v=D.maxScore,C)},void 0),videoRanges:E,preferHDR:A,minFramerate:p,minBitrate:m,minIndex:y}}function Mi(r,e){qe.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function Ng(r){return r.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const s=t.channels||"2";return i.channels[s]=(i.channels[s]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function kS(r,e,t,i){return r.slice(t,i+1).reduce((s,n,a)=>{if(!n.codecSet)return s;const o=n.audioGroups;let l=s[n.codecSet];l||(s[n.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,n.bitrate);const u=Math.min(n.height,n.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,n.frameRate),l.minIndex=Math.min(l.minIndex,a),l.maxScore=Math.max(l.maxScore,n.score),l.fragmentError+=n.fragmentError,l.videoRanges[n.videoRange]=(l.videoRanges[n.videoRange]||0)+1,o&&o.forEach(c=>{if(!c)return;const h=e.groups[c];h&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?h.hasDefault:h.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(h.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+h.channels[f]}))}),s},{})}function Ud(r){if(!r)return r;const{lang:e,assocLang:t,characteristics:i,channels:s,audioCodec:n}=r;return{lang:e,assocLang:t,characteristics:i,channels:s,audioCodec:n}}function Gi(r,e,t){if("attrs"in r){const i=e.indexOf(r);if(i!==-1)return i}for(let i=0;i<e.length;i++){const s=e[i];if(Ys(r,s,t))return i}return-1}function Ys(r,e,t){const{groupId:i,name:s,lang:n,assocLang:a,default:o}=r,l=r.forced;return(i===void 0||e.groupId===i)&&(s===void 0||e.name===s)&&(n===void 0||PS(n,e.lang))&&(n===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(!("characteristics"in r)||OS(r.characteristics||"",e.characteristics))&&(t===void 0||t(r,e))}function PS(r,e="--"){return r.length===e.length?r===e:r.startsWith(e)||e.startsWith(r)}function OS(r,e=""){const t=r.split(","),i=e.split(",");return t.length===i.length&&!t.some(s=>i.indexOf(s)===-1)}function Hs(r,e){const{audioCodec:t,channels:i}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function MS(r,e,t,i,s){const n=e[i],o=e.reduce((f,p,m)=>{const y=p.uri;return(f[y]||(f[y]=[])).push(m),f},{})[n.uri];o.length>1&&(i=Math.max.apply(Math,o));const l=n.videoRange,u=n.frameRate,c=n.codecSet.substring(0,4),h=$d(e,i,f=>{if(f.videoRange!==l||f.frameRate!==u||f.codecSet.substring(0,4)!==c)return!1;const p=f.audioGroups,m=t.filter(y=>!p||p.indexOf(y.groupId)!==-1);return Gi(r,m,s)>-1});return h>-1?h:$d(e,i,f=>{const p=f.audioGroups,m=t.filter(y=>!p||p.indexOf(y.groupId)!==-1);return Gi(r,m,s)>-1})}function $d(r,e,t){for(let i=e;i>-1;i--)if(t(r[i]))return i;for(let i=e+1;i<r.length;i++)if(t(r[i]))return i;return-1}function go(r,e){var t;return!!r&&r!==((t=e.loadLevelObj)==null?void 0:t.uri)}class FS extends yi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:s,partCurrent:n,hls:a}=this,{autoLevelEnabled:o,media:l}=a;if(!s||!l)return;const u=performance.now(),c=n?n.stats:s.stats,h=n?n.duration:s.duration,f=u-c.loading.start,p=a.minAutoLevel,m=s.level,y=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||m<=p){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const v=y>-1&&y!==m,E=!!t||v;if(!E&&(l.paused||!l.playbackRate||!l.readyState))return;const A=a.mainForwardBufferInfo;if(!E&&A===null)return;const x=this.bwEstimator.getEstimateTTFB(),w=Math.abs(l.playbackRate);if(f<=Math.max(x,1e3*(h/(w*2))))return;const k=A?A.len/w:0,F=c.loading.first?c.loading.first-c.loading.start:-1,L=c.loaded&&F>-1,M=this.getBwEstimate(),C=a.levels,D=C[m],B=Math.max(c.loaded,Math.round(h*(s.bitrate||D.averageBitrate)/8));let H=L?f-F:f;H<1&&L&&(H=Math.min(f,c.loaded*8/M));const q=L?c.loaded*1e3/H:0,Y=x/1e3,Z=q?(B-c.loaded)/q:B*8/M+Y;if(Z<=k)return;const Q=q?q*8:M,K=((i=t?.details||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,z=this.hls.config.abrBandWidthUpFactor;let X=Number.POSITIVE_INFINITY,ie;for(ie=m-1;ie>p;ie--){const ge=C[ie].maxBitrate,ce=!C[ie].details||K;if(X=this.getTimeToLoadFrag(Y,Q,h*ge,ce),X<Math.min(k,h+Y))break}if(X>=Z||X>h*10)return;L?this.bwEstimator.sample(f-Math.min(x,F),c.loaded):this.bwEstimator.sampleTTFB(f);const W=C[ie].maxBitrate;this.getBwEstimate()*z>W&&this.resetEstimator(W);const ae=this.findBestLevel(W,p,ie,0,k,1,1);ae>-1&&(ie=ae),this.warn(`Fragment ${s.sn}${n?" part "+n.index:""} of level ${m} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${k.toFixed(3)} s
      Estimated load time for current fragment: ${Z.toFixed(3)} s
      Estimated load time for down switch fragment: ${X.toFixed(3)} s
      TTFB estimate: ${F|0} ms
      Current BW estimate: ${pe(M)?M|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${ie} @ ${W|0} bps`),a.nextLoadLevel=a.nextAutoLevel=ie,this.clearTimer();const de=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===ie&&ie>0){const ge=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${ie>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${ge.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,ie>p){let ce=this.findBestLevel(this.hls.levels[p].bitrate,p,ie,0,ge,1,1);ce===-1&&(ce=p),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ce,this.resetEstimator(this.hls.levels[ce].bitrate)}}};v||Z>X*2?de():this.timer=self.setInterval(de,X*1e3),a.trigger(I.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:n,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Vv(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(I.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var s;this.fragCurrent=i,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case ee.BUFFER_ADD_CODEC_ERROR:case ee.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ee.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:s,partCurrent:n}=this;if(i&&s&&i.sn===s.sn&&i.level===s.level){const a=performance.now(),o=n?n.stats:i.stats,l=a-o.loading.start,u=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&u>-1){const h=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(h,u),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,i,s){const n=e+i/t,a=s?e+this.lastLevelLoadSec:0;return n+a}onLevelLoaded(e,t){const i=this.hls.config,{loading:s}=t.stats,n=s.end-s.first;pe(n)&&(this.lastLevelLoadSec=n/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const s=i?i.stats:t.stats;if(t.type===ye.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const n=i?i.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+s.loaded,l=(a.loaded?a.loaded.duration:0)+n;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const n={stats:s,frag:t,part:i,id:t.type};this.onFragBuffered(I.FRAG_BUFFERED,n),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:s}=t,n=s!=null&&s.stats.loaded?s.stats:i.stats;if(n.aborted||this.ignoreFragment(i))return;const a=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,n.loaded),n.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ye.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,n=this.findBestLevel(i,t,e,0,s,1,1);if(n>-1)return n;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const n=i&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,n)&&a[e].loadError<=a[n].loadError)return e}return this._nextAutoLevel=n,this.nextAutoLevelKey=this.getAutoLevelKey(),n}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:s,config:n,minAutoLevel:a}=i,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=n.abrBandWidthFactor,h=n.abrBandWidthUpFactor;if(u){const v=this.findBestLevel(l,a,s,u,0,c,h);if(v>=0)return this.rebufferNotice=-1,v}let f=o?Math.min(o,n.maxStarvationDelay):n.maxStarvationDelay;if(!u){const v=this.bitrateTestDelay;v&&(f=(o?Math.min(o,n.maxLoadingDelay):n.maxLoadingDelay)-v,this.info(`bitrate test took ${Math.round(1e3*v)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),c=h=1)}const p=this.findBestLevel(l,a,s,u,f,c,h);if(this.rebufferNotice!==p&&(this.rebufferNotice=p,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${p}`)),p>-1)return p;const m=i.levels[a],y=i.loadLevelObj;return y&&m?.bitrate<y.bitrate?a:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,s,n,a,o){var l;const u=s+n,c=this.lastLoadedFragLevel,h=c===-1?this.hls.firstLevel:c,{fragCurrent:f,partCurrent:p}=this,{levels:m,allAudioTracks:y,loadLevel:v,config:E}=this.hls;if(m.length===1)return 0;const A=m[h],x=!!((l=this.hls.latestLevelDetails)!=null&&l.live),w=v===-1||c===-1;let k,F="SDR",L=A?.frameRate||0;const{audioPreference:M,videoPreference:C}=E,D=this.audioTracksByGroup||(this.audioTracksByGroup=Ng(y));let B=-1;if(w){if(this.firstSelection!==-1)return this.firstSelection;const Q=this.codecTiers||(this.codecTiers=kS(m,D,t,i)),K=wS(Q,F,e,M,C),{codecSet:z,videoRanges:X,minFramerate:ie,minBitrate:W,minIndex:ae,preferHDR:de}=K;B=ae,k=z,F=de?X[X.length-1]:X[0],L=ie,e=Math.max(e,W),this.log(`picked start tier ${Ye(K)}`)}else k=A?.codecSet,F=A?.videoRange;const H=p?p.duration:f?f.duration:0,q=this.bwEstimator.getEstimateTTFB()/1e3,Y=[];for(let Q=i;Q>=t;Q--){var Z;const K=m[Q],z=Q>h;if(!K)continue;if(E.useMediaCapabilities&&!K.supportedResult&&!K.supportedPromise){const ce=navigator.mediaCapabilities;typeof ce?.decodingInfo=="function"&&SS(K,D,F,L,e,M)?(K.supportedPromise=Mg(K,D,ce,this.supportedCache),K.supportedPromise.then(ve=>{if(!this.hls)return;K.supportedResult=ve;const Me=this.hls.levels,ke=Me.indexOf(K);ve.error?this.warn(`MediaCapabilities decodingInfo error: "${ve.error}" for level ${ke} ${Ye(ve)}`):ve.supported?ve.decodingInfoResults.some(Ve=>Ve.smooth===!1||Ve.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${ke} not smooth or powerEfficient: ${Ye(ve)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${ke} ${Ye(ve)}`),ke>-1&&Me.length>1&&(this.log(`Removing unsupported level ${ke}`),this.hls.removeLevel(ke),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ve=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ve}`)})):K.supportedResult=Pg}if((k&&K.codecSet!==k||F&&K.videoRange!==F||z&&L>K.frameRate||!z&&L>0&&L<K.frameRate||(Z=K.supportedResult)!=null&&(Z=Z.decodingInfoResults)!=null&&Z.some(ce=>ce.smooth===!1))&&(!w||Q!==B)){Y.push(Q);continue}const X=K.details,ie=(p?X?.partTarget:X?.averagetargetduration)||H;let W;z?W=o*e:W=a*e;const ae=H&&s>=H*2&&n===0?K.averageBitrate:K.maxBitrate,de=this.getTimeToLoadFrag(q,W,ae*ie,X===void 0);if(W>=ae&&(Q===c||K.loadError===0&&K.fragmentError===0)&&(de<=q||!pe(de)||x&&!this.bitrateTestDelay||de<u)){const ce=this.forcedAutoLevel;return Q!==v&&(ce===-1||ce!==v)&&(Y.length&&this.trace(`Skipped level(s) ${Y.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${m[Y[0]].codecs}" ${m[Y[0]].videoRange}; not compatible with "${k}" ${F}`),this.info(`switch candidate:${h}->${Q} adjustedbw(${Math.round(W)})-bitrate=${Math.round(W-ae)} ttfb:${q.toFixed(1)} avgDuration:${ie.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${de.toFixed(1)} firstSelection:${w} codecSet:${K.codecSet} videoRange:${K.videoRange} hls.loadLevel:${v}`)),w&&(this.firstSelection=Q),Q}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const Bg={search:function(r,e){let t=0,i=r.length-1,s=null,n=null;for(;t<=i;){s=(t+i)/2|0,n=r[s];const a=e(n);if(a>0)t=s+1;else if(a<0)i=s-1;else return n}return null}};function NS(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!pe(e))return null;const i=r[0].programDateTime;if(e<(i||0))return null;const s=r[r.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let n=0;n<r.length;++n){const a=r[n];if(US(e,t,a))return a}return null}function tr(r,e,t=0,i=0,s=.005){let n=null;if(r){n=e[1+r.sn-e[0].sn]||null;const o=r.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),n&&r.level!==n.level&&n.end<=r.end&&(n=e[2+r.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(n=e[0]);if(n&&((!r||r.level===n.level)&&Vd(t,i,n)===0||BS(n,r,Math.min(s,i))))return n;const a=Bg.search(e,Vd.bind(null,t,i));return a&&(a!==r||!n)?a:n}function BS(r,e,t){if(e&&e.start===0&&e.level<r.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((s,n)=>(n[0]==="INF"&&(s+=parseFloat(n[1])),s),t);return r.start<=i}return!1}function Vd(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=r?1:t.start-i>r&&t.start?-1:0}function US(r,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>r}function Ug(r,e,t){if(r&&r.startCC<=e&&r.endCC>=e){let i=r.fragments;const{fragmentHint:s}=r;s&&(i=i.concat(s));let n;return Bg.search(i,a=>a.cc<e?1:a.cc>e?-1:(n=a,a.end<=t?1:a.start>t?-1:0)),n||null}return null}function mo(r){switch(r.details){case ee.FRAG_LOAD_TIMEOUT:case ee.KEY_LOAD_TIMEOUT:case ee.LEVEL_LOAD_TIMEOUT:case ee.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function $g(r){return r.details.startsWith("key")}function Vg(r){return $g(r)&&!!r.frag&&!r.frag.decryptdata}function Gd(r,e){const t=mo(e);return r.default[`${t?"timeout":"error"}Retry`]}function kc(r,e){const t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function Hd(r){return He(He({},r),{errorRetry:null,timeoutRetry:null})}function yo(r,e,t,i){if(!r)return!1;const s=i?.code,n=e<r.maxNumRetry&&($S(s)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,i,n):n}function $S(r){return Uu(r)||!!r&&(r<400||r>499)}function Uu(r){return r===0&&navigator.onLine===!1}var It={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},ei={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class VS extends yi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(I.ERROR,this.onError,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(I.ERROR,this.onError,this),e.off(I.ERROR,this.onErrorOut,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===ye.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,i=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||i===-1?t.loadLevel:i}variantHasKey(e,t){if(e){var i;if((i=e.details)!=null&&i.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(a=>s.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const s=this.hls,n=t.context;switch(t.details){case ee.FRAG_LOAD_ERROR:case ee.FRAG_LOAD_TIMEOUT:case ee.KEY_LOAD_ERROR:case ee.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case ee.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=Er();return}case ee.FRAG_GAP:case ee.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=It.SendAlternateToPenaltyBox;return}case ee.LEVEL_EMPTY_ERROR:case ee.LEVEL_PARSING_ERROR:{var a;const l=t.parent===ye.MAIN?t.level:s.loadLevel;t.details===ee.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case ee.LEVEL_LOAD_ERROR:case ee.LEVEL_LOAD_TIMEOUT:typeof n?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.level));return;case ee.AUDIO_TRACK_LOAD_ERROR:case ee.AUDIO_TRACK_LOAD_TIMEOUT:case ee.SUBTITLE_LOAD_ERROR:case ee.SUBTITLE_TRACK_LOAD_TIMEOUT:if(n){const l=s.loadLevelObj;if(l&&(n.type===Pe.AUDIO_TRACK&&l.hasAudioGroup(n.groupId)||n.type===Pe.SUBTITLE_TRACK&&l.hasSubtitleGroup(n.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=It.SendAlternateToPenaltyBox,t.errorAction.flags=ei.MoveAllAlternatesMatchingHost;return}}return;case ee.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:It.SendAlternateToPenaltyBox,flags:ei.MoveAllAlternatesMatchingHDCP};return;case ee.KEY_SYSTEM_SESSION_UPDATE_FAILED:case ee.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case ee.KEY_SYSTEM_NO_SESSION:t.errorAction={action:It.SendAlternateToPenaltyBox,flags:ei.MoveAllAlternatesMatchingKey};return;case ee.BUFFER_ADD_CODEC_ERROR:case ee.REMUX_ALLOC_ERROR:case ee.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:s.loadLevel)}return;case ee.INTERNAL_EXCEPTION:case ee.BUFFER_APPENDING_ERROR:case ee.BUFFER_FULL_ERROR:case ee.LEVEL_SWITCH_ERROR:case ee.BUFFER_STALLED_ERROR:case ee.BUFFER_SEEK_OVER_HOLE:case ee.BUFFER_NUDGE_ON_STALL:t.errorAction=Er();return}t.type===Te.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Er())}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,s=Gd(i.config.playlistLoadPolicy,e),n=this.playlistError++;if(yo(s,n,mo(e),e.response))return{action:It.RetryRequest,flags:ei.None,retryConfig:s,retryCount:n};const o=this.getLevelSwitchAction(e,t);return s&&(o.retryConfig=s,o.retryCount=n),o}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),s=t.levels[i],{fragLoadPolicy:n,keyLoadPolicy:a}=t.config,o=Gd($g(e)?a:n,e),l=t.levels.reduce((c,h)=>c+h.fragmentError,0);if(s&&(e.details!==ee.FRAG_GAP&&s.fragmentError++,!Vg(e)&&yo(o,l,mo(e),e.response)))return{action:It.RetryRequest,flags:ei.None,retryConfig:o,retryCount:l};const u=this.getLevelSwitchAction(e,i);return o&&(u.retryConfig=o,u.retryCount=l),u}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const s=this.hls.levels[t];if(s){var n,a;const u=e.details;s.loadError++,u===ee.BUFFER_APPEND_ERROR&&s.fragmentError++;let c=-1;const{levels:h,loadLevel:f,minAutoLevel:p,maxAutoLevel:m}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const y=(n=e.frag)==null?void 0:n.type,E=(y===ye.AUDIO&&u===ee.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===ee.BUFFER_ADD_CODEC_ERROR||u===ee.BUFFER_APPEND_ERROR))&&h.some(({audioCodec:F})=>s.audioCodec!==F),x=e.sourceBufferName==="video"&&(u===ee.BUFFER_ADD_CODEC_ERROR||u===ee.BUFFER_APPEND_ERROR)&&h.some(({codecSet:F,audioCodec:L})=>s.codecSet!==F&&s.audioCodec===L),{type:w,groupId:k}=(a=e.context)!=null?a:{};for(let F=h.length;F--;){const L=(F+f)%h.length;if(L!==f&&L>=p&&L<=m&&h[L].loadError===0){var o,l;const M=h[L];if(u===ee.FRAG_GAP&&y===ye.MAIN&&e.frag){const C=h[L].details;if(C){const D=tr(e.frag,C.fragments,e.frag.start);if(D!=null&&D.gap)continue}}else{if(w===Pe.AUDIO_TRACK&&M.hasAudioGroup(k)||w===Pe.SUBTITLE_TRACK&&M.hasSubtitleGroup(k))continue;if(y===ye.AUDIO&&(o=s.audioGroups)!=null&&o.some(C=>M.hasAudioGroup(C))||y===ye.SUBTITLE&&(l=s.subtitleGroups)!=null&&l.some(C=>M.hasSubtitleGroup(C))||E&&s.audioCodec===M.audioCodec||x&&s.codecSet===M.codecSet||!E&&s.codecSet!==M.codecSet)continue}c=L;break}}if(c>-1&&i.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:It.SendAlternateToPenaltyBox,flags:ei.None,nextAutoLevel:c}}return{action:It.SendAlternateToPenaltyBox,flags:ei.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case It.DoNothing:break;case It.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==ee.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:s}=i,n=i.nextAutoLevel;switch(s){case ei.None:this.switchLevel(e,n);break;case ei.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),u=t.levels[l],c=u?.attrs["HDCP-LEVEL"];if(i.hdcpLevel=c,c==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(c){t.maxHdcpLevel=Bu[Bu.indexOf(c)-1],i.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case ei.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const u=this.hls.levels,c=u.length;for(let f=c;f--;)if(this.variantHasKey(u[f],l)){var a,o;this.log(`Banned key found in level ${f} (${u[f].bitrate}bps) or audio group "${(a=u[f].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${Lt(l.keyId||[])}`),u[f].fragmentError++,u[f].loadError++,this.log(`Removing level ${f} with key error (${e.error})`),this.hls.removeLevel(f)}const h=e.frag;if(this.hls.levels.length<c)i.resolved=!0;else if(h&&h.type!==ye.MAIN){const f=h.decryptdata;f&&!l.matches(f)&&(i.resolved=!0)}}break}}i.resolved||this.switchLevel(e,n)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===ee.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=Nu(e.mimeType),s=this.hls.levels;for(let n=s.length;n--;)s[n][`${e.sourceBufferName}Codec`]===i&&(this.log(`Removing level ${n} for ${e.details} ("${i}" not supported)`),this.hls.removeLevel(n))}}}function Er(r){const e={action:It.DoNothing,flags:ei.None};return r&&(e.resolved=!0),e}var vt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class GS{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let s=i.length;s--;){const n=i[s];if(!n)break;if(n.start<=e&&e<=n.end&&n.loaded)return n}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:s}=this,n=Object.keys(s);for(let a=n.length;a--;){const o=s[n[a]];if(o?.body.type===t&&(!i||o.buffered)){const l=o.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,i,s,n){this.timeRanges&&(this.timeRanges[e]=t);const a=s?.fragment.sn||-1;Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l||a>=l.body.sn)return;if(!l.buffered&&(!l.loaded||n)){l.body.type===i&&this.removeFragment(l.body);return}const u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(c=>{const h=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return h&&this.removeFragment(l.body),h})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,s=ur(i),n=this.fragments[s];if(!n||n.buffered&&i.gap)return;const a=!i.relurl;Object.keys(t).forEach(o=>{const l=i.elementaryStreams[o];if(!l)return;const u=t[o],c=a||l.partial===!0;n.range[o]=this.getBufferedTimes(i,e.part,c,u)}),n.loaded=null,Object.keys(n.range).length?(this.bufferedEnd(n,i),Oa(n)||this.removeParts(i.sn-1,i.type)):this.removeFragment(n.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=qd(i,s=>s.fragment.sn>=e))}fragBuffered(e,t){const i=ur(e);let s=this.fragments[i];!s&&t&&(s=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,this.bufferedEnd(s,e))}getBufferedTimes(e,t,i,s){const n={time:[],partial:i},a=e.start,o=e.end,l=e.minEndPTS||o,u=e.maxStartPTS||a;for(let c=0;c<s.length;c++){const h=s.start(c)-this.bufferPadding,f=s.end(c)+this.bufferPadding;if(u>=h&&l<=f){n.time.push({startPTS:Math.max(a,s.start(c)),endPTS:Math.min(o,s.end(c))});break}else if(a<f&&o>h){const p=Math.max(a,s.start(c)),m=Math.min(o,s.end(c));m>p&&(n.partial=!0,n.time.push({startPTS:p,endPTS:m}))}else if(o<=h)break}return n}getPartialFragment(e){let t=null,i,s,n,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&Oa(c)&&(s=c.body.start-o,n=c.body.end+o,e>=s&&e<=n&&(i=Math.min(e-s,n-e),a<=i&&(t=c.body,a=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Oa(t))}getState(e){const t=ur(e),i=this.fragments[t];return i?i.buffered?Oa(i)?vt.PARTIAL:vt.OK:vt.APPENDING:vt.NOT_LOADED}isTimeBuffered(e,t,i){let s,n;for(let a=0;a<i.length;a++){if(s=i.start(a)-this.bufferPadding,n=i.end(a)+this.bufferPadding,e>=s&&t<=n)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,s=t.part?null:t,n=ur(i);this.fragments[n]={body:i,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:s,timeRanges:n,type:a}=t;if(i.sn==="initSegment")return;const o=i.type;if(s){let u=this.activePartLists[o];u||(this.activePartLists[o]=u=[]),u.push(s)}this.timeRanges=n;const l=n[a];this.detectEvictedFragments(a,l,o,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=ur(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let s=i.length;s--;){const n=t[i[s]];if(n?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,s,n){s&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==i||s&&!l.gap||l.start<t&&l.end>e&&(o.buffered||n)&&this.removeFragment(l)})}removeFragment(e){const t=ur(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const s=e.sn;this.activePartLists[e.type]=qd(i,n=>n.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(i=>i.clearElementaryStreamInfo())}}function Oa(r){var e,t,i;return r.buffered&&!!(r.body.gap||(e=r.range.video)!=null&&e.partial||(t=r.range.audio)!=null&&t.partial||(i=r.range.audiovideo)!=null&&i.partial)}function ur(r){return`${r.type}_${r.level}_${r.sn}`}function qd(r,e){return r.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var Rs={cbc:0,ctr:1};class HS{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case Rs.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Rs.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function qS(r){const e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?r.slice(0,e-t):r}class jS{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let s=0;s<4;s++)i[s]=t.getUint32(s*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,s=i[0],n=i[1],a=i[2],o=i[3],l=this.invSubMix,u=l[0],c=l[1],h=l[2],f=l[3],p=new Uint32Array(256);let m=0,y=0,v=0;for(v=0;v<256;v++)v<128?p[v]=v<<1:p[v]=v<<1^283;for(v=0;v<256;v++){let E=y^y<<1^y<<2^y<<3^y<<4;E=E>>>8^E&255^99,e[m]=E,t[E]=m;const A=p[m],x=p[A],w=p[x];let k=p[E]*257^E*16843008;s[m]=k<<24|k>>>8,n[m]=k<<16|k>>>16,a[m]=k<<8|k>>>24,o[m]=k,k=w*16843009^x*65537^A*257^m*16843008,u[E]=k<<24|k>>>8,c[E]=k<<16|k>>>16,h[E]=k<<8|k>>>24,f[E]=k,m?(m=A^p[p[p[w^A]]],y^=p[p[y]]):m=y=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,s=0;for(;s<t.length&&i;)i=t[s]===this.key[s],s++;if(i)return;this.key=t;const n=this.keySize=t.length;if(n!==4&&n!==6&&n!==8)throw new Error("Invalid aes key size="+n);const a=this.ksRows=(n+6+1)*4;let o,l;const u=this.keySchedule=new Uint32Array(a),c=this.invKeySchedule=new Uint32Array(a),h=this.sBox,f=this.rcon,p=this.invSubMix,m=p[0],y=p[1],v=p[2],E=p[3];let A,x;for(o=0;o<a;o++){if(o<n){A=u[o]=t[o];continue}x=A,o%n===0?(x=x<<8|x>>>24,x=h[x>>>24]<<24|h[x>>>16&255]<<16|h[x>>>8&255]<<8|h[x&255],x^=f[o/n|0]<<24):n>6&&o%n===4&&(x=h[x>>>24]<<24|h[x>>>16&255]<<16|h[x>>>8&255]<<8|h[x&255]),u[o]=A=(u[o-n]^x)>>>0}for(l=0;l<a;l++)o=a-l,l&3?x=u[o]:x=u[o-4],l<4||o<=4?c[l]=x:c[l]=m[h[x>>>24]]^y[h[x>>>16&255]]^v[h[x>>>8&255]]^E[h[x&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const s=this.keySize+6,n=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],u=o[1],c=o[2],h=o[3],f=this.uint8ArrayToUint32Array_(i);let p=f[0],m=f[1],y=f[2],v=f[3];const E=new Int32Array(e),A=new Int32Array(E.length);let x,w,k,F,L,M,C,D,B,H,q,Y,Z,Q;const K=this.networkToHostOrderSwap;for(;t<E.length;){for(B=K(E[t]),H=K(E[t+1]),q=K(E[t+2]),Y=K(E[t+3]),L=B^n[0],M=Y^n[1],C=q^n[2],D=H^n[3],Z=4,Q=1;Q<s;Q++)x=l[L>>>24]^u[M>>16&255]^c[C>>8&255]^h[D&255]^n[Z],w=l[M>>>24]^u[C>>16&255]^c[D>>8&255]^h[L&255]^n[Z+1],k=l[C>>>24]^u[D>>16&255]^c[L>>8&255]^h[M&255]^n[Z+2],F=l[D>>>24]^u[L>>16&255]^c[M>>8&255]^h[C&255]^n[Z+3],L=x,M=w,C=k,D=F,Z=Z+4;x=a[L>>>24]<<24^a[M>>16&255]<<16^a[C>>8&255]<<8^a[D&255]^n[Z],w=a[M>>>24]<<24^a[C>>16&255]<<16^a[D>>8&255]<<8^a[L&255]^n[Z+1],k=a[C>>>24]<<24^a[D>>16&255]<<16^a[L>>8&255]<<8^a[M&255]^n[Z+2],F=a[D>>>24]<<24^a[L>>16&255]<<16^a[M>>8&255]<<8^a[C&255]^n[Z+3],A[t]=K(x^p),A[t+1]=K(F^m),A[t+2]=K(k^y),A[t+3]=K(w^v),p=B,m=H,y=q,v=Y,t=t+4}return A.buffer}}class KS{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=WS(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function WS(r){switch(r){case Rs.cbc:return"AES-CBC";case Rs.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${r}`)}}const zS=16;let Pc=class{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?qS(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,s){return this.useSoftware?new Promise((n,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,i,s);const l=this.flush();l?n(l.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,s)}softwareDecrypt(e,t,i,s){const{currentIV:n,currentResult:a,remainderData:o}=this;if(s!==Rs.cbc||t.byteLength!==16)return qe.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=pi(o,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;n&&(i=n);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new jS),u.expandKey(t);const c=a;return this.currentResult=u.decrypt(l.buffer,0,i),this.currentIV=l.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,i,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,s));this.key=t,this.fastAesKey=new KS(this.subtle,t,s)}return this.fastAesKey.expandKey().then(n=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new HS(this.subtle,new Uint8Array(i),s).decrypt(e.buffer,n)):Promise.reject(new Error("web crypto not initialized"))).catch(n=>(qe.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(e,t,i,s)))}onWebCryptoError(e,t,i,s){const n=this.enableSoftwareAES;if(n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,s);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(n?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%zS;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(qe.log(`[decrypter]: ${e}`),this.logEnabled=!1)}};const jd=Math.pow(2,17);class YS{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new as({type:Te.NETWORK_ERROR,details:ee.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,n=s.fLoader,a=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(m=>m[0]==="GAP")){l(Wd(e));return}else e.gap=!1;const u=this.loader=n?new n(s):new a(s),c=Kd(e);e.loader=u;const h=Hd(s.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:jd};e.stats=u.stats;const p={onSuccess:(m,y,v,E)=>{this.resetLoader(e,u);let A=m.data;v.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(A.slice(0,16)),A=A.slice(16)),o({frag:e,part:null,payload:A,networkDetails:E})},onError:(m,y,v,E)=>{this.resetLoader(e,u),l(new as({type:Te.NETWORK_ERROR,details:ee.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:He({url:i,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:v,stats:E}))},onAbort:(m,y,v)=>{this.resetLoader(e,u),l(new as({type:Te.NETWORK_ERROR,details:ee.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:v,stats:m}))},onTimeout:(m,y,v)=>{this.resetLoader(e,u),l(new as({type:Te.NETWORK_ERROR,details:ee.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:v,stats:m}))}};t&&(p.onProgress=(m,y,v,E)=>t({frag:e,part:null,payload:v,networkDetails:E})),u.load(c,f,p)})}loadPart(e,t,i){this.abort();const s=this.config,n=s.fLoader,a=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(Wd(e,t));return}const u=this.loader=n?new n(s):new a(s),c=Kd(e,t);e.loader=u;const h=Hd(s.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:jd};t.stats=u.stats,u.load(c,f,{onSuccess:(p,m,y,v)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const E={frag:e,part:t,payload:p.data,networkDetails:v};i(E),o(E)},onError:(p,m,y,v)=>{this.resetLoader(e,u),l(new as({type:Te.NETWORK_ERROR,details:ee.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:He({url:c.url,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:y,stats:v}))},onAbort:(p,m,y)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new as({type:Te.NETWORK_ERROR,details:ee.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:y,stats:p}))},onTimeout:(p,m,y)=>{this.resetLoader(e,u),l(new as({type:Te.NETWORK_ERROR,details:ee.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:y,stats:p}))}})})}updateStatsFromPart(e,t){const i=e.stats,s=t.stats,n=s.total;if(i.loaded+=s.loaded,n){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(i.loaded/n),l),h=(l-u)*Math.round(i.loaded/u);i.total=i.loaded+h}else i.total=Math.max(i.loaded,i.total);const a=i.loading,o=s.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Kd(r,e=null){const t=e||r,i={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,n=t.byteRangeEndOffset;if(pe(s)&&pe(n)){var a;let o=s,l=n;if(r.sn==="initSegment"&&XS((a=r.decryptdata)==null?void 0:a.method)){const u=n-s;u%16&&(l=n+(16-u%16)),s!==0&&(i.resetIV=!0,o=s-16)}i.rangeStart=o,i.rangeEnd=l}return i}function Wd(r,e){const t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),i={type:Te.MEDIA_ERROR,details:ee.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(i.part=e),(e||r).stats.aborted=!0,new as(i)}function XS(r){return r==="AES-128"||r==="AES-256"}class as extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Gg extends yi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Oc{constructor(e,t,i,s=0,n=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Ma(),this.buffering={audio:Ma(),video:Ma(),audiovideo:Ma()},this.level=e,this.sn=t,this.id=i,this.size=s,this.part=n,this.partial=a}}function Ma(){return{start:0,executeStart:0,executeEnd:0,end:0}}const zd={length:0,start:()=>0,end:()=>0};class Ie{static isBuffered(e,t){if(e){const i=Ie.getBuffered(e);for(let s=i.length;s--;)if(t>=i.start(s)&&t<=i.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=Ie.getBuffered(e);return Ie.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const s=Ie.bufferedRanges(e);if(s.length)return Ie.bufferedInfo(s,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((c,h)=>c.start-h.start||h.end-c.end);let s=-1,n=[];if(i)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(s=c);const h=n.length;if(h){const f=n[h-1].end;e[c].start-f<i?e[c].end>f&&(n[h-1].end=e[c].end):n.push(e[c])}else n.push(e[c])}else n=e;let a=0,o,l=t,u=t;for(let c=0;c<n.length;c++){const h=n[c].start,f=n[c].end;if(s===-1&&t>=h&&t<=f&&(s=c),t+i>=h&&t<f)l=h,u=f,a=u-t;else if(t+i<h){o=h;break}}return{len:a,start:l||0,end:u||0,nextStart:o,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||zd}catch(t){return qe.log("failed to get media.buffered",t),zd}}}const Hg=/\{\$([a-zA-Z0-9-_]+)\}/g;function Yd(r){return Hg.test(r)}function $u(r,e){if(r.variableList!==null||r.hasVariableRefs){const t=r.variableList;return e.replace(Hg,i=>{const s=i.substring(2,i.length-1),n=t?.[s];return n===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),i):n})}return e}function Xd(r,e,t){let i=r.variableList;i||(r.variableList=i={});let s,n;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(s))n=a.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(a){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else s=e.NAME,n=e.VALUE;s in i?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):i[s]=n||""}function QS(r,e,t){const i=e.IMPORT;if(t&&i in t){let s=r.variableList;s||(r.variableList=s={}),s[i]=t[i]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const JS=/^(\d+)x(\d+)$/,Qd=/(.+?)=(".*?"|.*?)(?:,|$)/g;class at{constructor(e,t){typeof e=="string"&&(e=at.parseAttrList(e,t)),Ke(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)i[s]=parseInt(t.slice(s*2,s*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((s,n)=>(s[n.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=JS.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const s={};for(Qd.lastIndex=0;(i=Qd.exec(e))!==null;){const a=i[1].trim();let o=i[2];const l=o.indexOf('"')===0&&o.lastIndexOf('"')===o.length-1;let u=!1;if(l)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))o=$u(t,o);else if(!u&&!l)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":qe.warn(`${e}: attribute ${a} is missing quotes`)}s[a]=o}return s}}const ZS="com.apple.hls.interstitial";function eE(r){return r!=="ID"&&r!=="CLASS"&&r!=="CUE"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function tE(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"||r==="SCTE35-CMD"}class qg{constructor(e,t,i=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(s=t?.tagOrder)!=null?s:i,t){const n=t.attr;for(const a in n)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==n[a]){qe.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=Ke(new at({}),n,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const n=t?.endDate||new Date(this.attr["END-DATE"]);pe(n.getTime())&&(this._endDate=n)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(qe.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(pe(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===ZS}get isValid(){return!!this.id&&!this._badValueForSameId&&pe(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const iE=10;class sE{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let i=t.decryptdata;return i||(t.setKeyFormat(e.keyFormat),i=t.decryptdata),!!i&&e.matches(i)})}get hasProgramDateTime(){return this.fragments.length?pe(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||iE}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function To(r,e){return r.length===e.length?!r.some((t,i)=>t!==e[i]):!1}function Jd(r,e){return!r&&!e?!0:!r||!e?!1:To(r,e)}function br(r){return r==="AES-128"||r==="AES-256"||r==="AES-256-CTR"}function Mc(r){switch(r){case"AES-128":case"AES-256":return Rs.cbc;case"AES-256-CTR":return Rs.ctr;default:throw new Error(`invalid full segment method ${r}`)}}function Fc(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function Vu(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}function rE(r){const e=Vu(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function jg(r){const e=function(i,s,n){const a=i[s];i[s]=i[n],i[n]=a};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function Kg(r){const e=r.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),s=i[i.length-1].split(",");if(s.length===2){const n=s[0]==="base64",a=s[1];n?(i.splice(-1,1),t=Fc(a)):t=rE(a)}}return t}const _o=typeof self<"u"?self:void 0;var ot={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Rt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function io(r){switch(r){case Rt.FAIRPLAY:return ot.FAIRPLAY;case Rt.PLAYREADY:return ot.PLAYREADY;case Rt.WIDEVINE:return ot.WIDEVINE;case Rt.CLEARKEY:return ot.CLEARKEY}}function Ol(r){switch(r){case ot.FAIRPLAY:return Rt.FAIRPLAY;case ot.PLAYREADY:return Rt.PLAYREADY;case ot.WIDEVINE:return Rt.WIDEVINE;case ot.CLEARKEY:return Rt.CLEARKEY}}function An(r){const{drmSystems:e,widevineLicenseUrl:t}=r,i=e?[ot.FAIRPLAY,ot.WIDEVINE,ot.PLAYREADY,ot.CLEARKEY].filter(s=>!!e[s]):[];return!i[ot.WIDEVINE]&&t&&i.push(ot.WIDEVINE),i}const Wg=(function(r){return _o!=null&&(r=_o.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function nE(r,e,t,i){let s;switch(r){case ot.FAIRPLAY:s=["cenc","sinf"];break;case ot.WIDEVINE:case ot.PLAYREADY:s=["cenc"];break;case ot.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return aE(s,e,t,i)}function aE(r,e,t,i){return[{initDataTypes:r,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(n=>({contentType:`audio/mp4; codecs=${n}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(n=>({contentType:`video/mp4; codecs=${n}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function oE(r){var e;return!!r&&(r.sessionType==="persistent-license"||!!((e=r.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function zg(r){const e=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const l=Fc(o).subarray(0,16);return jg(l),l}}return null}let cr={};class Ds{static clearKeyUriToKeyIdMap(){cr={}}static setKeyIdForUri(e,t){cr[e]=t}static addKeyIdForUri(e){const t=Object.keys(cr).length%Number.MAX_SAFE_INTEGER,i=new Uint8Array(16);return new DataView(i.buffer,12,4).setUint32(0,t),cr[e]=i,i}constructor(e,t,i,s=[1],n=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=s,this.iv=n,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!br(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(Eg(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&To(e.keyFormatVersions,this.keyFormatVersions)&&Jd(e.iv,this.iv)&&Jd(e.keyId,this.keyId)}isSupported(){if(this.method){if(br(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Rt.FAIRPLAY:case Rt.WIDEVINE:case Rt.PLAYREADY:case Rt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(br(this.method)){let n=this.iv;return n||(typeof e!="number"&&(qe.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),n=uE(e)),new Ds(this.method,this.uri,"identity",this.keyFormatVersions,n)}if(this.keyId){const n=cr[this.uri];if(n&&!To(this.keyId,n)&&Ds.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const i=Kg(this.uri);if(i)switch(this.keyFormat){case Rt.WIDEVINE:if(this.pssh=i,!this.keyId){const n=dS(i.buffer);if(n.length){var s;const a=n[0];this.keyId=(s=a.kids)!=null&&s.length?a.kids[0]:null}}this.keyId||(this.keyId=Zd(t));break;case Rt.PLAYREADY:{const n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=hS(n,null,i),this.keyId=zg(i);break}default:{let n=i.subarray(0,16);if(n.length!==16){const a=new Uint8Array(16);a.set(n,16-n.length),n=a}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n;n=lE(t),n||(n=Zd(t),n||(n=cr[this.uri])),n&&(this.keyId=n,Ds.setKeyIdForUri(this.uri,n))}return this}}function lE(r){const e=r?.[Rt.WIDEVINE];return e?e.keyId:null}function Zd(r){const e=r?.[Rt.PLAYREADY];if(e){const t=Kg(e.uri);if(t)return zg(t)}return null}function uE(r){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}const ef=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,tf=/#EXT-X-MEDIA:(.*)/g,cE=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ml=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),hE=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Hi{static findGroup(e,t){for(let i=0;i<e.length;i++){const s=e[i];if(s.id===t)return s}}static resolve(e,t){return Ic.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return cE.test(e)}static parseMasterPlaylist(e,t){const i=Yd(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},n=[];if(ef.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let a;for(;(a=ef.exec(e))!=null;)if(a[1]){var o;const u=new at(a[1],s),c=$u(s,a[2]),h={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:Hi.resolve(c,t)},f=u.decimalResolution("RESOLUTION");f&&(h.width=f.width,h.height=f.height),nf(u.CODECS,h);const p=u["SUPPLEMENTAL-CODECS"];p&&(h.supplemental={},nf(p,h.supplemental)),(o=h.unknownCodecs)!=null&&o.length||n.push(h),s.levels.push(h)}else if(a[3]){const u=a[3],c=a[4];switch(u){case"SESSION-DATA":{const h=new at(c,s),f=h["DATA-ID"];f&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[f]=h);break}case"SESSION-KEY":{const h=sf(c,t,s);h.encrypted&&h.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(h)):qe.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const h=new at(c,s);Xd(s,h,t)}break}case"CONTENT-STEERING":{const h=new at(c,s);s.contentSteering={uri:Hi.resolve(h["SERVER-URI"],t),pathwayId:h["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=rf(c);break}}}const l=n.length>0&&n.length<s.levels.length;return s.levels=l?n:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,i){let s;const n={},a=i.levels,o={AUDIO:a.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:a.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(tf.lastIndex=0;(s=tf.exec(e))!==null;){const u=new at(s[1],i),c=u.TYPE;if(c){const h=o[c],f=n[c]||[];n[c]=f;const p=u.LANGUAGE,m=u["ASSOC-LANGUAGE"],y=u.CHANNELS,v=u.CHARACTERISTICS,E=u["INSTREAM-ID"],A={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||p||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:p,url:u.URI?Hi.resolve(u.URI,t):""};if(m&&(A.assocLang=m),y&&(A.channels=y),v&&(A.characteristics=v),E&&(A.instreamId=E),h!=null&&h.length){const x=Hi.findGroup(h,A.groupId)||h[0];af(A,x,"audioCodec"),af(A,x,"textCodec")}f.push(A)}}return n}static parseLevelPlaylist(e,t,i,s,n,a){var o;const l={url:t},u=new sE(t),c=u.fragments,h=[];let f=null,p=0,m=0,y=0,v=0,E=0,A=null,x=new wl(s,l),w,k,F,L=-1,M=!1,C=null,D;if(Ml.lastIndex=0,u.m3u8=e,u.hasVariableRefs=Yd(e),((o=Ml.exec(e))==null?void 0:o[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(w=Ml.exec(e))!==null;){M&&(M=!1,x=new wl(s,l),x.playlistOffset=y,x.setStart(y),x.sn=p,x.cc=v,E&&(x.bitrate=E),x.level=i,f&&(x.initSegment=f,f.rawProgramDateTime&&(x.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),C&&(x.setByteRange(C),C=null)));const Y=w[1];if(Y){x.duration=parseFloat(Y);const Z=(" "+w[2]).slice(1);x.title=Z||null,x.tagList.push(Z?["INF",Y,Z]:["INF",Y])}else if(w[3]){if(pe(x.duration)){x.playlistOffset=y,x.setStart(y),F&&lf(x,F,u),x.sn=p,x.level=i,x.cc=v,c.push(x);const Z=(" "+w[3]).slice(1);x.relurl=$u(u,Z),Gu(x,A,h),A=x,y+=x.duration,p++,m=0,M=!0}}else{if(w=w[0].match(hE),!w){qe.warn("No matches on slow regex match for level playlist!");continue}for(k=1;k<w.length&&w[k]===void 0;k++);const Z=(" "+w[k]).slice(1),Q=(" "+w[k+1]).slice(1),K=w[k+2]?(" "+w[k+2]).slice(1):null;switch(Z){case"BYTERANGE":A?x.setByteRange(Q,A):x.setByteRange(Q);break;case"PROGRAM-DATE-TIME":x.rawProgramDateTime=Q,x.tagList.push(["PROGRAM-DATE-TIME",Q]),L===-1&&(L=c.length);break;case"PLAYLIST-TYPE":u.type&&is(u,Z,w),u.type=Q.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?is(u,Z,w):c.length>0&&uf(u,Z,w),p=u.startSN=parseInt(Q);break;case"SKIP":{u.skippedSegments&&is(u,Z,w);const z=new at(Q,u),X=z.decimalInteger("SKIPPED-SEGMENTS");if(pe(X)){u.skippedSegments+=X;for(let W=X;W--;)c.push(null);p+=X}const ie=z.enumeratedString("RECENTLY-REMOVED-DATERANGES");ie&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(ie.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&is(u,Z,w),u.targetduration=Math.max(parseInt(Q),1);break;case"VERSION":u.version!==null&&is(u,Z,w),u.version=parseInt(Q);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||is(u,Z,w),u.live=!1;break;case"#":(Q||K)&&x.tagList.push(K?[Q,K]:[Q]);break;case"DISCONTINUITY":v++,x.tagList.push(["DIS"]);break;case"GAP":x.gap=!0,x.tagList.push([Z]);break;case"BITRATE":x.tagList.push([Z,Q]),E=parseInt(Q)*1e3,pe(E)?x.bitrate=E:E=0;break;case"DATERANGE":{const z=new at(Q,u),X=new qg(z,u.dateRanges[z.ID],u.dateRangeTagCount);u.dateRangeTagCount++,X.isValid||u.skippedSegments?u.dateRanges[X.id]=X:qe.warn(`Ignoring invalid DATERANGE tag: "${Q}"`),x.tagList.push(["EXT-X-DATERANGE",Q]);break}case"DEFINE":{{const z=new at(Q,u);"IMPORT"in z?QS(u,z,a):Xd(u,z,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?is(u,Z,w):c.length>0&&uf(u,Z,w),u.startCC=v=parseInt(Q);break;case"KEY":{const z=sf(Q,t,u);if(z.isSupported()){if(z.method==="NONE"){F=void 0;break}F||(F={});const X=F[z.keyFormat];X!=null&&X.matches(z)||(X&&(F=Ke({},F)),F[z.keyFormat]=z)}else qe.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${Q}"`);break}case"START":u.startTimeOffset=rf(Q);break;case"MAP":{const z=new at(Q,u);if(x.duration){const X=new wl(s,l);of(X,z,i,F),f=X,x.initSegment=f,f.rawProgramDateTime&&!x.rawProgramDateTime&&(x.rawProgramDateTime=f.rawProgramDateTime)}else{const X=x.byteRangeEndOffset;if(X){const ie=x.byteRangeStartOffset;C=`${X-ie}@${ie}`}else C=null;of(x,z,i,F),f=x,M=!0}f.cc=v;break}case"SERVER-CONTROL":{D&&is(u,Z,w),D=new at(Q),u.canBlockReload=D.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=D.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&D.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=D.optionalFloat("PART-HOLD-BACK",0),u.holdBack=D.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&is(u,Z,w);const z=new at(Q);u.partTarget=z.decimalFloatingPoint("PART-TARGET");break}case"PART":{let z=u.partList;z||(z=u.partList=[]);const X=m>0?z[z.length-1]:void 0,ie=m++,W=new at(Q,u),ae=new Qv(W,x,l,ie,X);z.push(ae),x.duration+=ae.duration;break}case"PRELOAD-HINT":{const z=new at(Q,u);u.preloadHint=z;break}case"RENDITION-REPORT":{const z=new at(Q,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(z);break}default:qe.warn(`line parsed but not handled: ${w}`);break}}}A&&!A.relurl?(c.pop(),y-=A.duration,u.partList&&(u.fragmentHint=A)):u.partList&&(Gu(x,A,h),x.cc=v,u.fragmentHint=x,F&&lf(x,F,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const B=c.length,H=c[0],q=c[B-1];if(y+=u.skippedSegments*u.targetduration,y>0&&B&&q){u.averagetargetduration=y/B;const Y=q.sn;u.endSN=Y!=="initSegment"?Y:0,u.live||(q.endList=!0),L>0&&(fE(c,L),H&&h.unshift(H))}return u.fragmentHint&&(y+=u.fragmentHint.duration),u.totalduration=y,h.length&&u.dateRangeTagCount&&H&&Yg(h,u),u.endCC=v,u}}function Yg(r,e){let t=r.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];r.push(o),t++}else return;const i=r[t-1],s=e.live?1/0:e.totalduration,n=Object.keys(e.dateRanges);for(let o=n.length;o--;){const l=e.dateRanges[n[o]],u=l.startDate.getTime();l.tagAnchor=i.ref;for(let c=t;c--;){var a;if(((a=r[c])==null?void 0:a.sn)<e.startSN)break;const h=dE(e,u,r,c,s);if(h!==-1){l.tagAnchor=e.fragments[h].ref;break}}}}function dE(r,e,t,i,s){const n=t[i];if(n){const o=n.programDateTime;if(e>=o||i===0){var a;const l=(((a=t[i+1])==null?void 0:a.start)||s)-n.start;if(e<=o+l*1e3){const u=t[i].sn-r.startSN;if(u<0)return-1;const c=r.fragments;if(c.length>t.length){const f=(t[i+1]||c[c.length-1]).sn-r.startSN;for(let p=f;p>u;p--){const m=c[p].programDateTime;if(e>=m&&e<m+c[p].duration*1e3)return p}}return u}}}return-1}function sf(r,e,t){var i,s;const n=new at(r,t),a=(i=n.METHOD)!=null?i:"",o=n.URI,l=n.hexadecimalInteger("IV"),u=n.KEYFORMATVERSIONS,c=(s=n.KEYFORMAT)!=null?s:"identity";o&&n.IV&&!l&&qe.error(`Invalid IV: ${n.IV}`);const h=o?Hi.resolve(o,e):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Ds(a,h,c,f,l,n.KEYID)}function rf(r){const t=new at(r).decimalFloatingPoint("TIME-OFFSET");return pe(t)?t:null}function nf(r,e){let t=(r||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const s=t.filter(n=>Rc(n,i));s.length&&(e[`${i}Codec`]=s.map(n=>n.split("/")[0]).join(","),t=t.filter(n=>s.indexOf(n)===-1))}),e.unknownCodecs=t}function af(r,e,t){const i=e[t];i&&(r[t]=i)}function fE(r,e){let t=r[e];for(let i=e;i--;){const s=r[i];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function Gu(r,e,t){r.rawProgramDateTime?t.push(r):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime)}function of(r,e,t,i){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",i&&(r.levelkeys=i),r.initSegment=null}function lf(r,e,t){r.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&i.push(r)}function is(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function uf(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Fl(r,e){const t=e.startPTS;if(pe(t)){let i=0,s;e.sn>r.sn?(i=t-r.start,s=r):(i=r.start-t,s=e),s.duration!==i&&s.setDuration(i)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.setStart(r.start+(r.minEndPTS-r.start)):e.setStart(r.start+r.duration):e.setStart(Math.max(r.start-e.duration,0))}function Xg(r,e,t,i,s,n,a){i-t<=0&&(a.warn("Fragment should have a positive duration",e),i=t+e.duration,n=s+e.duration);let l=t,u=i;const c=e.startPTS,h=e.endPTS;if(pe(c)){const E=Math.abs(c-t);r&&E>r.totalduration?a.warn(`media timestamps and playlist times differ by ${E}s for level ${e.level} ${r.url}`):pe(e.deltaPTS)?e.deltaPTS=Math.max(E,e.deltaPTS):e.deltaPTS=E,l=Math.max(t,c),t=Math.min(t,c),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,u=Math.min(i,h),i=Math.max(i,h),n=e.endDTS!==void 0?Math.max(n,e.endDTS):n}const f=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=s,e.endPTS=i,e.minEndPTS=u,e.endDTS=n;const p=e.sn;if(!r||p<r.startSN||p>r.endSN)return 0;let m;const y=p-r.startSN,v=r.fragments;for(v[y]=e,m=y;m>0;m--)Fl(v[m],v[m-1]);for(m=y;m<v.length-1;m++)Fl(v[m],v[m+1]);return r.fragmentHint&&Fl(v[v.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,f}function pE(r,e,t){if(r===e)return;let i=null;const s=r.fragments;for(let c=s.length-1;c>=0;c--){const h=s[c].initSegment;if(h){i=h;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let n;yE(r,e,(c,h,f,p)=>{if((!e.startCC||e.skippedSegments)&&h.cc!==c.cc){const m=c.cc-h.cc;for(let y=f;y<p.length;y++)p[y].cc+=m;e.endCC=p[p.length-1].cc}pe(c.startPTS)&&pe(c.endPTS)&&(h.setStart(h.startPTS=c.startPTS),h.startDTS=c.startDTS,h.maxStartPTS=c.maxStartPTS,h.endPTS=c.endPTS,h.endDTS=c.endDTS,h.minEndPTS=c.minEndPTS,h.setDuration(c.endPTS-c.startPTS),h.duration&&(n=h),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(h.elementaryStreams=c.elementaryStreams),h.loader=c.loader,c.hasStats&&(h.stats=c.stats),c.initSegment&&(h.initSegment=c.initSegment,i=c.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(i&&o.forEach(c=>{var h;c&&(!c.initSegment||c.initSegment.relurl===((h=i)==null?void 0:h.relurl))&&(c.initSegment=i)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(c=>!c),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=gE(r.dateRanges,e,t));const c=r.fragments.filter(h=>h.rawProgramDateTime);if(r.hasProgramDateTime&&!e.hasProgramDateTime)for(let h=1;h<o.length;h++)o[h].programDateTime===null&&Gu(o[h],o[h-1],c);Yg(c,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var l;const c=Zg(r,e.startSN-1);e.startCC=(l=c?.cc)!=null?l:a[0].cc}mE(r.partList,e.partList,(c,h)=>{h.elementaryStreams=c.elementaryStreams,h.stats=c.stats}),n?Xg(e,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS,t):Qg(r,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const c=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=c),e.driftEndTime=u,e.driftEnd=c}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=r.requestScheduled)}function gE(r,e,t){const{dateRanges:i,recentlyRemovedDateranges:s}=e,n=Ke({},r);s&&s.forEach(l=>{delete n[l]});const o=Object.keys(n).length;return o?(Object.keys(i).forEach(l=>{const u=n[l],c=new qg(i[l].attr,u);c.isValid?(n[l]=c,u||(c.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ye(i[l].attr)}"`)}),n):i}function mE(r,e,t){if(r&&e){let i=0;for(let s=0,n=r.length;s<=n;s++){const a=r[s],o=e[s+i];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):i--}}}function yE(r,e,t){const i=e.skippedSegments,s=Math.max(r.startSN,e.startSN)-e.startSN,n=(r.fragmentHint?1:0)+(i?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,a=e.startSN-r.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let u=s;u<=n;u++){const c=l[a+u];let h=o[u];if(i&&!h&&c&&(h=e.fragments[u]=c),c&&h){t(c,h,u,o);const f=c.relurl,p=h.relurl;if(f&&TE(f,p)){e.playlistParsingError=cf(`media sequence mismatch ${h.sn}:`,r,e,c,h);return}else if(c.cc!==h.cc){e.playlistParsingError=cf(`discontinuity sequence mismatch (${c.cc}!=${h.cc})`,r,e,c,h);return}}}}function cf(r,e,t,i,s){return new Error(`${r} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Qg(r,e,t=!0){const i=e.startSN+e.skippedSegments-r.startSN,s=r.fragments,n=i>=0;let a=0;if(n&&i<s.length)a=s[i].start;else if(n&&e.startSN===r.endSN+1)a=r.fragmentEnd;else if(n&&t)a=r.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=r.fragmentStart;else return;Hu(e,a)}function Hu(r,e){if(e){const t=r.fragments;for(let i=r.skippedSegments;i<t.length;i++)t[i].addStart(e);r.fragmentHint&&r.fragmentHint.addStart(e)}}function Jg(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){const i=r.fragments;if(i.length&&t*4>e){const n=i[i.length-1].duration*1e3;n<t&&(t=n)}}else t/=2;return Math.round(t)}function Zg(r,e,t){if(!r)return null;let i=r.fragments[e-r.startSN];return i||(i=r.fragmentHint,i&&i.sn===e)?i:e<r.startSN&&t&&t.sn===e?t:null}function hf(r,e,t){return r?em(r.partList,e,t):null}function em(r,e,t){if(r)for(let i=r.length;i--;){const s=r[i];if(s.index===t&&s.fragment.sn===e)return s}return null}function tm(r){r.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function TE(r,e){return r!==e&&e?df(r)!==df(e):!1}function df(r){return r.replace(/\?[^?]*$/,"")}function Ln(r,e){for(let i=0,s=r.length;i<s;i++){var t;if(((t=r[i])==null?void 0:t.cc)===e)return r[i]}return null}function _E(r,e){return!!(r&&e.startCC<r.endCC&&e.endCC>r.startCC)}function ff(r,e){const t=r.start+e;r.startPTS=t,r.setStart(t),r.endPTS=t+r.duration}function im(r,e){const t=e.fragments;for(let i=0,s=t.length;i<s;i++)ff(t[i],r);e.fragmentHint&&ff(e.fragmentHint,r),e.alignedSliding=!0}function vE(r,e){r&&(sm(e,r),e.alignedSliding||vo(e,r),!e.alignedSliding&&!e.skippedSegments&&Qg(r,e,!1))}function sm(r,e){if(!_E(e,r))return;const t=Math.min(e.endCC,r.endCC),i=Ln(e.fragments,t),s=Ln(r.fragments,t);if(!i||!s)return;qe.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const n=i.start-s.start;im(n,r)}function vo(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;const t=r.fragments,i=e.fragments;if(!t.length||!i.length)return;let s,n;const a=Math.min(e.endCC,r.endCC);e.startCC<a&&r.startCC<a&&(s=Ln(i,a),n=Ln(t,a)),(!s||!n)&&(s=i[Math.floor(i.length/2)],n=Ln(t,s.cc)||t[Math.floor(t.length/2)]);const o=s.programDateTime,l=n.programDateTime;if(!o||!l)return;const u=(l-o)/1e3-(n.start-s.start);im(u,r)}function $t(r,e,t){Kt(r,e,t),r.addEventListener(e,t)}function Kt(r,e,t){r.removeEventListener(e,t)}const SE={toString:function(r){let e="";const t=r.length;for(let i=0;i<t;i++)e+=`[${r.start(i).toFixed(3)}-${r.end(i).toFixed(3)}]`;return e}},le={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Nc extends Gg{constructor(e,t,i,s,n){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=le.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:l,mediaBuffer:u,state:c}=this,h=l?l.currentTime:0,f=Ie.bufferInfo(u||l,h,a.maxBufferHole),p=!f.len;if(this.log(`Media seeking to ${pe(h)?h.toFixed(3):h}, state: ${c}, ${p?"out of":"in"} buffer`),this.state===le.ENDED)this.resetLoadingState();else if(o){const m=a.maxFragLookUpTolerance,y=o.start-m,v=o.start+o.duration+m;if(p||v<f.start||y>f.end){const E=h>v;(h<y||E)&&(E&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(h,1/0,this.playlistType,!0);const m=this.lastCurrentTime;if(h>m&&(this.lastCurrentTime=h),!this.loadingParts){const y=Math.max(f.end,h),v=this.shouldLoadParts(this.getLevelDetails(),y);v&&(this.log(`LL-Part loading ON after seeking to ${h.toFixed(2)} with buffer @${y.toFixed(2)}`),this.loadingParts=v)}}this.hls.hasEnoughToStart||(this.log(`Setting ${p?"startPosition":"nextLoadPosition"} to ${h} for seek without enough to start`),this.nextLoadPosition=h,p&&(this.startPosition=h)),p&&this.state===le.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=n,this.hls=e,this.fragmentLoader=new YS(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Pc(e.config)}registerListeners(){const{hls:e}=this;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===le.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=le.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,s=this.config.timelineOffset||0;if(i<=s)return!1;const n=e.buffered;this.config.maxBufferHole&&n&&n.length>1&&(e=Ie.bufferedInfo(n,e.start,0));const a=e.nextStart;if(a&&a>s&&a<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const c=l[l.length-1];return Ie.isBuffered(this.media,c.start+c.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;$t(i,"seeking",this.onMediaSeeking),$t(i,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===le.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Kt(s,"seeking",this.onMediaSeeking),Kt(s,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=le.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const s=n=>{const a=n.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${n.part?" part: "+n.part.index:""} of ${this.fragInfo(a,!1,n.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(n)};this._doFragLoad(e,t,i,s).then(n=>{if(!n)return;const a=this.state,o=n.frag;if(this.fragContextChanged(o)){(a===le.FRAG_LOADING||!this.fragCurrent&&a===le.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=le.IDLE);return}"payload"in n&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(I.FRAG_LOADED,n)),this._handleFragmentLoadComplete(n)}).catch(n=>{this.state===le.STOPPED||this.state===le.ERROR||(this.warn(`Frag error: ${n?.message||n}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===vt.APPENDING){const n=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,n),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===vt.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:i};this.hls.trigger(I.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const s=i?.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:s}=this,{frag:n,payload:a}=i,o=n.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&br(o.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,Mc(o.method)).catch(u=>{throw s.trigger(I.ERROR,{type:Te.MEDIA_ERROR,details:ee.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:n}),u}).then(u=>{const c=self.performance.now();return s.trigger(I.FRAG_DECRYPTED,{frag:n,payload:u,stats:{tstart:l,tdecrypt:c}}),i.payload=u,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===le.STOPPED||this.state===le.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==le.STOPPED&&(this.state=le.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var i,s;const n=e.tracks;if(n&&!t.encrypted&&((i=n.audio)!=null&&i.encrypted||(s=n.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(I.ERROR,{type:Te.KEY_SYSTEM_ERROR,details:ee.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?SE.toString(Ie.getBuffered(i)):"(detached)"})`),gt(e)){var s;if(e.type!==ye.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=le.IDLE;return}}const n=(s=this.levels)==null?void 0:s[e.level];n!=null&&n.fragmentError&&(this.log(`Resetting level fragment error count of ${n.fragmentError} on frag buffered`),n.fragmentError=0)}this.state=le.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:s,partsLoaded:n}=e,a=!n||n.length===0||n.some(l=>!l),o=new Oc(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,s){var n;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((n=e.decryptdata)!=null&&n.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=le.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(I.KEY_LOADED,f),this.state===le.KEY_LOADING&&(this.state=le.IDLE),f}),this.hls.trigger(I.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(gt(e)&&(!l||e.sn!==l.sn)){const f=this.shouldLoadParts(t.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${l?.sn}->${e.sn}`),this.loadingParts=f)}if(i=Math.max(e.start,i||0),this.loadingParts&&gt(e)){const f=a.partList;if(f&&s){i>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const p=this.getNextPart(f,e,i);if(p>-1){const m=f[p];e=this.fragCurrent=m.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${m.index} (${p}/${f.length-1}) of ${this.fragInfo(e,!1,m)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=m.start+m.duration,this.state=le.FRAG_LOADING;let y;return o?y=o.then(v=>!v||this.fragContextChanged(v.frag)?null:this.doFragPartsLoad(e,m,t,s)).catch(v=>this.handleFragLoadError(v)):y=this.doFragPartsLoad(e,m,t,s).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(I.FRAG_LOADING,{frag:e,part:m,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):y}else if(!e.url||this.loadedEndOfParts(f,i))return Promise.resolve(null)}}if(gt(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=a.partList)==null?void 0:u.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),pe(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=le.FRAG_LOADING;const c=this.config.progressive&&e.type!==ye.SUBTITLE;let h;return c&&o?h=o.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(e,s)).catch(f=>this.handleFragLoadError(f)):h=Promise.all([this.fragmentLoader.load(e,c?s:void 0),o]).then(([f])=>(!c&&s&&s(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(I.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}doFragPartsLoad(e,t,i,s){return new Promise((n,a)=>{var o;const l=[],u=(o=i.details)==null?void 0:o.partList,c=h=>{this.fragmentLoader.loadPart(e,h,s).then(f=>{l[h.index]=f;const p=f.part;this.hls.trigger(I.FRAG_LOADED,f);const m=hf(i.details,e.sn,h.index+1)||em(u,e.sn,h.index+1);if(m)c(m);else return n({frag:e,part:p,partsLoaded:l})}).catch(a)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===ee.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Te.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(I.ERROR,t)}else this.hls.trigger(I.ERROR,{type:Te.OTHER_ERROR,details:ee.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==le.PARSING){!this.fragCurrent&&this.state!==le.STOPPED&&this.state!==le.ERROR&&(this.state=le.IDLE);return}const{frag:i,part:s,level:n}=t,a=self.performance.now();i.stats.parsing.end=a,s&&(s.stats.parsing.end=a);const o=this.getLevelDetails(),u=o&&i.sn>o.endSN||this.shouldLoadParts(o,i.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(i,s,n,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i;const n=e.partList[0];if(n.fragment.type===ye.SUBTITLE)return!1;const a=n.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=a){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>n.start-n.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:s,sn:n,part:a}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${n} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const o=t[s],l=o.details,u=a>-1?hf(l,n,a):null,c=u?u.fragment:Zg(l,n,i);return c?(i&&i!==c&&(c.stats=i.stats),{frag:c,part:u,level:o}):null}bufferFragmentData(e,t,i,s,n){if(this.state!==le.PARSING)return;const{data1:a,data2:o}=e;let l=a;if(o&&(l=pi(a,o)),!l.length)return;const u=this.initPTS[t.cc],c=u?-u.baseTime/u.timescale:void 0,h={type:e.type,frag:t,part:i,chunkMeta:s,offset:c,parent:t.type,data:l};if(this.hls.trigger(I.BUFFER_APPENDING,h),e.dropped&&e.independent&&!i){if(n)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ie.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,s=Ie.bufferInfo(t,i,0),n=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,n*.25),o=Math.max(Math.min(e.start-a,s.end-a),i+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var i;const s=this.getLoadPosition();if(!pe(s))return null;const a=this.lastCurrentTime>s||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,a)}getFwdBufferInfoAtPos(e,t,i,s){const n=Ie.bufferInfo(e,t,s);if(n.len===0&&n.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,i);if(a&&(n.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(n.nextStart,a.end)-t,s);return Ie.bufferInfo(e,t,o)}}return n}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,s=Math.max(Math.min(e-t,i.maxBufferLength),t),n=Math.max(e-t*3,i.maxMaxBufferLength/2,s);return n>=s?(i.maxMaxBufferLength=n,this.warn(`Reduce max buffer length to ${n}s`),!0):!1}getAppendedFrag(e,t=ye.MAIN){const i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,s=i.length;if(!s)return null;const{config:n}=this,a=i[0].start,o=n.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const h=n.initialLiveManifestSize;if(s<h)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${h})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var u;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const f=this.hls.startPosition,p=this.hls.liveSyncPosition,m=l?(f!==-1&&f>=a?f:p)||l.start:e;this.log(`Setting startPosition to ${m} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${p} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=m}}else e<=a&&(l=i[0]);if(!l){const h=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,h,t)}let c=this.filterReplacedPrimary(l,t);if(!c&&l){const h=l.sn-t.startSN;c=this.filterReplacedPrimary(i[h+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===vt.OK||i===vt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,s,n){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&i.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s,0);if(o!==null&&i.len+o.len>=n){const l=a.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(pf(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(pf(this.config)&&e.type!==ye.SUBTITLE){const i=this.hls.interstitialsManager,s=i?.bufferingItem;if(s){const a=s.event;if(a){if(a.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&t?.live===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const n=i?.playerQueue;if(n)for(let a=n.length;a--;){const o=n[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let s=-1,n=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const u=e[o];if(a=a&&!u.independent,s>-1&&i<u.start)break;const c=u.loaded;c?s=-1:(n||(u.independent||a)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${u.start}`),s=o),n=c}return s}loadedEndOfParts(e,t){let i;for(let s=e.length;s--;){if(i=e[s],!i.loaded)return!1;if(t>i.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,i=this.fragPrevious;let s=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),s=NS(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const n=i.sn+1;if(n>=e.startSN&&n<=e.endSN){const a=t[n-e.startSN];i.cc===a.cc&&(s=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=Ug(e,i.cc,i.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const n=this.hls.liveSyncPosition;n!==null&&(s=this.getFragmentAtPosition(n,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,i){const{config:s}=this;let{fragPrevious:n}=this,{fragments:a,endSN:o}=i;const{fragmentHint:l}=i,{maxFragLookUpTolerance:u}=s,c=i.partList,h=!!(this.loadingParts&&c!=null&&c.length&&l);h&&!this.bitrateTest&&c[c.length-1].fragment.sn===l.sn&&(a=a.concat(l),o=l.sn);let f;if(e<t){var p;const y=e<this.lastCurrentTime||e>t-u||(p=this.media)!=null&&p.paused||!this.startFragRequested?0:u;f=tr(n,a,e,y)}else f=a[a.length-1];if(f){const m=f.sn-i.startSN,y=this.fragmentTracker.getState(f);if((y===vt.OK||y===vt.PARTIAL&&f.gap)&&(n=f),n&&f.sn===n.sn&&(!h||c[0].fragment.sn>f.sn||!i.live)&&f.level===n.level){const E=a[m+1];f.sn<o&&this.fragmentTracker.getState(E)!==vt.OK?f=E:f=null}}return f}alignPlaylists(e,t,i){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const n=e.fragmentStart,a=!t,o=e.alignedSliding&&pe(n);if(a||!o&&!n){vE(i,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),l}return n}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const s=this.timelineOffset;if(i===-1){const n=this.startTimeOffset!==null,a=n?this.startTimeOffset:e.startTimeOffset;a!==null&&pe(a)?(i=t+a,a<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${a} found in ${n?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+s}this.nextLoadPosition=i+s}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&gt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==le.FRAG_LOADING_WAITING_RETRY)&&(this.state=le.IDLE)}onFragmentOrKeyLoadError(e,t){var i;if(t.chunkMeta&&!t.frag){const E=this.getCurrentContext(t.chunkMeta);E&&(t.frag=E.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var n;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(n=this.fragCurrent)==null?void 0:n.url}`);return}const a=t.details===ee.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(s,!0);const o=t.errorAction;if(!o){this.state=le.ERROR;return}const{action:l,flags:u,retryCount:c=0,retryConfig:h}=o,f=!!h,p=f&&l===It.RetryRequest,m=f&&!o.resolved&&u===ei.MoveAllAlternatesMatchingHost,y=(i=this.hls.latestLevelDetails)==null?void 0:i.live;if(!p&&m&&gt(s)&&!s.endList&&y&&!Vg(t))this.resetFragmentErrors(e),this.treatAsGap(s),o.resolved=!0;else if((p||m)&&c<h.maxNumRetry){var v;const E=Uu((v=t.response)==null?void 0:v.code),A=kc(h,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+A,this.state=le.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,E){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${c+1}/${h.maxNumRetry} in ${A}ms`)}else if(h)if(this.resetFragmentErrors(e),c<h.maxNumRetry)!a&&l!==It.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else l===It.SendAlternateToPenaltyBox?this.state=le.WAITING_LEVEL:this.state=le.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,i=t===1/0;(!t||e>=t||i&&!Uu(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=le.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===le.PARSING||this.state===le.PARSED){const t=e.frag,i=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,i),n=s&&s.len>.5;n&&this.reduceMaxBufferLength(s.len,t?.duration||10);const a=!n;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===ye.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==le.STOPPED&&(this.state=le.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const s=Ie.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,i),this.state===le.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==le.STOPPED&&(this.state=le.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,s){const n=i.details;if(!n){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const h=c.endPTS-c.startPTS;if(h<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${h})`),l||!1;const f=s?0:Xg(n,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS,this);return this.hls.trigger(I.LEVEL_PTS_UPDATED,{details:n,level:i,drift:f,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)){var o;const l=((o=this.transmuxer)==null?void 0:o.error)===null;if((i.fragmentError===0||l&&(i.fragmentError<2||e.endList))&&this.treatAsGap(e,i),l){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(I.ERROR,{type:Te.MEDIA_ERROR,details:ee.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=le.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(I.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ye.MAIN?"level":"track"}fragInfo(e,t=!0,i){var s,n;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((s=t&&!i?e.startPTS:(i||e).start)!=null?s:NaN).toFixed(3)}-${((n=t&&!i?e.endPTS:(i||e).end)!=null?n:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function pf(r){return!!r.interstitialsController&&r.enableInterstitialPlayback!==!1}class rm{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=EE(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function EE(r,e){const t=new Uint8Array(e);let i=0;for(let s=0;s<r.length;s++){const n=r[s];t.set(n,i),i+=n.length}return t}var Nl={exports:{}},gf;function bE(){return gf||(gf=1,(function(r){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function s(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function n(l,u,c,h,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var p=new s(c,h||l,f),m=t?t+u:u;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],p]:l._events[m].push(p):(l._events[m]=p,l._eventsCount++),l}function a(l,u){--l._eventsCount===0?l._events=new i:delete l._events[u]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,h;if(this._eventsCount===0)return u;for(h in c=this._events)e.call(c,h)&&u.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=t?t+u:u,h=this._events[c];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,p=h.length,m=new Array(p);f<p;f++)m[f]=h[f].fn;return m},o.prototype.listenerCount=function(u){var c=t?t+u:u,h=this._events[c];return h?h.fn?1:h.length:0},o.prototype.emit=function(u,c,h,f,p,m){var y=t?t+u:u;if(!this._events[y])return!1;var v=this._events[y],E=arguments.length,A,x;if(v.fn){switch(v.once&&this.removeListener(u,v.fn,void 0,!0),E){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,c),!0;case 3:return v.fn.call(v.context,c,h),!0;case 4:return v.fn.call(v.context,c,h,f),!0;case 5:return v.fn.call(v.context,c,h,f,p),!0;case 6:return v.fn.call(v.context,c,h,f,p,m),!0}for(x=1,A=new Array(E-1);x<E;x++)A[x-1]=arguments[x];v.fn.apply(v.context,A)}else{var w=v.length,k;for(x=0;x<w;x++)switch(v[x].once&&this.removeListener(u,v[x].fn,void 0,!0),E){case 1:v[x].fn.call(v[x].context);break;case 2:v[x].fn.call(v[x].context,c);break;case 3:v[x].fn.call(v[x].context,c,h);break;case 4:v[x].fn.call(v[x].context,c,h,f);break;default:if(!A)for(k=1,A=new Array(E-1);k<E;k++)A[k-1]=arguments[k];v[x].fn.apply(v[x].context,A)}}return!0},o.prototype.on=function(u,c,h){return n(this,u,c,h,!1)},o.prototype.once=function(u,c,h){return n(this,u,c,h,!0)},o.prototype.removeListener=function(u,c,h,f){var p=t?t+u:u;if(!this._events[p])return this;if(!c)return a(this,p),this;var m=this._events[p];if(m.fn)m.fn===c&&(!f||m.once)&&(!h||m.context===h)&&a(this,p);else{for(var y=0,v=[],E=m.length;y<E;y++)(m[y].fn!==c||f&&!m[y].once||h&&m[y].context!==h)&&v.push(m[y]);v.length?this._events[p]=v.length===1?v[0]:v:a(this,p)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&a(this,c)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o})(Nl)),Nl.exports}var xE=bE(),Bc=Yv(xE);const Vn="1.6.15",Fr={};function AE(){return typeof __HLS_WORKER_BUNDLE__=="function"}function CE(){const r=Fr[Vn];if(r)return r.clientCount++,r;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return Fr[Vn]=s,s}function IE(r){const e=Fr[r];if(e)return e.clientCount++,e;const t=new self.URL(r,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Fr[r]=s,s}function DE(r){const e=Fr[r||Vn];if(e&&e.clientCount--===1){const{worker:i,objectURL:s}=e;delete Fr[r||Vn],s&&self.URL.revokeObjectURL(s),i.terminate()}}function nm(r,e){return e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function Uc(r,e){return e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function jo(r,e){let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t}function Gn(r,e){const t=e;let i=0;for(;Uc(r,e);){i+=10;const s=jo(r,e+6);i+=s,nm(r,e+10)&&(i+=10),e+=i}if(i>0)return r.subarray(t,t+i)}function LE(r,e,t,i){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],n=e[t+2],a=n>>2&15;if(a>12){const p=new Error(`invalid ADTS sampling index:${a}`);r.emit(I.ERROR,I.ERROR,{type:Te.MEDIA_ERROR,details:ee.FRAG_PARSING_ERROR,fatal:!0,error:p,reason:p.message});return}const o=(n>>6&3)+1,l=e[t+3]>>6&3|(n&1)<<2,u="mp4a.40."+o,c=s[a];let h=a;(o===5||o===29)&&(h-=3);const f=[o<<3|(h&14)>>1,(h&1)<<7|l<<3];return qe.log(`manifest codec:${i}, parsed codec:${u}, channels:${l}, rate:${c} (ADTS object type:${o} sampling index:${a})`),{config:f,samplerate:c,channelCount:l,codec:u,parsedCodec:u,manifestCodec:i}}function am(r,e){return r[e]===255&&(r[e+1]&246)===240}function om(r,e){return r[e+1]&1?7:9}function $c(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function RE(r,e){return e+5<r.length}function So(r,e){return e+1<r.length&&am(r,e)}function wE(r,e){return RE(r,e)&&am(r,e)&&$c(r,e)<=r.length-e}function kE(r,e){if(So(r,e)){const t=om(r,e);if(e+t>=r.length)return!1;const i=$c(r,e);if(i<=t)return!1;const s=e+i;return s===r.length||So(r,s)}return!1}function lm(r,e,t,i,s){if(!r.samplerate){const n=LE(e,t,i,s);if(!n)return;Ke(r,n)}}function um(r){return 1024*9e4/r}function PE(r,e){const t=om(r,e);if(e+t<=r.length){const i=$c(r,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function cm(r,e,t,i,s){const n=um(r.samplerate),a=i+s*n,o=PE(e,t);let l;if(o){const{frameLength:h,headerLength:f}=o,p=f+h,m=Math.max(0,t+p-e.length);m?(l=new Uint8Array(p-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+p);const y={unit:l,pts:a};return m||r.samples.push(y),{sample:y,length:p,missing:m}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:u,missing:-1}}function OE(r,e){return Uc(r,e)&&jo(r,e+6)+10<=r.length-e}function ME(r){return r instanceof ArrayBuffer?r:r.byteOffset==0&&r.byteLength==r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer}function Bl(r,e=0,t=1/0){return FE(r,e,t,Uint8Array)}function FE(r,e,t,i){const s=NE(r);let n=1;"BYTES_PER_ELEMENT"in i&&(n=i.BYTES_PER_ELEMENT);const a=BE(r)?r.byteOffset:0,o=(a+r.byteLength)/n,l=(a+e)/n,u=Math.floor(Math.max(0,Math.min(l,o))),c=Math.floor(Math.min(u+Math.max(t,0),o));return new i(s,u,c-u)}function NE(r){return r instanceof ArrayBuffer?r:r.buffer}function BE(r){return r&&r.buffer instanceof ArrayBuffer&&r.byteLength!==void 0&&r.byteOffset!==void 0}function UE(r){const e={key:r.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(r.size<2)return;if(r.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=r.data.subarray(1).indexOf(0);if(i===-1)return;const s=si(Bl(r.data,1,i)),n=r.data[2+i],a=r.data.subarray(3+i).indexOf(0);if(a===-1)return;const o=si(Bl(r.data,3+i,a));let l;return s==="-->"?l=si(Bl(r.data,4+i+a)):l=ME(r.data.subarray(4+i+a)),e.mimeType=s,e.pictureType=n,e.description=o,e.data=l,e}function $E(r){if(r.size<2)return;const e=si(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}}function VE(r){if(r.size<2)return;if(r.type==="TXXX"){let t=1;const i=si(r.data.subarray(t),!0);t+=i.length+1;const s=si(r.data.subarray(t));return{key:r.type,info:i,data:s}}const e=si(r.data.subarray(1));return{key:r.type,info:"",data:e}}function GE(r){if(r.type==="WXXX"){if(r.size<2)return;let t=1;const i=si(r.data.subarray(t),!0);t+=i.length+1;const s=si(r.data.subarray(t));return{key:r.type,info:i,data:s}}const e=si(r.data);return{key:r.type,info:"",data:e}}function HE(r){return r.type==="PRIV"?$E(r):r.type[0]==="W"?GE(r):r.type==="APIC"?UE(r):VE(r)}function qE(r){const e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=jo(r,4),i=10;return{type:e,size:t,data:r.subarray(i,i+t)}}const Fa=10,jE=10;function hm(r){let e=0;const t=[];for(;Uc(r,e);){const i=jo(r,e+6);r[e+5]>>6&1&&(e+=Fa),e+=Fa;const s=e+i;for(;e+jE<s;){const n=qE(r.subarray(e)),a=HE(n);a&&t.push(a),e+=n.size+Fa}nm(r,e)&&(e+=Fa)}return t}function dm(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"}function KE(r){if(r.data.byteLength===8){const e=new Uint8Array(r.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function Vc(r){const e=hm(r);for(let t=0;t<e.length;t++){const i=e[t];if(dm(i))return KE(i)}}let ii=(function(r){return r.audioId3="org.id3",r.dateRange="com.apple.quicktime.HLS",r.emsg="https://aomedia.org/emsg/ID3",r.misbklv="urn:misb:KLV:bin:1910.1",r})({});function $i(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Gc{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=pi(this.cachedData,e),this.cachedData=null);let i=Gn(e,0),s=i?i.length:0,n;const a=this._audioTrack,o=this._id3Track,l=i?Vc(i):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&pe(l))&&(this.basePTS=WE(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ii.audioId3,duration:Number.POSITIVE_INFINITY});s<u;){if(this.canParse(e,s)){const c=this.appendFrame(a,e,s);c?(this.frameIndex++,this.lastPTS=c.sample.pts,s+=c.length,n=s):s=u}else OE(e,s)?(i=Gn(e,s),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ii.audioId3,duration:Number.POSITIVE_INFINITY}),s+=i.length,n=s):s++;if(s===u&&n!==u){const c=e.slice(n);this.cachedData?this.cachedData=pi(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:$i(),id3Track:o,textTrack:$i()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:$i(),id3Track:this._id3Track,textTrack:$i()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const WE=(r,e,t)=>{if(pe(r))return r*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let Na=null;const zE=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],YE=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],XE=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],QE=[0,1,1,4];function fm(r,e,t,i,s){if(t+24>e.length)return;const n=pm(e,t);if(n&&t+n.frameLength<=e.length){const a=n.samplesPerFrame*9e4/n.sampleRate,o=i+s*a,l={unit:e.subarray(t,t+n.frameLength),pts:o,dts:o};return r.config=[],r.channelCount=n.channelCount,r.samplerate=n.sampleRate,r.samples.push(l),{sample:l,length:n.frameLength,missing:0}}}function pm(r,e){const t=r[e+1]>>3&3,i=r[e+1]>>1&3,s=r[e+2]>>4&15,n=r[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&n!==3){const a=r[e+2]>>1&1,o=r[e+3]>>6,l=t===3?3-i:i===3?3:4,u=zE[l*14+s-1]*1e3,h=YE[(t===3?0:t===2?1:2)*3+n],f=o===3?1:2,p=XE[t][i],m=QE[i],y=p*8*m,v=Math.floor(p*u/h+a)*m;if(Na===null){const x=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Na=x?parseInt(x[1]):0}return Na&&Na<=87&&i===2&&u>=224e3&&o===0&&(r[e+3]=r[e+3]|128),{sampleRate:h,channelCount:f,frameLength:v,samplesPerFrame:y}}}function Hc(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function gm(r,e){return e+1<r.length&&Hc(r,e)}function JE(r,e){return Hc(r,e)&&4<=r.length-e}function mm(r,e){if(e+1<r.length&&Hc(r,e)){const i=pm(r,e);let s=4;i!=null&&i.frameLength&&(s=i.frameLength);const n=e+s;return n===r.length||gm(r,n)}return!1}class ZE extends Gc{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=Gn(e,0);let s=i?.length||0;if(mm(e,s))return!1;for(let n=e.length;s<n;s++)if(kE(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return wE(e,t)}appendFrame(e,t,i){lm(e,this.observer,t,i,e.manifestCodec);const s=cm(e,t,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const ym=(r,e)=>{let t=0,i=5;e+=i;const s=new Uint32Array(1),n=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=r[e];const o=Math.min(i,8),l=8-o;n[0]=4278190080>>>24+l<<l,s[0]=(a[0]&n[0])>>l,t=t?t<<o|s[0]:s[0],e+=1,i-=o}return t};class eb extends Gc{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const s=Tm(e,t,i,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=Gn(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&Vc(t)!==void 0&&ym(e,i)<16}}function Tm(r,e,t,i,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const n=e[t+4]>>6;if(n>=3)return-1;const o=[48e3,44100,32e3][n],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+n]*2;if(t+c>e.length)return-1;const h=e[t+6]>>5;let f=0;h===2?f+=2:(h&1&&h!==1&&(f+=2),h&4&&(f+=2));const p=(e[t+6]<<8|e[t+7])>>12-f&1,y=[2,1,2,3,3,4,4,5][h]+p,v=e[t+5]>>3,E=e[t+5]&7,A=new Uint8Array([n<<6|v<<1|E>>2,(E&3)<<6|h<<3|p<<2|l>>4,l<<4&224]),x=1536/o*9e4,w=i+s*x,k=e.subarray(t,t+c);return r.config=A,r.channelCount=y,r.samplerate=o,r.samples.push({unit:k,pts:w}),c}class tb extends Gc{resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Gn(e,0);let i=t?.length||0;if(t&&e[i]===11&&e[i+1]===119&&Vc(t)!==void 0&&ym(e,i)<=16)return!1;for(let s=e.length;i<s;i++)if(mm(e,i))return qe.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return JE(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return fm(e,t,i,this.basePTS,this.frameIndex)}}const ib=/\/emsg[-/]ID3/i;class sb{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,s){const n=this.videoTrack=$i("video",1),a=this.audioTrack=$i("audio",1),o=this.txtTrack=$i("text",1);if(this.id3Track=$i("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=Dg(e);if(l.video){const{id:u,timescale:c,codec:h,supplemental:f}=l.video;n.id=u,n.timescale=o.timescale=c,n.codec=h,n.supplemental=f}if(l.audio){const{id:u,timescale:c,codec:h}=l.audio;a.id=u,a.timescale=c,a.codec=h}o.id=Ag.text,n.sampleDuration=0,n.duration=a.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return eS(e)}demux(e,t){this.timeOffset=t;let i=e;const s=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=pi(this.remainderData,e));const o=oS(i);this.remainderData=o.remainder,s.samples=o.valid||new Uint8Array}else s.samples=i;const a=this.extractID3Track(s,t);return n.samples=kd(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return i.samples=kd(e,t),{videoTrack:t,audioTrack:$i(),id3Track:s,textTrack:$i()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const s=we(e.samples,["emsg"]);s&&s.forEach(n=>{const a=uS(n);if(ib.test(a.schemeIdUri)){const o=mf(a,t);let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=a.payload;i.samples.push({data:u,len:u.byteLength,dts:o,pts:o,type:ii.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=mf(a,t);i.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:ii.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function mf(r,e){return pe(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale}class rb{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Pc(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Rs.cbc)}decryptAacSample(e,t,i){const s=e[t].unit;if(s.length<=16)return;const n=s.subarray(16,s.length-s.length%16),a=n.buffer.slice(n.byteOffset,n.byteOffset+n.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)}).catch(i)}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let s=0;for(let n=32;n<e.length-16;n+=160,s+=16)i.set(e.subarray(n,n+16),s);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let s=0;for(let n=32;n<e.length-16;n+=160,s+=16)e.set(i.subarray(s,s+16),n);return e}decryptAvcSample(e,t,i,s,n){const a=wg(n.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{n.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,s)}).catch(s)}decryptAvcSamples(e,t,i,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){s();return}const n=e[t].units;for(;!(i>=n.length);i++){const a=n[i];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,i,s,a),!this.decrypter.isSync()))return}}}}class _m{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,s;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const n=i.units;s=n[n.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,s=i.length;if(s){const n=i[s-1];e.pts=n.pts,e.dts=n.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const s=t.byteLength;let n=e.naluState||0;const a=n,o=[];let l=0,u,c,h,f=-1,p=0;for(n===-1&&(f=0,p=this.getNALuType(t,0),n=0,l=1);l<s;){if(u=t[l++],!n){n=u?0:1;continue}if(n===1){n=u?0:2;continue}if(!u)n=3;else if(u===1){if(c=l-n-1,f>=0){const m={data:t.subarray(f,c),type:p};o.push(m)}else{const m=this.getLastNalUnit(e.samples);m&&(a&&l<=4-a&&m.state&&(m.data=m.data.subarray(0,m.data.byteLength-a)),c>0&&(m.data=pi(m.data,t.subarray(0,c)),m.state=0))}l<s?(h=this.getNALuType(t,l),f=l,p=h,n=0):n=-1}else n=0}if(f>=0&&n>=0){const m={data:t.subarray(f,s),type:p,state:n};o.push(m)}if(o.length===0){const m=this.getLastNalUnit(e.samples);m&&(m.data=pi(m.data,t))}return e.naluState=n,o}}class Rn{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,s=new Uint8Array(4),n=Math.min(4,t);if(n===0)throw new Error("no bytes available");s.set(e.subarray(i,i+n)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=n*8,this.bytesAvailable-=n}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&qe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class nb extends _m{parsePES(e,t,i,s){const n=this.parseNALu(e,i.data,s);let a=this.VideoSample,o,l=!1;i.data=null,a&&n.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),n.forEach(u=>{var c,h;switch(u.type){case 1:{let y=!1;o=!0;const v=u.data;if(l&&v.length>4){const E=this.readSliceType(v);(E===2||E===4||E===7||E===9)&&(y=!0)}if(y){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.frame=!0,a.key=y;break}case 5:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,Lc(u.data,1,i.pts,t.samples);break}case 7:{var p,m;o=!0,l=!0;const y=u.data,v=this.readSPS(y);if(!e.sps||e.width!==v.width||e.height!==v.height||((p=e.pixelRatio)==null?void 0:p[0])!==v.pixelRatio[0]||((m=e.pixelRatio)==null?void 0:m[1])!==v.pixelRatio[1]){e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.sps=[y];const E=y.subarray(1,4);let A="avc1.";for(let x=0;x<3;x++){let w=E[x].toString(16);w.length<2&&(w="0"+w),A+=w}e.codec=A}break}case 8:o=!0,e.pps=[u.data];break;case 9:o=!0,e.audFound=!0,(h=a)!=null&&h.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(u)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Rn(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,s=8,n;for(let a=0;a<e;a++)s!==0&&(n=t.readEG(),s=(i+n+256)%256),i=s===0?i:s}readSPS(e){const t=new Rn(e);let i=0,s=0,n=0,a=0,o,l,u;const c=t.readUByte.bind(t),h=t.readBits.bind(t),f=t.readUEG.bind(t),p=t.readBoolean.bind(t),m=t.skipBits.bind(t),y=t.skipEG.bind(t),v=t.skipUEG.bind(t),E=this.skipScalingList.bind(this);c();const A=c();if(h(5),m(3),c(),v(),A===100||A===110||A===122||A===244||A===44||A===83||A===86||A===118||A===128){const M=f();if(M===3&&m(1),v(),v(),m(1),p())for(l=M!==3?8:12,u=0;u<l;u++)p()&&(u<6?E(16,t):E(64,t))}v();const x=f();if(x===0)f();else if(x===1)for(m(1),y(),y(),o=f(),u=0;u<o;u++)y();v(),m(1);const w=f(),k=f(),F=h(1);F===0&&m(1),m(1),p()&&(i=f(),s=f(),n=f(),a=f());let L=[1,1];if(p()&&p())switch(c()){case 1:L=[1,1];break;case 2:L=[12,11];break;case 3:L=[10,11];break;case 4:L=[16,11];break;case 5:L=[40,33];break;case 6:L=[24,11];break;case 7:L=[20,11];break;case 8:L=[32,11];break;case 9:L=[80,33];break;case 10:L=[18,11];break;case 11:L=[15,11];break;case 12:L=[64,33];break;case 13:L=[160,99];break;case 14:L=[4,3];break;case 15:L=[3,2];break;case 16:L=[2,1];break;case 255:{L=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((w+1)*16-i*2-s*2),height:(2-F)*(k+1)*16-(F?2:4)*(n+a),pixelRatio:L}}}class ab extends _m{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,s){const n=this.parseNALu(e,i.data,s);let a=this.VideoSample,o,l=!1;i.data=null,a&&n.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),n.forEach(u=>{var c,h;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,l){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,Lc(u.data,2,i.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Ke(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(o=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const p=this.readSPS(u.data);e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.codec=p.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const m in p.params)e.params[m]=p.params[m]}this.pushParameterSet(e.sps,u.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const p=this.readPPS(u.data);for(const m in p)e.params[m]=p[m]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(h=a)!=null&&h.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:o=!1;break}a&&o&&a.units.push(u)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[i]=e[s],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Rn(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:s}}readSPS(e){const t=new Rn(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const s=t.readBits(2),n=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),h=t.readUByte(),f=t.readUByte(),p=t.readUByte(),m=t.readUByte(),y=t.readUByte(),v=t.readUByte(),E=t.readUByte(),A=[],x=[];for(let Ee=0;Ee<i;Ee++)A.push(t.readBoolean()),x.push(t.readBoolean());if(i>0)for(let Ee=i;Ee<8;Ee++)t.readBits(2);for(let Ee=0;Ee<i;Ee++)A[Ee]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),x[Ee]&&t.readUByte();t.readUEG();const w=t.readUEG();w==3&&t.skipBits(1);const k=t.readUEG(),F=t.readUEG(),L=t.readBoolean();let M=0,C=0,D=0,B=0;L&&(M+=t.readUEG(),C+=t.readUEG(),D+=t.readUEG(),B+=t.readUEG());const H=t.readUEG(),q=t.readUEG(),Y=t.readUEG(),Z=t.readBoolean();for(let Ee=Z?0:i;Ee<=i;Ee++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let nt=0;nt<4;nt++)for(let Xe=0;Xe<(nt===3?2:6);Xe++)if(!t.readBoolean())t.readUEG();else{const be=Math.min(64,1<<4+(nt<<1));nt>1&&t.readEG();for(let Fe=0;Fe<be;Fe++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const z=t.readUEG();let X=0;for(let Ee=0;Ee<z;Ee++){let nt=!1;if(Ee!==0&&(nt=t.readBoolean()),nt){Ee===z&&t.readUEG(),t.readBoolean(),t.readUEG();let Xe=0;for(let yt=0;yt<=X;yt++){const be=t.readBoolean();let Fe=!1;be||(Fe=t.readBoolean()),(be||Fe)&&Xe++}X=Xe}else{const Xe=t.readUEG(),yt=t.readUEG();X=Xe+yt;for(let be=0;be<Xe;be++)t.readUEG(),t.readBoolean();for(let be=0;be<yt;be++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ee=t.readUEG();for(let nt=0;nt<Ee;nt++){for(let Xe=0;Xe<Y+4;Xe++)t.readBits(1);t.readBits(1)}}let W=0,ae=1,de=1,ge=!0,ce=1,ve=0;t.readBoolean(),t.readBoolean();let Me=!1;if(t.readBoolean()){if(t.readBoolean()){const Ne=t.readUByte(),_i=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Vt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Ne>0&&Ne<16?(ae=_i[Ne-1],de=Vt[Ne-1]):Ne===255&&(ae=t.readBits(16),de=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Me=t.readBoolean(),Me&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ce=t.readBits(32),ve=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Vt=t.readBoolean(),Ri=t.readBoolean();let zt=!1;(Vt||Ri)&&(zt=t.readBoolean(),zt&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),zt&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let vi=0;vi<=i;vi++){ge=t.readBoolean();const wi=ge||t.readBoolean();let fs=!1;wi?t.readEG():fs=t.readBoolean();const ps=fs?1:t.readUEG()+1;if(Vt)for(let oi=0;oi<ps;oi++)t.readUEG(),t.readUEG(),zt&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Ri)for(let oi=0;oi<ps;oi++)t.readUEG(),t.readUEG(),zt&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),W=t.readUEG())}let Ve=k,rt=F;if(L){let Ee=1,nt=1;w===1?Ee=nt=2:w==2&&(Ee=2),Ve=k-Ee*C-Ee*M,rt=F-nt*B-nt*D}const Ze=s?["A","B","C"][s]:"",Ct=o<<24|l<<16|u<<8|c;let ai=0;for(let Ee=0;Ee<32;Ee++)ai=(ai|(Ct>>Ee&1)<<31-Ee)>>>0;let ct=ai.toString(16);return a===1&&ct==="2"&&(ct="6"),{codecString:`hvc1.${Ze}${a}.${ct}.${n?"H":"L"}${E}.B0`,params:{general_tier_flag:n,general_profile_idc:a,general_profile_space:s,general_profile_compatibility_flags:[o,l,u,c],general_constraint_indicator_flags:[h,f,p,m,y,v],general_level_idc:E,bit_depth:H+8,bit_depth_luma_minus8:H,bit_depth_chroma_minus8:q,min_spatial_segmentation_idc:W,chroma_format_idc:w,frame_rate:{fixed:ge,fps:ve/ce}},width:Ve,height:rt,pixelRatio:[ae,de]}}readPPS(e){const t=new Rn(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),n=t.readBoolean();let a=1;return n&&s?a=0:n?a=3:s&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Et=188;class As{constructor(e,t,i,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=s,this.videoParser=null}static probe(e,t){const i=As.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(Et*5,t-Et)+1,s=0;for(;s<i;){let n=!1,a=-1,o=0;for(let l=s;l<t;l+=Et)if(e[l]===71&&(t-l===Et||e[l+Et]===71)){if(o++,a===-1&&(a=l,a!==0&&(i=Math.min(a+Et*99,e.length-Et)+1)),n||(n=qu(e,l)===0),n&&o>1&&(a===0&&o>2||l+Et>i))return a}else{if(o)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Ag[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=As.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=As.createTrack("audio",s),this._id3Track=As.createTrack("id3"),this._txtTrack=As.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,s=!1){i||(this.sampleAes=null);let n;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=a.pid,h=a.pesData,f=o.pid,p=l.pid,m=o.pesData,y=l.pesData,v=null,E=this.pmtParsed,A=this._pmtId,x=e.length;if(this.remainderData&&(e=pi(this.remainderData,e),x=e.length,this.remainderData=null),x<Et&&!s)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};const w=Math.max(0,As.syncOffset(e));x-=(x-w)%Et,x<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,x,e.buffer.byteLength-x));let k=0;for(let L=w;L<x;L+=Et)if(e[L]===71){const M=!!(e[L+1]&64),C=qu(e,L),D=(e[L+3]&48)>>4;let B;if(D>1){if(B=L+5+e[L+4],B===L+Et)continue}else B=L+4;switch(C){case c:M&&(h&&(n=hr(h,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,u,n,!1)),h={data:[],size:0}),h&&(h.data.push(e.subarray(B,L+Et)),h.size+=L+Et-B);break;case f:if(M){if(m&&(n=hr(m,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,n);break;case"mp3":this.parseMPEGPES(o,n);break;case"ac3":this.parseAC3PES(o,n);break}m={data:[],size:0}}m&&(m.data.push(e.subarray(B,L+Et)),m.size+=L+Et-B);break;case p:M&&(y&&(n=hr(y,this.logger))&&this.parseID3PES(l,n),y={data:[],size:0}),y&&(y.data.push(e.subarray(B,L+Et)),y.size+=L+Et-B);break;case 0:M&&(B+=e[B]+1),A=this._pmtId=ob(e,B);break;case A:{M&&(B+=e[B]+1);const H=lb(e,B,this.typeSupported,i,this.observer,this.logger);c=H.videoPid,c>0&&(a.pid=c,a.segmentCodec=H.segmentVideoCodec),f=H.audioPid,f>0&&(o.pid=f,o.segmentCodec=H.segmentAudioCodec),p=H.id3Pid,p>0&&(l.pid=p),v!==null&&!E&&(this.logger.warn(`MPEG-TS PMT found at ${L} after unknown PID '${v}'. Backtracking to sync byte @${w} to parse all TS packets.`),v=null,L=w-188),E=this.pmtParsed=!0;break}case 17:case 8191:break;default:v=C;break}}else k++;k>0&&ju(this.observer,new Error(`Found ${k} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=h,o.pesData=m,l.pesData=y;const F={audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};return s&&this.extractRemainingSamples(F),F}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:s,textTrack:n}=e,a=i.pesData,o=t.pesData,l=s.pesData;let u;if(a&&(u=hr(a,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,n,u,!0),i.pesData=null)):i.pesData=a,o&&(u=hr(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(u=hr(l,this.logger))?(this.parseID3PES(s,u),s.pesData=null):s.pesData=l}demuxSampleAes(e,t,i){const s=this.demux(e,i,!0,!this.config.progressive),n=this.sampleAes=new rb(this.observer,this.config,t);return this.decrypt(s,n)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new nb:e==="hevc"&&(this.videoParser=new ab))}decrypt(e,t){return new Promise(i=>{const{audioTrack:s,videoTrack:n}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{n.samples?t.decryptAvcSamples(n.samples,0,0,()=>{i(e)}):i(e)}):n.samples&&t.decryptAvcSamples(n.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const s=this.aacOverFlow;let n=t.data;if(s){this.aacOverFlow=null;const h=s.missing,f=s.sample.unit.byteLength;if(h===-1)n=pi(s.sample.unit,n);else{const p=f-h;s.sample.unit.set(n.subarray(0,h),p),e.samples.push(s.sample),i=s.missing}}let a,o;for(a=i,o=n.length;a<o-1&&!So(n,a);a++);if(a!==i){let h;const f=a<o-1;if(f?h=`AAC PES did not start with ADTS header,offset:${a}`:h="No ADTS header found in AAC PES",ju(this.observer,new Error(h),f,this.logger),!f)return}lm(e,this.observer,n,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(s){const h=um(e.samplerate);l=s.sample.pts+h}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;a<o;)if(c=cm(e,n,a,l,u),a+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;a<o-1&&!So(n,a);a++);}parseMPEGPES(e,t){const i=t.data,s=i.length;let n=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<s;)if(gm(i,a)){const l=fm(e,i,a,o,n);if(l)a+=l.length,n++;else break}else a++}parseAC3PES(e,t){{const i=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const n=i.length;let a=0,o=0,l;for(;o<n&&(l=Tm(e,i,o,s,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Ke({},t,{type:this._videoTrack?ii.emsg:ii.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function qu(r,e){return((r[e+1]&31)<<8)+r[e+2]}function ob(r,e){return(r[e+10]&31)<<8|r[e+11]}function lb(r,e,t,i,s,n){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(r[e+1]&15)<<8|r[e+2],l=e+3+o-4,u=(r[e+10]&15)<<8|r[e+11];for(e+=12+u;e<l;){const c=qu(r,e),h=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!i){Ul("ADTS AAC",n);break}case 15:a.audioPid===-1&&(a.audioPid=c);break;case 21:a.id3Pid===-1&&(a.id3Pid=c);break;case 219:if(!i){Ul("H.264",n);break}case 27:a.videoPid===-1&&(a.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?n.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="mp3");break;case 193:if(!i){Ul("AC-3",n);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="ac3"):n.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&h>0){let f=e+5,p=h;for(;p>2;){r[f]===106&&(t.ac3!==!0?n.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=c,a.segmentAudioCodec="ac3"));const y=r[f+1]+2;f+=y,p-=y}}break;case 194:case 135:return ju(s,new Error("Unsupported EC-3 in M2TS found"),void 0,n),a;case 36:a.videoPid===-1&&(a.videoPid=c,a.segmentVideoCodec="hevc",n.log("HEVC in M2TS found"));break}e+=h+5}return a}function ju(r,e,t,i){i.warn(`parsing error: ${e.message}`),r.emit(I.ERROR,I.ERROR,{type:Te.MEDIA_ERROR,details:ee.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Ul(r,e){e.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function hr(r,e){let t=0,i,s,n,a,o;const l=r.data;if(!r||r.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=pi(l[0],l[1]),l.splice(1,1);if(i=l[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(s=(i[4]<<8)+i[5],s&&s>r.size-6)return null;const c=i[7];c&192&&(a=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,c&64?(o=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),n=i[8];let h=n+9;if(r.size<=h)return null;r.size-=h;const f=new Uint8Array(r.size);for(let p=0,m=l.length;p<m;p++){i=l[p];let y=i.byteLength;if(h)if(h>y){h-=y;continue}else i=i.subarray(h),y-=h,h=0;f.set(i,t),t+=y}return s&&(s-=n+3),{data:f,pts:a,dts:o,len:s}}return null}class ub{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const _s=Math.pow(2,32)-1;class J{static init(){J.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in J.types)J.types.hasOwnProperty(e)&&(J.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);J.HDLR_TYPES={video:t,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);J.STTS=J.STSC=J.STCO=n,J.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),J.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),J.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),J.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);J.FTYP=J.box(J.types.ftyp,a,l,a,o),J.DINF=J.box(J.types.dinf,J.box(J.types.dref,s))}static box(e,...t){let i=8,s=t.length;const n=s;for(;s--;)i+=t[s].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=i&255,a.set(e,4),s=0,i=8;s<n;s++)a.set(t[s],i),i+=t[s].byteLength;return a}static hdlr(e){return J.box(J.types.hdlr,J.HDLR_TYPES[e])}static mdat(e){return J.box(J.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(_s+1)),s=Math.floor(t%(_s+1));return J.box(J.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return J.box(J.types.mdia,J.mdhd(e.timescale||0,e.duration||0),J.hdlr(e.type),J.minf(e))}static mfhd(e){return J.box(J.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?J.box(J.types.minf,J.box(J.types.smhd,J.SMHD),J.DINF,J.stbl(e)):J.box(J.types.minf,J.box(J.types.vmhd,J.VMHD),J.DINF,J.stbl(e))}static moof(e,t,i){return J.box(J.types.moof,J.mfhd(e),J.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=J.trak(e[t]);return J.box.apply(null,[J.types.moov,J.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(J.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=J.trex(e[t]);return J.box.apply(null,[J.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(_s+1)),s=Math.floor(t%(_s+1)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return J.box(J.types.mvhd,n)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let s,n;for(s=0;s<t.length;s++)n=t[s].flags,i[s+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return J.box(J.types.sdtp,i)}static stbl(e){return J.box(J.types.stbl,J.stsd(e),J.box(J.types.stts,J.STTS),J.box(J.types.stsc,J.STSC),J.box(J.types.stsz,J.STSZ),J.box(J.types.stco,J.STCO))}static avc1(e){let t=[],i=[],s,n,a;for(s=0;s<e.sps.length;s++)n=e.sps[s],a=n.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(n));for(s=0;s<e.pps.length;s++)n=e.pps[s],a=n.byteLength,i.push(a>>>8&255),i.push(a&255),i=i.concat(Array.prototype.slice.call(n));const o=J.box(J.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),l=e.width,u=e.height,c=e.pixelRatio[0],h=e.pixelRatio[1];return J.box(J.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,J.box(J.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),J.box(J.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,h>>24,h>>16&255,h>>8&255,h&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return J.box(J.types.mp4a,J.audioStsd(e),J.box(J.types.esds,J.esds(e)))}static mp3(e){return J.box(J.types[".mp3"],J.audioStsd(e))}static ac3(e){return J.box(J.types["ac-3"],J.audioStsd(e),J.box(J.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return J.box(J.types.stsd,J.STSD,J.mp4a(e));if(t==="ac3"&&e.config)return J.box(J.types.stsd,J.STSD,J.ac3(e));if(t==="mp3"&&e.codec==="mp3")return J.box(J.types.stsd,J.STSD,J.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return J.box(J.types.stsd,J.STSD,J.avc1(e));if(t==="hevc"&&e.vps)return J.box(J.types.stsd,J.STSD,J.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),s=e.width||0,n=e.height||0,a=Math.floor(i/(_s+1)),o=Math.floor(i%(_s+1));return J.box(J.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,n>>8&255,n&255,0,0]))}static traf(e,t){const i=J.sdtp(e),s=e.id,n=Math.floor(t/(_s+1)),a=Math.floor(t%(_s+1));return J.box(J.types.traf,J.box(J.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),J.box(J.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,a>>24,a>>16&255,a>>8&255,a&255])),J.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,J.box(J.types.trak,J.tkhd(e),J.mdia(e))}static trex(e){const t=e.id;return J.box(J.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],s=i.length,n=12+16*s,a=new Uint8Array(n);let o,l,u,c,h,f;for(t+=8+n,a.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<s;o++)l=i[o],u=l.duration,c=l.size,h=l.flags,f=l.cts,a.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*o);return J.box(J.types.trun,a)}static initSegment(e){J.types||J.init();const t=J.moov(e);return pi(J.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],s=4,n=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let a=n.length;for(let m=0;m<i.length;m+=1){a+=3;for(let y=0;y<i[m].length;y+=1)a+=2+i[m][y].length}const o=new Uint8Array(a);o.set(n,0),a=n.length;const l=i.length-1;for(let m=0;m<i.length;m+=1){o.set(new Uint8Array([32+m|(m===l?128:0),0,i[m].length]),a),a+=3;for(let y=0;y<i[m].length;y+=1)o.set(new Uint8Array([i[m][y].length>>8,i[m][y].length&255]),a),a+=2,o.set(i[m][y],a),a+=i[m][y].length}const u=J.box(J.types.hvcC,o),c=e.width,h=e.height,f=e.pixelRatio[0],p=e.pixelRatio[1];return J.box(J.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,J.box(J.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),J.box(J.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,p>>24,p>>16&255,p>>8&255,p&255])))}}J.types=void 0;J.HDLR_TYPES=void 0;J.STTS=void 0;J.STSC=void 0;J.STCO=void 0;J.STSZ=void 0;J.VMHD=void 0;J.SMHD=void 0;J.STSD=void 0;J.FTYP=void 0;J.DINF=void 0;const vm=9e4;function qc(r,e,t=1,i=!1){const s=r*e*t;return i?Math.round(s):s}function cb(r,e,t=1,i=!1){return qc(r,e,1/t,i)}function _n(r,e=!1){return qc(r,1e3,1/vm,e)}function hb(r,e=1){return qc(r,vm,1/e)}function yf(r){const{baseTime:e,timescale:t,trackId:i}=r;return`${e/t} (${e}/${t}) trackId: ${i}`}const db=10*1e3,fb=1024,pb=1152,gb=1536;let dr=null,$l=null;function Tf(r,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}class so extends yi{constructor(e,t,i,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,dr===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);dr=a?parseInt(a[1]):0}if($l===null){const n=navigator.userAgent.match(/Safari\/(\d+)/i);$l=n?parseInt(n[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&yf(t)} > ${e&&yf(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,s=e.reduce((n,a)=>{let o=a.pts,l=o-n;return l<-4294967296&&(t=!0,o=ti(o,i),l=o-n),l>0?n:o},i);return t&&this.debug("PTS rollover detected"),s}remux(e,t,i,s,n,a,o,l){let u,c,h,f,p,m,y=n,v=n;const E=e.pid>-1,A=t.pid>-1,x=t.samples.length,w=e.samples.length>0,k=o&&x>0||x>1;if((!E||w)&&(!A||k)||this.ISGenerated||o){if(this.ISGenerated){var L,M,C,D;const Y=this.videoTrackConfig;(Y&&(t.width!==Y.width||t.height!==Y.height||((L=t.pixelRatio)==null?void 0:L[0])!==((M=Y.pixelRatio)==null?void 0:M[0])||((C=t.pixelRatio)==null?void 0:C[1])!==((D=Y.pixelRatio)==null?void 0:D[1]))||!Y&&k||this.nextAudioTs===null&&w)&&this.resetInitSegment()}this.ISGenerated||(h=this.generateIS(e,t,n,a));const B=this.isVideoContiguous;let H=-1,q;if(k&&(H=mb(t.samples),!B&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,H>0){this.warn(`Dropped ${H} out of ${x} video samples due to a missing keyframe`);const Y=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(H),t.dropped+=H,v+=(t.samples[0].pts-Y)/t.inputTimeScale,q=v}else H===-1&&(this.warn(`No keyframe found out of ${x} video samples`),m=!1);if(this.ISGenerated){if(w&&k){const Y=this.getVideoStartPts(t.samples),Q=(ti(e.samples[0].pts,Y)-Y)/t.inputTimeScale;y+=Math.max(0,Q),v+=Math.max(0,-Q)}if(w){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),h=this.generateIS(e,t,n,a)),c=this.remuxAudio(e,y,this.isAudioContiguous,a,A||k||l===ye.AUDIO?v:void 0),k){const Y=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),h=this.generateIS(e,t,n,a)),u=this.remuxVideo(t,v,B,Y)}}else k&&(u=this.remuxVideo(t,v,B,0));u&&(u.firstKeyFrame=H,u.independent=H!==-1,u.firstKeyFramePTS=q)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(p=Sm(i,n,this._initPTS,this._initDTS)),s.samples.length&&(f=Em(s,n,this._initPTS))),{audio:c,video:u,initSegment:h,independent:m,text:f,id3:p}}computeInitPts(e,t,i,s){const n=Math.round(i*t);let a=ti(e,n);if(a<n+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(n-a)/t} ${s}`);a<n+t;)a+=8589934592;return a-n}generateIS(e,t,i,s){const n=e.samples,a=t.samples,o=this.typeSupported,l={},u=this._initPTS;let c=!u||s,h="audio/mp4",f,p,m,y=-1;if(c&&(f=p=1/0),e.config&&n.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(h="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:h,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):J.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(y=e.id,m=e.inputTimeScale,!u||m!==u.timescale?f=p=this.computeInitPts(n[0].pts,m,i,"audio"):c=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:J.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(y=t.id,m=t.inputTimeScale,!u||m!==u.timescale){const v=this.getVideoStartPts(a),E=ti(a[0].dts,v),A=this.computeInitPts(E,m,i,"video"),x=this.computeInitPts(v,m,i,"video");p=Math.min(p,A),f=Math.min(f,x)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(u&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${i} ${f/m} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${f/m} (${f}/${m}) trackId: ${y}`),this._initPTS={baseTime:f,timescale:m,trackId:y},this._initDTS={baseTime:p,timescale:m,trackId:y}):f=m=void 0,{tracks:l,initPTS:f,timescale:m,trackId:y}}remuxVideo(e,t,i,s){const n=e.inputTimeScale,a=e.samples,o=[],l=a.length,u=this._initPTS,c=u.baseTime*n/u.timescale;let h=this.nextVideoTs,f=8,p=this.videoSampleDuration,m,y,v=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,A=!1;if(!i||h===null){const W=c+t*n,ae=a[0].pts-ti(a[0].dts,a[0].pts);dr&&h!==null&&Math.abs(W-ae-(h+c))<15e3?i=!0:h=W-ae-c}const x=h+c;for(let W=0;W<l;W++){const ae=a[W];ae.pts=ti(ae.pts,x),ae.dts=ti(ae.dts,x),ae.dts<a[W>0?W-1:W].dts&&(A=!0)}A&&a.sort(function(W,ae){const de=W.dts-ae.dts,ge=W.pts-ae.pts;return de||ge}),m=a[0].dts,y=a[a.length-1].dts;const w=y-m,k=w?Math.round(w/(l-1)):p||e.inputTimeScale/30;if(i){const W=m-x,ae=W>k,de=W<-1;if((ae||de)&&(ae?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${_n(W,!0)} ms (${W}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${_n(-W,!0)} ms (${W}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!de||x>=a[0].pts||dr)){m=x;const ge=a[0].pts-W;if(ae)a[0].dts=m,a[0].pts=ge;else{let ce=!0;for(let ve=0;ve<a.length&&!(a[ve].dts>ge&&ce);ve++){const Me=a[ve].pts;if(a[ve].dts-=W,a[ve].pts-=W,ve<a.length-1){const ke=a[ve+1].pts,Ve=a[ve].pts,rt=ke<=Ve,Ze=ke<=Me;ce=rt==Ze}}}this.log(`Video: Initial PTS/DTS adjusted: ${_n(ge,!0)}/${_n(m,!0)}, delta: ${_n(W,!0)} ms`)}}m=Math.max(0,m);let F=0,L=0,M=m;for(let W=0;W<l;W++){const ae=a[W],de=ae.units,ge=de.length;let ce=0;for(let ve=0;ve<ge;ve++)ce+=de[ve].data.length;L+=ce,F+=ge,ae.length=ce,ae.dts<M?(ae.dts=M,M+=k/4|0||1):M=ae.dts,v=Math.min(ae.pts,v),E=Math.max(ae.pts,E)}y=a[l-1].dts;const C=L+4*F+8;let D;try{D=new Uint8Array(C)}catch(W){this.observer.emit(I.ERROR,I.ERROR,{type:Te.MUX_ERROR,details:ee.REMUX_ALLOC_ERROR,fatal:!1,error:W,bytes:C,reason:`fail allocating video mdat ${C}`});return}const B=new DataView(D.buffer);B.setUint32(0,C),D.set(J.types.mdat,4);let H=!1,q=Number.POSITIVE_INFINITY,Y=Number.POSITIVE_INFINITY,Z=Number.NEGATIVE_INFINITY,Q=Number.NEGATIVE_INFINITY;for(let W=0;W<l;W++){const ae=a[W],de=ae.units;let ge=0;for(let Me=0,ke=de.length;Me<ke;Me++){const Ve=de[Me],rt=Ve.data,Ze=Ve.data.byteLength;B.setUint32(f,Ze),f+=4,D.set(rt,f),f+=Ze,ge+=4+Ze}let ce;if(W<l-1)p=a[W+1].dts-ae.dts,ce=a[W+1].pts-ae.pts;else{const Me=this.config,ke=W>0?ae.dts-a[W-1].dts:k;if(ce=W>0?ae.pts-a[W-1].pts:k,Me.stretchShortVideoTrack&&this.nextAudioTs!==null){const Ve=Math.floor(Me.maxBufferHole*n),rt=(s?v+s*n:this.nextAudioTs+c)-ae.pts;rt>Ve?(p=rt-ke,p<0?p=ke:H=!0,this.log(`It is approximately ${rt/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=ke}else p=ke}const ve=Math.round(ae.pts-ae.dts);q=Math.min(q,p),Z=Math.max(Z,p),Y=Math.min(Y,ce),Q=Math.max(Q,ce),o.push(Tf(ae.key,p,ge,ve))}if(o.length){if(dr){if(dr<70){const W=o[0].flags;W.dependsOn=2,W.isNonSync=0}}else if($l&&Q-Y<Z-q&&k/Z<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let W=m;for(let ae=0,de=o.length;ae<de;ae++){const ge=W+o[ae].duration,ce=W+o[ae].cts;if(ae<de-1){const ve=ge+o[ae+1].cts;o[ae].duration=ve-ce}else o[ae].duration=ae?o[ae-1].duration:k;o[ae].cts=0,W=ge}}}p=H||!p?k:p;const K=y+p;this.nextVideoTs=h=K-c,this.videoSampleDuration=p,this.isVideoContiguous=!0;const ie={data1:J.moof(e.sequenceNumber++,m,Ke(e,{samples:o})),data2:D,startPTS:(v-c)/n,endPTS:(E+p-c)/n,startDTS:(m-c)/n,endDTS:h/n,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,ie}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return pb;case"ac3":return gb;default:return fb}}remuxAudio(e,t,i,s,n){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,u=this.getSamplesPerFrame(e),c=u*l,h=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,p=[],m=n!==void 0;let y=e.samples,v=f?0:8,E=this.nextAudioTs||-1;const A=h.baseTime*a/h.timescale,x=A+t*a;if(this.isAudioContiguous=i=i||y.length&&E>0&&(s&&Math.abs(x-(E+A))<9e3||Math.abs(ti(y[0].pts,x)-(E+A))<20*c),y.forEach(function(Q){Q.pts=ti(Q.pts,x)}),!i||E<0){const Q=y.length;if(y=y.filter(K=>K.pts>=0),Q!==y.length&&this.warn(`Removed ${y.length-Q} of ${Q} samples (initPTS ${A} / ${a})`),!y.length)return;n===0?E=0:s&&!m?E=Math.max(0,x-A):E=y[0].pts-A}if(e.segmentCodec==="aac"){const Q=this.config.maxAudioFramesDrift;for(let K=0,z=E+A;K<y.length;K++){const X=y[K],ie=X.pts,W=ie-z,ae=Math.abs(1e3*W/a);if(W<=-Q*c&&m)K===0&&(this.warn(`Audio frame @ ${(ie/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*W/a)} ms.`),this.nextAudioTs=E=ie-A,z=ie);else if(W>=Q*c&&ae<db&&m){let de=Math.round(W/c);for(z=ie-de*c;z<0&&de&&c;)de--,z+=c;K===0&&(this.nextAudioTs=E=z-A),this.warn(`Injecting ${de} audio frames @ ${((z-A)/a).toFixed(3)}s due to ${Math.round(1e3*W/a)} ms gap.`);for(let ge=0;ge<de;ge++){let ce=ub.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ce||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ce=X.unit.subarray()),y.splice(K,0,{unit:ce,pts:z}),z+=c,K++}}X.pts=z,z+=c}}let w=null,k=null,F,L=0,M=y.length;for(;M--;)L+=y[M].unit.byteLength;for(let Q=0,K=y.length;Q<K;Q++){const z=y[Q],X=z.unit;let ie=z.pts;if(k!==null){const ae=p[Q-1];ae.duration=Math.round((ie-k)/l)}else if(i&&e.segmentCodec==="aac"&&(ie=E+A),w=ie,L>0){L+=v;try{F=new Uint8Array(L)}catch(ae){this.observer.emit(I.ERROR,I.ERROR,{type:Te.MUX_ERROR,details:ee.REMUX_ALLOC_ERROR,fatal:!1,error:ae,bytes:L,reason:`fail allocating audio mdat ${L}`});return}f||(new DataView(F.buffer).setUint32(0,L),F.set(J.types.mdat,4))}else return;F.set(X,v);const W=X.byteLength;v+=W,p.push(Tf(!0,u,W,0)),k=ie}const C=p.length;if(!C)return;const D=p[p.length-1];E=k-A,this.nextAudioTs=E+l*D.duration;const B=f?new Uint8Array(0):J.moof(e.sequenceNumber++,w/l,Ke({},e,{samples:p}));e.samples=[];const H=(w-A)/a,q=this.nextAudioTs/a,Z={data1:B,data2:F,startPTS:H,endPTS:q,startDTS:H,endDTS:q,type:"audio",hasAudio:!0,hasVideo:!1,nb:C};return this.isAudioContiguous=!0,Z}}function ti(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function mb(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function Sm(r,e,t,i){const s=r.samples.length;if(!s)return;const n=r.inputTimeScale;for(let o=0;o<s;o++){const l=r.samples[o];l.pts=ti(l.pts-t.baseTime*n/t.timescale,e*n)/n,l.dts=ti(l.dts-i.baseTime*n/i.timescale,e*n)/n}const a=r.samples;return r.samples=[],{samples:a}}function Em(r,e,t){const i=r.samples.length;if(!i)return;const s=r.inputTimeScale;for(let a=0;a<i;a++){const o=r.samples[a];o.pts=ti(o.pts-t.baseTime*s/t.timescale,e*s)/s}r.samples.sort((a,o)=>a.pts-o.pts);const n=r.samples;return r.samples=[],{samples:n}}class yb extends yi{constructor(e,t,i,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,s){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:i,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:n,video:a}=this.initData=Dg(e);if(t)rS(e,t);else{const l=n||a;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}n&&(i=_f(n,ze.AUDIO,this)),a&&(s=_f(a,ze.VIDEO,this));const o={};n&&a?o.audiovideo={container:"video/mp4",codec:i+","+s,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:n?o.audio={container:"audio/mp4",codec:i,encrypted:n.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:s,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,i,s,n,a){var o,l;let{initPTS:u,lastEndTime:c}=this;const h={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};pe(c)||(c=this.lastEndTime=n||0);const f=t.samples;if(!f.length)return h;const p={initPTS:void 0,timescale:void 0,trackId:void 0};let m=this.initData;if((o=m)!=null&&o.length||(this.generateInitSegment(f),m=this.initData),!((l=m)!=null&&l.length))return this.warn("Failed to generate initSegment."),h;this.emitInitSegment&&(p.tracks=this.initTracks,this.emitInitSegment=!1);const y=aS(f,m,this),v=m.audio?y[m.audio.id]:null,E=m.video?y[m.video.id]:null,A=Ba(E,1/0),x=Ba(v,1/0),w=Ba(E,0,!0),k=Ba(v,0,!0);let F=n,L=0;const M=v&&(!E||!u&&x<A||u&&u.trackId===m.audio.id),C=M?v:E;if(C){const z=C.timescale,X=C.start-n*z,ie=M?m.audio.id:m.video.id;F=C.start/z,L=M?k-x:w-A,(a||!u)&&(Tb(u,F,n,L)||z!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${n} ${X/z} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${F-n} (${X}/${z}) trackId: ${ie}`),u=null,p.initPTS=X,p.timescale=z,p.trackId=ie)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${n}`);u?(p.initPTS=u.baseTime,p.timescale=u.timescale,p.trackId=u.trackId):((!p.timescale||p.trackId===void 0||p.initPTS===void 0)&&(this.warn("Could not set initPTS"),p.initPTS=F,p.timescale=1,p.trackId=-1),this.initPTS=u={baseTime:p.initPTS,timescale:p.timescale,trackId:p.trackId});const D=F-u.baseTime/u.timescale,B=D+L;L>0?this.lastEndTime=B:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const H=!!m.audio,q=!!m.video;let Y="";H&&(Y+="audio"),q&&(Y+="video");const Z=(m.audio?m.audio.encrypted:!1)||(m.video?m.video.encrypted:!1),Q={data1:f,startPTS:D,startDTS:D,endPTS:B,endDTS:B,type:Y,hasAudio:H,hasVideo:q,nb:1,dropped:0,encrypted:Z};h.audio=H&&!q?Q:void 0,h.video=q?Q:void 0;const K=E?.sampleCount;if(K){const z=E.keyFrameIndex,X=z!==-1;Q.nb=K,Q.dropped=z===0||this.isVideoContiguous?0:X?z:K,Q.independent=X,Q.firstKeyFrame=z,X&&E.keyFrameStart&&(Q.firstKeyFramePTS=(E.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(h.independent=X),this.isVideoContiguous||(this.isVideoContiguous=X),Q.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${z}/${K} dropped: ${Q.dropped} start: ${Q.firstKeyFramePTS||"NA"}`)}return h.initSegment=p,h.id3=Sm(i,n,u,u),s.samples.length&&(h.text=Em(s,n,u)),h}}function Ba(r,e,t=!1){return r?.start!==void 0?(r.start+(t?r.duration:0))/r.timescale:e}function Tb(r,e,t,i){if(r===null)return!0;const s=Math.max(i,1),n=e-r.baseTime/r.timescale;return Math.abs(n-t)>s}function _f(r,e,t){const i=r.codec;return i&&i.length>4?i:e===ze.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?fo(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let os;try{os=self.performance.now.bind(self.performance)}catch{os=Date.now}const ro=[{demux:sb,remux:yb},{demux:As,remux:so},{demux:ZE,remux:so},{demux:tb,remux:so}];ro.splice(2,0,{demux:eb,remux:so});class vf{constructor(e,t,i,s,n,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=n,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,s){const n=i.transmuxing;n.executeStart=os();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:u,discontinuity:c,trackSwitch:h,accurateTimeOffset:f,timeOffset:p,initSegmentChange:m}=s||o,{audioCodec:y,videoCodec:v,defaultInitPts:E,duration:A,initSegmentData:x}=l,w=_b(a,t);if(w&&br(w.method)){const M=this.getDecrypter(),C=Mc(w.method);if(M.isSync()){let D=M.softwareDecrypt(a,w.key.buffer,w.iv.buffer,C);if(i.part>-1){const H=M.flush();D=H&&H.buffer}if(!D)return n.executeEnd=os(),Vl(i);a=new Uint8Array(D)}else return this.asyncResult=!0,this.decryptionPromise=M.webCryptoDecrypt(a,w.key.buffer,w.iv.buffer,C).then(D=>{const B=this.push(D,null,i);return this.decryptionPromise=null,B}),this.decryptionPromise}const k=this.needsProbing(c,h);if(k){const M=this.configureTransmuxer(a);if(M)return this.logger.warn(`[transmuxer] ${M.message}`),this.observer.emit(I.ERROR,I.ERROR,{type:Te.MEDIA_ERROR,details:ee.FRAG_PARSING_ERROR,fatal:!1,error:M,reason:M.message}),n.executeEnd=os(),Vl(i)}(c||h||m||k)&&this.resetInitSegment(x,y,v,A,t),(c||m||k)&&this.resetInitialTimestamp(E),u||this.resetContiguity();const F=this.transmux(a,w,p,f,i);this.asyncResult=Hn(F);const L=this.currentTransmuxState;return L.contiguous=!0,L.discontinuity=!1,L.trackSwitch=!1,n.executeEnd=os(),F}flush(e){const t=e.transmuxing;t.executeStart=os();const{decrypter:i,currentTransmuxState:s,decryptionPromise:n}=this;if(n)return this.asyncResult=!0,n.then(()=>this.flush(e));const a=[],{timeOffset:o}=s;if(i){const h=i.flush();h&&a.push(this.push(h.buffer,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=os();const h=[Vl(e)];return this.asyncResult?Promise.resolve(h):h}const c=l.flush(o);return Hn(c)?(this.asyncResult=!0,c.then(h=>(this.flushRemux(a,h,e),a))):(this.flushRemux(a,c,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,i){const{audioTrack:s,videoTrack:n,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===ye.MAIN?"level":"track"} ${i.level}`);const c=this.remuxer.remux(s,n,a,o,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:i}),i.transmuxing.executeEnd=os()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,s,n){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,i,s),o.resetInitSegment(e,t,i,n))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,s,n){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,i,s,n):a=this.transmuxUnencrypted(e,i,s,n),a}transmuxUnencrypted(e,t,i,s){const{audioTrack:n,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(n,a,o,l,t,i,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,i,s,n){return this.demuxer.demuxSampleAes(e,t,i).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,i,s,!1,this.id),chunkMeta:n}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:s}=this;let n;for(let h=0,f=ro.length;h<f;h++){var a;if((a=ro[h].demux)!=null&&a.probe(e,this.logger)){n=ro[h];break}}if(!n)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,u=n.remux,c=n.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(i,t,s,this.logger)),(!o||!(o instanceof c))&&(this.demuxer=new c(i,t,s,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Pc(this.config)),e}}function _b(r,e){let t=null;return r.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Vl=r=>({remuxResult:{},chunkMeta:r});function Hn(r){return"then"in r&&r.then instanceof Function}class vb{constructor(e,t,i,s,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=s,this.defaultInitPts=n||null}}class Sb{constructor(e,t,i,s,n,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=s,this.timeOffset=n,this.initSegmentChange=a}}let Sf=0;class bm{constructor(e,t,i,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Sf++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const u=l.data,c=this.hls;if(!(!c||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var h;const f=(h=this.workerContext)==null?void 0:h.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{c.logger[u.data.logType]&&c.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,c.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(I.ERROR,{type:Te.OTHER_ERROR,details:ee.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const n=e.config;this.hls=e,this.id=t,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=i,this.onFlush=s;const a=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===I.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new Bc,this.observer.on(I.FRAG_DECRYPTED,a),this.observer.on(I.ERROR,a);const o=Md(n.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(n.workerPath||AE()){try{n.workerPath?(l.log(`loading Web Worker ${n.workerPath} for "${t}"`),this.workerContext=IE(n.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=CE());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:Ye(n)})}catch(c){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new vf(this.observer,o,n,"",t,e.logger)}return}}this.transmuxer=new vf(this.observer,o,n,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Sf++;const t=this.hls.config,i=Md(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:Ye(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),DE(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,s,n,a,o,l,u,c){var h,f;u.transmuxing.start=self.performance.now();const{instanceNo:p,transmuxer:m}=this,y=a?a.start:n.start,v=n.decryptdata,E=this.frag,A=!(E&&n.cc===E.cc),x=!(E&&u.level===E.level),w=E?u.sn-E.sn:-1,k=this.part?u.part-this.part.index:-1,F=w===0&&u.id>1&&u.id===E?.stats.chunkCount,L=!x&&(w===1||w===0&&(k===1||F&&k<=0)),M=self.performance.now();(x||w||n.stats.parsing.start===0)&&(n.stats.parsing.start=M),a&&(k||!L)&&(a.stats.parsing.start=M);const C=!(E&&((h=n.initSegment)==null?void 0:h.url)===((f=E.initSegment)==null?void 0:f.url)),D=new Sb(A,L,l,x,y,C);if(!L||A||C){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${n.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===ye.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${A}
        trackSwitch: ${x}
        contiguous: ${L}
        accurateTimeOffset: ${l}
        timeOffset: ${y}
        initSegmentChange: ${C}`);const B=new vb(i,s,t,o,c);this.configureTransmuxer(B)}if(this.frag=n,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:p,cmd:"demux",data:e,decryptdata:v,chunkMeta:u,state:D},e instanceof ArrayBuffer?[e]:[]);else if(m){const B=m.push(e,v,u,D);Hn(B)?B.then(H=>{this.handleTransmuxComplete(H)}).catch(H=>{this.transmuxerError(H,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(B)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const s=i.flush(e);Hn(s)?s.then(n=>{this.handleFlushResult(n,e)}).catch(n=>{this.transmuxerError(n,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(I.ERROR,{type:Te.MEDIA_ERROR,details:ee.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Ef=100;class Eb extends Nc{constructor(e,t,i){super(e,t,i,"audio-stream-controller",ye.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(I.BUFFER_RESET,this.onBufferReset,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(I.BUFFER_RESET,this.onBufferReset,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:n,trackId:a}){if(i===ye.MAIN){const o=t.cc,l=this.fragCurrent;if(this.initPTS[o]={baseTime:s,timescale:n,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${s/n} (${s}/${n}) trackId: ${a}`),this.mainAnchor=t,this.state===le.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==o)&&this.syncWithAnchor(t,u?.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==o?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===le.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;const s=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&s?.cc===t.cc)return;const n=(s||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),l=Ug(a,n,o);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===le.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=le.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(Ef),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=le.IDLE):this.state=le.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case le.IDLE:this.doTickIdle();break;case le.WAITING_TRACK:{const{levels:e,trackId:t}=this,i=e?.[t],s=i?.details;if(s&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(s))break;this.state=le.WAITING_INIT_PTS}break}case le.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case le.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:i,cache:s,complete:n}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=le.FRAG_LOADING;const o=s.flush().buffer,l={frag:t,part:i,payload:o,networkDetails:null};this._handleFragmentLoadProgress(l),n&&super._handleFragmentLoadComplete(l)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=le.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:s,trackId:n}=this,a=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(i!=null&&i[n]))return;const o=i[n],l=o.details;if(!l||this.waitForLive(o)||this.waitForCdnTuneIn(l)){this.state=le.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,ze.AUDIO,ye.AUDIO));const c=this.getFwdBufferInfo(u,ye.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,l)){t.trigger(I.BUFFER_EOS,{type:"audio"}),this.state=le.ENDED;return}const h=c.len,f=t.maxBufferLength,p=l.fragments,m=p[0].start,y=this.getLoadPosition(),v=this.flushing?y:c.end;if(this.switchingTrack&&s){const x=y;l.PTSKnown&&x<m&&(c.end>m||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=m+.05)}if(h>=f&&!this.switchingTrack&&v<p[p.length-1].start)return;let E=this.getNextFragment(v,l);if(E&&this.isLoopLoading(E,v)&&(E=this.getNextFragmentLoopLoading(E,l,c,ye.MAIN,f)),!E){this.bufferFlushed=!0;return}let A=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&A&&gt(E)&&!E.endList&&(!l.live||!this.loadingParts&&v<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(A)===vt.OK&&(this.mainFragLoading=A=null),A&&gt(A))){if(E.start>A.end){const w=this.fragmentTracker.getFragAtPos(v,ye.MAIN);w&&w.end>A.end&&(A=w,this.mainFragLoading={frag:w,targetBufferTime:null})}if(E.start>A.end)return}this.loadFragment(E,o,v)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new $n(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==le.STOPPED&&(this.setInterval(Ef),this.state=le.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(I.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:s}=this,{details:n,id:a,groupId:o,track:l}=t;if(!s){this.warn(`Audio tracks reset while loading track ${a} "${l.name}" of "${o}"`);return}const u=this.mainDetails;if(!u||n.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==le.STOPPED&&(this.state=le.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${l.name}" of "${o}" loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`);const c=s[a];let h=0;if(n.live||(i=c.details)!=null&&i.live){if(this.checkLiveUpdate(n),n.deltaUpdateFailed)return;if(c.details){var f;h=this.alignPlaylists(n,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}n.alignedSliding||(sm(n,u),n.alignedSliding||vo(n,u),h=n.fragmentStart)}c.details=n,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,h),this.hls.trigger(I.AUDIO_TRACK_UPDATED,{details:n,id:a,groupId:t.groupId}),this.state===le.WAITING_TRACK&&!this.waitForCdnTuneIn(n)&&(this.state=le.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:s,payload:n}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const u=l[o];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const h=a.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new bm(this.hls,ye.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const p=this.initPTS[i.cc],m=(t=i.initSegment)==null?void 0:t.data;if(p!==void 0){const v=s?s.index:-1,E=v!==-1,A=new Oc(i.level,i.sn,i.stats.chunkCount,n.byteLength,v,E);f.push(n,m,h,"",i,s,c.totalduration,!1,A,p)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${c.startSN} ,${c.endSN}],track ${o}`);const{cache:y}=this.waitingData=this.waitingData||{frag:i,part:s,cache:new rm,complete:!1};y.push(new Uint8Array(n)),this.state!==le.STOPPED&&(this.state=le.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ye.MAIN&&gt(t.frag)&&(this.mainFragLoading=t,this.state===le.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:s}=t;if(i.type!==ye.AUDIO){!this.audioOnly&&i.type===ye.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(gt(i)){this.fragPrevious=i;const n=this.switchingTrack;n&&(this.bufferedTrack=n,this.switchingTrack=null,this.hls.trigger(I.AUDIO_TRACK_SWITCHED,He({},n)))}this.fragBufferedComplete(i,s),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=le.ERROR;return}switch(t.details){case ee.FRAG_GAP:case ee.FRAG_PARSING_ERROR:case ee.FRAG_DECRYPT_ERROR:case ee.FRAG_LOAD_ERROR:case ee.FRAG_LOAD_TIMEOUT:case ee.KEY_LOAD_ERROR:case ee.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ye.AUDIO,t);break;case ee.AUDIO_TRACK_LOAD_ERROR:case ee.AUDIO_TRACK_LOAD_TIMEOUT:case ee.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===le.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===Pe.AUDIO_TRACK&&(this.state=le.IDLE);break;case ee.BUFFER_ADD_CODEC_ERROR:case ee.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case ee.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ee.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ze.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ze.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===le.ENDED&&(this.state=le.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,ye.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:s}=this,{remuxResult:n,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:u,level:c}=o,{details:h}=c,{audio:f,text:p,id3:m,initSegment:y}=n;if(this.fragContextChanged(l)||!h){this.fragmentTracker.removeFragment(l);return}if(this.state=le.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),y!=null&&y.tracks){const v=l.initSegment||l;if(this.unhandledEncryptionError(y,l))return;this._bufferInitSegment(c,y.tracks,v,a),s.trigger(I.FRAG_PARSING_INIT_SEGMENT,{frag:v,id:i,tracks:y.tracks})}if(f){const{startPTS:v,endPTS:E,startDTS:A,endDTS:x}=f;u&&(u.elementaryStreams[ze.AUDIO]={startPTS:v,endPTS:E,startDTS:A,endDTS:x}),l.setElementaryStreamInfo(ze.AUDIO,v,E,A,x),this.bufferFragmentData(f,l,u,a)}if(m!=null&&(t=m.samples)!=null&&t.length){const v=Ke({id:i,frag:l,details:h},m);s.trigger(I.FRAG_PARSING_METADATA,v)}if(p){const v=Ke({id:i,frag:l,details:h},p);s.trigger(I.FRAG_PARSING_USERDATA,v)}}_bufferInitSegment(e,t,i,s){if(this.state!==le.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const n=t.audio;n.id=ye.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${n.container}, codecs[level/parsed]=[${a}/${n.codec}]`),a&&a.split(",").length===1&&(n.levelCodec=a),this.hls.trigger(I.BUFFER_CODECS,t);const o=n.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:i,part:null,chunkMeta:s,parent:i.type,data:o};this.hls.trigger(I.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===vt.NOT_LOADED||s===vt.PARTIAL){var n;if(!gt(e))this._loadInitSegment(e,t);else if((n=t.details)!=null&&n.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=le.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&vo(t.details,a)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:s,characteristics:n,audioCodec:a,channels:o}=this.bufferedTrack;Ys({name:t,lang:i,assocLang:s,characteristics:n,audioCodec:a,channels:o},e,Hs)||(go(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(I.AUDIO_TRACK_SWITCHED,He({},e))}}class jc extends yi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const s=t?.renditionReports;if(s){let n=-1;for(let a=0;a<s.length;a++){const o=s[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=o.URI||""}if(l===e){n=a;break}else l===e.substring(0,l.length)&&(n=a)}if(n!==-1){const a=s[n],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let l=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=i&&Fd(i);return new Nd(o,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:s,stats:n}=t,a=self.performance.now(),o=n.loading.first?Math.max(0,a-n.loading.first):0;s.advancedDateTime=Date.now()-o;const l=this.hls.config.timelineOffset;if(l!==s.appliedTimelineOffset){const c=Math.max(l||0,0);s.appliedTimelineOffset=c,s.fragments.forEach(h=>{h.setStart(h.playlistOffset+c)})}if(s.live||i!=null&&i.live){const c="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(i),i&&s.fragments.length>0){pE(i,s,this);const A=s.playlistParsingError;if(A){this.warn(A);const x=this.hls;if(!x.config.ignorePlaylistParsingErrors){var u;const{networkDetails:w}=t;x.trigger(I.ERROR,{type:Te.NETWORK_ERROR,details:ee.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:A,reason:A.message,level:t.level||void 0,parent:(u=s.fragments[0])==null?void 0:u.type,networkDetails:w,stats:n});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=n.loading.start);const h=this.hls.mainForwardBufferInfo,f=h?h.end-h.len:0,p=(s.edge-f)*1e3,m=Jg(s,p);if(s.requestScheduled+m<a?s.requestScheduled=a:s.requestScheduled+=m,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let y,v,E;if(s.canBlockReload&&s.endSN&&s.advanced){const A=this.hls.config.lowLatencyMode,x=s.lastPartSn,w=s.endSN,k=s.lastPartIndex,F=k!==-1,L=x===w;F?L?(v=w+1,E=A?0:k):(v=x,E=A?k+1:s.maxPartIndex):v=w+1;const M=s.age,C=M+s.ageHeader;let D=Math.min(C-s.partTarget,s.targetduration*1.5);if(D>0){if(C>s.targetduration*3)this.log(`Playlist last advanced ${M.toFixed(2)}s ago. Omitting segment and part directives.`),v=void 0,E=void 0;else if(i!=null&&i.tuneInGoal&&C-s.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${D} with playlist age: ${s.age}`),D=0;else{const B=Math.floor(D/s.targetduration);if(v+=B,E!==void 0){const H=Math.round(D%s.targetduration/s.partTarget);E+=H}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${M.toFixed(2)}s goal: ${D} skip sn ${B} to part ${E}`)}s.tuneInGoal=D}if(y=this.getDeliveryDirectives(s,t.deliveryDirectives,v,E),A||!L){s.requestScheduled=a,this.loadingPlaylist(c,y);return}}else(s.canBlockReload||s.canSkipUntil)&&(y=this.getDeliveryDirectives(s,t.deliveryDirectives,v,E));y&&v!==void 0&&s.canBlockReload&&(s.requestScheduled=n.loading.first+Math.max(m-o*2,m/2)),this.scheduleLoading(c,y,s)}else this.clearTimer()}scheduleLoading(e,t,i){const s=i||e.details;if(!s){this.loadingPlaylist(e,t);return}const n=self.performance.now(),a=s.requestScheduled;if(n>=a){this.loadingPlaylist(e,t);return}const o=a-n;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,i,s){let n=Fd(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,s=t.part,n=to.No),new Nd(i,s,n)}checkRetry(e){const t=e.details,i=mo(e),s=e.errorAction,{action:n,retryCount:a=0,retryConfig:o}=s||{},l=!!s&&!!o&&(n===It.RetryRequest||!s.resolved&&n===It.SendAlternateToPenaltyBox);if(l){var u;if(a>=o.maxNumRetry)return!1;if(i&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=kc(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,s.resolved=!0}return l}}function xm(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!qn(r[t].attrs,e[t].attrs))return!1;return!0}function qn(r,e,t){const i=r["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>r[s]!==e[s])}function Ku(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}class bb extends jc{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(I.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:s,details:n}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==s){this.warn(`Audio track with id:${i} and group:${s} not found in active group ${a?.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${i} "${a.name}" lang:${a.lang} group:${s} loaded [${n.startSN}-${n.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,s=this.groupIds;let n=this.currentTrack;if(!i||s?.length!==i?.length||i!=null&&i.some(o=>s?.indexOf(o)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(f=>!i||i.indexOf(f.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(f=>f.default)&&(this.selectDefaultTrack=!1),o.forEach((f,p)=>{f.id=p});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!n&&l){const f=Gi(l,o,Hs);if(f>-1)n=o[f];else{const p=Gi(l,this.tracks);n=this.tracks[p]}}let u=this.findTrackId(n);u===-1&&n&&(u=this.findTrackId(null));const c={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${i?.join(",")}`),this.hls.trigger(I.AUDIO_TRACKS_UPDATED,c);const h=this.trackId;if(u!==-1&&h===-1)this.setAudioTrack(u);else if(o.length&&h===-1){var a;const f=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(f.message),this.hls.trigger(I.ERROR,{type:Te.MEDIA_ERROR,details:ee.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===Pe.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const s=this.currentTrack;if(s&&Ys(e,s,Hs))return s;const n=Gi(e,this.tracksInGroup,Hs);if(n>-1){const a=this.tracksInGroup[n];return this.setAudioTrack(n),a}else if(s){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=MS(e,t.levels,i,a,Hs);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=Gi(e,i);if(a>-1)return i[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,s=t[e],n=s.details&&!s.details.live;if(e===this.trackId&&s===i&&n||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(I.AUDIO_TRACK_SWITCHING,He({},s)),n))return;const a=this.switchParams(s.url,i?.details,s.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if(!(this.selectDefaultTrack&&!s.default)&&(!e||Ys(e,s,Hs)))return i}if(e){const{name:i,lang:s,assocLang:n,characteristics:a,audioCodec:o,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(Ys({name:i,lang:s,assocLang:n,characteristics:a,audioCodec:o,channels:l},c,Hs))return u}for(let u=0;u<t.length;u++){const c=t[u];if(qn(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(qn(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&go(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,s=e.groupId,n=this.getUrlWithDirectives(e.url,t),a=e.details,o=a?.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(I.AUDIO_TRACK_LOADING,{url:n,id:i,groupId:s,deliveryDirectives:t||null,track:e})}}class xb{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(n){var i;if(s.onError(n),this.queues===null||this.tracks===null)return;const a=(i=this.tracks[e])==null?void 0:i.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],s=i?.buffer;return s?`SourceBuffer${s.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const bf=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Am="HlsJsTrackRemovedError";class Ab extends Error{constructor(e){super(e),this.name=Am}}class Cb extends yi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:s,mediaSource:n}=this;i&&this.log("Media source opened"),!(!s||!n)&&(n.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(I.MEDIA_ATTACHED,{media:s,mediaSource:n}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:s}=this;i!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=zv(Ls(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.BUFFER_RESET,this.onBufferReset,this),e.on(I.BUFFER_APPENDING,this.onBufferAppending,this),e.on(I.BUFFER_CODECS,this.onBufferCodecs,this),e.on(I.BUFFER_EOS,this.onBufferEos,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.FRAG_PARSED,this.onFragParsed,this),e.on(I.FRAG_CHANGED,this.onFragChanged,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.BUFFER_RESET,this.onBufferReset,this),e.off(I.BUFFER_APPENDING,this.onBufferAppending,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.BUFFER_EOS,this.onBufferEos,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.FRAG_PARSED,this.onFragParsed,this),e.off(I.FRAG_CHANGED,this.onFragChanged,this),e.off(I.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const n=this.isUpdating();n||this.operationQueue.removeBlockers();const a=this.isQueued();(n||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${n?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?Ke(i,s.tracks):this.sourceBuffers.forEach(n=>{const[a]=n;a&&(i[a]=Ke({},this.tracks[a]),this.removeBuffer(a)),n[0]=n[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media;this.transferData=this.overrides=void 0;const s=Ls(this.appendSource);if(s){const n=!!t.mediaSource;(n||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(a),n)this._objectUrl=i.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{i.removeAttribute("src");const l=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||l&&a instanceof l,xf(i),Ib(i,o),i.load()}catch{i.src=o}else i.src=o}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,s=t.tracks,n=s?Object.keys(s):null,a=n?n.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&n&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Ye(i,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${Ye(s,(l,u)=>l==="initSegment"?void 0:u)}}`),!Sg(s,i)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,u=this.details,c=Math.max(l,u?.fragments[0].start||0);if(c-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(i)}") start time: ${c} currentTime: ${l}`),this.onMediaDetaching(I.MEDIA_DETACHING,{}),this.onMediaAttaching(I.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,n.forEach(l=>{const u=l,c=s[u];if(c){const h=c.buffer;if(h){const f=this.fragmentTracker,p=c.id;if(f.hasFragments(p)||f.hasParts(p)){const v=Ie.getBuffered(h);f.detectEvictedFragments(u,v,p,null,!0)}const m=Gl(u),y=[u,h];this.sourceBuffers[m]=y,h.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,c)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:n,_objectUrl:a}=this;if(n){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=n.readyState==="open";try{const l=n.sourceBuffers;for(let u=l.length;u--;)o&&l[u].abort(),n.removeSourceBuffer(l[u]);o&&n.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}n.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("sourceended",this._onMediaSourceEnded),n.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(n.removeEventListener("startstreaming",this._onStartStreaming),n.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),i||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(s.removeAttribute("src"),this.appendSource&&xf(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(I.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(n){this.warn(`onBufferReset ${e}`,n)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Gl(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new xb(this.tracks)}onBufferCodecs(e,t){var i;const s=this.tracks,n=Object.keys(t);this.log(`BUFFER_CODECS: "${n}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&n.some(l=>!s[l]);if(a||o){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${n}" SourceBuffers`);return}n.forEach(l=>{var u,c;const h=t[l],{id:f,codec:p,levelCodec:m,container:y,metadata:v,supplemental:E}=h;let A=s[l];const x=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[l],w=x!=null&&x.buffer?x:A,k=w?.pendingCodec||w?.codec,F=w?.levelCodec;A||(A=s[l]={buffer:void 0,listeners:[],codec:p,supplemental:E,container:y,levelCodec:m,metadata:v,id:f});const L=eo(k,F),M=L?.replace(bf,"$1");let C=eo(p,m);const D=(c=C)==null?void 0:c.replace(bf,"$1");C&&L&&M!==D&&(l.slice(0,5)==="audio"&&(C=fo(C,this.appendSource)),this.log(`switching codec ${k} to ${C}`),C!==(A.pendingCodec||A.codec)&&(A.pendingCodec=C),A.container=y,this.appendChangeType(l,y,C))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((i=t.audio)==null?void 0:i.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const s=`${t};codecs=${i}`,n={label:`change-type=${s}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),o.changeType(s),a.codec=i,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(n,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,s=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,ye.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const l=this.tracks.video;(this.lastVideoAppendEnd>s||l!=null&&l.buffer&&Ie.isBuffered(l.buffer,s)||((o=this.fragmentTracker.getAppendedFrag(s,ye.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:s,type:n,parent:a,frag:o,part:l,chunkMeta:u,offset:c}=t,h=u.buffering[n],{sn:f,cc:p}=o,m=self.performance.now();h.start=m;const y=o.stats.buffering,v=l?l.stats.buffering:null;y.start===0&&(y.start=m),v&&v.start===0&&(v.start=m);const E=i.audio;let A=!1;n==="audio"&&E?.container==="audio/mpeg"&&(A=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const x=i.video,w=x?.buffer;if(w&&f!=="initSegment"){const L=l||o,M=this.blockedAudioAppend;if(n==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(x.ending||x.ended)){const D=L.start+L.duration*.05,B=w.buffered,H=this.currentOp("video");!B.length&&!H?this.blockAudio(L):!H&&!Ie.isBuffered(w,D)&&this.lastVideoAppendEnd<D&&this.blockAudio(L)}else if(n==="video"){const C=L.end;if(M){const D=M.frag.start;(C>D||C<this.lastVideoAppendEnd||Ie.isBuffered(w,D))&&this.unblockAudio()}this.lastVideoAppendEnd=C}}const k=(l||o).start,F={label:`append-${n}`,execute:()=>{var L;h.executeStart=self.performance.now();const M=(L=this.tracks[n])==null?void 0:L.buffer;M&&(A?this.updateTimestampOffset(M,k,.1,n,f,p):c!==void 0&&pe(c)&&this.updateTimestampOffset(M,c,1e-6,n,f,p)),this.appendExecutor(s,n)},onStart:()=>{},onComplete:()=>{const L=self.performance.now();h.executeEnd=h.end=L,y.first===0&&(y.first=L),v&&v.first===0&&(v.first=L);const M={};this.sourceBuffers.forEach(([C,D])=>{C&&(M[C]=Ie.getBuffered(D))}),this.appendErrors[n]=0,n==="audio"||n==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(I.BUFFER_APPENDED,{type:n,frag:o,part:l,chunkMeta:u,parent:o.type,timeRanges:M})},onError:L=>{var M;const C={type:Te.MEDIA_ERROR,parent:o.type,details:ee.BUFFER_APPEND_ERROR,sourceBufferName:n,frag:o,part:l,chunkMeta:u,error:L,err:L,fatal:!1},D=(M=this.media)==null?void 0:M.error;if(L.code===DOMException.QUOTA_EXCEEDED_ERR||L.name=="QuotaExceededError"||"quota"in L)C.details=ee.BUFFER_FULL_ERROR;else if(L.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!D)C.errorAction=Er(!0);else if(L.name===Am&&this.sourceBufferCount===0)C.errorAction=Er(!0);else{const B=++this.appendErrors[n];this.warn(`Failed ${B}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${n}" sourceBuffer (${D||"no media error"})`),(B>=this.hls.config.appendErrorMaxRetry||D)&&(C.fatal=!0)}this.hls.trigger(I.ERROR,C)}};this.log(`queuing "${n}" append sn: ${f}${l?" p: "+l.index:""} of ${o.type===ye.MAIN?"level":"track"} ${o.level} cc: ${p}`),this.append(F,n,this.isPending(this.tracks[n]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(I.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:i,startOffset:s,endOffset:n}=t;i?this.append(this.getFlushOp(i,s,n),i):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,s,n),a)})}onFragParsed(e,t){const{frag:i,part:s}=t,n=[],a=s?s.elementaryStreams:i.elementaryStreams;a[ze.AUDIOVIDEO]?n.push("audiovideo"):(a[ze.AUDIO]&&n.push("audio"),a[ze.VIDEO]&&n.push("video"));const o=()=>{const l=self.performance.now();i.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const u=s?s.stats:i.stats;this.hls.trigger(I.FRAG_BUFFERED,{frag:i,part:s,stats:u,id:i.type})};n.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(o,n).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const s=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(I.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(I.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===ee.BUFFER_APPEND_ERROR&&t.frag){var i;const s=(i=t.errorAction)==null?void 0:i.nextAutoLevel;pe(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const s=e.config,n=i.currentTime,a=t.levelTargetDuration,o=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(pe(o)&&o>=0){const u=Math.max(o,a),c=Math.floor(n/a)*a-u;this.flushBackBuffer(n,a,c)}const l=s.frontBufferFlushThreshold;if(pe(l)&&l>0){const u=Math.max(s.maxBufferLength,l),c=Math.max(u,a),h=Math.floor(n/a)*a+c;this.flushFrontBuffer(n,a,h)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([s,n])=>{if(n){const o=Ie.getBuffered(n);if(o.length>0&&i>o.start(0)){var a;this.hls.trigger(I.BACK_BUFFER_REACHED,{bufferEnd:i});const l=this.tracks[s];if((a=this.details)!=null&&a.live)this.hls.trigger(I.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(l!=null&&l.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:s})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([s,n])=>{if(n){const a=Ie.getBuffered(n),o=a.length;if(o<2)return;const l=a.start(o-1),u=a.end(o-1);if(i>l||e>=l&&e<=u)return;this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||i?.readyState!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&i.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),c=Math.max(u,s);return{duration:1/0,start:u,end:c}}return{duration:1/0}}const n=(e=this.overrides)==null?void 0:e.duration;if(n)return pe(n)?{duration:n}:null;const a=this.media.duration,o=pe(i.duration)?i.duration:0;return s>o&&s>a||!pe(a)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:i}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(pe(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${i}.`),s.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Ye(i)}`),this.tracksReady){var s;const n=(s=this.transferData)==null?void 0:s.tracks;n&&Object.keys(n).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const s=this.tracks[t];e[t]={buffer:i,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(I.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(I.ERROR,{type:Te.MEDIA_ERROR,details:ee.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const n in e){const a=n,o=e[a];if(this.isPending(o)){const l=this.getTrackCodec(o,a),u=`${o.container};codecs=${l}`;o.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(a)?" Queued":""} ${Ye(o)}`);try{const c=i.addSourceBuffer(u),h=Gl(a),f=[a,c];t[h]=f,o.buffer=c}catch(c){var s;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(a),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[a],this.hls.trigger(I.ERROR,{type:Te.MEDIA_ERROR,details:ee.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:a,mimeType:u,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let s=e.codec;i&&(t==="video"||t==="audiovideo")&&Bn(i,"video")&&(s=mS(s,i));const n=eo(s,e.levelCodec);return n?t.slice(0,5)==="audio"?fo(n,this.appendSource):n:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(n,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(I.BUFFER_FLUSHED,{type:n})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${s}`,t),this.hls.trigger(I.ERROR,{type:Te.MEDIA_ERROR,details:ee.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const n=this.currentOp(e);n&&n.onError(s)}updateTimestampOffset(e,t,i,s,n,a){const o=t-e.timestampOffset;Math.abs(o)>=i&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${n} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,i){const{media:s,mediaSource:n}=this,a=this.tracks[e],o=a?.buffer;if(!s||!n||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=pe(s.duration)?s.duration:1/0,u=pe(n.duration)?n.duration:1/0,c=Math.max(0,t),h=Math.min(i,l,u);h>c&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${c},${h}] from the ${e} SourceBuffer`),o.remove(c,h)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],s=i?.buffer;if(!s)throw new Ab(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,s=t.map(a=>this.appendBlocker(a));return t.length>1&&this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(a=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const s=(i=this.tracks[t])==null?void 0:i.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const s=this.tracks[e];if(!s)return;const n=s.buffer;if(!n)return;const a=i.bind(this,e);s.listeners.push({event:t,listener:a}),n.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(s=>{i.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function xf(r){const e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function Ib(r,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}function Gl(r){return r==="audio"?1:0}class Kc{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(I.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.BUFFER_CODECS,this.onBufferCodecs,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(I.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&pe(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((s,n)=>this.isLevelAllowed(s)&&n<=e);return this.clientRect=null,Kc.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const s=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let n=e.length-1;const a=Math.max(t,i);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&s(l,e[o+1])){n=o;break}}return n}}const Db={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Gt=Db,Lb={HLS:"h"},Rb=Lb;class zi{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof zi?i:new zi(i))),this.value=e,this.params=t}}const wb="Dict";function kb(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function Pb(r,e,t,i){return new Error(`failed to ${r} "${kb(e)}" as ${t}`,{cause:i})}function Yi(r,e,t){return Pb("serialize",r,e,t)}class Cm{constructor(e){this.description=e}}const Af="Bare Item",Ob="Boolean";function Mb(r){if(typeof r!="boolean")throw Yi(r,Ob);return r?"?1":"?0"}function Fb(r){return btoa(String.fromCharCode(...r))}const Nb="Byte Sequence";function Bb(r){if(ArrayBuffer.isView(r)===!1)throw Yi(r,Nb);return`:${Fb(r)}:`}const Ub="Integer";function $b(r){return r<-999999999999999||999999999999999<r}function Im(r){if($b(r))throw Yi(r,Ub);return r.toString()}function Vb(r){return`@${Im(r.getTime()/1e3)}`}function Dm(r,e){if(r<0)return-Dm(-r,e);const t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){const s=Math.floor(r*t);return(s%2===0?s:s+1)/t}else return Math.round(r*t)/t}const Gb="Decimal";function Hb(r){const e=Dm(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Yi(r,Gb);const t=e.toString();return t.includes(".")?t:`${t}.0`}const qb="String",jb=/[\x00-\x1f\x7f]+/;function Kb(r){if(jb.test(r))throw Yi(r,qb);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function Wb(r){return r.description||r.toString().slice(7,-1)}const zb="Token";function Cf(r){const e=Wb(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Yi(e,zb);return e}function Wu(r){switch(typeof r){case"number":if(!pe(r))throw Yi(r,Af);return Number.isInteger(r)?Im(r):Hb(r);case"string":return Kb(r);case"symbol":return Cf(r);case"boolean":return Mb(r);case"object":if(r instanceof Date)return Vb(r);if(r instanceof Uint8Array)return Bb(r);if(r instanceof Cm)return Cf(r);default:throw Yi(r,Af)}}const Yb="Key";function zu(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw Yi(r,Yb);return r}function Wc(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${zu(e)}`:`;${zu(e)}=${Wu(t)}`).join("")}function Lm(r){return r instanceof zi?`${Wu(r.value)}${Wc(r.params)}`:Wu(r)}function Xb(r){return`(${r.value.map(Lm).join(" ")})${Wc(r.params)}`}function Qb(r,e={whitespace:!0}){if(typeof r!="object"||r==null)throw Yi(r,wb);const t=r instanceof Map?r.entries():Object.entries(r),i=e?.whitespace?" ":"";return Array.from(t).map(([s,n])=>{n instanceof zi||(n=new zi(n));let a=zu(s);return n.value===!0?a+=Wc(n.params):(a+="=",Array.isArray(n.value)?a+=Xb(n):a+=Lm(n)),a}).join(`,${i}`)}function Rm(r,e){return Qb(r,e)}const Fi="CMCD-Object",dt="CMCD-Request",Us="CMCD-Session",vs="CMCD-Status",Jb={br:Fi,ab:Fi,d:Fi,ot:Fi,tb:Fi,tpb:Fi,lb:Fi,tab:Fi,lab:Fi,url:Fi,pb:dt,bl:dt,tbl:dt,dl:dt,ltc:dt,mtp:dt,nor:dt,nrr:dt,rc:dt,sn:dt,sta:dt,su:dt,ttfb:dt,ttfbb:dt,ttlb:dt,cmsdd:dt,cmsds:dt,smrt:dt,df:dt,cs:dt,ts:dt,cid:Us,pr:Us,sf:Us,sid:Us,st:Us,v:Us,msd:Us,bs:vs,bsd:vs,cdn:vs,rtp:vs,bg:vs,pt:vs,ec:vs,e:vs},Zb={REQUEST:dt};function ex(r){return Object.keys(r).reduce((e,t)=>{var i;return(i=r[t])===null||i===void 0||i.forEach(s=>e[s]=t),e},{})}function tx(r,e){const t={};if(!r)return t;const i=Object.keys(r),s=e?ex(e):{};return i.reduce((n,a)=>{var o;const l=Jb[a]||s[a]||Zb.REQUEST,u=(o=n[l])!==null&&o!==void 0?o:n[l]={};return u[a]=r[a],n},t)}function ix(r){return["ot","sf","st","e","sta"].includes(r)}function sx(r){return typeof r=="number"?pe(r):r!=null&&r!==""&&r!==!1}const wm="event";function rx(r,e){const t=new URL(r),i=new URL(e);if(t.origin!==i.origin)return r;const s=t.pathname.split("/").slice(1),n=i.pathname.split("/").slice(1,-1);for(;s[0]===n[0];)s.shift(),n.shift();for(;n.length;)n.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const no=r=>Math.round(r),Yu=(r,e)=>Array.isArray(r)?r.map(t=>Yu(t,e)):r instanceof zi&&typeof r.value=="string"?new zi(Yu(r.value,e),r.params):(e.baseUrl&&(r=rx(r,e.baseUrl)),e.version===1?encodeURIComponent(r):r),Ua=r=>no(r/100)*100,nx=(r,e)=>{let t=r;return e.version>=2&&(r instanceof zi&&typeof r.value=="string"?t=new zi([r]):typeof r=="string"&&(t=[r])),Yu(t,e)},ax={br:no,d:no,bl:Ua,dl:Ua,mtp:Ua,nor:nx,rtp:Ua,tb:no},km="request",Pm="response",zc=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],ox=["e"],lx=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Ko(r){return lx.test(r)}function ux(r){return zc.includes(r)||ox.includes(r)||Ko(r)}const Om=["d","dl","nor","ot","rtp","su"];function cx(r){return zc.includes(r)||Om.includes(r)||Ko(r)}const hx=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function dx(r){return zc.includes(r)||Om.includes(r)||hx.includes(r)||Ko(r)}const fx=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function px(r){return fx.includes(r)||Ko(r)}const gx={[Pm]:dx,[wm]:ux,[km]:cx};function Mm(r,e={}){const t={};if(r==null||typeof r!="object")return t;const i=e.version||r.v||1,s=e.reportingMode||km,n=i===1?px:gx[s];let a=Object.keys(r).filter(n);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const l=s===Pm||s===wm;l&&!a.includes("ts")&&a.push("ts"),i>1&&!a.includes("v")&&a.push("v");const u=Ke({},ax,e.formatters),c={version:i,reportingMode:s,baseUrl:e.baseUrl};return a.sort().forEach(h=>{let f=r[h];const p=u[h];if(typeof p=="function"&&(f=p(f,c)),h==="v"){if(i===1)return;f=i}h=="pr"&&f===1||(l&&h==="ts"&&!pe(f)&&(f=Date.now()),sx(f)&&(ix(h)&&typeof f=="string"&&(f=new Cm(f)),t[h]=f))}),t}function mx(r,e={}){const t={};if(!r)return t;const i=Mm(r,e),s=tx(i,e?.customHeaderMap);return Object.entries(s).reduce((n,[a,o])=>{const l=Rm(o,{whitespace:!1});return l&&(n[a]=l),n},t)}function yx(r,e,t){return Ke(r,mx(e,t))}const Tx="CMCD";function _x(r,e={}){return r?Rm(Mm(r,e),{whitespace:!1}):""}function vx(r,e={}){if(!r)return"";const t=_x(r,e);return encodeURIComponent(t)}function Sx(r,e={}){if(!r)return"";const t=vx(r,e);return`${Tx}=${t}`}const If=/CMCD=[^&#]+/;function Ex(r,e,t){const i=Sx(e,t);if(!i)return r;if(If.test(r))return r.replace(If,i);const s=r.includes("?")?"&":"?";return`${r}${s}${i}`}class bx{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:Gt.MANIFEST,su:!this.initialized})}catch(n){this.hls.logger.warn("Could not generate manifest CMCD data.",n)}},this.applyFragmentData=s=>{try{const{frag:n,part:a}=s,o=this.hls.levels[n.level],l=this.getObjectType(n),u={d:(a||n).duration*1e3,ot:l};(l===Gt.VIDEO||l===Gt.AUDIO||l==Gt.MUXED)&&(u.br=o.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));const c=a?this.getNextPart(a):this.getNextFrag(n);c!=null&&c.url&&c.url!==n.url&&(u.nor=c.url),this.apply(s,u)}catch(n){this.hls.logger.warn("Could not generate segment CMCD data.",n)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHED,this.onMediaDetached,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHED,this.onMediaDetached,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,s;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:Rb.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ke(t,this.createData());const i=t.ot===Gt.INIT||t.ot===Gt.VIDEO||t.ot===Gt.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((a,o)=>(s.includes(o)&&(a[o]=t[o]),a),{}));const n={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),yx(e.headers,t,n)):e.url=Ex(e.url,t,n)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const s=e.sn-i.startSN;return i.fragments[s+1]}}getNextPart(e){var t;const{index:i,fragment:s}=e,n=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(n){const{sn:a}=s;for(let o=n.length-1;o>=0;o--){const l=n[o];if(l.index===i&&l.fragment.sn===a)return n[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Gt.TIMED_TEXT;if(e.sn==="initSegment")return Gt.INIT;if(t==="audio")return Gt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Gt.VIDEO:Gt.MUXED}getTopBandwidth(e){let t=0,i;const s=this.hls;if(e===Gt.AUDIO)i=s.audioTracks;else{const n=s.maxAutoLevel,a=n>-1?n+1:s.levels.length;i=s.levels.slice(0,a)}return i.forEach(n=>{n.bitrate>t&&(t=n.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===Gt.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:Ie.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new i(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,a,o){t(n),this.loader.load(n,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new i(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,a,o){t(n),this.loader.load(n,a,o)}}}}const xx=3e5;let Ax=class extends yi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if(i?.action===It.SendAlternateToPenaltyBox&&i.flags===ei.MoveAllAlternatesMatchingHost){const s=this.levels;let n=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:u}=t.context;o&&s?a=this.getPathwayForGroupId(o,u,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!n&&s&&(n=this.pathways()),n&&n.length>1&&(this.updatePathwayPriority(n),i.resolved=this.pathwayId!==a),t.details===ee.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${s&&s.length} priorities: ${Ye(n)} penalized: ${Ye(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(n=>{s-i[n]>xx&&delete i[n]});for(let n=0;n<e.length;n++){const a=e[n];if(a in i)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,tm(t),this.hls.trigger(I.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[o];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,i){const s=this.getLevelsForPathway(i).concat(this.levels||[]);for(let n=0;n<s.length;n++)if(t===Pe.AUDIO_TRACK&&s[n].hasAudioGroup(e)||t===Pe.SUBTITLE_TRACK&&s[n].hasSubtitleGroup(e))return s[n].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},s={};e.forEach(n=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=n;if(t.some(c=>c.pathwayId===a))return;const u=this.getLevelsForPathway(o).map(c=>{const h=new at(c.attrs);h["PATHWAY-ID"]=a;const f=h.AUDIO&&`${h.AUDIO}_clone_${a}`,p=h.SUBTITLES&&`${h.SUBTITLES}_clone_${a}`;f&&(i[h.AUDIO]=f,h.AUDIO=f),p&&(s[h.SUBTITLES]=p,h.SUBTITLES=p);const m=Fm(c.uri,h["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),y=new $n({attrs:h,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:m,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let v=1;v<c.audioGroups.length;v++)y.addGroupId("audio",`${c.audioGroups[v]}_clone_${a}`);if(c.subtitleGroups)for(let v=1;v<c.subtitleGroups.length;v++)y.addGroupId("text",`${c.subtitleGroups[v]}_clone_${a}`);return y});t.push(...u),Df(this.audioTracks,i,l,a),Df(this.subtitleTracks,s,l,a)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+c)}const n={responseType:"json",url:s.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},u={onSuccess:(c,h,f,p)=>{this.log(`Loaded steering manifest: "${s}"`);const m=c.data;if(m?.VERSION!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":y,"PATHWAY-CLONES":v,"PATHWAY-PRIORITY":E}=m;if(y)try{this.uri=new self.URL(y,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${y}`);return}this.scheduleRefresh(this.uri||f.url),v&&this.clonePathways(v);const A={steeringManifest:m,url:s.toString()};this.hls.trigger(I.STEERING_MANIFEST_LOADED,A),E&&this.updatePathwayPriority(E)},onError:(c,h,f,p)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${h.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${h.url} no longer available`);return}let m=this.timeToLoad*1e3;if(c.code===429){const y=this.loader;if(typeof y?.getResponseHeader=="function"){const v=y.getResponseHeader("Retry-After");v&&(m=parseFloat(v)*1e3)}this.log(`Steering manifest ${h.url} rate limited`);return}this.scheduleRefresh(this.uri||h.url,m)},onTimeout:(c,h,f)=>{this.log(`Timeout loading steering manifest (${h.url})`),this.scheduleRefresh(this.uri||h.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(n,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const s=(i=this.hls)==null?void 0:i.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}};function Df(r,e,t,i){r&&Object.keys(e).forEach(s=>{const n=r.filter(a=>a.groupId===s).map(a=>{const o=Ke({},a);return o.details=void 0,o.attrs=new at(o.attrs),o.url=o.attrs.URI=Fm(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[s],o.attrs["PATHWAY-ID"]=i,o});r.push(...n)})}function Fm(r,e,t,i){const{HOST:s,PARAMS:n,[t]:a}=i;let o;e&&(o=a?.[e],o&&(r=o));const l=new self.URL(r);return s&&!o&&(l.host=s),n&&Object.keys(n).sort().forEach(u=>{u&&l.searchParams.set(u,n[u])}),l.href}class xr extends yi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=xr.CDMCleanupPromise?[xr.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:i,initData:s}=t,n=`"${t.type}" event: init data type: "${i}"`;if(this.debug(n),s!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=An(this.config));const o=a.map(Ol).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=io(a);if(i!=="sinf"||o!==ot.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${i}" for selected key-system ${o}`);return}let l;try{const p=_t(new Uint8Array(s)),m=Fc(JSON.parse(p).sinf),y=Rg(m);if(!y)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(y.subarray(8,24))}catch(p){this.warn(`${n} Failed to parse sinf: ${p}`);return}const u=Lt(l),{keyIdToKeySessionPromise:c,mediaKeySessions:h}=this;let f=c[u];for(let p=0;p<h.length;p++){const m=h[p],y=m.decryptdata;if(!y.keyId)continue;const v=Lt(y.keyId);if(To(l,y.keyId)||y.uri.replace(/-/g,"").indexOf(u)!==-1){if(f=c[v],!f)continue;if(y.pssh)break;delete c[v],y.pssh=new Uint8Array(s),y.keyId=l,f=c[u]=f.then(()=>this.generateRequestWithPreferredKeySession(m,i,s,"encrypted-event-key-match")),f.catch(E=>this.handleError(E));break}}f||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${h.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(I.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(I.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(I.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(I.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(I.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(I.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,s=t?.[e];if(s)return s.licenseUrl;if(e===ot.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t?.[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(a,o,l)=>!!a&&l.indexOf(a)===o,s=t.map(a=>a.audioCodec).filter(i),n=t.map(a=>a.videoCodec).filter(i);return s.length+n.length===0&&n.push("avc1.42e01e"),new Promise((a,o)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,s,n).then(h=>a({keySystem:c,mediaKeys:h})).catch(h=>{u.length?l(u):h instanceof Zt?o(h):o(new Zt({type:Te.KEY_SYSTEM_ERROR,details:ee.KEY_SYSTEM_NO_ACCESS,error:h,fatal:!0},h.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${i}`;return Wg===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return i(e,t)}getMediaKeysPromise(e,t,i){var s;const n=nE(e,t,i,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(s=a)==null?void 0:s.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ye(n)}`),o=this.requestMediaKeySystemAccess(e,n);const l=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),o.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const c=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const h=l.mediaKeys=u.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,c.then(p=>p?this.setMediaKeysServerCertificate(f,e,p):f)));return h.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),h})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${Lt(e.keyId||[])} keyUri: ${e.uri}`);const s=i.createSession(),n={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(n),n}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),s=$a(t),n="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,n,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyId ${Lt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),i.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Ol(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:i})=>this.attemptSetMediaKeys(t,i))}selectKeySystem(e){return new Promise((t,i)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const n=Ol(s);n?t(n):i(new Error(`Unable to find format for key-system "${s}"`))}).catch(i)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=An(this.config),i=e.map(io).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(i)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let i=0;i<t.length;i++){const s=Cx(e,t[i]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,i=$a(t),s=this.bannedKeyIds[i];if(s||this.getKeyStatus(t)==="internal-error"){const o=Lf(s||"internal-error",t);return this.handleError(o,e.frag),Promise.reject(o)}const n=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${n}`);const a=this.keyIdToKeySessionPromise[i];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${n}`),this.attemptSetMediaKeys(l,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:u,decryptdata:t}))))).then(l=>{const u="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,u,c,"playlist-key")});return o.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[i]=o,o}return a.catch(o=>{if(o instanceof Zt){const l=He({},o.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const u=new Zt(l,o.message);this.handleError(u,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Zt){t&&(e.data.frag=t);const i=e.data.decryptdata;this.error(`${e.message}${i?` (${Lt(i.keyId||[])})`:""}`),this.hls.trigger(I.ERROR,e.data)}else this.error(e.message),this.hls.trigger(I.ERROR,{type:Te.KEY_SYSTEM_ERROR,details:ee.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=$a(e),i=this.keyIdToKeySessionPromise[t];if(!i){const s=io(e.keyFormat),n=s?[s]:An(this.config);return this.attemptKeySystemAccess(n)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=An(this.config)),e.length===0)throw new Zt({type:Te.KEY_SYSTEM_ERROR,details:ee.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ye({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(i).then(()=>this.media?this.media.setMediaKeys(t):new Promise((n,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(n).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(n=>i.indexOf(n)===-1)})}generateRequestWithPreferredKeySession(e,t,i,s){var n;const a=(n=this.config.drmSystems)==null||(n=n[e.keySystem])==null?void 0:n.generateRequest;if(a)try{const m=a.call(this.hls,t,i,e);if(!m)throw new Error("Invalid response from configured generateRequest filter");t=m.initDataType,i=m.initData?m.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(m){if(this.warn(m.message),this.hls&&this.hls.config.debug)throw m}if(i===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const o=$a(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${o} URI: ${l} (init data type: ${t} length: ${i.byteLength})`);const u=new Bc,c=e._onmessage=m=>{const y=e.mediaKeysSession;if(!y){u.emit("error",new Error("invalid state"));return}const{messageType:v,message:E}=m;this.log(`"${v}" message event for session "${y.sessionId}" message size: ${E.byteLength}`),v==="license-request"||v==="license-renewal"?this.renewLicense(e,E).catch(A=>{u.eventNames().length?u.emit("error",A):this.handleError(A)}):v==="license-release"?e.keySystem===ot.FAIRPLAY&&this.updateKeySession(e,Vu("acknowledged")).then(()=>this.removeSession(e)).catch(A=>this.handleError(A)):this.warn(`unhandled media key message type "${v}"`)},h=(m,y)=>{y.keyStatus=m;let v;m.startsWith("usable")?u.emit("resolved"):m==="internal-error"||m==="output-restricted"||m==="output-downscaled"?v=Lf(m,y.decryptdata):m==="expired"?v=new Error(`key expired (keyId: ${o})`):m==="released"?v=new Error("key released"):m==="status-pending"||this.warn(`unhandled key status change "${m}" (keyId: ${o})`),v&&(u.eventNames().length?u.emit("error",v):this.handleError(v))},f=e._onkeystatuseschange=m=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const v=this.getKeyStatuses(e);if(!Object.keys(v).some(w=>v[w]!=="status-pending"))return;if(v[o]==="expired"){this.log(`Expired key ${Ye(v)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let A=v[o];if(A)h(A,e);else{var x;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(x=e.keyStatusTimeouts)[o]||(x[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const k=this.getKeyStatus(e.decryptdata);if(k&&k!=="status-pending")return this.log(`No status for keyId ${o} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${k} from other session.`),h(k,e);this.log(`key status for ${o} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),A="internal-error",h(A,e)},1e3)),this.log(`No status for keyId ${o} (${Ye(v)}).`)}};$t(e.mediaKeysSession,"message",c),$t(e.mediaKeysSession,"keystatuseschange",f);const p=new Promise((m,y)=>{u.on("error",y),u.on("resolved",m)});return e.mediaKeysSession.generateRequest(t,i).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o} URI: ${l}`)}).catch(m=>{throw new Zt({type:Te.KEY_SYSTEM_ERROR,details:ee.KEY_SYSTEM_NO_SESSION,error:m,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${m}`)}).then(()=>p).catch(m=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw m}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((i,s)=>{if(typeof s=="string"&&typeof i=="object"){const o=s;s=i,i=o}const n="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(e.keySystem===ot.PLAYREADY&&n.length===16){const o=Lt(n);t[o]=i,jg(n)}const a=Lt(n);i==="internal-error"&&(this.bannedKeyIds[a]=i),this.log(`key status change "${i}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=i}),t}fetchServerCertificate(e){const t=this.config,i=t.loader,s=new i(t),n=this.getServerCertificateUrl(e);return n?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:n},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,p,m,y)=>{a(f.data)},onError:(f,p,m,y)=>{o(new Zt({type:Te.KEY_SYSTEM_ERROR,details:ee.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:He({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${n}). Status: ${f.code} (${f.text})`))},onTimeout:(f,p,m)=>{o(new Zt({type:Te.KEY_SYSTEM_ERROR,details:ee.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${n})`))},onAbort:(f,p,m)=>{o(new Error("aborted"))}};s.load(l,c,h)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((s,n)=>{e.setServerCertificate(i).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${i.byteLength}) on "${t}"`),s(e)}).catch(a=>{n(new Zt({type:Te.KEY_SYSTEM_ERROR,details:ee.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(s=>{throw new Zt({type:Te.KEY_SYSTEM_ERROR,details:ee.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(i,"application/xml"),n=s.querySelectorAll("HttpHeader");if(n.length>0){let c;for(let h=0,f=n.length;h<f;h++){var a,o;c=n[h];const p=(a=c.querySelector("name"))==null?void 0:a.textContent,m=(o=c.querySelector("value"))==null?void 0:o.textContent;p&&m&&e.setRequestHeader(p,m)}}const l=s.querySelector("Challenge"),u=l?.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return Vu(atob(u))}setupLicenseXHR(e,t,i,s){const n=this.config.licenseXhrSetup;return n?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return n.call(this.hls,e,t,i,s)}).catch(a=>{if(!i.decryptdata)throw a;return e.open("POST",t,!0),n.call(this.hls,e,t,i,s)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((s,n)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return n(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,o,a,e)}catch(c){this.error(c)}s(l)}else{const l=i.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||o.status>=400&&o.status<500)n(new Zt({type:Te.KEY_SYSTEM_ERROR,details:ee.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(s,n)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==ot.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)}).catch(n)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,$t(i,"encrypted",this.onMediaEncrypted),$t(i,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=i.mediaKeys}onMediaDetached(){const e=this.media;e&&(Kt(e,"encrypted",this.onMediaEncrypted),Kt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const i=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ds.clearKeyUriToKeyIdMap();const n=s.length;xr.CDMCleanupPromise=Promise.all(s.map(a=>this.removeSession(a)).concat((i==null||(e=i.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(I.ERROR,{type:Te.OTHER_ERROR,details:ee.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(I.ERROR,{type:Te.OTHER_ERROR,details:ee.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{n&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((s,n)=>(s.indexOf(n.keyFormat)===-1&&s.push(n.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Lt(s?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const n=this.mediaKeySessions.indexOf(e);n>-1&&this.mediaKeySessions.splice(n,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(u=>self.clearTimeout(a[u]));const{drmSystemOptions:o}=this.config;return(oE(o)?new Promise((u,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u).catch(c)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(I.ERROR,{type:Te.OTHER_ERROR,details:ee.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(I.ERROR,{type:Te.OTHER_ERROR,details:ee.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}xr.CDMCleanupPromise=void 0;function $a(r){if(!r)throw new Error("Could not read keyId of undefined decryptdata");if(r.keyId===null)throw new Error("keyId is null");return Lt(r.keyId)}function Cx(r,e){if(r.keyId&&e.mediaKeysSession.keyStatuses.has(r.keyId))return e.mediaKeysSession.keyStatuses.get(r.keyId);if(r.matches(e.decryptdata))return e.keyStatus}class Zt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Lf(r,e){const t=r==="output-restricted",i=t?ee.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:ee.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Zt({type:Te.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${r}"`)}class Ix{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(I.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(I.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const s=performance.now();if(t){if(this.lastTime){const n=s-this.lastTime,a=i-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/n,u=this.hls;if(u.trigger(I.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:i}),l>0&&a>u.config.fpsDroppedMonitoringThreshold*o){let c=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(I.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Nm(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function Bm(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){qe.debug(`[texttrack-utils]: ${i}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,r.addCue(s)}catch(s){qe.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(r.mode=t)}function yr(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues)for(let i=r.cues.length;i--;)e&&r.cues[i].removeEventListener("enter",e),r.removeCue(r.cues[i]);t==="disabled"&&(r.mode=t)}function Xu(r,e,t,i){const s=r.mode;if(s==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const n=Lx(r.cues,e,t);for(let a=0;a<n.length;a++)(!i||i(n[a]))&&r.removeCue(n[a])}s==="disabled"&&(r.mode=s)}function Dx(r,e){if(e<=r[0].startTime)return 0;const t=r.length-1;if(e>r[t].endTime)return-1;let i=0,s=t,n;for(;i<=s;)if(n=Math.floor((s+i)/2),e<r[n].startTime)s=n-1;else if(e>r[n].startTime&&i<t)i=n+1;else return n;return r[i].startTime-e<e-r[s].startTime?i:s}function Lx(r,e,t){const i=[],s=Dx(r,e);if(s>-1)for(let n=s,a=r.length;n<a;n++){const o=r[n];if(o.startTime>=e&&o.endTime<=t)i.push(o);else if(o.startTime>t)return i}return i}function ao(r){const e=[];for(let t=0;t<r.length;t++){const i=r[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(r[t])}return e}class Rx extends jc{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=ao(this.media.textTracks);for(let n=0;n<i.length;n++)if(i[n].mode==="hidden")t=i[n];else if(i[n].mode==="showing"){t=i[n];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(I.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;ao(i.textTracks).forEach(a=>{yr(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:s,details:n}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==s){this.warn(`Subtitle track with id:${i} and group:${s} not found in active group ${a?.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${i} "${a.name}" lang:${a.lang} group:${s} loaded [${n.startSN}-${n.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,s=this.groupIds;let n=this.currentTrack;if(!i||s?.length!==i?.length||i!=null&&i.some(a=>s?.indexOf(a)===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(c=>!i||i.indexOf(c.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(c=>c.default)&&(this.selectDefaultTrack=!1),a.forEach((c,h)=>{c.id=h});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!n&&o){this.selectDefaultTrack=!1;const c=Gi(o,a);if(c>-1)n=a[c];else{const h=Gi(o,this.tracks);n=this.tracks[h]}}let l=this.findTrackId(n);l===-1&&n&&(l=this.findTrackId(null));const u={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${i?.join(",")}" group-id`),this.hls.trigger(I.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const n=t[s];if(!(i&&!n.default||!i&&!e)&&(!e||Ys(n,e)))return s}if(e){for(let s=0;s<t.length;s++){const n=t[s];if(qn(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const n=t[s];if(qn(e.attrs,n.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if(Ku(s,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Pe.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&Ys(e,i))return i;const s=Gi(e,this.tracksInGroup);if(s>-1){const n=this.tracksInGroup[s];return this.setSubtitleTrack(s),n}else{if(i)return null;{const n=Gi(e,t);if(n>-1)return t[n]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,s=e.groupId,n=this.getUrlWithDirectives(e.url,t),a=e.details,o=a?.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(I.SUBTITLE_TRACK_LOADING,{url:n,id:i,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=ao(e.textTracks),i=this.currentTrack;let s;if(i&&(s=t.filter(n=>Ku(i,n))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(n=>{n.mode!=="disabled"&&n!==s&&(n.mode="disabled")}),s){const n=this.subtitleDisplay?"showing":"hidden";s.mode!==n&&(s.mode=n)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!pe(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(I.SUBTITLE_TRACK_SWITCH,{id:e});return}const n=!!s.details&&!s.details.live;if(e===this.trackId&&s===i&&n)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:a,groupId:o="",name:l,type:u,url:c}=s;this.hls.trigger(I.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:u,url:c});const h=this.switchParams(s.url,i?.details,s.details);this.loadPlaylist(h)}}function wx(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const n=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?n:n&3|8).toString(16)})}}}function wn(r){let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0).toString()}const Ar=.025;let Eo=(function(r){return r[r.Point=0]="Point",r[r.Range=1]="Range",r})({});function kx(r,e,t){return`${r.identifier}-${t+1}-${wn(e)}`}class Px{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Hl(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=Hl(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=pe(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Hl(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Ar))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Eo.Range:Eo.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return Ox(this)}}function Hl(r,e){return r-e.start<e.duration/2&&!(Math.abs(r-(e.start+e.duration))<Ar)?e.start:e.start+e.duration}function Um(r,e,t){const i=new self.URL(r,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function ql(r,e){for(;(t=r.assetList[++e])!=null&&t.error;)var t;return e}function Ox(r){return`["${r.identifier}" ${r.cue.pre?"<pre>":r.cue.post?"<post>":""}${r.timelineStart.toFixed(2)}-${r.resumeTime.toFixed(2)}]`}function mr(r){const e=r.timelineStart,t=r.duration||0;return`["${r.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class Mx{constructor(e,t,i,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(I.PLAYOUT_LIMIT_REACHED,{})};const n=this.hls=new e(t);this.interstitial=i,this.assetItem=s;const a=()=>{this.hasDetails=!0};n.once(I.LEVEL_LOADED,a),n.once(I.AUDIO_TRACK_LOADED,a),n.once(I.SUBTITLE_TRACK_LOADED,a),n.on(I.MEDIA_ATTACHING,(o,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&n.on(I.BUFFER_APPENDED,()=>{const c=this.bufferedEnd;this.reachedPlayout(c)&&(this._bufferedEosTime=c,n.trigger(I.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=Um(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const i=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,n=Ie.bufferInfo(e,s,0);return this.getAssetTime(n.end)>=i-.02}reachedPlayout(e){const i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ie.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const i=t-this.startOffset;if(i>0&&i<e)return i}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,i){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,i){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${mr(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Rf=.033;class Fx extends yi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(n=s[i])!=null&&n.event;){var n;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let s=0;s<i.length;s++){let n=i[s];if(t&&t!=="primary"&&(n=n[t]),e===n.start||e>n.start&&e<n.end)return s}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let s=e;s<=t&&i[s];s++){const n=i[s].event;if(n!=null&&n.restrictions.jump&&!n.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var i;if(((i=t[s].event)==null?void 0:i.identifier)===e)return s}return-1}findAssetIndex(e,t){const i=e.assetList,s=i.length;if(s>1)for(let n=0;n<s;n++){const a=i[n];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||n===s-1))return n}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const i=t.assetList,s=i[i.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:s}=i,n=this.events,a=this.parseDateRanges(s,{url:i.url},t),o=Object.keys(s),l=n?n.filter(u=>!o.includes(u.identifier)):[];a.length&&a.sort((u,c)=>{const h=u.cue.pre,f=u.cue.post,p=c.cue.pre,m=c.cue.post;if(h&&!p)return-1;if(p&&!h||f&&!m)return 1;if(m&&!f)return-1;if(!h&&!p&&!f&&!m){const y=u.startTime,v=c.startTime;if(y!==v)return y-v}return u.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=a,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],i=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const n=this.items,a=this.parseSchedule(s,e);(i||t.length||n?.length!==a.length||a.some((l,u)=>Math.abs(l.playout.start-n[u].playout.start)>.005||Math.abs(l.playout.end-n[u].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,n))}}parseDateRanges(e,t,i){const s=[],n=Object.keys(e);for(let a=0;a<n.length;a++){const o=n[a],l=e[o];if(l.isInterstitial){let u=this.eventMap[o];u?u.setDateRange(l):(u=new Px(l,t),this.eventMap[o]=u,i===!1&&(u.appendInPlace=i)),s.push(u)}}return s}parseSchedule(e,t){const i=[],s=t.main.details,n=s.live?1/0:s.edge;let a=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((c,h)=>{const f=c.cue.pre,p=c.cue.post,m=e[h-1]||null,y=c.appendInPlace,v=p?n:c.startOffset,E=c.duration,A=c.timelineOccupancy===Eo.Range?E:0,x=c.resumptionOffset,w=m?.startTime===v,k=v+c.cumulativeDuration;let F=y?k+E:v+x;if(f||!p&&v<=0){const M=u;u+=A,c.timelineStart=k;const C=a;a+=E,i.push({event:c,start:k,end:F,playout:{start:C,end:a},integrated:{start:M,end:u}})}else if(v<=n){if(!w){const D=v-l;if(D>Rf){const B=l,H=u;u+=D;const q=a;a+=D;const Y={previousEvent:e[h-1]||null,nextEvent:c,start:B,end:B+D,playout:{start:q,end:a},integrated:{start:H,end:u}};i.push(Y)}else D>0&&m&&(m.cumulativeDuration+=D,i[i.length-1].end=v)}p&&(F=k),c.timelineStart=k;const M=u;u+=A;const C=a;a+=E,i.push({event:c,start:k,end:F,playout:{start:C,end:a},integrated:{start:M,end:u}})}else return;const L=c.resumeTime;p||L>n?l=n:l=L}),l<n){var o;const c=l,h=u,f=n-l;u+=f;const p=a;a+=f,i.push({previousEvent:((o=i[i.length-1])==null?void 0:o.event)||null,nextEvent:null,start:l,end:c+f,playout:{start:p,end:a},integrated:{start:h,end:u}})}this.setDurations(n,a,u)}else i.push({previousEvent:null,nextEvent:null,start:0,end:n,playout:{start:0,end:n},integrated:{start:0,end:n}}),this.setDurations(n,n,n);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,s=i.live?1/0:i.edge;let n=0,a=-1;e.forEach((o,l)=>{const u=o.cue.pre,c=o.cue.post,h=u?0:c?s:o.startTime;this.updateAssetDurations(o),a===h?o.cumulativeDuration=n:(n=0,a=h),!c&&o.snapOptions.in&&(o.resumeAnchor=tr(null,i.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<Rf&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const p=pe(o.resumeOffset)?o.resumeOffset:o.duration;n+=p})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(i-s)>Ar?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,l=o.edge;if(i>=l)return this.log(`"${e.identifier}" resumption ${i} past ${a} playlist end ${l}`),!1;const u=tr(null,o.fragments,i);if(!u)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const c=a==="audio"?.175:0;return Math.abs(u.start-i)<Ar+c||Math.abs(u.end-i)<Ar+c?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${a} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,s=!1,n=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],l=t+i;o.startOffset=i,o.timelineStart=l,s||(s=o.duration===null),n||(n=!!o.error);const u=o.error?0:o.duration||0;i+=u}s&&!n?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Ai(r){return`[${r.event?'"'+r.event.identifier+'"':"primary"}: ${r.start.toFixed(2)}-${r.end.toFixed(2)}]`}class Nx{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let s;try{s=Um(i,this.hls.sessionId,e.baseUrl)}catch(f){const p=this.assignAssetListError(e,ee.ASSET_LIST_LOAD_ERROR,f,i);this.hls.trigger(I.ERROR,p);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const n=this.hls.config,a=n.loader,o=new a(n),l={responseType:"json",url:s.href},u=n.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,p,m,y)=>{const v=f.data,E=v?.ASSETS;if(!Array.isArray(E)){const A=this.assignAssetListError(e,ee.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),m.url,p,y);this.hls.trigger(I.ERROR,A);return}e.assetListResponse=v,this.hls.trigger(I.ASSET_LIST_LOADED,{event:e,assetListResponse:v,networkDetails:y})},onError:(f,p,m,y)=>{const v=this.assignAssetListError(e,ee.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${p.url})`),p.url,y,m);this.hls.trigger(I.ERROR,v)},onTimeout:(f,p,m)=>{const y=this.assignAssetListError(e,ee.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${p.url})`),p.url,f,m);this.hls.trigger(I.ERROR,y)}};return o.load(l,c,h),this.hls.trigger(I.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,i,s,n,a){return e.error=i,{type:Te.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:i,networkDetails:a,stats:n}}}function wf(r){var e;r==null||(e=r.play())==null||e.catch(()=>{})}function Va(r,e){return`[${r}] Advancing timeline position to ${e}`}class Bx extends yi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled||!this.schedule)return;const s=i-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const a=s<=-.01;this.timelinePos=i,this.bufferedPos=i;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(i,i-s)&&this.updateSchedule(!0),this.checkBuffer(),a&&i<o.start||i>=o.end){var l;const p=this.findItemIndex(o);let m=this.schedule.findItemIndexAtTime(i);if(m===-1&&(m=p+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${i} (resolving from ${p} to ${m})`)),!this.isInterstitial(o)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!a&&m>p){const y=this.schedule.findJumpRestrictedIndex(p+1,m);if(y>p){this.setSchedulePosition(y);return}}this.setSchedulePosition(m);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(o)){const p=o.event.assetList[0];p&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,p))}return}const c=u.timelineStart,h=u.duration||0;if(a&&i<c||i>=c+h){var f;(f=o.event)!=null&&f.appendInPlace&&(this.clearAssetPlayers(o.event,o),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,u)}},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(i>=s.end){this.timelinePos=s.end;const o=this.findItemIndex(s);this.setSchedulePosition(o+1)}const n=this.playingAsset;if(!n)return;const a=n.timelineStart+(n.duration||0);i>=a&&this.setScheduleToAssetAtTime(i,n)},this.onScheduleUpdate=(i,s)=>{const n=this.schedule;if(!n)return;const a=this.playingItem,o=n.events||[],l=n.items||[],u=n.durations,c=i.map(y=>y.identifier),h=!!(o.length||c.length);(h||s)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${l.map(y=>Ai(y))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`);let f=null,p=null;a&&(f=this.updateItem(a,this.timelinePos),this.itemsMatch(a,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const m=this.bufferingItem;if(m&&(p=this.updateItem(m,this.bufferedPos),this.itemsMatch(m,p)?this.bufferingItem=p:m.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(m.event,null))),i.forEach(y=>{y.assetList.forEach(v=>{this.clearAssetPlayer(v.identifier,null)})}),this.playerQueue.forEach(y=>{if(y.interstitial.appendInPlace){const v=y.assetItem.timelineStart,E=y.timelineOffset-v;if(E)try{y.timelineOffset=v}catch(A){Math.abs(E)>Ar&&this.warn(`${A} ("${y.assetId}" ${y.timelineOffset}->${v})`)}}}),h||s){if(this.hls.trigger(I.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:l.slice(0),durations:u,removedIds:c}),this.isInterstitial(a)&&c.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(f,a),m&&p!==f&&this.trimInPlace(p,m),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new Nx(e),this.schedule=new Fx(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(I.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(I.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(I.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(I.MEDIA_ENDED,this.onMediaEnded,this),e.on(I.ERROR,this.onError,this),e.on(I.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(I.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(I.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(I.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(I.MEDIA_ENDED,this.onMediaEnded,this),e.off(I.ERROR,this.onError,this),e.off(I.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Kt(e,"play",this.onPlay),Kt(e,"pause",this.onPause),Kt(e,"seeking",this.onSeeking),Kt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;$t(i,"seeking",this.onSeeking),$t(i,"timeupdate",this.onTimeupdate),$t(i,"play",this.onPlay),$t(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!s){this.clearScheduleState();const n=this.findItemIndex(i);this.setSchedulePosition(n)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,s=this.media;if(this.media=null,!i&&(s&&this.removeMediaListeners(s),this.detachedData)){const n=this.getBufferingPlayer();n&&(this.log(`Removing schedule state for detachedData and ${n}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,n.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=h=>h&&e.getAssetPlayer(h.identifier),s=(h,f,p,m,y)=>{if(h){let v=h[f].start;const E=h.event;if(E){if(f==="playout"||E.timelineOccupancy!==Eo.Point){const A=i(p);A?.interstitial===E&&(v+=A.assetItem.startOffset+A[y])}}else{const A=m==="bufferedPos"?a():e[m];v+=A-h.start}return v}return 0},n=(h,f)=>{var p;if(h!==0&&f!=="primary"&&(p=e.schedule)!=null&&p.length){var m;const y=e.schedule.findItemIndexAtTime(h),v=(m=e.schedule.items)==null?void 0:m[y];if(v){const E=v[f].start-v.start;return h+E}}return h},a=()=>{const h=e.bufferedPos;return h===Number.MAX_VALUE?o("primary"):Math.max(h,0)},o=h=>{var f,p;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((p=e.schedule)==null?void 0:p.durations[h])||0},l=(h,f)=>{var p,m;const y=e.effectivePlayingItem;if(y!=null&&(p=y.event)!=null&&p.restrictions.skip||!e.schedule)return;e.log(`seek to ${h} "${f}"`);const v=e.effectivePlayingItem,E=e.schedule.findItemIndexAtTime(h,f),A=(m=e.schedule.items)==null?void 0:m[E],x=e.getBufferingPlayer(),w=x?.interstitial,k=w?.appendInPlace,F=v&&e.itemsMatch(v,A);if(v&&(k||F)){const L=i(e.playingAsset),M=L?.media||e.primaryMedia;if(M){const C=f==="primary"?M.currentTime:s(v,f,e.playingAsset,"timelinePos","currentTime"),D=h-C,B=(k?C:M.currentTime)+D;if(B>=0&&(!L||k||B<=L.duration)){M.currentTime=B;return}}}if(A){let L=h;if(f!=="primary"){const C=A[f].start,D=h-C;L=A.start+D}const M=!e.isInterstitial(A);if((!e.isInterstitial(v)||v.event.appendInPlace)&&(M||A.event.appendInPlace)){const C=e.media||(k?x?.media:null);C&&(C.currentTime=L)}else if(v){const C=e.findItemIndex(v);if(E>C){const B=e.schedule.findJumpRestrictedIndex(C+1,E);if(B>C){e.setSchedulePosition(B);return}}let D=0;if(M)e.timelinePos=L,e.checkBuffer();else{const B=A.event.assetList,H=h-(A[f]||A).start;for(let q=B.length;q--;){const Y=B[q];if(Y.duration&&H>=Y.startOffset&&H<Y.startOffset+Y.duration){D=q;break}}}e.setSchedulePosition(E,D)}}},u=()=>{const h=e.effectivePlayingItem;if(e.isInterstitial(h))return h;const f=t();return e.isInterstitial(f)?f:null},c={get bufferedEnd(){const h=t(),f=e.bufferingItem;if(f&&f===h){var p;return s(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((p=e.bufferingAsset)==null?void 0:p.startOffset)||0}return 0},get currentTime(){const h=u(),f=e.effectivePlayingItem;return f&&f===h?s(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(h){const f=u(),p=e.effectivePlayingItem;p&&p===f&&l(h+p.playout.start,"playout")},get duration(){const h=u();return h?h.playout.end-h.playout.start:0},get assetPlayers(){var h;const f=(h=u())==null?void 0:h.event.assetList;return f?f.map(p=>e.getAssetPlayer(p.identifier)):[]},get playingIndex(){var h;const f=(h=u())==null?void 0:h.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var h;return((h=e.schedule)==null||(h=h.events)==null?void 0:h.slice(0))||[]},get schedule(){var h;return((h=e.schedule)==null||(h=h.items)==null?void 0:h.slice(0))||[]},get interstitialPlayer(){return u()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const h=t();return e.findItemIndex(h)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const h=e.effectivePlayingItem;return e.findItemIndex(h)},primary:{get bufferedEnd(){return a()},get currentTime(){const h=e.timelinePos;return h>0?h:0},set currentTime(h){l(h,"primary")},get duration(){return o("primary")},get seekableStart(){var h;return((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(h){l(h,"integrated")},get duration(){return o("integrated")},get seekableStart(){var h;return n(((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0,"integrated")}},skip:()=>{const h=e.effectivePlayingItem,f=h?.event;if(f&&!f.restrictions.skip){const p=e.findItemIndex(h);if(f.appendInPlace){const m=h.playout.start+h.event.duration;l(m+.001,"playout")}else e.advanceAfterAssetEnded(f,p,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const n=(t=s)==null?void 0:t.currentTime;if(!(n===void 0||!pe(n)))return n}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,s=e.media;if(i&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const n=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ye(n)}`),this.detachedData=n}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var i,s;if(e.media===t)return;let n=null;const a=this.hls,o=e!==a,l=o&&e.interstitial.appendInPlace,u=(i=this.detachedData)==null?void 0:i.mediaSource;let c;if(a.media)l&&(n=a.transferMedia(),this.detachedData=n),c="Primary";else if(u){const m=this.getBufferingPlayer();m?(n=m.transferMedia(),c=`${m}`):c="detached MediaSource"}else c="detached media";if(!n){if(u)n=this.detachedData,this.log(`using detachedData: MediaSource ${Ye(n)}`);else if(!this.detachedData||a.media===t){const m=this.playerQueue;m.length>1&&m.forEach(y=>{if(o&&y.interstitial.appendInPlace!==l){const v=y.interstitial;this.clearInterstitial(y.interstitial,null),v.appendInPlace=!1,v.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${v}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const h=n&&"mediaSource"in n&&((s=n.mediaSource)==null?void 0:s.readyState)!=="closed",f=h&&n?n:t;this.log(`${h?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${c} (media.currentTime: ${t.currentTime})`);const p=this.schedule;if(f===n&&p){const m=o&&e.assetId===p.assetIdAtEnd;f.overrides={duration:p.duration,endOfStream:!o||m,cueRemoval:!o}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,s=this.effectivePlayingItem;if(i===-1){const n=this.hls.startPosition;if(this.log(Va("checkStart",n)),this.timelinePos=n,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(n>=0||!this.primaryLive){const a=this.timelinePos=n>0?n:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(s&&!this.playingItem){const n=e.findItemIndex(s);this.setSchedulePosition(n)}}advanceAssetBuffering(e,t){const i=e.event,s=i.findAssetIndex(t),n=ql(i,s);if(!i.isAssetPastPlayoutLimit(n))this.bufferedToEvent(e,n);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,i){const s=ql(e,i);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const n=this.schedule.items;if(n){const a=t+1,o=n.length;if(a>=o){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(Va("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const n=e.assetList[s];n&&this.advanceInPlace(n.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const i=this.schedule;if(!i)return;const s=t.parentIdentifier,n=i.getEvent(s);if(n){const a=i.findEventIndex(s),o=i.findAssetIndex(n,e);this.advanceAfterAssetEnded(n,a,o-1)}}setSchedulePosition(e,t){var i;const s=(i=this.schedule)==null?void 0:i.items;if(!s||this.playbackDisabled)return;const n=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${n&&Ai(n)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const c=a.event,h=this.playingAsset,f=h?.identifier,p=f?this.getAssetPlayer(f):null;if(p&&f&&(!this.eventItemsMatch(a,n)||t!==void 0&&f!==c.assetList[t].identifier)){var l;const m=c.findAssetIndex(h);if(this.log(`INTERSTITIAL_ASSET_ENDED ${m+1}/${c.assetList.length} ${mr(h)}`),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(I.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:m,event:c,schedule:s.slice(0),scheduleIndex:e,player:p}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),m);return}this.retreiveMediaSource(f,n),p.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&p.detachMedia()}if(!this.eventItemsMatch(a,n)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${Ai(a)}`),c.hasPlayed=!0,this.hls.trigger(I.INTERSTITIAL_ENDED,{event:c,schedule:s.slice(0),scheduleIndex:e}),c.cue.once)){var u;this.updateSchedule();const m=(u=this.schedule)==null?void 0:u.items;if(n&&m){const y=this.findItemIndex(n);this.advanceSchedule(y,m,t,a,o)}return}}this.advanceSchedule(e,s,t,a,o)}advanceSchedule(e,t,i,s,n){const a=this.schedule;if(!a)return;const o=t[e]||null,l=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(c=>{const h=c.interstitial,f=a.findEventIndex(h.identifier);(f<e||f>e+1)&&this.clearInterstitial(h,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const c=o.event;if(i===void 0){i=a.findAssetIndex(c,this.timelinePos);const m=ql(c,i-1);if(c.isAssetPastPlayoutLimit(m)||c.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(c,e,i);return}i=m}const h=this.waitingItem;this.assetsBuffered(o,l)||this.setBufferingItem(o);let f=this.preloadAssets(c,i);if(this.eventItemsMatch(o,h||s)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${Ai(o)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(I.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const p=c.assetList[i];if(!p){this.advanceAfterAssetEnded(c,e,i||0);return}if(f||(f=this.getAssetPlayer(p.identifier)),f===null||f.destroyed){const m=c.assetList.length;this.warn(`asset ${i+1}/${m} player destroyed ${c}`),f=this.createAssetPlayer(c,p,i),f.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(p))return;this.startAssetPlayer(f,i,t,e,l),this.shouldPlay&&wf(f.media)}else o?(this.resumePrimary(o,e,s),this.shouldPlay&&wf(this.hls.media)):n&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var s,n;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Ai(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(Va("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!i)return;const a=(n=this.schedule)==null?void 0:n.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Ai(e)}`),this.hls.trigger(I.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(i<s.fragmentStart||i>s.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Ie.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const n=this.hls;n.media?this.checkBuffer():(this.transferMediaTo(n,s),i&&this.startLoadingPrimaryAt(e,i)),i||(this.log(Va("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((i=s.mainForwardBufferInfo)==null?void 0:i.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(I.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(I.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const i=this.hls.levels[t.level];if(!i.details)return;const s=He(He({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=He(He({},this.altSelection),{},{audio:i});return}const n=He(He({},s),{},{audio:i});this.mediaSelection=n}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=He(He({},this.altSelection),{},{subtitles:i});return}const n=He(He({},s),{},{subtitles:i});this.mediaSelection=n}onAudioTrackSwitching(e,t){const i=Ud(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(i)))}onSubtitleTrackSwitch(e,t){const i=Ud(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(i)))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const n=t[s];if(n.cue.post){var i;const a=this.schedule.findEventIndex(n.identifier),o=(i=this.schedule.items)==null?void 0:i[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){var i;const s=(i=this.schedule)==null?void 0:i.items;if(e&&s){const n=this.findItemIndex(e,t);return s[n]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((n,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(n.identifier,null)});const i=e.end+.25,s=Ie.bufferInfo(this.primaryMedia,i,0);(s.end>i||(s.nextStart||0)>i)&&(this.log(`trim buffered interstitial ${Ai(e)} (was ${Ai(t)})`),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const i=this.mediaSelection;i&&((t=this.schedule)==null||t.updateSchedule(i,[],e))}checkBuffer(e){var t;const i=(t=this.schedule)==null?void 0:t.items;if(!i)return;const s=Ie.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,i,e)}updateBufferedPos(e,t,i){const s=this.schedule,n=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],n)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let l=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const c=this.findItemIndex(n),h=Math.min(c+1,t.length-1),f=t[h];if((l===-1&&n&&e>=n.end||(u=f.event)!=null&&u.appendInPlace&&e+.01>=f.start)&&(l=h),this.isInterstitial(n)){const p=n.event;if(h-o>1&&p.appendInPlace===!1||p.assetList.length===0&&p.assetListLoader)return}if(this.bufferedPos=e,l>c&&l>o)this.bufferedToItem(f);else{const p=this.primaryDetails;this.primaryLive&&p&&e>p.edge-p.targetduration&&f.start<p.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else i&&a&&!this.itemsMatch(a,n)&&(l===o?this.bufferedToItem(a):l===o+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const n=this.getAssetPlayer(s.identifier);return!(n!=null&&n.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,t)&&i){const{items:s,events:n}=i;if(!s||!n)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Ai(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const u=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((c,h)=>{const f=this.getAssetPlayer(c.identifier);f&&(h===u&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(I.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:n.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,s=i.assetList.length===0&&!i.assetListLoader,n=i.cue.once;if(s||!n){const a=this.preloadAssets(i,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const i=e.assetUrl,s=e.assetList.length,n=s===0&&!e.assetListLoader,a=e.cue.once;if(n){const l=e.timelineStart;if(e.appendInPlace){var o;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(o=f.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const f=c-l;f>0&&(u=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:s} ${e}${u?` live-start: ${c} start-offset: ${u}`:""}`),i)return this.createAsset(e,0,0,l,e.duration,i);const h=this.assetListLoader.loadAssetList(e,u);h&&(e.assetListLoader=h)}else if(!a&&s){for(let u=t;u<s;u++){const c=e.assetList[u],h=this.getAssetPlayerQueueIndex(c.identifier);(h===-1||this.playerQueue[h].destroyed)&&!c.error&&this.createAssetPlayer(e,c,u)}const l=e.assetList[t];if(l){const u=this.getAssetPlayer(l.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,s,n,a){const o={parentIdentifier:e.identifier,identifier:kx(e,a,t),duration:n,startOffset:i,timelineStart:s,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,i){const s=this.hls,n=s.userConfig;let a=n.videoPreference;const o=s.loadLevelObj||s.levels[s.currentLevel];(a||o)&&(a=Ke({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const l=s.audioTracks[s.audioTrack],u=s.subtitleTracks[s.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const w=this.timelinePos-t.timelineStart;if(w>1){const k=t.duration;k&&w<k&&(c=w)}}const h=t.identifier,f=He(He({},n),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:h,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:l||n.audioPreference,subtitlePreference:u||n.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const p=f.cmcd;p!=null&&p.sessionId&&p.contentId&&(f.cmcd=Ke({},p,{contentId:wn(t.uri)})),this.getAssetPlayer(h)&&this.warn(`Duplicate date range identifier ${e} and asset ${h}`);const m=new Mx(this.HlsPlayerClass,f,e,t);this.playerQueue.push(m),e.assetList[i]=t;let y=!0;const v=w=>{if(w.live){var k;const M=new Error(`Interstitials MUST be VOD assets ${e}`),C={fatal:!0,type:Te.OTHER_ERROR,details:ee.INTERSTITIAL_ASSET_ITEM_ERROR,error:M},D=((k=this.schedule)==null?void 0:k.findEventIndex(e.identifier))||-1;this.handleAssetItemError(C,e,D,i,M.message);return}const F=w.edge-w.fragmentStart,L=t.duration;(y||L===null||F>L)&&(y=!1,this.log(`Interstitial asset "${h}" duration change ${L} > ${F}`),t.duration=F,this.updateSchedule())};m.on(I.LEVEL_UPDATED,(w,{details:k})=>v(k)),m.on(I.LEVEL_PTS_UPDATED,(w,{details:k})=>v(k)),m.on(I.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const E=(w,k)=>{const F=this.getAssetPlayer(h);if(F&&k.tracks){F.off(I.BUFFER_CODECS,E),F.tracks=k.tracks;const L=this.primaryMedia;this.bufferingAsset===F.assetItem&&L&&!F.media&&this.bufferAssetPlayer(F,L)}};m.on(I.BUFFER_CODECS,E);const A=()=>{var w;const k=this.getAssetPlayer(h);if(this.log(`buffered to end of asset ${k}`),!k||!this.schedule)return;const F=this.schedule.findEventIndex(e.identifier),L=(w=this.schedule.items)==null?void 0:w[F];this.isInterstitial(L)&&this.advanceAssetBuffering(L,t)};m.on(I.BUFFERED_TO_END,A);const x=w=>()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;this.shouldPlay=!0;const F=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,F,w)};return m.once(I.MEDIA_ENDED,x(i)),m.once(I.PLAYOUT_LIMIT_REACHED,x(1/0)),m.on(I.ERROR,(w,k)=>{if(!this.schedule)return;const F=this.getAssetPlayer(h);if(k.details===ee.BUFFER_STALLED_ERROR){if(F!=null&&F.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(k,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${k.error} ${e}`)}),m.on(I.DESTROYING,()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;const k=new Error(`Asset player destroyed unexpectedly ${h}`),F={fatal:!0,type:Te.OTHER_ERROR,details:ee.INTERSTITIAL_ASSET_ITEM_ERROR,error:k};this.handleAssetItemError(F,e,this.schedule.findEventIndex(e.identifier),i,k.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${mr(t)}`),this.hls.trigger(I.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:m}),m}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){const s=this.playerQueue[i];this.log(`clear ${s} toSegment: ${t&&Ai(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(i,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,s,n){const{interstitial:a,assetItem:o,assetId:l}=e,u=a.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!c||c.identifier!==l)&&(c&&(this.clearAssetPlayer(c.identifier,i[s]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${mr(o)}`),this.hls.trigger(I.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:i.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,n)}bufferAssetPlayer(e,t){var i,s;if(!this.schedule)return;const{interstitial:n,assetItem:a}=e,o=this.schedule.findEventIndex(n.identifier),l=(i=this.schedule.items)==null?void 0:i[o];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=a;const u=this.getBufferingPlayer();if(u===e)return;const c=n.appendInPlace;if(c&&u?.interstitial.appendInPlace===!1)return;const h=u?.tracks||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(c&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(h&&!Sg(h,e.tracks)){const f=new Error(`Asset ${mr(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(h)}')`),p={fatal:!0,type:Te.OTHER_ERROR,details:ee.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},m=n.findAssetIndex(a);this.handleAssetItemError(p,n,o,m,f.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,i=this.primaryMedia;if(!t||!i)return;const s=i.currentTime,n=t.findAssetIndex(e,s),a=e.assetList[n];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const l=o.currentTime||s-a.timelineStart,u=o.duration-l;if(this.warn(`Stalled at ${l} of ${l+u} in ${o} ${e} (media.currentTime: ${s})`),l&&(u/i.playbackRate<.5||o.bufferedInPlaceToEnd(i))&&o.hls){const c=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,c,n)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,i,s,n){if(e.details===ee.BUFFER_STALLED_ERROR)return;const a=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&mr(a)} ${e.error}`),!this.schedule)return;const o=a?.identifier||"",l=this.getAssetPlayerQueueIndex(o),u=this.playerQueue[l]||null,c=this.schedule.items,h=Ke({},e,{fatal:!1,errorAction:Er(!0),asset:a,assetListIndex:s,event:t,schedule:c,scheduleIndex:i,player:u});if(this.hls.trigger(I.INTERSTITIAL_ASSET_ERROR,h),!e.fatal)return;const f=this.playingAsset,p=this.bufferingAsset,m=new Error(n);if(a&&(this.clearAssetPlayer(o,null),a.error=m),!t.assetList.some(y=>!y.error))t.error=m;else for(let y=s;y<t.assetList.length;y++)this.resetAssetPlayer(t.assetList[y].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):f&&f.identifier===o?this.advanceAfterAssetEnded(t,i,s):p&&p.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,p)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;let s=this.timelinePos;if(i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${s} playing: ${Ai(i)} error: ${e.error}`),s===-1&&(s=this.hls.startPosition);const a=this.updateItem(i,s);this.itemsMatch(i,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(s===-1){this.checkStart();return}if(!this.schedule)return;const n=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(n)}onAssetListLoaded(e,t){var i,s;const n=t.event,a=n.identifier,o=t.assetListResponse.ASSETS;if(!((i=this.schedule)!=null&&i.hasEvent(a)))return;const l=n.timelineStart,u=n.duration;let c=0;o.forEach((y,v)=>{const E=parseFloat(y.DURATION);this.createAsset(n,v,c,l+c,E,y.URI),c+=E}),n.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${u}) ${n}`);const h=this.waitingItem,f=h?.event.identifier===a;this.updateSchedule();const p=(s=this.bufferingItem)==null?void 0:s.event;if(f){var m;const y=this.schedule.findEventIndex(a),v=(m=this.schedule.items)==null?void 0:m[y];if(v){if(!this.playingItem&&this.timelinePos>v.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==y){n.error=new Error(`Interstitial ${o.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${n}`),this.log(n.error.message),this.updateSchedule(!0),this.primaryFallback(n);return}this.setBufferingItem(v)}this.setSchedulePosition(y)}else if(p?.identifier===a){const y=n.assetList[0];if(y){const v=this.getAssetPlayer(y.identifier);if(p.appendInPlace){const E=this.primaryMedia;v&&E&&this.bufferAssetPlayer(v,E)}else v&&v.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case ee.ASSET_LIST_PARSING_ERROR:case ee.ASSET_LIST_LOAD_ERROR:case ee.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case ee.BUFFER_STALLED_ERROR:{const i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace){this.handleInPlaceStall(i.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const kf=500;class Ux extends Nc{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",ye.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(I.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(I.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=le.IDLE,this.setInterval(kf),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:s}=t;if(this.fragContextChanged(i)||(gt(i)&&(this.fragPrevious=i),this.state=le.IDLE),!s)return;const n=this.tracksBuffered[this.currentTrackId];if(!n)return;let a;const o=i.start;for(let u=0;u<n.length;u++)if(o>=n[u].start&&o<=n[u].end){a=n[u];break}const l=i.start+i.duration;a?a.end=l:(a={start:o,end:l},n.push(a)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:s}=t;if(i===0&&s!==Number.POSITIVE_INFINITY){const n=s-1;if(n<=0)return;t.endOffsetSubtitles=Math.max(0,n),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=n){a.shift();continue}else if(a[o].start<n)a[o].start=n;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(i,n,ye.SUBTITLE)}}onError(e,t){const i=t.frag;i?.type===ye.SUBTITLE&&(t.details===ee.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==le.STOPPED&&(this.state=le.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&xm(this.levels,t)){this.levels=t.map(i=>new $n(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const s=new $n(i);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ye.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==le.STOPPED&&this.setInterval(kf)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:s,levels:n}=this,{details:a,id:o}=t;if(!n){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=n[o];if(o>=n.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(a.live||(i=l.details)!=null&&i.live){if(a.deltaUpdateFailed)return;const h=this.mainDetails;if(!h){this.startFragRequested=!1;return}const f=h.fragments[0];if(!l.details)a.hasProgramDateTime&&h.hasProgramDateTime?(vo(a,h),u=a.fragmentStart):f&&(u=f.start,Hu(a,u));else{var c;u=this.alignPlaylists(a,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&f&&(u=f.start,Hu(a,u))}h&&!this.startFragRequested&&this.setStartPosition(h,u)}l.details=a,this.levelLastLoaded=l,o===s&&(this.hls.trigger(I.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===le.IDLE&&(tr(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,s=t.decryptdata,n=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&s!=null&&s.key&&s.iv&&br(s.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer,Mc(s.method)).catch(o=>{throw n.trigger(I.ERROR,{type:Te.MEDIA_ERROR,details:ee.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();n.trigger(I.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=le.IDLE})}}doTick(){if(!this.media){this.state=le.IDLE;return}if(this.state===le.IDLE){const{currentTrackId:e,levels:t}=this,i=t?.[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:s}=this,n=this.getLoadPosition(),a=Ie.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n,s.maxBufferHole),{end:o,len:l}=a,u=i.details,c=this.hls.maxBufferLength+u.levelTargetDuration;if(l>c)return;const h=u.fragments,f=h.length,p=u.edge;let m=null;const y=this.fragPrevious;if(o<p){const A=s.maxFragLookUpTolerance,x=o>p-A?0:A;m=tr(y,h,Math.max(h[0].start,o),x),!m&&y&&y.start<h[0].start&&(m=h[0])}else m=h[f-1];if(m=this.filterReplacedPrimary(m,i.details),!m)return;const v=m.sn-u.startSN,E=h[v-1];if(E&&E.cc===m.cc&&this.fragmentTracker.getState(E)===vt.NOT_LOADED&&(m=E),this.fragmentTracker.getState(m)===vt.NOT_LOADED){const A=this.mapToInitFragWhenRequired(m);A&&this.loadFragment(A,i,o)}}}loadFragment(e,t,i){gt(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new $x(this.tracksBuffered[this.currentTrackId]||[])}}class $x{constructor(e){this.buffered=void 0;const t=(i,s,n)=>{if(s=s>>>0,s>n-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${n})`);return e[s][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const Vx={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},$m=r=>String.fromCharCode(Vx[r]||r),Ci=15,ss=100,Gx={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Hx={17:2,18:4,21:6,22:8,23:10,19:13,20:15},qx={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},jx={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Kx=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Wx{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;qe.log(`${this.time} [${e}] ${i}`)}}}const $s=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class Vm{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const s=t[i];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class zx{constructor(){this.uchar=" ",this.penState=new Vm}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Yx{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Vm,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<ss;t++)this.chars.push(new zx);this.logger=e}equals(e){for(let t=0;t<ss;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<ss;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<ss;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ss&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ss)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=$m(e);if(this.pos>=ss){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<ss;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<ss;i++){const s=this.chars[i].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class jl{constructor(e){this.rows=[],this.currRow=Ci-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Ci;t++)this.rows.push(new Yx(e));this.logger=e}reset(){for(let e=0;e<Ci;e++)this.rows[e].clear();this.currRow=Ci-1}equals(e){let t=!0;for(let i=0;i<Ci;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<Ci;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Ci;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ye(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<Ci;o++)this.rows[o].clear();const n=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[n].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(a.rows[n+u])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const n=e.indent,a=Math.max(n-1,0);i.setCursor(e.indent),e.color=i.chars[a].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ye(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",s=-1;for(let n=0;n<Ci;n++){const a=this.rows[n].getTextString();a&&(s=n+1,e?t.push("Row "+s+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class Pf{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new jl(i),this.nonDisplayedMemory=new jl(i),this.lastOutputScreen=new jl(i),this.currRollUpRow=this.displayedMemory.rows[Ci-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Ci-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[i]}this.logger.log(2,"MIDROW: "+Ye(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Of{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Qx(),this.logger=void 0;const s=this.logger=new Wx;this.channels=[null,new Pf(e,t,s),new Pf(e+1,i,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const s=t[i]&127,n=t[i+1]&127;let a=!1,o=null;if(s===0&&n===0)continue;this.logger.log(3,()=>"["+$s([t[i],t[i+1]])+"] -> ("+$s([s,n])+")");const l=this.cmdHistory;if(s>=16&&s<=31){if(Xx(s,n,l)){Ga(null,null,l),this.logger.log(3,()=>"Repeated command ("+$s([s,n])+") is dropped");continue}Ga(s,n,this.cmdHistory),a=this.parseCmd(s,n),a||(a=this.parseMidrow(s,n)),a||(a=this.parsePAC(s,n)),a||(a=this.parseBackgroundAttributes(s,n))}else Ga(null,null,l);if(!a&&(o=this.parseChars(s,n),o)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+$s([s,n])+" orig: "+$s([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(i||s))return!1;const n=e===20||e===21||e===23?1:2,a=this.channels[n];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=n,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[i];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+$s([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,n=(e===16||e===24)&&t>=64&&t<=95;if(!(s||n))return!1;const a=e<=23?1:2;t>=64&&t<=95?i=a===1?Gx[e]:qx[e]:i=a===1?Hx[e]:jx[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(i,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let i;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,s.underline=(i&1)===1,i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((i-16)/2)*4,s}parseChars(e,t){let i,s=null,n=null;if(e>=25?(i=2,n=e-8):(i=1,n=e),n>=17&&n<=19){let a;n===17?a=t+80:n===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+$m(a)+"' in channel "+i),s=[a]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+$s(s).join(",")),s}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(i||s))return!1;let n;const a={};e===16||e===24?(n=Math.floor((t-32)/2),a.background=Kx[n],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Ga(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function Ga(r,e,t){t.a=r,t.b=e}function Xx(r,e,t){return t.a===r&&t.b===e}function Qx(){return{a:null,b:null}}var Yc=(function(){if(_o!=null&&_o.VTTCue)return self.VTTCue;const r=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const u=l.toLowerCase();return~o.indexOf(u)?u:!1}function i(o){return t(r,o)}function s(o){return t(e,o)}function n(o,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const h in c)o[h]=c[h]}return o}function a(o,l,u){const c=this,h={enumerable:!0};c.hasBeenReset=!1;let f="",p=!1,m=o,y=l,v=u,E=null,A="",x=!0,w="auto",k="start",F=50,L="middle",M=50,C="middle";Object.defineProperty(c,"id",n({},h,{get:function(){return f},set:function(D){f=""+D}})),Object.defineProperty(c,"pauseOnExit",n({},h,{get:function(){return p},set:function(D){p=!!D}})),Object.defineProperty(c,"startTime",n({},h,{get:function(){return m},set:function(D){if(typeof D!="number")throw new TypeError("Start time must be set to a number.");m=D,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",n({},h,{get:function(){return y},set:function(D){if(typeof D!="number")throw new TypeError("End time must be set to a number.");y=D,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",n({},h,{get:function(){return v},set:function(D){v=""+D,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",n({},h,{get:function(){return E},set:function(D){E=D,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",n({},h,{get:function(){return A},set:function(D){const B=i(D);if(B===!1)throw new SyntaxError("An invalid or illegal string was specified.");A=B,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",n({},h,{get:function(){return x},set:function(D){x=!!D,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",n({},h,{get:function(){return w},set:function(D){if(typeof D!="number"&&D!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");w=D,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",n({},h,{get:function(){return k},set:function(D){const B=s(D);if(!B)throw new SyntaxError("An invalid or illegal string was specified.");k=B,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",n({},h,{get:function(){return F},set:function(D){if(D<0||D>100)throw new Error("Position must be between 0 and 100.");F=D,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",n({},h,{get:function(){return L},set:function(D){const B=s(D);if(!B)throw new SyntaxError("An invalid or illegal string was specified.");L=B,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",n({},h,{get:function(){return M},set:function(D){if(D<0||D>100)throw new Error("Size must be between 0 and 100.");M=D,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",n({},h,{get:function(){return C},set:function(D){const B=s(D);if(!B)throw new SyntaxError("An invalid or illegal string was specified.");C=B,this.hasBeenReset=!0}})),c.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a})();class Jx{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Gm(r){function e(i,s,n,a){return(i|0)*3600+(s|0)*60+(n|0)+parseFloat(a||0)}const t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class Zx{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let s=0;s<i.length;++s)if(t===i[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function Hm(r,e,t,i){const s=i?r.split(i):[r];for(const n in s){if(typeof s[n]!="string")continue;const a=s[n].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const Qu=new Yc(0,0,""),Ha=Qu.align==="middle"?"middle":"center";function e1(r,e,t){const i=r;function s(){const o=Gm(r);if(o===null)throw new Error("Malformed timestamp: "+i);return r=r.replace(/^[^\sa-zA-Z-]+/,""),o}function n(o,l){const u=new Zx;Hm(o,function(f,p){let m;switch(f){case"region":for(let y=t.length-1;y>=0;y--)if(t[y].id===p){u.set(f,t[y].region);break}break;case"vertical":u.alt(f,p,["rl","lr"]);break;case"line":m=p.split(","),u.integer(f,m[0]),u.percent(f,m[0])&&u.set("snapToLines",!1),u.alt(f,m[0],["auto"]),m.length===2&&u.alt("lineAlign",m[1],["start",Ha,"end"]);break;case"position":m=p.split(","),u.percent(f,m[0]),m.length===2&&u.alt("positionAlign",m[1],["start",Ha,"end","line-left","line-right","auto"]);break;case"size":u.percent(f,p);break;case"align":u.alt(f,p,["start",Ha,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&Qu.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",Ha);let h=u.get("position","auto");h==="auto"&&Qu.position===50&&(h=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=h}function a(){r=r.replace(/^\s+/,"")}if(a(),e.startTime=s(),a(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);r=r.slice(3),a(),e.endTime=s(),a(),n(r,e)}function qm(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class t1{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Jx,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let n=t.buffer,a=0;for(n=qm(n);a<n.length&&n[a]!=="\r"&&n[a]!==`
`;)++a;const o=n.slice(0,a);return n[a]==="\r"&&++a,n[a]===`
`&&++a,t.buffer=n.slice(a),o}function s(n){Hm(n,function(a,o){},/:/)}try{let n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;n=i();const o=n.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:n=i(),t.state){case"HEADER":/:/.test(n)?s(n):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new Yc(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{e1(n,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=n.indexOf("-->")!==-1;if(!n||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n}continue;case"BADCUE":n||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const i1=/\r\n|\n\r|\n|\r/g,Kl=function(e,t,i=0){return e.slice(i,i+t.length)===t},s1=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!pe(t)||!pe(i)||!pe(s)||!pe(n))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*s,t+=3600*1e3*n,t};function Xc(r,e,t){return wn(r.toString())+wn(e.toString())+wn(t)}const r1=function(e,t,i){let s=e[t],n=e[s.prevCC];if(!n||!n.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(a=n)!=null&&a.new;){var a;e.ccOffset+=s.start-n.start,s.new=!1,s=n,n=e[s.prevCC]}e.presentationOffset=i};function n1(r,e,t,i,s,n,a){const o=new t1,l=si(new Uint8Array(r)).trim().replace(i1,`
`).split(`
`),u=[],c=e?hb(e.baseTime,e.timescale):0;let h="00:00.000",f=0,p=0,m,y=!0;o.oncue=function(v){const E=t[i];let A=t.ccOffset;const x=(f-c)/9e4;if(E!=null&&E.new&&(p!==void 0?A=t.ccOffset=E.start:r1(t,i,x)),x){if(!e){m=new Error("Missing initPTS for VTT MPEGTS");return}A=x-t.presentationOffset}const w=v.endTime-v.startTime,k=ti((v.startTime+A-p)*9e4,s*9e4)/9e4;v.startTime=Math.max(k,0),v.endTime=Math.max(k+w,0);const F=v.text.trim();v.text=decodeURIComponent(encodeURIComponent(F)),v.id||(v.id=Xc(v.startTime,v.endTime,F)),v.endTime>0&&u.push(v)},o.onparsingerror=function(v){m=v},o.onflush=function(){if(m){a(m);return}n(u)},l.forEach(v=>{if(y)if(Kl(v,"X-TIMESTAMP-MAP=")){y=!1,v.slice(16).split(",").forEach(E=>{Kl(E,"LOCAL:")?h=E.slice(6):Kl(E,"MPEGTS:")&&(f=parseInt(E.slice(7)))});try{p=s1(h)/1e3}catch(E){m=E}return}else v===""&&(y=!1);o.parse(v+`
`)}),o.flush()}const Wl="stpp.ttml.im1t",jm=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Km=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,a1={left:"start",center:"center",right:"end",start:"start",end:"end"};function Mf(r,e,t,i){const s=we(new Uint8Array(r),["mdat"]);if(s.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const n=s.map(o=>si(o)),a=cb(e.baseTime,1,e.timescale);try{n.forEach(o=>t(o1(o,a)))}catch(o){i(o)}}function o1(r,e){const s=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const n={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(n).reduce((h,f)=>(h[f]=s.getAttribute(`ttp:${f}`)||n[f],h),{}),o=s.getAttribute("xml:space")!=="preserve",l=Ff(zl(s,"styling","style")),u=Ff(zl(s,"layout","region")),c=zl(s,"body","[begin]");return[].map.call(c,h=>{const f=Wm(h,o);if(!f||!h.hasAttribute("begin"))return null;const p=Xl(h.getAttribute("begin"),a),m=Xl(h.getAttribute("dur"),a);let y=Xl(h.getAttribute("end"),a);if(p===null)throw Nf(h);if(y===null){if(m===null)throw Nf(h);y=p+m}const v=new Yc(p-e,y-e,f);v.id=Xc(v.startTime,v.endTime,v.text);const E=u[h.getAttribute("region")],A=l[h.getAttribute("style")],x=l1(E,A,l),{textAlign:w}=x;if(w){const k=a1[w];k&&(v.lineAlign=k),v.align=w}return Ke(v,x),v}).filter(h=>h!==null)}function zl(r,e,t){const i=r.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function Ff(r){return r.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function Wm(r,e){return[].slice.call(r.childNodes).reduce((t,i,s)=>{var n;return i.nodeName==="br"&&s?t+`
`:(n=i.childNodes)!=null&&n.length?Wm(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function l1(r,e,t){const i="http://www.w3.org/ns/ttml#styling";let s=null;const n=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(s=t[a]),n.reduce((o,l)=>{const u=Yl(e,i,l)||Yl(r,i,l)||Yl(s,i,l);return u&&(o[l]=u),o},{})}function Yl(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function Nf(r){return new Error(`Could not parse ttml timestamp ${r}`)}function Xl(r,e){if(!r)return null;let t=Gm(r);return t===null&&(jm.test(r)?t=u1(r,e):Km.test(r)&&(t=c1(r,e))),t}function u1(r,e){const t=jm.exec(r),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function c1(r,e){const t=Km.exec(r),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class qa{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class h1{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Uf(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this),e.on(I.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(I.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(I.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this),e.off(I.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(I.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(I.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new qa(this,"textTrack1"),t=new qa(this,"textTrack2"),i=new qa(this,"textTrack3"),s=new qa(this,"textTrack4");this.cea608Parser1=new Of(1,e,t),this.cea608Parser2=new Of(3,i,s)}addCues(e,t,i,s,n){let a=!1;for(let o=n.length;o--;){const l=n[o],u=d1(l[0],l[1],t,i);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],i),a=!0,u/(i-t)>.5))return}if(a||n.push([t,i]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,i,s)}else{const o=this.Cues.newCue(null,t,i,s);this.hls.trigger(I.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:n,trackId:a}){const{unparsedVttFrags:o}=this;i===ye.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:n,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(I.FRAG_LOADED,l):this.hls.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let s=0;s<i.textTracks.length;s++){const n=i.textTracks[s];if(Bf(n,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return n}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:s}=this,{label:n,languageCode:a}=t[e],o=this.getExistingTrack(n,a);if(o)i[e]=o,yr(i[e]),Nm(i[e],s);else{const l=this.createTextTrack("captions",n,a);l&&(l[e]=!0,i[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,s={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(I.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,i){const s=this.media;if(s)return s.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:s}=this;Object.keys(s).forEach(n=>{yr(s[n]),delete s[n]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Uf(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)yr(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],s=i.some(n=>n.textCodec===Wl);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(xm(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const a=this.media,o=a?ao(a.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(o){let h=null;for(let f=0;f<o.length;f++)if(o[f]&&Bf(o[f],l)){h=o[f],o[f]=null;break}h&&(c=h)}if(c)yr(c);else{const h=zm(l);c=this.createTextTrack(h,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),o!=null&&o.length){const l=o.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(I.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!s)return;const n=`textTrack${s[1]}`,a=this.captionsProperties[n];a&&(a.label=i.name,i.lang&&(a.languageCode=i.lang),a.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ye.MAIN){var i,s;const{cea608Parser1:n,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:u}=t.frag,c=(i=(s=t.part)==null?void 0:s.index)!=null?i:-1;n&&a&&(u!==o+1||u===o&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(n.reset(),a.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:i,payload:s}=t;if(i.type===ye.SUBTITLE)if(s.byteLength){const n=i.decryptdata,a="stats"in t;if(n==null||!n.encrypted||a){const o=this.tracks[i.level],l=this.vttCCs;l[i.cc]||(l[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),o&&o.textCodec===Wl?this._parseIMSC1(i,s):this._parseVTTs(t)}}else this.hls.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;Mf(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),i.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{i.logger.log(`Failed to parse IMSC1: ${s}`),i.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:i,payload:s}=e,{initPTS:n,unparsedVttFrags:a}=this,o=n.length-1;if(!n[i.cc]&&o===-1){a.push(e);return}const l=this.hls,u=(t=i.initSegment)!=null&&t.data?pi(i.initSegment.data,new Uint8Array(s)).buffer:s;n1(u,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,c=>{this._appendCues(c,i.level),l.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},c=>{const h=c.message==="Missing initPTS for VTT MPEGTS";h?a.push(e):this._fallbackToIMSC1(i,s),l.logger.log(`Failed to parse VTT cue: ${c}`),!(h&&o>i.cc)&&l.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:c})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||Mf(t,this.initPTS[e.cc],()=>{i.textCodec=Wl,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(n=>Bm(s,n))}else{const s=this.tracks[t];if(!s)return;const n=s.default?"default":"subtitles"+t;i.trigger(I.CUES_PARSED,{type:"subtitles",cues:e,track:n})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===ye.SUBTITLE&&this.onFragLoaded(I.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:s}=t;if(!(i.type===ye.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let n=0;n<s.length;n++){const a=s[n].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(s[n].pts,o[0]),this.cea608Parser2.addData(s[n].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:s,type:n}){const{media:a}=this;if(!(!a||a.currentTime<i)){if(!n||n==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>Xu(o[l],t,i))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>Xu(o[l],t,s))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let s=2;for(let n=0;n<i;n++){const a=e[s++],o=127&e[s++],l=127&e[s++];if(o===0&&l===0)continue;if((4&a)!==0){const c=3&a;(c===0||c===1)&&(t[c].push(o),t[c].push(l))}}return t}}function zm(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function Bf(r,e){return!!r&&r.kind===zm(e)&&Ku(e,r)}function d1(r,e,t,i){return Math.min(e,i)-Math.max(r,t)}function Uf(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const f1=/\s/,p1={newCue(r,e,t,i){const s=[];let n,a,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let f=0;f<i.rows.length;f++)if(n=i.rows[f],o=!0,l=0,u="",!n.isEmpty()){var h;for(let y=0;y<n.chars.length;y++)f1.test(n.chars[y].uchar)&&o?l++:(u+=n.chars[y].uchar,o=!1);n.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const p=qm(u.trim()),m=Xc(e,t,p);r!=null&&(h=r.cues)!=null&&h.getCueById(m)||(a=new c(e,t,p),a.id=m,a.line=f+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(a))}return r&&s.length&&(s.sort((f,p)=>f.line==="auto"||p.line==="auto"?0:f.line>8&&p.line>8?p.line-f.line:f.line-p.line),s.forEach(f=>Bm(r,f))),s}};function g1(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const m1=/(\d+)-(\d+)\/(\d+)/;class $f{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||v1,this.controller=new self.AbortController,this.stats=new Dc}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const n=y1(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,n),self.clearTimeout(this.requestTimeout),t.timeout=l&&pe(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(Hn(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(h=>{var f;this.response=this.loader=h;const p=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},u-(p-s.loading.start)),!h.ok){const{status:y,statusText:v}=h;throw new S1(v||"fetch, bad network response",y,h)}s.loading.first=p,s.total=_1(h.headers)||s.total;const m=(f=this.callbacks)==null?void 0:f.onProgress;return m&&pe(t.highWaterMark)?this.loadProgressively(h,s,e,t.highWaterMark,m):a?h.arrayBuffer():e.responseType==="json"?h.json():h.text()}).then(h=>{var f,p;const m=this.response;if(!m)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const y=h[o];y&&(s.loaded=s.total=y);const v={url:m.url,data:h,code:m.status},E=(f=this.callbacks)==null?void 0:f.onProgress;E&&!pe(t.highWaterMark)&&E(s,e,h,m),(p=this.callbacks)==null||p.onSuccess(v,s,e,m)}).catch(h=>{var f;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const p=h&&h.code||0,m=h?h.message:null;(f=this.callbacks)==null||f.onError({code:p,text:m},e,h?h.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,s=0,n){const a=new rm,o=e.body.getReader(),l=()=>o.read().then(u=>{if(u.done)return a.dataLength&&n(t,i,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=u.value,h=c.length;return t.loaded+=h,h<s||a.dataLength?(a.push(c),a.dataLength>=s&&n(t,i,a.flush().buffer,e)):n(t,i,c.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function y1(r,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ke({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function T1(r){const e=m1.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function _1(r){const e=r.get("Content-Range");if(e){const i=T1(e);if(pe(i))return i}const t=r.get("Content-Length");if(t)return parseInt(t)}function v1(r,e){return new self.Request(r.url,e)}class S1 extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const E1=/^age:\s*[\d.]+\s*$/im;class Ym{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Dc,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const n=this.xhrSetup;n?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return n(i,t.url)}).catch(a=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),n(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:i.status,text:a.message},t,i,s)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:n,maxLoadTimeMs:a}=i.loadPolicy;if(s)for(const o in s)e.setRequestHeader(o,s[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=n&&pe(n)?n:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const s=t.readyState,n=this.config;if(!i.aborted&&s>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,c=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const m=c??t.response;if(m!=null){var a,o;i.loading.end=Math.max(self.performance.now(),i.loading.first);const y=t.responseType==="arraybuffer"?m.byteLength:m.length;i.loaded=i.total=y,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const v=(a=this.callbacks)==null?void 0:a.onProgress;v&&v(i,e,m,t);const E={url:t.responseURL,data:m,code:u};(o=this.callbacks)==null||o.onSuccess(E,i,e,t);return}}const h=n.loadPolicy.errorRetry,f=i.retry,p={url:e.url,data:void 0,code:u};if(yo(h,f,!1,p))this.retry(h);else{var l;qe.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(yo(e,t,!0))this.retry(e);else{var i;qe.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=kc(e,i.retry),i.retry++,qe.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&E1.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const b1={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},x1=He(He({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Ym,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:FS,bufferController:Cb,capLevelController:Kc,errorController:VS,fpsController:Ix,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Wg,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:b1},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},A1()),{},{subtitleStreamController:Ux,subtitleTrackController:Rx,timelineController:h1,audioStreamController:Eb,audioTrackController:bb,emeController:xr,cmcdController:bx,contentSteeringController:Ax,interstitialsController:Bx});function A1(){return{cueHandler:p1,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function C1(r,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=Ju(r),s=["manifest","level","frag"],n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,l=e[o]===void 0,u=[];n.forEach(c=>{const h=`${a}Loading${c}`,f=e[h];if(f!==void 0&&l){u.push(h);const p=i[o].default;switch(e[o]={default:p},c){case"TimeOut":p.maxLoadTimeMs=f,p.maxTimeToFirstByteMs=f;break;case"MaxRetry":p.errorRetry.maxNumRetry=f,p.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":p.errorRetry.retryDelayMs=f,p.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":p.errorRetry.maxRetryDelayMs=f,p.timeoutRetry.maxRetryDelayMs=f;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${o}": ${Ye(e[o])}`)}),He(He({},i),e)}function Ju(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(Ju):Object.keys(r).reduce((e,t)=>(e[t]=Ju(r[t]),e),{}):r}function I1(r,e){const t=r.loader;t!==$f&&t!==Ym?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):g1()&&(r.loader=$f,r.progressive=!0,r.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const oo=2,D1=.1,L1=.05,R1=100;class w1 extends Gg{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(R1),this.mediaSource=t.mediaSource;const i=this.media=t.media;$t(i,"playing",this.onMediaPlaying),$t(i,"waiting",this.onMediaWaiting),$t(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(Kt(i,"playing",this.onMediaPlaying),Kt(i,"waiting",this.onMediaWaiting),Kt(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,s;const n=(i=this.hls)==null?void 0:i.config;if(!n)return;const a=this.media;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,u=!this.seeking&&o,c=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,n.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!1}));return}if(!Ie.getBuffered(a).length){this.nudgeRetry=0;return}const h=Ie.bufferInfo(a,e,0),f=h.nextStart||0,p=this.fragmentTracker;if(o&&p&&this.hls){const F=Vf(this.hls.inFlightFragments,e),L=h.len>oo,M=!f||F||f-e>oo&&!p.getPartialFragment(e);if(L||M)return;this.moved=!1}const m=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&p){if(!(h.len>0)&&!f)return;const L=Math.max(f,h.start||0)-e,C=!!(m!=null&&m.live)?m.targetduration*2:oo,D=ja(e,p);if(L>0&&(L<=C||D)){a.paused||this._trySkipBufferHole(D);return}}const y=n.detectStallWithCurrentTimeMs,v=self.performance.now(),E=this.waiting;let A=this.stalled;if(A===null)if(E>0&&v-E<y)A=this.stalled=E;else{this.stalled=v;return}const x=v-A;if(!o&&(x>=y||E)&&this.hls){var w;if(((w=this.mediaSource)==null?void 0:w.readyState)==="ended"&&!(m!=null&&m.live)&&Math.abs(e-(m?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(h),!this.media||!this.hls)return}const k=Ie.bufferInfo(a,e,n.maxBufferHole);this._tryFixBufferStall(k,x,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(I.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&s&&s.length>1&&e>s.end(0)){const n=Ie.bufferedInfo(Ie.timeRangesToArray(this.buffered.audio),e,0);if(n.len>1&&t>=n.start){const a=Ie.timeRangesToArray(s),o=Ie.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const l=Ie.bufferedInfo(a,e,0).bufferedIndex,u=a[o].end,c=a[o+1].start;if((l===-1||l>o)&&c-u<1&&e-u<2){const h=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${c} buffered index: ${l}`);this.warn(h.message),this.media.currentTime+=1e-6;let f=ja(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const p=Ie.bufferInfo(this.media,e,0);this.hls.trigger(I.ERROR,{type:Te.MEDIA_ERROR,details:ee.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:f,buffer:p.len,bufferInfo:p})}}}}}_tryFixBufferStall(e,t,i){var s,n;const{fragmentTracker:a,media:o}=this,l=(s=this.hls)==null?void 0:s.config;if(!o||!a||!l)return;const u=(n=this.hls)==null?void 0:n.latestLevelDetails,c=ja(i,a);if((c||u!=null&&u.live&&i<u.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const h=e.buffered,f=this.adjacentTraversal(e,i);(h&&h.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-i<l.maxBufferHole||f))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const i=this.fragmentTracker,s=e.nextStart;if(i&&s){const n=i.getFragAtPos(t,ye.MAIN),a=i.getFragAtPos(s,ye.MAIN);if(n&&a)return a.sn-n.sn<2}return!1}_reportStall(e){const{hls:t,media:i,stallReported:s,stalled:n}=this;if(!s&&n!==null&&i&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${Ye(e)})`);this.warn(a.message),t.trigger(I.ERROR,{type:Te.MEDIA_ERROR,details:ee.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:n}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:s}=this,n=(t=this.hls)==null?void 0:t.config;if(!s||!i||!n)return 0;const a=s.currentTime,o=Ie.bufferInfo(s,a,0),l=a<o.start?o.start:o.nextStart;if(l&&this.hls){const c=o.len<=n.maxBufferHole,h=o.len>0&&o.len<1&&s.readyState<3,f=l-a;if(f>0&&(c||h)){if(f>n.maxBufferHole){let m=!1;if(a===0){const y=i.getAppendedFrag(0,ye.MAIN);y&&l<y.end&&(m=!0)}if(!m&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||Vf(this.hls.inFlightFragments,l))return 0;let v=!1,E=e.end;for(;E<l;){const A=ja(E,i);if(A)E+=A.duration;else{v=!0;break}}if(v)return 0}}const p=Math.max(l+L1,a+D1);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${p}`),this.moved=!0,s.currentTime=p,!(e!=null&&e.gap)){const m=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${p}`),y={type:Te.MEDIA_ERROR,details:ee.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?y.part=e:y.frag=e),this.hls.trigger(I.ERROR,y)}return p}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:s}=this,n=t?.config;if(!i||!n)return 0;const a=i.currentTime;if(this.nudgeRetry++,s<n.nudgeMaxRetry){const o=a+(s+1)*n.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(l.message),i.currentTime=o,t.trigger(I.ERROR,{type:Te.MEDIA_ERROR,details:ee.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${n.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(I.ERROR,{type:Te.MEDIA_ERROR,details:ee.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Vf(r,e){const t=Gf(r.main);if(t&&t.start<=e)return t;const i=Gf(r.audio);return i&&i.start<=e?i:null}function Gf(r){if(!r)return null;switch(r.state){case le.IDLE:case le.STOPPED:case le.ENDED:case le.ERROR:return null}return r.frag}function ja(r,e){return e.getAppendedFrag(r,ye.MAIN)||e.getPartialFragment(r)}const k1=.25;function Zu(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Ql(r,e,t,i,s){let n=new r(e,t,"");try{n.value=i,s&&(n.type=s)}catch{n=new r(e,t,Ye(s?He({type:s},i):i))}return n}const Ka=(()=>{const r=Zu();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class P1{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(I.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&yr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return Nm(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:i,enableID3MetadataCues:s}=this.hls.config;if(!i&&!s)return;const{samples:n}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=Zu();if(a)for(let o=0;o<n.length;o++){const l=n[o].type;if(l===ii.emsg&&!i||!s)continue;const u=hm(n[o].data),c=n[o].pts;let h=c+n[o].duration;h>Ka&&(h=Ka),h-c<=0&&(h=c+k1);for(let p=0;p<u.length;p++){const m=u[p];if(!dm(m)){this.updateId3CueEnds(c,l);const y=Ql(a,c,h,m,l);y&&this.id3Track.addCue(y)}}}}updateId3CueEnds(e,t){var i;const s=(i=this.id3Track)==null?void 0:i.cues;if(s)for(let n=s.length;n--;){const a=s[n];a.type===t&&a.startTime<e&&a.endTime===Ka&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:s}){const{id3Track:n,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(n&&(o||l)){let u;s==="audio"?u=c=>c.type===ii.audioId3&&l:s==="video"?u=c=>c.type===ii.emsg&&o:u=c=>c.type===ii.audioId3&&l||c.type===ii.emsg&&o,Xu(n,t,i,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:i,timelineOffset:s,enableDateRangeMetadataCues:n,interstitialsController:a}=this.hls.config;if(!n)return;const o=Zu();if(i&&s&&!a){const{fragmentStart:y,fragmentEnd:v}=e;let E=this.assetCue;E?(E.startTime=y,E.endTime=v):o&&(E=this.assetCue=Ql(o,y,v,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),E&&(E.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(E),E.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:u}=e,c=Object.keys(u);let h=this.dateRangeCuesAppended;if(l&&t){var f;if((f=l.cues)!=null&&f.length){const y=Object.keys(h).filter(v=>!c.includes(v));for(let v=y.length;v--;){var p;const E=y[v],A=(p=h[E])==null?void 0:p.cues;delete h[E],A&&Object.keys(A).forEach(x=>{const w=A[x];if(w){w.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(w)}catch{}}})}}else h=this.dateRangeCuesAppended={}}const m=e.fragments[e.fragments.length-1];if(!(c.length===0||!pe(m?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let y=0;y<c.length;y++){const v=c[y],E=u[v],A=E.startTime,x=h[v],w=x?.cues||{};let k=x?.durationKnown||!1,F=Ka;const{duration:L,endDate:M}=E;if(M&&L!==null)F=A+L,k=!0;else if(E.endOnNext&&!k){const D=c.reduce((B,H)=>{if(H!==E.id){const q=u[H];if(q.class===E.class&&q.startDate>E.startDate&&(!B||E.startDate<B.startDate))return q}return B},null);D&&(F=D.startTime,k=!0)}const C=Object.keys(E.attr);for(let D=0;D<C.length;D++){const B=C[D];if(!eE(B))continue;const H=w[B];if(H)k&&!(x!=null&&x.durationKnown)?H.endTime=F:Math.abs(H.startTime-A)>.01&&(H.startTime=A,H.endTime=F);else if(o){let q=E.attr[B];tE(B)&&(q=Eg(q));const Z=Ql(o,A,F,{key:B,data:q},ii.dateRange);Z&&(Z.id=v,this.id3Track.addCue(Z),w[B]=Z,a&&(B==="X-ASSET-LIST"||B==="X-ASSET-URL")&&Z.addEventListener("enter",this.onEventCueEnter))}}h[v]={cues:w,dateRange:E,durationKnown:k}}}}}class O1{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:n,maxLiveSyncPlaybackRate:a}=this.config;if(!n||a===1||!i.live)return;const o=this.targetLatency;if(o===null)return;const l=s-o,u=Math.min(this.maxLatency,o+i.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){const h=Math.min(2,Math.max(1,a)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,p=Math.min(h,Math.max(1,f));this.changeMediaPlaybackRate(t,p)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:s}=e,{liveSyncDuration:n,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let u=o&&i||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=n!==void 0?n:a*s);const c=s;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const s=i.edge,n=e-t-this.edgeStalled,a=s-i.totalduration,o=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(a,n),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===ee.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,s;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class M1 extends jc{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,s=[],n={},a={};let o=!1,l=!1,u=!1;t.levels.forEach(c=>{const h=c.attrs;let{audioCodec:f,videoCodec:p}=c;f&&(c.audioCodec=f=fo(f,i)||void 0),p&&(p=c.videoCodec=yS(p));const{width:m,height:y,unknownCodecs:v}=c,E=v?.length||0;if(o||(o=!!(m&&y)),l||(l=!!p),u||(u=!!f),E||f&&!this.isAudioSupported(f)||p&&!this.isVideoSupported(p)){this.log(`Some or all CODECS not supported "${h.CODECS}"`);return}const{CODECS:A,"FRAME-RATE":x,"HDCP-LEVEL":w,"PATHWAY-ID":k,RESOLUTION:F,"VIDEO-RANGE":L}=h,C=`${`${k||"."}-`}${c.bitrate}-${F}-${x}-${A}-${L}-${w}`;if(n[C])if(n[C].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const D=a[C]+=1;c.attrs["PATHWAY-ID"]=new Array(D+1).join(".");const B=this.createLevel(c);n[C]=B,s.push(B)}else n[C].addGroupId("audio",h.AUDIO),n[C].addGroupId("text",h.SUBTITLES);else{const D=this.createLevel(c);n[C]=D,a[C]=1,s.push(D)}}),this.filterAndSortMediaOptions(s,t,o,l,u)}createLevel(e){const t=new $n(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(s.message),t.supportedResult=Og(s,[])}return t}isAudioSupported(e){return Bn(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Bn(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,s,n){var a;let o=[],l=[],u=e;const c=((a=t.stats)==null?void 0:a.parsing)||{};if((i||s)&&n&&(u=u.filter(({videoCodec:A,videoRange:x,width:w,height:k})=>(!!A||!!(w&&k))&&IS(x))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let A="no level with compatible codecs found in manifest",x=A;t.levels.length&&(x=`one or more CODECS in variant not supported: ${Ye(t.levels.map(k=>k.attrs.CODECS).filter((k,F,L)=>L.indexOf(k)===F))}`,this.warn(x),A+=` (${x})`);const w=new Error(A);this.hls.trigger(I.ERROR,{type:Te.MEDIA_ERROR,details:ee.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:w,reason:x})}}),c.end=performance.now();return}t.audioTracks&&(o=t.audioTracks.filter(A=>!A.audioCodec||this.isAudioSupported(A.audioCodec)),Hf(o)),t.subtitles&&(l=t.subtitles,Hf(l));const h=u.slice(0);u.sort((A,x)=>{if(A.attrs["HDCP-LEVEL"]!==x.attrs["HDCP-LEVEL"])return(A.attrs["HDCP-LEVEL"]||"")>(x.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&A.height!==x.height)return A.height-x.height;if(A.frameRate!==x.frameRate)return A.frameRate-x.frameRate;if(A.videoRange!==x.videoRange)return po.indexOf(A.videoRange)-po.indexOf(x.videoRange);if(A.videoCodec!==x.videoCodec){const w=Pd(A.videoCodec),k=Pd(x.videoCodec);if(w!==k)return k-w}if(A.uri===x.uri&&A.codecSet!==x.codecSet){const w=ho(A.codecSet),k=ho(x.codecSet);if(w!==k)return k-w}return A.averageBitrate!==x.averageBitrate?A.averageBitrate-x.averageBitrate:0});let f=h[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==h.length)){for(let A=0;A<h.length;A++)if(h[A].pathwayId===u[0].pathwayId){f=h[A];break}}this._levels=u;for(let A=0;A<u.length;A++)if(u[A]===f){var p;this._firstLevel=A;const x=f.bitrate,w=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${x}`),((p=this.hls.userConfig)==null?void 0:p.abrEwmaDefaultEstimate)===void 0){const k=Math.min(x,this.hls.config.abrEwmaDefaultEstimateMax);k>w&&w===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}const m=n&&!s,y=this.hls.config,v=!!(y.audioStreamController&&y.audioTrackController),E={levels:u,audioTracks:o,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:n,video:s,altAudio:v&&!m&&o.some(A=>!!A.url)};c.end=performance.now(),this.hls.trigger(I.MANIFEST_PARSED,E)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),h=e<0;if(this.hls.trigger(I.ERROR,{type:Te.OTHER_ERROR,details:ee.LEVEL_SWITCH_ERROR,level:e,fatal:h,error:c,reason:c.message}),h)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,s=this.currentLevel,n=s?s.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,i===e&&s&&n===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${i}${n?" with Pathway "+n:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(I.LEVEL_SWITCHING,l);const u=a.details;if(!u||u.live){const c=this.switchParams(a.uri,s?.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===Pe.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ye.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(n=>!!i[n]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var i;const{level:s,details:n}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${s}`),(o=t.deliveryDirectives)!=null&&o.skip&&(n.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let l=a.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(s,t,l)}else(i=t.deliveryDirectives)!=null&&i.skip&&(n.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,n=e.attrs["PATHWAY-ID"],a=e.details,o=a?.age;this.log(`Loading level index ${s}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${n?" Pathway "+n:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(I.LEVEL_LOADING,{url:i,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((n,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(n),n===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,n.details&&n.details.fragments.forEach(o=>o.level=-1)),!1));tm(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=i.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(I.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(I.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function Hf(r){const e={};r.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function Xm(){return self.SourceBuffer||self.WebKitSourceBuffer}function Qm(){if(!Ls())return!1;const e=Xm();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function F1(){if(!Qm())return!1;const r=Ls();return typeof r?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(Un(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(Un(e,"audio"))))}function N1(){var r;const e=Xm();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}const B1=100;class U1 extends Nc{constructor(e,t,i){super(e,t,i,"stream-controller",ye.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,n=s?s.currentTime:null;if(n===null||!pe(n)||(this.log(`Media seeked to ${n.toFixed(3)}`),!this.getBufferedFrag(n)))return;const a=this.getFwdBufferInfoAtPos(s,n,ye.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${n} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:s}=this;if(this.stopLoad(),this.setInterval(B1),this.level=-1,!this.startFragRequested){let n=s.startLevel;n===-1&&(s.config.testBandwidth&&this.levels.length>1?(n=0,this.bitrateTest=!0):n=s.firstAutoLevel),s.nextLoadLevel=n,this.level=s.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=le.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=le.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case le.WAITING_LEVEL:{const{levels:e,level:t}=this,i=e?.[t],s=i?.details;if(s&&(!s.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(s))break;this.state=le.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=le.IDLE;break}break}case le.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===le.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const n=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[n]))return;const a=i[n],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const y={};this.altAudio===2&&(y.type="video"),this.hls.trigger(I.BUFFER_EOS,y),this.state=le.ENDED;return}if(!this.buffering)return;e.loadLevel!==n&&e.manualLevel===-1&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=e.nextLoadLevel=n;const u=a.details;if(!u||this.state===le.WAITING_LEVEL||this.waitForLive(a)){this.level=n,this.state=le.WAITING_LEVEL,this.startFragRequested=!1;return}const c=o.len,h=this.getMaxBufferLength(a.maxBitrate);if(c>=h)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:o.end;let p=this.getNextFragment(f,u);if(this.couldBacktrack&&!this.fragPrevious&&p&&gt(p)&&this.fragmentTracker.getState(p)!==vt.OK){var m;const v=((m=this.backtrackFragment)!=null?m:p).sn-u.startSN,E=u.fragments[v-1];E&&p.cc===E.cc&&(p=E,this.fragmentTracker.removeFragment(E))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,f)){if(!p.gap){const v=this.audioOnly&&!this.altAudio?ze.AUDIO:ze.VIDEO,E=(v===ze.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;E&&this.afterBufferFlushed(E,v,ye.MAIN)}p=this.getNextFragmentLoopLoading(p,u,o,ye.MAIN,h)}p&&(p.initSegment&&!p.initSegment.data&&!this.bitrateTest&&(p=p.initSegment),this.loadFragment(p,a,f))}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);s===vt.NOT_LOADED||s===vt.PARTIAL?gt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ye.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const n=this.getLevelDetails();if(n!=null&&n.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<n.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],u=this.fragLastKbps;u&&this.fragCurrent?i=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:i=0}else i=0;const a=this.getBufferedFrag(t.currentTime+i);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,u=o.duration,c=Math.max(a.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case le.KEY_LOADING:case le.FRAG_LOADING:case le.FRAG_LOADING_WAITING_RETRY:case le.PARSING:case le.PARSED:this.state=le.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;$t(i,"playing",this.onMediaPlaying),$t(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(Kt(i,"playing",this.onMediaPlaying),Kt(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(I.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,s=!1;for(let n=0;n<t.levels.length;n++){const a=t.levels[n].audioCodec;a&&(i=i||a.indexOf("mp4a.40.2")!==-1,s=s||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&s&&!N1(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==le.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=le.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:s,startFragRequested:n}=this,a=t.level,o=t.details,l=o.totalduration;if(!s){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const u=t.levelInfo,c=this.fragCurrent;c&&(this.state===le.FRAG_LOADING||this.state===le.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let h=0;if(o.live||(i=u.details)!=null&&i.live){var f;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;h=this.alignPlaylists(o,u.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(u.details=o,this.levelLastLoaded=u,n||this.setStartPosition(o,h),this.hls.trigger(I.LEVEL_UPDATED,{details:o,level:a}),this.state===le.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=le.IDLE}n&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const s=this.hls.liveSyncPosition,n=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,l=n>=a-t.maxFragLookUpTolerance&&n<=o;if(s!==null&&i.duration>s&&(n<s||!l)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&i.readyState<4||n<o-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),i.readyState))if(this.warn(`Playback: ${n.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const h=Ie.bufferInfo(i,s,0);if(!((u=h.buffered)!=null&&u.length)){i.currentTime=s;return}if(h.start<=n){i.currentTime=s;return}const{nextStart:p}=Ie.bufferedInfo(h.buffered,n,0);p&&(i.currentTime=p)}else i.currentTime=s}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:s,payload:n}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const o=a[i.level];if(!o){this.warn(`Level ${i.level} not found on progress`);return}const l=o.details;if(!l){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const u=o.videoCodec,c=l.PTSKnown||!l.live,h=(t=i.initSegment)==null?void 0:t.data,f=this._getAudioCodec(o),p=this.transmuxer=this.transmuxer||new bm(this.hls,ye.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=s?s.index:-1,y=m!==-1,v=new Oc(i.level,i.sn,i.stats.chunkCount,n.byteLength,m,y),E=this.initPTS[i.cc];p.push(n,h,f,u,i,s,l.totalduration,c,v,E)}onAudioTrackSwitching(e,t){const i=this.hls,s=this.altAudio!==0;if(go(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.altAudio=0,this.fragmentTracker.removeAllFragments(),i.once(I.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(I.AUDIO_TRACK_SWITCHED,t)}),i.trigger(I.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(I.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=go(t.url,this.hls);if(i){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let s,n,a=!1;for(const o in i){const l=i[o];if(l.id==="main"){if(n=o,s=l,o==="video"){const u=i[o];u&&(this.videoBuffer=u.buffer)}}else a=!0}a&&s?(this.log(`Alternate track found, use ${n}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:s}=t,n=i.type===ye.MAIN;if(n){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===le.PARSED&&(this.state=le.IDLE);return}const o=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),gt(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}const a=this.media;a&&(!this._hasEnoughToStart&&Ie.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),n&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=le.ERROR;return}switch(t.details){case ee.FRAG_GAP:case ee.FRAG_PARSING_ERROR:case ee.FRAG_DECRYPT_ERROR:case ee.FRAG_LOAD_ERROR:case ee.FRAG_LOAD_TIMEOUT:case ee.KEY_LOAD_ERROR:case ee.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ye.MAIN,t);break;case ee.LEVEL_LOAD_ERROR:case ee.LEVEL_LOAD_TIMEOUT:case ee.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===le.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===Pe.LEVEL&&(this.state=le.IDLE);break;case ee.BUFFER_ADD_CODEC_ERROR:case ee.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case ee.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case ee.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=le.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ze.AUDIO||!this.altAudio){const i=(t===ze.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,ye.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&i&&(i+=s);const n=this.getLevelDetails(),a=Ie.getBuffered(e),o=a.length?a.start(0):0,l=o-i,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<u||this.loadingParts&&l<2*(n?.partTarget||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),i+=l,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${o}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:s}=this,n=i?.frag;if(!n||this.fragContextChanged(n))return;t.fragmentError=0,this.state=le.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=n.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),s.trigger(I.FRAG_LOADED,i),n.bitrateTest=!1}).catch(i=>{this.state===le.STOPPED||this.state===le.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:i}=this,{remuxResult:s,chunkMeta:n}=e,a=this.getCurrentContext(n);if(!a){this.resetWhenMissingContext(n);return}const{frag:o,part:l,level:u}=a,{video:c,text:h,id3:f,initSegment:p}=s,{details:m}=u,y=this.altAudio?void 0:s.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=le.PARSING,p){const v=p.tracks;if(v){const w=o.initSegment||o;if(this.unhandledEncryptionError(p,o))return;this._bufferInitSegment(u,v,w,n),i.trigger(I.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:t,tracks:v})}const E=p.initPTS,A=p.timescale,x=this.initPTS[o.cc];if(pe(E)&&(!x||x.baseTime!==E||x.timescale!==A)){const w=p.trackId;this.initPTS[o.cc]={baseTime:E,timescale:A,trackId:w},i.trigger(I.INIT_PTS_FOUND,{frag:o,id:t,initPTS:E,timescale:A,trackId:w})}}if(c&&m){y&&c.type==="audiovideo"&&this.logMuxedErr(o);const v=m.fragments[o.sn-1-m.startSN],E=o.sn===m.startSN,A=!v||o.cc>v.cc;if(s.independent!==!1){const{startPTS:x,endPTS:w,startDTS:k,endDTS:F}=c;if(l)l.elementaryStreams[c.type]={startPTS:x,endPTS:w,startDTS:k,endDTS:F};else if(c.firstKeyFrame&&c.independent&&n.id===1&&!A&&(this.couldBacktrack=!0),c.dropped&&c.independent){const L=this.getMainFwdBufferInfo(),M=(L?L.end:this.getLoadPosition())+this.config.maxBufferHole,C=c.firstKeyFramePTS?c.firstKeyFramePTS:x;if(!E&&M<C-this.config.maxBufferHole&&!A){this.backtrack(o);return}else A&&(o.gap=!0);o.setElementaryStreamInfo(c.type,o.start,w,o.start,F,!0)}else E&&x-(m.appliedTimelineOffset||0)>oo&&(o.gap=!0);o.setElementaryStreamInfo(c.type,x,w,k,F),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,n,E||A)}else if(E||A)o.gap=!0;else{this.backtrack(o);return}}if(y){const{startPTS:v,endPTS:E,startDTS:A,endDTS:x}=y;l&&(l.elementaryStreams[ze.AUDIO]={startPTS:v,endPTS:E,startDTS:A,endDTS:x}),o.setElementaryStreamInfo(ze.AUDIO,v,E,A,x),this.bufferFragmentData(y,o,l,n)}if(m&&f!=null&&f.samples.length){const v={id:t,frag:o,details:m,samples:f.samples};i.trigger(I.FRAG_PARSING_METADATA,v)}if(m&&h){const v={id:t,frag:o,details:m,samples:h.samples};i.trigger(I.FRAG_PARSING_USERDATA,v)}}logMuxedErr(e){this.warn(`${gt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,s){if(this.state!==le.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:n,video:a,audiovideo:o}=t;if(n){const u=e.audioCodec;let c=eo(n.codec,u);c==="mp4a"&&(c="mp4a.40.5");const h=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");const f=n.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&h.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&h.indexOf("android")!==-1&&n.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log(`Android: force audio codec to ${c}`)),u&&u!==c&&this.log(`Swapping manifest audio codec "${u}" for "${c}"`),n.levelCodec=c,n.id=ye.MAIN,this.log(`Init audio buffer, container:${n.container}, codecs[selected/level/parsed]=[${c||""}/${u||""}/${n.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=ye.MAIN;const u=a.codec;if(u?.length===4)switch(u){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${a.codec!==u?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(I.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{const h=t[u].initSegment;h!=null&&h.byteLength&&this.hls.trigger(I.BUFFER_APPENDING,{type:u,data:h,frag:i,part:null,chunkMeta:s,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ye.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e?.[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=le.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(Ie.isBuffered(e,i)?t=this.getAppendedFrag(i):Ie.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,n=t.level;(!s||t.sn!==s.sn||s.level!==n)&&(this.fragPlaying=t,this.hls.trigger(I.FRAG_CHANGED,{frag:t}),(!s||s.level!==n)&&this.hls.trigger(I.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return pe(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(pe(t)){const i=this.getLevelDetails(),s=this.currentFrag||(i?tr(null,i.fragments,t):null);if(s){const n=s.programDateTime;if(n!==null){const a=n+(t-s.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class $1 extends yi{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[i].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=ee.KEY_LOAD_ERROR,i,s,n){return new as({type:Te.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:i,networkDetails:s})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,n=t.length;s<n;s++){const a=t[s];if(e.cc<=a.cc&&(!gt(e)||!gt(a)||e.sn<a.sn)||!i&&s==n-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const l=io(o);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const s=An(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,s;t&&e.setKeyFormat(t);const n=e.decryptdata;if(!n){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,ee.KEY_LOAD_ERROR,u))}const a=n.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,ee.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=Jl(n);let l=this.keyIdToKeyInfo[o];if((i=l)!=null&&i.decryptdata.key)return n.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(s=l)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(c=>{const{keyInfo:h}=c;return n.key=h.decryptdata.key,{frag:e,keyInfo:h}})}switch(this.log(`${this.keyIdToKeyInfo[o]?"Rel":"L"}oading${n.keyId?" keyId: "+Lt(n.keyId):""} URI: ${n.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[o]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return n.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,ee.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${n.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const a=nS(t.initSegment.data);if(a.length){let o=a[0];o.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${Lt(o)}`),Ds.setKeyIdForUri(e.decryptdata.uri,o)):(o=Ds.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Lt(o)}`)),e.decryptdata.keyId=o}}if(!e.decryptdata.keyId&&!gt(t))return Promise.resolve(i);const n=this.emeController.loadKey(i);return(e.keyLoadPromise=n.then(a=>(e.mediaKeySessionContext=a,i))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,s=i.loader,n=new s(i);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=i.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,p,m,y)=>{const{frag:v,keyInfo:E}=m,A=Jl(E.decryptdata);if(!v.decryptdata||E!==this.keyIdToKeyInfo[A])return o(this.createKeyLoadError(v,ee.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),y));E.decryptdata.key=v.decryptdata.key=new Uint8Array(f.data),v.keyLoader=null,E.loader=null,a({frag:v,keyInfo:E})},onError:(f,p,m,y)=>{this.resetLoader(p),o(this.createKeyLoadError(t,ee.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),m,He({url:l.url,data:void 0},f)))},onTimeout:(f,p,m)=>{this.resetLoader(p),o(this.createKeyLoadError(t,ee.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(f,p,m)=>{this.resetLoader(p),o(this.createKeyLoadError(t,ee.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};n.load(l,c,h)})}resetLoader(e){const{frag:t,keyInfo:i,url:s}=e,n=i.loader;t.keyLoader===n&&(t.keyLoader=null,i.loader=null);const a=Jl(i.decryptdata)||s;delete this.keyIdToKeyInfo[a],n&&n.destroy()}}function Jl(r){if(r.keyFormat!==Rt.FAIRPLAY){const e=r.keyId;if(e)return Lt(e)}return r.uri}function qf(r){const{type:e}=r;switch(e){case Pe.AUDIO_TRACK:return ye.AUDIO;case Pe.SUBTITLE_TRACK:return ye.SUBTITLE;default:return ye.MAIN}}function Zl(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}let V1=class{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(I.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(I.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,s=t.loader,n=i||s,a=new n(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Pe.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:s,pathwayId:n,url:a,deliveryDirectives:o,levelInfo:l}=t;this.load({id:i,level:s,pathwayId:n,responseType:"text",type:Pe.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:i,groupId:s,url:n,deliveryDirectives:a,track:o}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:Pe.AUDIO_TRACK,url:n,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:i,groupId:s,url:n,deliveryDirectives:a,track:o}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:Pe.SUBTITLE_TRACK,url:n,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const i=this.loaders[Pe.LEVEL];if(i){const s=i.context;s&&!t.levels.some(n=>n===s.levelOrTrack)&&(i.abort(),delete this.loaders[Pe.LEVEL])}}load(e){var t;const i=this.hls.config;let s=this.getInternalLoader(e);if(s){const u=this.hls.logger,c=s.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let n;if(e.type===Pe.MANIFEST?n=i.manifestLoadPolicy.default:n=Ke({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),pe((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===Pe.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===Pe.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===Pe.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,h=u.targetduration;if(c&&h){const f=Math.max(c*3,h*.8)*1e3;n=Ke({},n,{maxTimeToFirstByteMs:Math.min(f,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,n.maxTimeToFirstByteMs)})}}}const a=n.errorRetry||n.timeoutRetry||{},o={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(u,c,h,f)=>{const p=this.getInternalLoader(h);this.resetInternalLoader(h.type);const m=u.data;c.parsing.start=performance.now(),Hi.isMediaPlaylist(m)||h.type!==Pe.MANIFEST?this.handleTrackOrLevelPlaylist(u,c,h,f||null,p):this.handleMasterPlaylist(u,c,h,f)},onError:(u,c,h,f)=>{this.handleNetworkError(c,h,!1,u,f)},onTimeout:(u,c,h)=>{this.handleNetworkError(c,h,!0,void 0,u)}};s.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,s){const n=this.hls,a=e.data,o=Zl(e,i),l=Hi.parseMasterPlaylist(a,o);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,i,l.playlistParsingError,s,t);return}const{contentSteering:u,levels:c,sessionData:h,sessionKeys:f,startTimeOffset:p,variableList:m}=l;this.variableList=m,c.forEach(A=>{const{unknownCodecs:x}=A;if(x){const{preferManagedMediaSource:w}=this.hls.config;let{audioCodec:k,videoCodec:F}=A;for(let L=x.length;L--;){const M=x[L];Bn(M,"audio",w)?(A.audioCodec=k=k?`${k},${M}`:M,Mr.audio[k.substring(0,4)]=2,x.splice(L,1)):Bn(M,"video",w)&&(A.videoCodec=F=F?`${F},${M}`:M,Mr.video[F.substring(0,4)]=2,x.splice(L,1))}}});const{AUDIO:y=[],SUBTITLES:v,"CLOSED-CAPTIONS":E}=Hi.parseMasterPlaylistMedia(a,o,l);y.length&&!y.some(x=>!x.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new at({}),bitrate:0,url:""})),n.trigger(I.MANIFEST_LOADED,{levels:c,audioTracks:y,subtitles:v,captions:E,contentSteering:u,url:o,stats:t,networkDetails:s,sessionData:h,sessionKeys:f,startTimeOffset:p,variableList:m})}handleTrackOrLevelPlaylist(e,t,i,s,n){const a=this.hls,{id:o,level:l,type:u}=i,c=Zl(e,i),h=pe(l)?l:pe(o)?o:0,f=qf(i),p=Hi.parseLevelPlaylist(e.data,c,h,f,0,this.variableList);if(u===Pe.MANIFEST){const m={attrs:new at({}),bitrate:0,details:p,name:"",url:c};p.requestScheduled=t.loading.start+Jg(p,0),a.trigger(I.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:c,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=p,this.handlePlaylistLoaded(p,e,t,i,s,n)}handleManifestParsingError(e,t,i,s,n){this.hls.trigger(I.ERROR,{type:Te.NETWORK_ERROR,details:ee.MANIFEST_PARSING_ERROR,fatal:t.type===Pe.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:s,stats:n})}handleNetworkError(e,t,i=!1,s,n){let a=`A network ${i?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===Pe.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===Pe.AUDIO_TRACK||e.type===Pe.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let l=ee.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case Pe.MANIFEST:l=i?ee.MANIFEST_LOAD_TIMEOUT:ee.MANIFEST_LOAD_ERROR,u=!0;break;case Pe.LEVEL:l=i?ee.LEVEL_LOAD_TIMEOUT:ee.LEVEL_LOAD_ERROR,u=!1;break;case Pe.AUDIO_TRACK:l=i?ee.AUDIO_TRACK_LOAD_TIMEOUT:ee.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case Pe.SUBTITLE_TRACK:l=i?ee.SUBTITLE_TRACK_LOAD_TIMEOUT:ee.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const h={type:Te.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:n};if(s){const f=t?.url||e.url;h.response=He({url:f,data:void 0},s)}this.hls.trigger(I.ERROR,h)}handlePlaylistLoaded(e,t,i,s,n,a){const o=this.hls,{type:l,level:u,levelOrTrack:c,id:h,groupId:f,deliveryDirectives:p}=s,m=Zl(t,s),y=qf(s);let v=typeof s.level=="number"&&y===ye.MAIN?u:void 0;const E=e.playlistParsingError;if(E){if(this.hls.logger.warn(`${E} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(I.ERROR,{type:Te.NETWORK_ERROR,details:ee.LEVEL_PARSING_ERROR,fatal:!1,url:m,error:E,reason:E.message,response:t,context:s,level:v,parent:y,networkDetails:n,stats:i});return}e.playlistParsingError=null}if(!e.fragments.length){const A=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(I.ERROR,{type:Te.NETWORK_ERROR,details:ee.LEVEL_EMPTY_ERROR,fatal:!1,url:m,error:A,reason:A.message,response:t,context:s,level:v,parent:y,networkDetails:n,stats:i});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case Pe.MANIFEST:case Pe.LEVEL:if(v){if(!c)v=0;else if(c!==o.levels[v]){const A=o.levels.indexOf(c);A>-1&&(v=A)}}o.trigger(I.LEVEL_LOADED,{details:e,levelInfo:c||o.levels[0],level:v||0,id:h||0,stats:i,networkDetails:n,deliveryDirectives:p,withoutMultiVariant:l===Pe.MANIFEST});break;case Pe.AUDIO_TRACK:o.trigger(I.AUDIO_TRACK_LOADED,{details:e,track:c,id:h||0,groupId:f||"",stats:i,networkDetails:n,deliveryDirectives:p});break;case Pe.SUBTITLE_TRACK:o.trigger(I.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:h||0,groupId:f||"",stats:i,networkDetails:n,deliveryDirectives:p});break}}};class ls{static get version(){return Vn}static isMSESupported(){return Qm()}static isSupported(){return F1()}static getMediaSource(){return Ls()}static get Events(){return I}static get MetadataSchema(){return ii}static get ErrorTypes(){return Te}static get ErrorDetails(){return ee}static get DefaultConfig(){return ls.defaultConfig?ls.defaultConfig:x1}static set DefaultConfig(e){ls.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Bc,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=Wv(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=C1(ls.DefaultConfig,e,t);this.userConfig=e,i.progressive&&I1(i,t);const{abrController:s,bufferController:n,capLevelController:a,errorController:o,fpsController:l}=i,u=new o(this),c=this.abrController=new s(this),h=new GS(this),f=i.interstitialsController,p=f?this.interstitialsController=new f(this,ls):null,m=this.bufferController=new n(this,h),y=this.capLevelController=new a(this),v=new l(this),E=new V1(this),A=i.contentSteeringController,x=A?new A(this):null,w=this.levelController=new M1(this,x),k=new P1(this),F=new $1(this.config,this.logger),L=this.streamController=new U1(this,h,F),M=this.gapController=new w1(this,h);y.setStreamController(L),v.setStreamController(L);const C=[E,w,L];p&&C.splice(1,0,p),x&&C.splice(1,0,x),this.networkControllers=C;const D=[c,m,M,y,v,k,h];this.audioTrackController=this.createController(i.audioTrackController,C);const B=i.audioStreamController;B&&C.push(this.audioStreamController=new B(this,h,F)),this.subtitleTrackController=this.createController(i.subtitleTrackController,C);const H=i.subtitleStreamController;H&&C.push(this.subtititleStreamController=new H(this,h,F)),this.createController(i.timelineController,D),F.emeController=this.emeController=this.createController(i.emeController,D),this.cmcdController=this.createController(i.cmcdController,D),this.latencyController=this.createController(O1,D),this.coreComponents=D,C.push(u);const q=u.onErrorOut;typeof q=="function"&&this.on(I.ERROR,q,u),this.on(I.MANIFEST_LOADED,E.onManifestLoaded,E)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,s){this._emitter.off(e,t,i,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const s=e===I.ERROR;this.trigger(I.ERROR,{type:Te.OTHER_ERROR,details:ee.INTERNAL_EXCEPTION,fatal:s,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(I.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const n=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(I.ERROR,{type:Te.OTHER_ERROR,details:ee.ATTACH_MEDIA_ERROR,fatal:!0,error:n});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,s=t?e:{media:i};this._media=i,this.trigger(I.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(I.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(I.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,s=this._url=Ic.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(I.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ye.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ye.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ye.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=wx()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){CS(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let s=0;s<i;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,i)for(let n=s;n--;){const a=e[n].attrs["HDCP-LEVEL"];if(a&&a<=i)return n}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=Ng(t);return Mg(e,i,navigator.mediaCapabilities)}}ls.defaultConfig=void 0;var bo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xn(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function G1(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function i(){var s=!1;try{s=this instanceof i}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var s=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return r[i]}})}),t}var eu,jf;function Wo(){if(jf)return eu;jf=1;var r;return typeof window<"u"?r=window:typeof bo<"u"?r=bo:typeof self<"u"?r=self:r={},eu=r,eu}var H1=Wo();const $=Xn(H1),q1={},j1=Object.freeze(Object.defineProperty({__proto__:null,default:q1},Symbol.toStringTag,{value:"Module"})),K1=G1(j1);var tu,Kf;function Jm(){if(Kf)return tu;Kf=1;var r=typeof bo<"u"?bo:typeof window<"u"?window:{},e=K1,t;return typeof document<"u"?t=document:(t=r["__GLOBAL_DOCUMENT_CACHE@4"],t||(t=r["__GLOBAL_DOCUMENT_CACHE@4"]=e)),tu=t,tu}var W1=Jm();const ue=Xn(W1);var Wa={exports:{}},iu={exports:{}},Wf;function z1(){return Wf||(Wf=1,(function(r){function e(){return r.exports=e=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var n in s)({}).hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},r.exports.__esModule=!0,r.exports.default=r.exports,e.apply(null,arguments)}r.exports=e,r.exports.__esModule=!0,r.exports.default=r.exports})(iu)),iu.exports}var su,zf;function Y1(){if(zf)return su;zf=1,su=e;var r=Object.prototype.toString;function e(t){if(!t)return!1;var i=r.call(t);return i==="[object Function]"||typeof t=="function"&&i!=="[object RegExp]"||typeof window<"u"&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)}return su}var ru,Yf;function X1(){if(Yf)return ru;Yf=1;function r(s,n){var a=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(a)return(a=a.call(s)).next.bind(a);if(Array.isArray(s)||(a=e(s))||n){a&&(s=a);var o=0;return function(){return o>=s.length?{done:!0}:{done:!1,value:s[o++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e(s,n){if(s){if(typeof s=="string")return t(s,n);var a=Object.prototype.toString.call(s).slice(8,-1);if(a==="Object"&&s.constructor&&(a=s.constructor.name),a==="Map"||a==="Set")return Array.from(s);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return t(s,n)}}function t(s,n){(n==null||n>s.length)&&(n=s.length);for(var a=0,o=new Array(n);a<n;a++)o[a]=s[a];return o}var i=(function(){function s(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1}var n=s.prototype;return n.getIsEnabled=function(){return this.enabled_},n.enable=function(){this.enabled_=!0},n.disable=function(){this.enabled_=!1},n.reset=function(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1},n.addInterceptor=function(o,l){this.typeToInterceptorsMap_.has(o)||this.typeToInterceptorsMap_.set(o,new Set);var u=this.typeToInterceptorsMap_.get(o);return u.has(l)?!1:(u.add(l),!0)},n.removeInterceptor=function(o,l){var u=this.typeToInterceptorsMap_.get(o);return u&&u.has(l)?(u.delete(l),!0):!1},n.clearInterceptorsByType=function(o){var l=this.typeToInterceptorsMap_.get(o);return l?(this.typeToInterceptorsMap_.delete(o),this.typeToInterceptorsMap_.set(o,new Set),!0):!1},n.clear=function(){return this.typeToInterceptorsMap_.size?(this.typeToInterceptorsMap_=new Map,!0):!1},n.getForType=function(o){return this.typeToInterceptorsMap_.get(o)||new Set},n.execute=function(o,l){for(var u=this.getForType(o),c=r(u),h;!(h=c()).done;){var f=h.value;try{l=f(l)}catch{}}return l},s})();return ru=i,ru}var nu,Xf;function Q1(){if(Xf)return nu;Xf=1;var r=(function(){function t(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1}var i=t.prototype;return i.getIsEnabled=function(){return this.enabled_},i.enable=function(){this.enabled_=!0},i.disable=function(){this.enabled_=!1},i.reset=function(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1},i.getMaxAttempts=function(){return this.maxAttempts_},i.setMaxAttempts=function(n){this.maxAttempts_=n},i.getDelayFactor=function(){return this.delayFactor_},i.setDelayFactor=function(n){this.delayFactor_=n},i.getFuzzFactor=function(){return this.fuzzFactor_},i.setFuzzFactor=function(n){this.fuzzFactor_=n},i.getInitialDelay=function(){return this.initialDelay_},i.setInitialDelay=function(n){this.initialDelay_=n},i.createRetry=function(n){var a=n===void 0?{}:n,o=a.maxAttempts,l=a.delayFactor,u=a.fuzzFactor,c=a.initialDelay;return new e({maxAttempts:o||this.maxAttempts_,delayFactor:l||this.delayFactor_,fuzzFactor:u||this.fuzzFactor_,initialDelay:c||this.initialDelay_})},t})(),e=(function(){function t(s){this.maxAttempts_=s.maxAttempts,this.delayFactor_=s.delayFactor,this.fuzzFactor_=s.fuzzFactor,this.currentDelay_=s.initialDelay,this.currentAttempt_=1}var i=t.prototype;return i.moveToNextAttempt=function(){this.currentAttempt_++;var n=this.currentDelay_*this.delayFactor_;this.currentDelay_=this.currentDelay_+n},i.shouldRetry=function(){return this.currentAttempt_<this.maxAttempts_},i.getCurrentDelay=function(){return this.currentDelay_},i.getCurrentMinPossibleDelay=function(){return(1-this.fuzzFactor_)*this.currentDelay_},i.getCurrentMaxPossibleDelay=function(){return(1+this.fuzzFactor_)*this.currentDelay_},i.getCurrentFuzzedDelay=function(){var n=this.getCurrentMinPossibleDelay(),a=this.getCurrentMaxPossibleDelay();return n+Math.random()*(a-n)},t})();return nu=r,nu}var au,Qf;function J1(){if(Qf)return au;Qf=1;var r=Wo(),e=function(s,n){return n===void 0&&(n=!1),function(a,o,l){if(a){s(a);return}if(o.statusCode>=400&&o.statusCode<=599){var u=l;if(n)if(r.TextDecoder){var c=t(o.headers&&o.headers["content-type"]);try{u=new TextDecoder(c).decode(l)}catch{}}else u=String.fromCharCode.apply(null,new Uint8Array(l));s({cause:u});return}s(null,l)}};function t(i){return i===void 0&&(i=""),i.toLowerCase().split(";").reduce(function(s,n){var a=n.split("="),o=a[0],l=a[1];return o.trim()==="charset"?l.trim():s},"utf-8")}return au=e,au}var Jf;function Z1(){if(Jf)return Wa.exports;Jf=1;var r=Wo(),e=z1(),t=Y1(),i=X1(),s=Q1();u.httpHandler=J1(),u.requestInterceptorsStorage=new i,u.responseInterceptorsStorage=new i,u.retryManager=new s;var n=function(m){var y={};return m&&m.trim().split(`
`).forEach(function(v){var E=v.indexOf(":"),A=v.slice(0,E).trim().toLowerCase(),x=v.slice(E+1).trim();typeof y[A]>"u"?y[A]=x:Array.isArray(y[A])?y[A].push(x):y[A]=[y[A],x]}),y};Wa.exports=u,Wa.exports.default=u,u.XMLHttpRequest=r.XMLHttpRequest||f,u.XDomainRequest="withCredentials"in new u.XMLHttpRequest?u.XMLHttpRequest:r.XDomainRequest,a(["get","put","post","patch","head","delete"],function(p){u[p==="delete"?"del":p]=function(m,y,v){return y=l(m,y,v),y.method=p.toUpperCase(),c(y)}});function a(p,m){for(var y=0;y<p.length;y++)m(p[y])}function o(p){for(var m in p)if(p.hasOwnProperty(m))return!1;return!0}function l(p,m,y){var v=p;return t(m)?(y=m,typeof p=="string"&&(v={uri:p})):v=e({},m,{uri:p}),v.callback=y,v}function u(p,m,y){return m=l(p,m,y),c(m)}function c(p){if(typeof p.callback>"u")throw new Error("callback argument missing");if(p.requestType&&u.requestInterceptorsStorage.getIsEnabled()){var m={uri:p.uri||p.url,headers:p.headers||{},body:p.body,metadata:p.metadata||{},retry:p.retry,timeout:p.timeout},y=u.requestInterceptorsStorage.execute(p.requestType,m);p.uri=y.uri,p.headers=y.headers,p.body=y.body,p.metadata=y.metadata,p.retry=y.retry,p.timeout=y.timeout}var v=!1,E=function(z,X,ie){v||(v=!0,p.callback(z,X,ie))};function A(){F.readyState===4&&!u.responseInterceptorsStorage.getIsEnabled()&&setTimeout(k,0)}function x(){var K=void 0;if(F.response?K=F.response:K=F.responseText||h(F),Y)try{K=JSON.parse(K)}catch{}return K}function w(K){if(clearTimeout(Z),clearTimeout(p.retryTimeout),K instanceof Error||(K=new Error(""+(K||"Unknown XMLHttpRequest Error"))),K.statusCode=0,!M&&u.retryManager.getIsEnabled()&&p.retry&&p.retry.shouldRetry()){p.retryTimeout=setTimeout(function(){p.retry.moveToNextAttempt(),p.xhr=F,c(p)},p.retry.getCurrentFuzzedDelay());return}if(p.requestType&&u.responseInterceptorsStorage.getIsEnabled()){var z={headers:Q.headers||{},body:Q.body,responseUrl:F.responseURL,responseType:F.responseType},X=u.responseInterceptorsStorage.execute(p.requestType,z);Q.body=X.body,Q.headers=X.headers}return E(K,Q)}function k(){if(!M){var K;clearTimeout(Z),clearTimeout(p.retryTimeout),p.useXDR&&F.status===void 0?K=200:K=F.status===1223?204:F.status;var z=Q,X=null;if(K!==0?(z={body:x(),statusCode:K,method:D,headers:{},url:C,rawRequest:F},F.getAllResponseHeaders&&(z.headers=n(F.getAllResponseHeaders()))):X=new Error("Internal XMLHttpRequest Error"),p.requestType&&u.responseInterceptorsStorage.getIsEnabled()){var ie={headers:z.headers||{},body:z.body,responseUrl:F.responseURL,responseType:F.responseType},W=u.responseInterceptorsStorage.execute(p.requestType,ie);z.body=W.body,z.headers=W.headers}return E(X,z,z.body)}}var F=p.xhr||null;F||(p.cors||p.useXDR?F=new u.XDomainRequest:F=new u.XMLHttpRequest);var L,M,C=F.url=p.uri||p.url,D=F.method=p.method||"GET",B=p.body||p.data,H=F.headers=p.headers||{},q=!!p.sync,Y=!1,Z,Q={body:void 0,headers:{},statusCode:0,method:D,url:C,rawRequest:F};if("json"in p&&p.json!==!1&&(Y=!0,H.accept||H.Accept||(H.Accept="application/json"),D!=="GET"&&D!=="HEAD"&&(H["content-type"]||H["Content-Type"]||(H["Content-Type"]="application/json"),B=JSON.stringify(p.json===!0?B:p.json))),F.onreadystatechange=A,F.onload=k,F.onerror=w,F.onprogress=function(){},F.onabort=function(){M=!0,clearTimeout(p.retryTimeout)},F.ontimeout=w,F.open(D,C,!q,p.username,p.password),q||(F.withCredentials=!!p.withCredentials),!q&&p.timeout>0&&(Z=setTimeout(function(){if(!M){M=!0,F.abort("timeout");var K=new Error("XMLHttpRequest timeout");K.code="ETIMEDOUT",w(K)}},p.timeout)),F.setRequestHeader)for(L in H)H.hasOwnProperty(L)&&F.setRequestHeader(L,H[L]);else if(p.headers&&!o(p.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in p&&(F.responseType=p.responseType),"beforeSend"in p&&typeof p.beforeSend=="function"&&p.beforeSend(F),F.send(B||null),F}function h(p){try{if(p.responseType==="document")return p.responseXML;var m=p.responseXML&&p.responseXML.documentElement.nodeName==="parsererror";if(p.responseType===""&&!m)return p.responseXML}catch{}return null}function f(){}return Wa.exports}var eA=Z1();const Zm=Xn(eA);var ou={exports:{}},lu,Zf;function tA(){if(Zf)return lu;Zf=1;var r=Jm(),e=Object.create||(function(){function C(){}return function(D){if(arguments.length!==1)throw new Error("Object.create shim only accepts one parameter.");return C.prototype=D,new C}})();function t(C,D){this.name="ParsingError",this.code=C.code,this.message=D||C.message}t.prototype=e(Error.prototype),t.prototype.constructor=t,t.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function i(C){function D(H,q,Y,Z){return(H|0)*3600+(q|0)*60+(Y|0)+(Z|0)/1e3}var B=C.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return B?B[3]?D(B[1],B[2],B[3].replace(":",""),B[4]):B[1]>59?D(B[1],B[2],0,B[4]):D(0,B[1],B[2],B[4]):null}function s(){this.values=e(null)}s.prototype={set:function(C,D){!this.get(C)&&D!==""&&(this.values[C]=D)},get:function(C,D,B){return B?this.has(C)?this.values[C]:D[B]:this.has(C)?this.values[C]:D},has:function(C){return C in this.values},alt:function(C,D,B){for(var H=0;H<B.length;++H)if(D===B[H]){this.set(C,D);break}},integer:function(C,D){/^-?\d+$/.test(D)&&this.set(C,parseInt(D,10))},percent:function(C,D){return D.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(D=parseFloat(D),D>=0&&D<=100)?(this.set(C,D),!0):!1}};function n(C,D,B,H){var q=H?C.split(H):[C];for(var Y in q)if(typeof q[Y]=="string"){var Z=q[Y].split(B);if(Z.length===2){var Q=Z[0].trim(),K=Z[1].trim();D(Q,K)}}}function a(C,D,B){var H=C;function q(){var Q=i(C);if(Q===null)throw new t(t.Errors.BadTimeStamp,"Malformed timestamp: "+H);return C=C.replace(/^[^\sa-zA-Z-]+/,""),Q}function Y(Q,K){var z=new s;n(Q,function(X,ie){switch(X){case"region":for(var W=B.length-1;W>=0;W--)if(B[W].id===ie){z.set(X,B[W].region);break}break;case"vertical":z.alt(X,ie,["rl","lr"]);break;case"line":var ae=ie.split(","),de=ae[0];z.integer(X,de),z.percent(X,de)&&z.set("snapToLines",!1),z.alt(X,de,["auto"]),ae.length===2&&z.alt("lineAlign",ae[1],["start","center","end"]);break;case"position":ae=ie.split(","),z.percent(X,ae[0]),ae.length===2&&z.alt("positionAlign",ae[1],["start","center","end"]);break;case"size":z.percent(X,ie);break;case"align":z.alt(X,ie,["start","center","end","left","right"]);break}},/:/,/\s/),K.region=z.get("region",null),K.vertical=z.get("vertical","");try{K.line=z.get("line","auto")}catch{}K.lineAlign=z.get("lineAlign","start"),K.snapToLines=z.get("snapToLines",!0),K.size=z.get("size",100);try{K.align=z.get("align","center")}catch{K.align=z.get("align","middle")}try{K.position=z.get("position","auto")}catch{K.position=z.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},K.align)}K.positionAlign=z.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},K.align)}function Z(){C=C.replace(/^\s+/,"")}if(Z(),D.startTime=q(),Z(),C.substr(0,3)!=="-->")throw new t(t.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+H);C=C.substr(3),Z(),D.endTime=q(),Z(),Y(C,D)}var o=r.createElement&&r.createElement("textarea"),l={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},u={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},c={v:"title",lang:"lang"},h={rt:"ruby"};function f(C,D){function B(){if(!D)return null;function de(ce){return D=D.substr(ce.length),ce}var ge=D.match(/^([^<]*)(<[^>]*>?)?/);return de(ge[1]?ge[1]:ge[2])}function H(de){return o.innerHTML=de,de=o.textContent,o.textContent="",de}function q(de,ge){return!h[ge.localName]||h[ge.localName]===de.localName}function Y(de,ge){var ce=l[de];if(!ce)return null;var ve=C.document.createElement(ce),Me=c[de];return Me&&ge&&(ve[Me]=ge.trim()),ve}for(var Z=C.document.createElement("div"),Q=Z,K,z=[];(K=B())!==null;){if(K[0]==="<"){if(K[1]==="/"){z.length&&z[z.length-1]===K.substr(2).replace(">","")&&(z.pop(),Q=Q.parentNode);continue}var X=i(K.substr(1,K.length-2)),ie;if(X){ie=C.document.createProcessingInstruction("timestamp",X),Q.appendChild(ie);continue}var W=K.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!W||(ie=Y(W[1],W[3]),!ie)||!q(Q,ie))continue;if(W[2]){var ae=W[2].split(".");ae.forEach(function(de){var ge=/^bg_/.test(de),ce=ge?de.slice(3):de;if(u.hasOwnProperty(ce)){var ve=ge?"background-color":"color",Me=u[ce];ie.style[ve]=Me}}),ie.className=ae.join(" ")}z.push(W[1]),Q.appendChild(ie),Q=ie;continue}Q.appendChild(C.document.createTextNode(H(K)))}return Z}var p=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function m(C){for(var D=0;D<p.length;D++){var B=p[D];if(C>=B[0]&&C<=B[1])return!0}return!1}function y(C){var D=[],B="",H;if(!C||!C.childNodes)return"ltr";function q(Q,K){for(var z=K.childNodes.length-1;z>=0;z--)Q.push(K.childNodes[z])}function Y(Q){if(!Q||!Q.length)return null;var K=Q.pop(),z=K.textContent||K.innerText;if(z){var X=z.match(/^.*(\n|\r)/);return X?(Q.length=0,X[0]):z}if(K.tagName==="ruby")return Y(Q);if(K.childNodes)return q(Q,K),Y(Q)}for(q(D,C);B=Y(D);)for(var Z=0;Z<B.length;Z++)if(H=B.charCodeAt(Z),m(H))return"rtl";return"ltr"}function v(C){if(typeof C.line=="number"&&(C.snapToLines||C.line>=0&&C.line<=100))return C.line;if(!C.track||!C.track.textTrackList||!C.track.textTrackList.mediaElement)return-1;for(var D=C.track,B=D.textTrackList,H=0,q=0;q<B.length&&B[q]!==D;q++)B[q].mode==="showing"&&H++;return++H*-1}function E(){}E.prototype.applyStyles=function(C,D){D=D||this.div;for(var B in C)C.hasOwnProperty(B)&&(D.style[B]=C[B])},E.prototype.formatStyle=function(C,D){return C===0?0:C+D};function A(C,D,B){E.call(this),this.cue=D,this.cueDiv=f(C,D.text);var H={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:D.vertical===""?"horizontal-tb":D.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(H,this.cueDiv),this.div=C.document.createElement("div"),H={direction:y(this.cueDiv),writingMode:D.vertical===""?"horizontal-tb":D.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:D.align==="middle"?"center":D.align,font:B.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(H),this.div.appendChild(this.cueDiv);var q=0;switch(D.positionAlign){case"start":case"line-left":q=D.position;break;case"center":q=D.position-D.size/2;break;case"end":case"line-right":q=D.position-D.size;break}D.vertical===""?this.applyStyles({left:this.formatStyle(q,"%"),width:this.formatStyle(D.size,"%")}):this.applyStyles({top:this.formatStyle(q,"%"),height:this.formatStyle(D.size,"%")}),this.move=function(Y){this.applyStyles({top:this.formatStyle(Y.top,"px"),bottom:this.formatStyle(Y.bottom,"px"),left:this.formatStyle(Y.left,"px"),right:this.formatStyle(Y.right,"px"),height:this.formatStyle(Y.height,"px"),width:this.formatStyle(Y.width,"px")})}}A.prototype=e(E.prototype),A.prototype.constructor=A;function x(C){var D,B,H,q;if(C.div){B=C.div.offsetHeight,H=C.div.offsetWidth,q=C.div.offsetTop;var Y=(Y=C.div.childNodes)&&(Y=Y[0])&&Y.getClientRects&&Y.getClientRects();C=C.div.getBoundingClientRect(),D=Y?Math.max(Y[0]&&Y[0].height||0,C.height/Y.length):0}this.left=C.left,this.right=C.right,this.top=C.top||q,this.height=C.height||B,this.bottom=C.bottom||q+(C.height||B),this.width=C.width||H,this.lineHeight=D!==void 0?D:C.lineHeight}x.prototype.move=function(C,D){switch(D=D!==void 0?D:this.lineHeight,C){case"+x":this.left+=D,this.right+=D;break;case"-x":this.left-=D,this.right-=D;break;case"+y":this.top+=D,this.bottom+=D;break;case"-y":this.top-=D,this.bottom-=D;break}},x.prototype.overlaps=function(C){return this.left<C.right&&this.right>C.left&&this.top<C.bottom&&this.bottom>C.top},x.prototype.overlapsAny=function(C){for(var D=0;D<C.length;D++)if(this.overlaps(C[D]))return!0;return!1},x.prototype.within=function(C){return this.top>=C.top&&this.bottom<=C.bottom&&this.left>=C.left&&this.right<=C.right},x.prototype.overlapsOppositeAxis=function(C,D){switch(D){case"+x":return this.left<C.left;case"-x":return this.right>C.right;case"+y":return this.top<C.top;case"-y":return this.bottom>C.bottom}},x.prototype.intersectPercentage=function(C){var D=Math.max(0,Math.min(this.right,C.right)-Math.max(this.left,C.left)),B=Math.max(0,Math.min(this.bottom,C.bottom)-Math.max(this.top,C.top)),H=D*B;return H/(this.height*this.width)},x.prototype.toCSSCompatValues=function(C){return{top:this.top-C.top,bottom:C.bottom-this.bottom,left:this.left-C.left,right:C.right-this.right,height:this.height,width:this.width}},x.getSimpleBoxPosition=function(C){var D=C.div?C.div.offsetHeight:C.tagName?C.offsetHeight:0,B=C.div?C.div.offsetWidth:C.tagName?C.offsetWidth:0,H=C.div?C.div.offsetTop:C.tagName?C.offsetTop:0;C=C.div?C.div.getBoundingClientRect():C.tagName?C.getBoundingClientRect():C;var q={left:C.left,right:C.right,top:C.top||H,height:C.height||D,bottom:C.bottom||H+(C.height||D),width:C.width||B};return q};function w(C,D,B,H){function q(ce,ve){for(var Me,ke=new x(ce),Ve=1,rt=0;rt<ve.length;rt++){for(;ce.overlapsOppositeAxis(B,ve[rt])||ce.within(B)&&ce.overlapsAny(H);)ce.move(ve[rt]);if(ce.within(B))return ce;var Ze=ce.intersectPercentage(B);Ve>Ze&&(Me=new x(ce),Ve=Ze),ce=new x(ke)}return Me||ke}var Y=new x(D),Z=D.cue,Q=v(Z),K=[];if(Z.snapToLines){var z;switch(Z.vertical){case"":K=["+y","-y"],z="height";break;case"rl":K=["+x","-x"],z="width";break;case"lr":K=["-x","+x"],z="width";break}var X=Y.lineHeight,ie=X*Math.round(Q),W=B[z]+X,ae=K[0];Math.abs(ie)>W&&(ie=ie<0?-1:1,ie*=Math.ceil(W/X)*X),Q<0&&(ie+=Z.vertical===""?B.height:B.width,K=K.reverse()),Y.move(ae,ie)}else{var de=Y.lineHeight/B.height*100;switch(Z.lineAlign){case"center":Q-=de/2;break;case"end":Q-=de;break}switch(Z.vertical){case"":D.applyStyles({top:D.formatStyle(Q,"%")});break;case"rl":D.applyStyles({left:D.formatStyle(Q,"%")});break;case"lr":D.applyStyles({right:D.formatStyle(Q,"%")});break}K=["+y","-x","+x","-y"],Y=new x(D)}var ge=q(Y,K);D.move(ge.toCSSCompatValues(B))}function k(){}k.StringDecoder=function(){return{decode:function(C){if(!C)return"";if(typeof C!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(C))}}},k.convertCueToDOMTree=function(C,D){return!C||!D?null:f(C,D)};var F=.05,L="sans-serif",M="1.5%";return k.processCues=function(C,D,B){if(!C||!D||!B)return null;for(;B.firstChild;)B.removeChild(B.firstChild);var H=C.document.createElement("div");H.style.position="absolute",H.style.left="0",H.style.right="0",H.style.top="0",H.style.bottom="0",H.style.margin=M,B.appendChild(H);function q(X){for(var ie=0;ie<X.length;ie++)if(X[ie].hasBeenReset||!X[ie].displayState)return!0;return!1}if(!q(D)){for(var Y=0;Y<D.length;Y++)H.appendChild(D[Y].displayState);return}var Z=[],Q=x.getSimpleBoxPosition(H),K=Math.round(Q.height*F*100)/100,z={font:K+"px "+L};(function(){for(var X,ie,W=0;W<D.length;W++)ie=D[W],X=new A(C,ie,z),H.appendChild(X.div),w(C,X,Q,Z),ie.displayState=X.div,Z.push(x.getSimpleBoxPosition(X))})()},k.Parser=function(C,D,B){B||(B=D,D={}),D||(D={}),this.window=C,this.vttjs=D,this.state="INITIAL",this.buffer="",this.decoder=B||new TextDecoder("utf8"),this.regionList=[]},k.Parser.prototype={reportOrThrowError:function(C){if(C instanceof t)this.onparsingerror&&this.onparsingerror(C);else throw C},parse:function(C){var D=this;C&&(D.buffer+=D.decoder.decode(C,{stream:!0}));function B(){for(var X=D.buffer,ie=0;ie<X.length&&X[ie]!=="\r"&&X[ie]!==`
`;)++ie;var W=X.substr(0,ie);return X[ie]==="\r"&&++ie,X[ie]===`
`&&++ie,D.buffer=X.substr(ie),W}function H(X){var ie=new s;if(n(X,function(ae,de){switch(ae){case"id":ie.set(ae,de);break;case"width":ie.percent(ae,de);break;case"lines":ie.integer(ae,de);break;case"regionanchor":case"viewportanchor":var ge=de.split(",");if(ge.length!==2)break;var ce=new s;if(ce.percent("x",ge[0]),ce.percent("y",ge[1]),!ce.has("x")||!ce.has("y"))break;ie.set(ae+"X",ce.get("x")),ie.set(ae+"Y",ce.get("y"));break;case"scroll":ie.alt(ae,de,["up"]);break}},/=/,/\s/),ie.has("id")){var W=new(D.vttjs.VTTRegion||D.window.VTTRegion);W.width=ie.get("width",100),W.lines=ie.get("lines",3),W.regionAnchorX=ie.get("regionanchorX",0),W.regionAnchorY=ie.get("regionanchorY",100),W.viewportAnchorX=ie.get("viewportanchorX",0),W.viewportAnchorY=ie.get("viewportanchorY",100),W.scroll=ie.get("scroll",""),D.onregion&&D.onregion(W),D.regionList.push({id:ie.get("id"),region:W})}}function q(X){var ie=new s;n(X,function(W,ae){switch(W){case"MPEGT":ie.integer(W+"S",ae);break;case"LOCA":ie.set(W+"L",i(ae));break}},/[^\d]:/,/,/),D.ontimestampmap&&D.ontimestampmap({MPEGTS:ie.get("MPEGTS"),LOCAL:ie.get("LOCAL")})}function Y(X){X.match(/X-TIMESTAMP-MAP/)?n(X,function(ie,W){ie==="X-TIMESTAMP-MAP"&&q(W)},/=/):n(X,function(ie,W){ie==="Region"&&H(W)},/:/)}try{var Z;if(D.state==="INITIAL"){if(!/\r\n|\n/.test(D.buffer))return this;Z=B();var Q=Z.match(/^WEBVTT([ \t].*)?$/);if(!Q||!Q[0])throw new t(t.Errors.BadSignature);D.state="HEADER"}for(var K=!1;D.buffer;){if(!/\r\n|\n/.test(D.buffer))return this;switch(K?K=!1:Z=B(),D.state){case"HEADER":/:/.test(Z)?Y(Z):Z||(D.state="ID");continue;case"NOTE":Z||(D.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(Z)){D.state="NOTE";break}if(!Z)continue;D.cue=new(D.vttjs.VTTCue||D.window.VTTCue)(0,0,"");try{D.cue.align="center"}catch{D.cue.align="middle"}if(D.state="CUE",Z.indexOf("-->")===-1){D.cue.id=Z;continue}case"CUE":try{a(Z,D.cue,D.regionList)}catch(X){D.reportOrThrowError(X),D.cue=null,D.state="BADCUE";continue}D.state="CUETEXT";continue;case"CUETEXT":var z=Z.indexOf("-->")!==-1;if(!Z||z&&(K=!0)){D.oncue&&D.oncue(D.cue),D.cue=null,D.state="ID";continue}D.cue.text&&(D.cue.text+=`
`),D.cue.text+=Z.replace(/\u2028/g,`
`).replace(/u2029/g,`
`);continue;case"BADCUE":Z||(D.state="ID");continue}}}catch(X){D.reportOrThrowError(X),D.state==="CUETEXT"&&D.cue&&D.oncue&&D.oncue(D.cue),D.cue=null,D.state=D.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var C=this;try{if(C.buffer+=C.decoder.decode(),(C.cue||C.state==="HEADER")&&(C.buffer+=`

`,C.parse()),C.state==="INITIAL")throw new t(t.Errors.BadSignature)}catch(D){C.reportOrThrowError(D)}return C.onflush&&C.onflush(),this}},lu=k,lu}var uu,ep;function iA(){if(ep)return uu;ep=1;var r="auto",e={"":1,lr:1,rl:1},t={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function i(a){if(typeof a!="string")return!1;var o=e[a.toLowerCase()];return o?a.toLowerCase():!1}function s(a){if(typeof a!="string")return!1;var o=t[a.toLowerCase()];return o?a.toLowerCase():!1}function n(a,o,l){this.hasBeenReset=!1;var u="",c=!1,h=a,f=o,p=l,m=null,y="",v=!0,E="auto",A="start",x="auto",w="auto",k=100,F="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return u},set:function(L){u=""+L}},pauseOnExit:{enumerable:!0,get:function(){return c},set:function(L){c=!!L}},startTime:{enumerable:!0,get:function(){return h},set:function(L){if(typeof L!="number")throw new TypeError("Start time must be set to a number.");h=L,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return f},set:function(L){if(typeof L!="number")throw new TypeError("End time must be set to a number.");f=L,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return p},set:function(L){p=""+L,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return m},set:function(L){m=L,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return y},set:function(L){var M=i(L);if(M===!1)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");y=M,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return v},set:function(L){v=!!L,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return E},set:function(L){if(typeof L!="number"&&L!==r)throw new SyntaxError("Line: an invalid number or illegal string was specified.");E=L,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return A},set:function(L){var M=s(L);M?(A=M,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return x},set:function(L){if(L<0||L>100)throw new Error("Position must be between 0 and 100.");x=L,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return w},set:function(L){var M=s(L);M?(w=M,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return k},set:function(L){if(L<0||L>100)throw new Error("Size must be between 0 and 100.");k=L,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return F},set:function(L){var M=s(L);if(!M)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");F=M,this.hasBeenReset=!0}}}),this.displayState=void 0}return n.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},uu=n,uu}var cu,tp;function sA(){if(tp)return cu;tp=1;var r={"":!0,up:!0};function e(s){if(typeof s!="string")return!1;var n=r[s.toLowerCase()];return n?s.toLowerCase():!1}function t(s){return typeof s=="number"&&s>=0&&s<=100}function i(){var s=100,n=3,a=0,o=100,l=0,u=100,c="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return s},set:function(h){if(!t(h))throw new Error("Width must be between 0 and 100.");s=h}},lines:{enumerable:!0,get:function(){return n},set:function(h){if(typeof h!="number")throw new TypeError("Lines must be set to a number.");n=h}},regionAnchorY:{enumerable:!0,get:function(){return o},set:function(h){if(!t(h))throw new Error("RegionAnchorX must be between 0 and 100.");o=h}},regionAnchorX:{enumerable:!0,get:function(){return a},set:function(h){if(!t(h))throw new Error("RegionAnchorY must be between 0 and 100.");a=h}},viewportAnchorY:{enumerable:!0,get:function(){return u},set:function(h){if(!t(h))throw new Error("ViewportAnchorY must be between 0 and 100.");u=h}},viewportAnchorX:{enumerable:!0,get:function(){return l},set:function(h){if(!t(h))throw new Error("ViewportAnchorX must be between 0 and 100.");l=h}},scroll:{enumerable:!0,get:function(){return c},set:function(h){var f=e(h);f===!1?console.warn("Scroll: an invalid or illegal string was specified."):c=f}}})}return cu=i,cu}var ip;function rA(){if(ip)return ou.exports;ip=1;var r=Wo(),e=ou.exports={WebVTT:tA(),VTTCue:iA(),VTTRegion:sA()};r.vttjs=e,r.WebVTT=e.WebVTT;var t=e.VTTCue,i=e.VTTRegion,s=r.VTTCue,n=r.VTTRegion;return e.shim=function(){r.VTTCue=t,r.VTTRegion=i},e.restore=function(){r.VTTCue=s,r.VTTRegion=n},r.VTTCue||e.shim(),ou.exports}var nA=rA();const sp=Xn(nA);function mt(){return mt=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},mt.apply(null,arguments)}var rp="https://example.com",zo=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=$.location&&$.location.href||"");var i=/^\/\//.test(e),s=!$.location&&!/\/\//i.test(e);e=new $.URL(e,$.location||rp);var n=new URL(t,e);return s?n.href.slice(rp.length):i?n.href.slice(n.protocol.length):n.href},Qc=(function(){function r(){this.listeners={}}var e=r.prototype;return e.on=function(i,s){this.listeners[i]||(this.listeners[i]=[]),this.listeners[i].push(s)},e.off=function(i,s){if(!this.listeners[i])return!1;var n=this.listeners[i].indexOf(s);return this.listeners[i]=this.listeners[i].slice(0),this.listeners[i].splice(n,1),n>-1},e.trigger=function(i){var s=this.listeners[i];if(s)if(arguments.length===2)for(var n=s.length,a=0;a<n;++a)s[a].call(this,arguments[1]);else for(var o=Array.prototype.slice.call(arguments,1),l=s.length,u=0;u<l;++u)s[u].apply(this,o)},e.dispose=function(){this.listeners={}},e.pipe=function(i){this.on("data",function(s){i.push(s)})},r})(),aA=function(e){return $.atob?$.atob(e):Buffer.from(e,"base64").toString("binary")};function e0(r){for(var e=aA(r),t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}class oA extends Qc{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf(`
`);t>-1;t=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const lA="	",hu=function(r){const e=/([0-9.]*)?@?([0-9.]*)?/.exec(r||""),t={};return e[1]&&(t.length=parseInt(e[1],10)),e[2]&&(t.offset=parseInt(e[2],10)),t},uA=function(){const t="(?:"+"[^=]*"+")=(?:"+'"[^"]*"|[^,]*'+")";return new RegExp("(?:^|,)("+t+")")},Ft=function(r){const e={};if(!r)return e;const t=r.split(uA());let i=t.length,s;for(;i--;)t[i]!==""&&(s=/([^=]*)=(.*)/.exec(t[i]).slice(1),s[0]=s[0].replace(/^\s+|\s+$/g,""),s[1]=s[1].replace(/^\s+|\s+$/g,""),s[1]=s[1].replace(/^['"](.*)['"]$/g,"$1"),e[s[0]]=s[1]);return e},np=r=>{const e=r.split("x"),t={};return e[0]&&(t.width=parseInt(e[0],10)),e[1]&&(t.height=parseInt(e[1],10)),t};class cA extends Qc{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,i;if(e=e.trim(),e.length===0)return;if(e[0]!=="#"){this.trigger("data",{type:"uri",uri:e});return}this.tagMappers.reduce((n,a)=>{const o=a(e);return o===e?n:n.concat([o])},[e]).forEach(n=>{for(let a=0;a<this.customParsers.length;a++)if(this.customParsers[a].call(this,n))return;if(n.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:n.slice(1)});return}if(n=n.replace("\r",""),t=/^#EXTM3U/.exec(n),t){this.trigger("data",{type:"tag",tagType:"m3u"});return}if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(n),t){i={type:"tag",tagType:"inf"},t[1]&&(i.duration=parseFloat(t[1])),t[2]&&(i.title=t[2]),this.trigger("data",i);return}if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(n),t){i={type:"tag",tagType:"targetduration"},t[1]&&(i.duration=parseInt(t[1],10)),this.trigger("data",i);return}if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(n),t){i={type:"tag",tagType:"version"},t[1]&&(i.version=parseInt(t[1],10)),this.trigger("data",i);return}if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(n),t){i={type:"tag",tagType:"media-sequence"},t[1]&&(i.number=parseInt(t[1],10)),this.trigger("data",i);return}if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(n),t){i={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(i.number=parseInt(t[1],10)),this.trigger("data",i);return}if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(n),t){i={type:"tag",tagType:"playlist-type"},t[1]&&(i.playlistType=t[1]),this.trigger("data",i);return}if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(n),t){i=mt(hu(t[1]),{type:"tag",tagType:"byterange"}),this.trigger("data",i);return}if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(n),t){i={type:"tag",tagType:"allow-cache"},t[1]&&(i.allowed=!/NO/.test(t[1])),this.trigger("data",i);return}if(t=/^#EXT-X-MAP:(.*)$/.exec(n),t){if(i={type:"tag",tagType:"map"},t[1]){const a=Ft(t[1]);a.URI&&(i.uri=a.URI),a.BYTERANGE&&(i.byterange=hu(a.BYTERANGE))}this.trigger("data",i);return}if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(n),t){i={type:"tag",tagType:"stream-inf"},t[1]&&(i.attributes=Ft(t[1]),i.attributes.RESOLUTION&&(i.attributes.RESOLUTION=np(i.attributes.RESOLUTION)),i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["FRAME-RATE"]&&(i.attributes["FRAME-RATE"]=parseFloat(i.attributes["FRAME-RATE"])),i.attributes["PROGRAM-ID"]&&(i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10))),this.trigger("data",i);return}if(t=/^#EXT-X-MEDIA:(.*)$/.exec(n),t){i={type:"tag",tagType:"media"},t[1]&&(i.attributes=Ft(t[1])),this.trigger("data",i);return}if(t=/^#EXT-X-ENDLIST/.exec(n),t){this.trigger("data",{type:"tag",tagType:"endlist"});return}if(t=/^#EXT-X-DISCONTINUITY/.exec(n),t){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(n),t){i={type:"tag",tagType:"program-date-time"},t[1]&&(i.dateTimeString=t[1],i.dateTimeObject=new Date(t[1])),this.trigger("data",i);return}if(t=/^#EXT-X-KEY:(.*)$/.exec(n),t){i={type:"tag",tagType:"key"},t[1]&&(i.attributes=Ft(t[1]),i.attributes.IV&&(i.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=i.attributes.IV.match(/.{8}/g),i.attributes.IV[0]=parseInt(i.attributes.IV[0],16),i.attributes.IV[1]=parseInt(i.attributes.IV[1],16),i.attributes.IV[2]=parseInt(i.attributes.IV[2],16),i.attributes.IV[3]=parseInt(i.attributes.IV[3],16),i.attributes.IV=new Uint32Array(i.attributes.IV))),this.trigger("data",i);return}if(t=/^#EXT-X-START:(.*)$/.exec(n),t){i={type:"tag",tagType:"start"},t[1]&&(i.attributes=Ft(t[1]),i.attributes["TIME-OFFSET"]=parseFloat(i.attributes["TIME-OFFSET"]),i.attributes.PRECISE=/YES/.test(i.attributes.PRECISE)),this.trigger("data",i);return}if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(n),t){i={type:"tag",tagType:"cue-out-cont"},t[1]?i.data=t[1]:i.data="",this.trigger("data",i);return}if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(n),t){i={type:"tag",tagType:"cue-out"},t[1]?i.data=t[1]:i.data="",this.trigger("data",i);return}if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(n),t){i={type:"tag",tagType:"cue-in"},t[1]?i.data=t[1]:i.data="",this.trigger("data",i);return}if(t=/^#EXT-X-SKIP:(.*)$/.exec(n),t&&t[1]){i={type:"tag",tagType:"skip"},i.attributes=Ft(t[1]),i.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(i.attributes["SKIPPED-SEGMENTS"]=parseInt(i.attributes["SKIPPED-SEGMENTS"],10)),i.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(i.attributes["RECENTLY-REMOVED-DATERANGES"]=i.attributes["RECENTLY-REMOVED-DATERANGES"].split(lA)),this.trigger("data",i);return}if(t=/^#EXT-X-PART:(.*)$/.exec(n),t&&t[1]){i={type:"tag",tagType:"part"},i.attributes=Ft(t[1]),["DURATION"].forEach(function(a){i.attributes.hasOwnProperty(a)&&(i.attributes[a]=parseFloat(i.attributes[a]))}),["INDEPENDENT","GAP"].forEach(function(a){i.attributes.hasOwnProperty(a)&&(i.attributes[a]=/YES/.test(i.attributes[a]))}),i.attributes.hasOwnProperty("BYTERANGE")&&(i.attributes.byterange=hu(i.attributes.BYTERANGE)),this.trigger("data",i);return}if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(n),t&&t[1]){i={type:"tag",tagType:"server-control"},i.attributes=Ft(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(a){i.attributes.hasOwnProperty(a)&&(i.attributes[a]=parseFloat(i.attributes[a]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(a){i.attributes.hasOwnProperty(a)&&(i.attributes[a]=/YES/.test(i.attributes[a]))}),this.trigger("data",i);return}if(t=/^#EXT-X-PART-INF:(.*)$/.exec(n),t&&t[1]){i={type:"tag",tagType:"part-inf"},i.attributes=Ft(t[1]),["PART-TARGET"].forEach(function(a){i.attributes.hasOwnProperty(a)&&(i.attributes[a]=parseFloat(i.attributes[a]))}),this.trigger("data",i);return}if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(n),t&&t[1]){i={type:"tag",tagType:"preload-hint"},i.attributes=Ft(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(a){if(i.attributes.hasOwnProperty(a)){i.attributes[a]=parseInt(i.attributes[a],10);const o=a==="BYTERANGE-LENGTH"?"length":"offset";i.attributes.byterange=i.attributes.byterange||{},i.attributes.byterange[o]=i.attributes[a],delete i.attributes[a]}}),this.trigger("data",i);return}if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(n),t&&t[1]){i={type:"tag",tagType:"rendition-report"},i.attributes=Ft(t[1]),["LAST-MSN","LAST-PART"].forEach(function(a){i.attributes.hasOwnProperty(a)&&(i.attributes[a]=parseInt(i.attributes[a],10))}),this.trigger("data",i);return}if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(n),t&&t[1]){i={type:"tag",tagType:"daterange"},i.attributes=Ft(t[1]),["ID","CLASS"].forEach(function(o){i.attributes.hasOwnProperty(o)&&(i.attributes[o]=String(i.attributes[o]))}),["START-DATE","END-DATE"].forEach(function(o){i.attributes.hasOwnProperty(o)&&(i.attributes[o]=new Date(i.attributes[o]))}),["DURATION","PLANNED-DURATION"].forEach(function(o){i.attributes.hasOwnProperty(o)&&(i.attributes[o]=parseFloat(i.attributes[o]))}),["END-ON-NEXT"].forEach(function(o){i.attributes.hasOwnProperty(o)&&(i.attributes[o]=/YES/i.test(i.attributes[o]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(o){i.attributes.hasOwnProperty(o)&&(i.attributes[o]=i.attributes[o].toString(16))});const a=/^X-([A-Z]+-)+[A-Z]+$/;for(const o in i.attributes){if(!a.test(o))continue;const l=/[0-9A-Fa-f]{6}/g.test(i.attributes[o]),u=/^\d+(\.\d+)?$/.test(i.attributes[o]);i.attributes[o]=l?i.attributes[o].toString(16):u?parseFloat(i.attributes[o]):String(i.attributes[o])}this.trigger("data",i);return}if(t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(n),t){this.trigger("data",{type:"tag",tagType:"independent-segments"});return}if(t=/^#EXT-X-I-FRAMES-ONLY/.exec(n),t){this.trigger("data",{type:"tag",tagType:"i-frames-only"});return}if(t=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(n),t){i={type:"tag",tagType:"content-steering"},i.attributes=Ft(t[1]),this.trigger("data",i);return}if(t=/^#EXT-X-I-FRAME-STREAM-INF:(.*)$/.exec(n),t){i={type:"tag",tagType:"i-frame-playlist"},i.attributes=Ft(t[1]),i.attributes.URI&&(i.uri=i.attributes.URI),i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes.RESOLUTION&&(i.attributes.RESOLUTION=np(i.attributes.RESOLUTION)),i.attributes["AVERAGE-BANDWIDTH"]&&(i.attributes["AVERAGE-BANDWIDTH"]=parseInt(i.attributes["AVERAGE-BANDWIDTH"],10)),i.attributes["FRAME-RATE"]&&(i.attributes["FRAME-RATE"]=parseFloat(i.attributes["FRAME-RATE"])),this.trigger("data",i);return}if(t=/^#EXT-X-DEFINE:(.*)$/.exec(n),t){i={type:"tag",tagType:"define"},i.attributes=Ft(t[1]),this.trigger("data",i);return}this.trigger("data",{type:"tag",data:n.slice(4)})})}addParser({expression:e,customType:t,dataParser:i,segment:s}){typeof i!="function"&&(i=n=>n),this.customParsers.push(n=>{if(e.exec(n))return this.trigger("data",{type:"custom",data:i(n),customType:t,segment:s}),!0})}addTagMapper({expression:e,map:t}){const i=s=>e.test(s)?t(s):s;this.tagMappers.push(i)}}const hA=r=>r.toLowerCase().replace(/-(\w)/g,e=>e[1].toUpperCase()),Ss=function(r){const e={};return Object.keys(r).forEach(function(t){e[hA(t)]=r[t]}),e},du=function(r){const{serverControl:e,targetDuration:t,partTargetDuration:i}=r;if(!e)return;const s="#EXT-X-SERVER-CONTROL",n="holdBack",a="partHoldBack",o=t&&t*3,l=i&&i*2;t&&!e.hasOwnProperty(n)&&(e[n]=o,this.trigger("info",{message:`${s} defaulting HOLD-BACK to targetDuration * 3 (${o}).`})),o&&e[n]<o&&(this.trigger("warn",{message:`${s} clamping HOLD-BACK (${e[n]}) to targetDuration * 3 (${o})`}),e[n]=o),i&&!e.hasOwnProperty(a)&&(e[a]=i*3,this.trigger("info",{message:`${s} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${e[a]}).`})),i&&e[a]<l&&(this.trigger("warn",{message:`${s} clamping PART-HOLD-BACK (${e[a]}) to partTargetDuration * 2 (${l}).`}),e[a]=l)};class dA extends Qc{constructor(e={}){super(),this.lineStream=new oA,this.parseStream=new cA,this.lineStream.pipe(this.parseStream),this.mainDefinitions=e.mainDefinitions||{},this.params=new URL(e.uri,"https://a.com").searchParams,this.lastProgramDateTime=null;const t=this,i=[];let s={},n,a,o=!1;const l=function(){},u={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},c="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";let h=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],iFramePlaylists:[],segments:[]};let f=0,p=0;const m={};this.on("end",()=>{s.uri||!s.parts&&!s.preloadHints||(!s.map&&n&&(s.map=n),!s.key&&a&&(s.key=a),!s.timeline&&typeof h=="number"&&(s.timeline=h),this.manifest.preloadSegment=s)}),this.parseStream.on("data",function(y){let v,E;if(t.manifest.definitions){for(const A in t.manifest.definitions)if(y.uri&&(y.uri=y.uri.replace(`{$${A}}`,t.manifest.definitions[A])),y.attributes)for(const x in y.attributes)typeof y.attributes[x]=="string"&&(y.attributes[x]=y.attributes[x].replace(`{$${A}}`,t.manifest.definitions[A]))}({tag(){({version(){y.version&&(this.manifest.version=y.version)},"allow-cache"(){this.manifest.allowCache=y.allowed,"allowed"in y||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const A={};"length"in y&&(s.byterange=A,A.length=y.length,"offset"in y||(y.offset=f)),"offset"in y&&(s.byterange=A,A.offset=y.offset),f=A.offset+A.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),y.title&&(s.title=y.title),y.duration>0&&(s.duration=y.duration),y.duration===0&&(s.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=i},key(){if(!y.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(y.attributes.METHOD==="NONE"){a=null;return}if(!y.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(y.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:y.attributes};return}if(y.attributes.KEYFORMAT==="com.microsoft.playready"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.microsoft.playready"]={uri:y.attributes.URI};return}if(y.attributes.KEYFORMAT===c){if(["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(y.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(y.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),y.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(y.attributes.KEYID&&y.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:y.attributes.KEYFORMAT,keyId:y.attributes.KEYID.substring(2)},pssh:e0(y.attributes.URI.split(",")[1])};return}y.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),a={method:y.attributes.METHOD||"AES-128",uri:y.attributes.URI},typeof y.attributes.IV<"u"&&(a.iv=y.attributes.IV)},"media-sequence"(){if(!isFinite(y.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+y.number});return}this.manifest.mediaSequence=y.number},"discontinuity-sequence"(){if(!isFinite(y.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+y.number});return}this.manifest.discontinuitySequence=y.number,h=y.number},"playlist-type"(){if(!/VOD|EVENT/.test(y.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+y.playlist});return}this.manifest.playlistType=y.playlistType},map(){n={},y.uri&&(n.uri=y.uri),y.byterange&&(n.byterange=y.byterange),a&&(n.key=a)},"stream-inf"(){if(this.manifest.playlists=i,this.manifest.mediaGroups=this.manifest.mediaGroups||u,!y.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}s.attributes||(s.attributes={}),mt(s.attributes,y.attributes)},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||u,!(y.attributes&&y.attributes.TYPE&&y.attributes["GROUP-ID"]&&y.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}const A=this.manifest.mediaGroups[y.attributes.TYPE];A[y.attributes["GROUP-ID"]]=A[y.attributes["GROUP-ID"]]||{},v=A[y.attributes["GROUP-ID"]],E={default:/yes/i.test(y.attributes.DEFAULT)},E.default?E.autoselect=!0:E.autoselect=/yes/i.test(y.attributes.AUTOSELECT),y.attributes.LANGUAGE&&(E.language=y.attributes.LANGUAGE),y.attributes.URI&&(E.uri=y.attributes.URI),y.attributes["INSTREAM-ID"]&&(E.instreamId=y.attributes["INSTREAM-ID"]),y.attributes.CHARACTERISTICS&&(E.characteristics=y.attributes.CHARACTERISTICS),y.attributes.FORCED&&(E.forced=/yes/i.test(y.attributes.FORCED)),v[y.attributes.NAME]=E},discontinuity(){h+=1,s.discontinuity=!0,this.manifest.discontinuityStarts.push(i.length)},"program-date-time"(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=y.dateTimeString,this.manifest.dateTimeObject=y.dateTimeObject),s.dateTimeString=y.dateTimeString,s.dateTimeObject=y.dateTimeObject;const{lastProgramDateTime:A}=this;this.lastProgramDateTime=new Date(y.dateTimeString).getTime(),A===null&&this.manifest.segments.reduceRight((x,w)=>(w.programDateTime=x-w.duration*1e3,w.programDateTime),this.lastProgramDateTime)},targetduration(){if(!isFinite(y.duration)||y.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+y.duration});return}this.manifest.targetDuration=y.duration,du.call(this,this.manifest)},start(){if(!y.attributes||isNaN(y.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:y.attributes["TIME-OFFSET"],precise:y.attributes.PRECISE}},"cue-out"(){s.cueOut=y.data},"cue-out-cont"(){s.cueOutCont=y.data},"cue-in"(){s.cueIn=y.data},skip(){this.manifest.skip=Ss(y.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",y.attributes,["SKIPPED-SEGMENTS"])},part(){o=!0;const A=this.manifest.segments.length,x=Ss(y.attributes);s.parts=s.parts||[],s.parts.push(x),x.byterange&&(x.byterange.hasOwnProperty("offset")||(x.byterange.offset=p),p=x.byterange.offset+x.byterange.length);const w=s.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${w} for segment #${A}`,y.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((k,F)=>{k.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${F} lacks required attribute(s): LAST-PART`})})},"server-control"(){const A=this.manifest.serverControl=Ss(y.attributes);A.hasOwnProperty("canBlockReload")||(A.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),du.call(this,this.manifest),A.canSkipDateranges&&!A.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const A=this.manifest.segments.length,x=Ss(y.attributes),w=x.type&&x.type==="PART";s.preloadHints=s.preloadHints||[],s.preloadHints.push(x),x.byterange&&(x.byterange.hasOwnProperty("offset")||(x.byterange.offset=w?p:0,w&&(p=x.byterange.offset+x.byterange.length)));const k=s.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${k} for segment #${A}`,y.attributes,["TYPE","URI"]),!!x.type)for(let F=0;F<s.preloadHints.length-1;F++){const L=s.preloadHints[F];L.type&&L.type===x.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${k} for segment #${A} has the same TYPE ${x.type} as preload hint #${F}`})}},"rendition-report"(){const A=Ss(y.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(A);const x=this.manifest.renditionReports.length-1,w=["LAST-MSN","URI"];o&&w.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${x}`,y.attributes,w)},"part-inf"(){this.manifest.partInf=Ss(y.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",y.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),du.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(Ss(y.attributes));const A=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${A}`,y.attributes,["ID","START-DATE"]);const x=this.manifest.dateRanges[A];x.endDate&&x.startDate&&new Date(x.endDate)<new Date(x.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),x.duration&&x.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),x.plannedDuration&&x.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const w=!!x.endOnNext;if(w&&!x.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),w&&(x.duration||x.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),x.duration&&x.endDate){const F=x.startDate.getTime()+x.duration*1e3;this.manifest.dateRanges[A].endDate=new Date(F)}if(!m[x.id])m[x.id]=x;else{for(const F in m[x.id])if(x[F]&&JSON.stringify(m[x.id][F])!==JSON.stringify(x[F])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}const k=this.manifest.dateRanges.findIndex(F=>F.id===x.id);this.manifest.dateRanges[k]=mt(this.manifest.dateRanges[k],x),m[x.id]=mt(m[x.id],x),this.manifest.dateRanges.pop()}},"independent-segments"(){this.manifest.independentSegments=!0},"i-frames-only"(){this.manifest.iFramesOnly=!0,this.requiredCompatibilityversion(this.manifest.version,4)},"content-steering"(){this.manifest.contentSteering=Ss(y.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",y.attributes,["SERVER-URI"])},define(){this.manifest.definitions=this.manifest.definitions||{};const A=(x,w)=>{if(x in this.manifest.definitions){this.trigger("error",{message:`EXT-X-DEFINE: Duplicate name ${x}`});return}this.manifest.definitions[x]=w};if("QUERYPARAM"in y.attributes){if("NAME"in y.attributes||"IMPORT"in y.attributes){this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});return}const x=this.params.get(y.attributes.QUERYPARAM);if(!x){this.trigger("error",{message:`EXT-X-DEFINE: No query param ${y.attributes.QUERYPARAM}`});return}A(y.attributes.QUERYPARAM,decodeURIComponent(x));return}if("NAME"in y.attributes){if("IMPORT"in y.attributes){this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});return}if(!("VALUE"in y.attributes)||typeof y.attributes.VALUE!="string"){this.trigger("error",{message:`EXT-X-DEFINE: No value for ${y.attributes.NAME}`});return}A(y.attributes.NAME,y.attributes.VALUE);return}if("IMPORT"in y.attributes){if(!this.mainDefinitions[y.attributes.IMPORT]){this.trigger("error",{message:`EXT-X-DEFINE: No value ${y.attributes.IMPORT} to import, or IMPORT used on main playlist`});return}A(y.attributes.IMPORT,this.mainDefinitions[y.attributes.IMPORT]);return}this.trigger("error",{message:"EXT-X-DEFINE: No attribute"})},"i-frame-playlist"(){this.manifest.iFramePlaylists.push({attributes:y.attributes,uri:y.uri,timeline:h}),this.warnOnMissingAttributes_("#EXT-X-I-FRAME-STREAM-INF",y.attributes,["BANDWIDTH","URI"])}}[y.tagType]||l).call(t)},uri(){s.uri=y.uri,i.push(s),this.manifest.targetDuration&&!("duration"in s)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),s.duration=this.manifest.targetDuration),a&&(s.key=a),s.timeline=h,n&&(s.map=n),p=0,this.lastProgramDateTime!==null&&(s.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=s.duration*1e3),s={}},comment(){},custom(){y.segment?(s.custom=s.custom||{},s.custom[y.customType]=y.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[y.customType]=y.data)}})[y.type].call(t)})}requiredCompatibilityversion(e,t){(e<t||!e)&&this.trigger("warn",{message:`manifest must be at least version ${t}`})}warnOnMissingAttributes_(e,t,i){const s=[];i.forEach(function(n){t.hasOwnProperty(n)||s.push(n)}),s.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${s.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push(`
`),this.manifest.dateRanges.length&&this.lastProgramDateTime===null&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}var Xs={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},fA=["video","audio","text"],ap=["Video","Audio","Text"],t0=function(e){return e&&e.replace(/avc1\.(\d+)\.(\d+)/i,function(t,i,s){var n=("00"+Number(i).toString(16)).slice(-2),a=("00"+Number(s).toString(16)).slice(-2);return"avc1."+n+"00"+a})},Ui=function(e){e===void 0&&(e="");var t=e.split(","),i=[];return t.forEach(function(s){s=s.trim();var n;fA.forEach(function(a){var o=Xs[a].exec(s.toLowerCase());if(!(!o||o.length<=1)){n=a;var l=s.substring(0,o[1].length),u=s.replace(l,"");i.push({type:l,details:u,mediaType:a})}}),n||i.push({type:s,details:"",mediaType:"unknown"})}),i},pA=function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var i=e.mediaGroups.AUDIO[t];if(!i)return null;for(var s in i){var n=i[s];if(n.default&&n.playlists)return Ui(n.playlists[0].attributes.CODECS)}return null},i0=function(e){return e===void 0&&(e=""),Xs.audio.test(e.trim().toLowerCase())},gA=function(e){return e===void 0&&(e=""),Xs.text.test(e.trim().toLowerCase())},Nr=function(e){if(!(!e||typeof e!="string")){var t=e.toLowerCase().split(",").map(function(n){return t0(n.trim())}),i="video";t.length===1&&i0(t[0])?i="audio":t.length===1&&gA(t[0])&&(i="application");var s="mp4";return t.every(function(n){return Xs.mp4.test(n)})?s="mp4":t.every(function(n){return Xs.webm.test(n)})?s="webm":t.every(function(n){return Xs.ogg.test(n)})&&(s="ogg"),i+"/"+s+';codecs="'+e+'"'}},kn=function(e,t){return e===void 0&&(e=""),t===void 0&&(t=!1),$.MediaSource&&$.MediaSource.isTypeSupported&&$.MediaSource.isTypeSupported(Nr(e))||t&&$.ManagedMediaSource&&$.ManagedMediaSource.isTypeSupported&&$.ManagedMediaSource.isTypeSupported(Nr(e))||!1},fu=function(e){return e===void 0&&(e=""),e.toLowerCase().split(",").every(function(t){t=t.trim();for(var i=0;i<ap.length;i++){var s=ap[i];if(Xs["muxer"+s].test(t))return!0}return!1})},op="mp4a.40.2",mA="avc1.4d400d",yA=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,TA=/^application\/dash\+xml/i,s0=function(e){return yA.test(e)?"hls":TA.test(e)?"dash":e==="application/vnd.videojs.vhs+json"?"vhs-json":null},_A=function(e){return e.toString(2).length},vA=function(e){return Math.ceil(_A(e)/8)},r0=function(e){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},SA=function(e){return r0(e)},Se=function(e){return e instanceof Uint8Array?e:(!Array.isArray(e)&&!SA(e)&&!(e instanceof ArrayBuffer)&&(typeof e!="number"||typeof e=="number"&&e!==e?e=0:e=[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},Dt=$.BigInt||Number,ec=[Dt("0x1"),Dt("0x100"),Dt("0x10000"),Dt("0x1000000"),Dt("0x100000000"),Dt("0x10000000000"),Dt("0x1000000000000"),Dt("0x100000000000000"),Dt("0x10000000000000000")];(function(){var r=new Uint16Array([65484]),e=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);return e[0]===255?"big":e[0]===204?"little":"unknown"})();var EA=function(e,t){var i=t===void 0?{}:t,s=i.signed,n=s===void 0?!1:s,a=i.le,o=a===void 0?!1:a;e=Se(e);var l=o?"reduce":"reduceRight",u=e[l]?e[l]:Array.prototype[l],c=u.call(e,function(f,p,m){var y=o?m:Math.abs(m+1-e.length);return f+Dt(p)*ec[y]},Dt(0));if(n){var h=ec[e.length]/Dt(2)-Dt(1);c=Dt(c),c>h&&(c-=h,c-=h,c-=Dt(2))}return Number(c)},bA=function(e,t){var i={},s=i.le,n=s===void 0?!1:s;(typeof e!="bigint"&&typeof e!="number"||typeof e=="number"&&e!==e)&&(e=0),e=Dt(e);for(var a=vA(e),o=new Uint8Array(new ArrayBuffer(a)),l=0;l<a;l++){var u=n?l:Math.abs(l+1-o.length);o[u]=Number(e/ec[l]&Dt(255)),e<0&&(o[u]=Math.abs(~o[u]),o[u]-=l===0?1:2)}return o},n0=function(e,t){if(typeof e!="string"&&e&&typeof e.toString=="function"&&(e=e.toString()),typeof e!="string")return new Uint8Array;t||(e=unescape(encodeURIComponent(e)));for(var i=new Uint8Array(e.length),s=0;s<e.length;s++)i[s]=e.charCodeAt(s);return i},xA=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(t=t.filter(function(o){return o&&(o.byteLength||o.length)&&typeof o!="string"}),t.length<=1)return Se(t[0]);var s=t.reduce(function(o,l,u){return o+(l.byteLength||l.length)},0),n=new Uint8Array(s),a=0;return t.forEach(function(o){o=Se(o),n.set(o,a),a+=o.byteLength}),n},it=function(e,t,i){var s=i===void 0?{}:i,n=s.offset,a=n===void 0?0:n,o=s.mask,l=o===void 0?[]:o;e=Se(e),t=Se(t);var u=t.every?t.every:Array.prototype.every;return t.length&&e.length-a>=t.length&&u.call(t,function(c,h){var f=l[h]?l[h]&e[a+h]:e[a+h];return c===f})},AA=function(e,t,i){t.forEach(function(s){for(var n in e.mediaGroups[s])for(var a in e.mediaGroups[s][n]){var o=e.mediaGroups[s][n][a];i(o,s,n,a)}})},vn={},rs={},Vs={},lp;function Yo(){if(lp)return Vs;lp=1;function r(n,a,o){if(o===void 0&&(o=Array.prototype),n&&typeof o.find=="function")return o.find.call(n,a);for(var l=0;l<n.length;l++)if(Object.prototype.hasOwnProperty.call(n,l)){var u=n[l];if(a.call(void 0,u,l,n))return u}}function e(n,a){return a===void 0&&(a=Object),a&&typeof a.freeze=="function"?a.freeze(n):n}function t(n,a){if(n===null||typeof n!="object")throw new TypeError("target is not an object");for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n[o]=a[o]);return n}var i=e({HTML:"text/html",isHTML:function(n){return n===i.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),s=e({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(n){return n===s.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});return Vs.assign=t,Vs.find=r,Vs.freeze=e,Vs.MIME_TYPE=i,Vs.NAMESPACE=s,Vs}var up;function a0(){if(up)return rs;up=1;var r=Yo(),e=r.find,t=r.NAMESPACE;function i(R){return R!==""}function s(R){return R?R.split(/[\t\n\f\r ]+/).filter(i):[]}function n(R,P){return R.hasOwnProperty(P)||(R[P]=!0),R}function a(R){if(!R)return[];var P=s(R);return Object.keys(P.reduce(n,{}))}function o(R){return function(P){return R&&R.indexOf(P)!==-1}}function l(R,P){for(var G in R)Object.prototype.hasOwnProperty.call(R,G)&&(P[G]=R[G])}function u(R,P){var G=R.prototype;if(!(G instanceof P)){let se=function(){};se.prototype=P.prototype,se=new se,l(G,se),R.prototype=G=se}G.constructor!=R&&(typeof R!="function"&&console.error("unknown Class:"+R),G.constructor=R)}var c={},h=c.ELEMENT_NODE=1,f=c.ATTRIBUTE_NODE=2,p=c.TEXT_NODE=3,m=c.CDATA_SECTION_NODE=4,y=c.ENTITY_REFERENCE_NODE=5,v=c.ENTITY_NODE=6,E=c.PROCESSING_INSTRUCTION_NODE=7,A=c.COMMENT_NODE=8,x=c.DOCUMENT_NODE=9,w=c.DOCUMENT_TYPE_NODE=10,k=c.DOCUMENT_FRAGMENT_NODE=11,F=c.NOTATION_NODE=12,L={},M={};L.INDEX_SIZE_ERR=(M[1]="Index size error",1),L.DOMSTRING_SIZE_ERR=(M[2]="DOMString size error",2);var C=L.HIERARCHY_REQUEST_ERR=(M[3]="Hierarchy request error",3);L.WRONG_DOCUMENT_ERR=(M[4]="Wrong document",4),L.INVALID_CHARACTER_ERR=(M[5]="Invalid character",5),L.NO_DATA_ALLOWED_ERR=(M[6]="No data allowed",6),L.NO_MODIFICATION_ALLOWED_ERR=(M[7]="No modification allowed",7);var D=L.NOT_FOUND_ERR=(M[8]="Not found",8);L.NOT_SUPPORTED_ERR=(M[9]="Not supported",9);var B=L.INUSE_ATTRIBUTE_ERR=(M[10]="Attribute in use",10);L.INVALID_STATE_ERR=(M[11]="Invalid state",11),L.SYNTAX_ERR=(M[12]="Syntax error",12),L.INVALID_MODIFICATION_ERR=(M[13]="Invalid modification",13),L.NAMESPACE_ERR=(M[14]="Invalid namespace",14),L.INVALID_ACCESS_ERR=(M[15]="Invalid access",15);function H(R,P){if(P instanceof Error)var G=P;else G=this,Error.call(this,M[R]),this.message=M[R],Error.captureStackTrace&&Error.captureStackTrace(this,H);return G.code=R,P&&(this.message=this.message+": "+P),G}H.prototype=Error.prototype,l(L,H);function q(){}q.prototype={length:0,item:function(R){return R>=0&&R<this.length?this[R]:null},toString:function(R,P){for(var G=[],se=0;se<this.length;se++)gs(this[se],G,R,P);return G.join("")},filter:function(R){return Array.prototype.filter.call(this,R)},indexOf:function(R){return Array.prototype.indexOf.call(this,R)}};function Y(R,P){this._node=R,this._refresh=P,Z(this)}function Z(R){var P=R._node._inc||R._node.ownerDocument._inc;if(R._inc!==P){var G=R._refresh(R._node);if(aa(R,"length",G.length),!R.$$length||G.length<R.$$length)for(var se=G.length;se in R;se++)Object.prototype.hasOwnProperty.call(R,se)&&delete R[se];l(G,R),R._inc=P}}Y.prototype.item=function(R){return Z(this),this[R]||null},u(Y,q);function Q(){}function K(R,P){for(var G=R.length;G--;)if(R[G]===P)return G}function z(R,P,G,se){if(se?P[K(P,se)]=G:P[P.length++]=G,R){G.ownerElement=R;var he=R.ownerDocument;he&&(se&&ve(he,R,se),ce(he,R,G))}}function X(R,P,G){var se=K(P,G);if(se>=0){for(var he=P.length-1;se<he;)P[se]=P[++se];if(P.length=he,R){var Ae=R.ownerDocument;Ae&&(ve(Ae,R,G),G.ownerElement=null)}}else throw new H(D,new Error(R.tagName+"@"+G))}Q.prototype={length:0,item:q.prototype.item,getNamedItem:function(R){for(var P=this.length;P--;){var G=this[P];if(G.nodeName==R)return G}},setNamedItem:function(R){var P=R.ownerElement;if(P&&P!=this._ownerElement)throw new H(B);var G=this.getNamedItem(R.nodeName);return z(this._ownerElement,this,R,G),G},setNamedItemNS:function(R){var P=R.ownerElement,G;if(P&&P!=this._ownerElement)throw new H(B);return G=this.getNamedItemNS(R.namespaceURI,R.localName),z(this._ownerElement,this,R,G),G},removeNamedItem:function(R){var P=this.getNamedItem(R);return X(this._ownerElement,this,P),P},removeNamedItemNS:function(R,P){var G=this.getNamedItemNS(R,P);return X(this._ownerElement,this,G),G},getNamedItemNS:function(R,P){for(var G=this.length;G--;){var se=this[G];if(se.localName==P&&se.namespaceURI==R)return se}return null}};function ie(){}ie.prototype={hasFeature:function(R,P){return!0},createDocument:function(R,P,G){var se=new ge;if(se.implementation=this,se.childNodes=new q,se.doctype=G||null,G&&se.appendChild(G),P){var he=se.createElementNS(R,P);se.appendChild(he)}return se},createDocumentType:function(R,P,G){var se=new wi;return se.name=R,se.nodeName=R,se.publicId=P||"",se.systemId=G||"",se}};function W(){}W.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(R,P){return yt(this,R,P)},replaceChild:function(R,P){yt(this,R,P,Xe),P&&this.removeChild(P)},removeChild:function(R){return ke(this,R)},appendChild:function(R){return this.insertBefore(R,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(R){return tn(this.ownerDocument||this,this,R)},normalize:function(){for(var R=this.firstChild;R;){var P=R.nextSibling;P&&P.nodeType==p&&R.nodeType==p?(this.removeChild(P),R.appendData(P.data)):(R.normalize(),R=P)}},isSupported:function(R,P){return this.ownerDocument.implementation.hasFeature(R,P)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(R){for(var P=this;P;){var G=P._nsMap;if(G){for(var se in G)if(Object.prototype.hasOwnProperty.call(G,se)&&G[se]===R)return se}P=P.nodeType==f?P.ownerDocument:P.parentNode}return null},lookupNamespaceURI:function(R){for(var P=this;P;){var G=P._nsMap;if(G&&Object.prototype.hasOwnProperty.call(G,R))return G[R];P=P.nodeType==f?P.ownerDocument:P.parentNode}return null},isDefaultNamespace:function(R){var P=this.lookupPrefix(R);return P==null}};function ae(R){return R=="<"&&"&lt;"||R==">"&&"&gt;"||R=="&"&&"&amp;"||R=='"'&&"&quot;"||"&#"+R.charCodeAt()+";"}l(c,W),l(c,W.prototype);function de(R,P){if(P(R))return!0;if(R=R.firstChild)do if(de(R,P))return!0;while(R=R.nextSibling)}function ge(){this.ownerDocument=this}function ce(R,P,G){R&&R._inc++;var se=G.namespaceURI;se===t.XMLNS&&(P._nsMap[G.prefix?G.localName:""]=G.value)}function ve(R,P,G,se){R&&R._inc++;var he=G.namespaceURI;he===t.XMLNS&&delete P._nsMap[G.prefix?G.localName:""]}function Me(R,P,G){if(R&&R._inc){R._inc++;var se=P.childNodes;if(G)se[se.length++]=G;else{for(var he=P.firstChild,Ae=0;he;)se[Ae++]=he,he=he.nextSibling;se.length=Ae,delete se[se.length]}}}function ke(R,P){var G=P.previousSibling,se=P.nextSibling;return G?G.nextSibling=se:R.firstChild=se,se?se.previousSibling=G:R.lastChild=G,P.parentNode=null,P.previousSibling=null,P.nextSibling=null,Me(R.ownerDocument,R),P}function Ve(R){return R&&(R.nodeType===W.DOCUMENT_NODE||R.nodeType===W.DOCUMENT_FRAGMENT_NODE||R.nodeType===W.ELEMENT_NODE)}function rt(R){return R&&(Ct(R)||ai(R)||Ze(R)||R.nodeType===W.DOCUMENT_FRAGMENT_NODE||R.nodeType===W.COMMENT_NODE||R.nodeType===W.PROCESSING_INSTRUCTION_NODE)}function Ze(R){return R&&R.nodeType===W.DOCUMENT_TYPE_NODE}function Ct(R){return R&&R.nodeType===W.ELEMENT_NODE}function ai(R){return R&&R.nodeType===W.TEXT_NODE}function ct(R,P){var G=R.childNodes||[];if(e(G,Ct)||Ze(P))return!1;var se=e(G,Ze);return!(P&&se&&G.indexOf(se)>G.indexOf(P))}function Zi(R,P){var G=R.childNodes||[];function se(Ae){return Ct(Ae)&&Ae!==P}if(e(G,se))return!1;var he=e(G,Ze);return!(P&&he&&G.indexOf(he)>G.indexOf(P))}function Ee(R,P,G){if(!Ve(R))throw new H(C,"Unexpected parent node type "+R.nodeType);if(G&&G.parentNode!==R)throw new H(D,"child not in parent");if(!rt(P)||Ze(P)&&R.nodeType!==W.DOCUMENT_NODE)throw new H(C,"Unexpected node type "+P.nodeType+" for parent node type "+R.nodeType)}function nt(R,P,G){var se=R.childNodes||[],he=P.childNodes||[];if(P.nodeType===W.DOCUMENT_FRAGMENT_NODE){var Ae=he.filter(Ct);if(Ae.length>1||e(he,ai))throw new H(C,"More than one element or text in fragment");if(Ae.length===1&&!ct(R,G))throw new H(C,"Element in fragment can not be inserted before doctype")}if(Ct(P)&&!ct(R,G))throw new H(C,"Only one element can be added and only after doctype");if(Ze(P)){if(e(se,Ze))throw new H(C,"Only one doctype is allowed");var We=e(se,Ct);if(G&&se.indexOf(We)<se.indexOf(G))throw new H(C,"Doctype can only be inserted before an element");if(!G&&We)throw new H(C,"Doctype can not be appended since element is present")}}function Xe(R,P,G){var se=R.childNodes||[],he=P.childNodes||[];if(P.nodeType===W.DOCUMENT_FRAGMENT_NODE){var Ae=he.filter(Ct);if(Ae.length>1||e(he,ai))throw new H(C,"More than one element or text in fragment");if(Ae.length===1&&!Zi(R,G))throw new H(C,"Element in fragment can not be inserted before doctype")}if(Ct(P)&&!Zi(R,G))throw new H(C,"Only one element can be added and only after doctype");if(Ze(P)){if(e(se,function(Yt){return Ze(Yt)&&Yt!==G}))throw new H(C,"Only one doctype is allowed");var We=e(se,Ct);if(G&&se.indexOf(We)<se.indexOf(G))throw new H(C,"Doctype can only be inserted before an element")}}function yt(R,P,G,se){Ee(R,P,G),R.nodeType===W.DOCUMENT_NODE&&(se||nt)(R,P,G);var he=P.parentNode;if(he&&he.removeChild(P),P.nodeType===k){var Ae=P.firstChild;if(Ae==null)return P;var We=P.lastChild}else Ae=We=P;var wt=G?G.previousSibling:R.lastChild;Ae.previousSibling=wt,We.nextSibling=G,wt?wt.nextSibling=Ae:R.firstChild=Ae,G==null?R.lastChild=We:G.previousSibling=We;do{Ae.parentNode=R;var Yt=R.ownerDocument||R;be(Ae,Yt)}while(Ae!==We&&(Ae=Ae.nextSibling));return Me(R.ownerDocument||R,R),P.nodeType==k&&(P.firstChild=P.lastChild=null),P}function be(R,P){if(R.ownerDocument!==P){if(R.ownerDocument=P,R.nodeType===h&&R.attributes)for(var G=0;G<R.attributes.length;G++){var se=R.attributes.item(G);se&&(se.ownerDocument=P)}for(var he=R.firstChild;he;)be(he,P),he=he.nextSibling}}function Fe(R,P){P.parentNode&&P.parentNode.removeChild(P),P.parentNode=R,P.previousSibling=R.lastChild,P.nextSibling=null,P.previousSibling?P.previousSibling.nextSibling=P:R.firstChild=P,R.lastChild=P,Me(R.ownerDocument,R,P);var G=R.ownerDocument||R;return be(P,G),P}ge.prototype={nodeName:"#document",nodeType:x,doctype:null,documentElement:null,_inc:1,insertBefore:function(R,P){if(R.nodeType==k){for(var G=R.firstChild;G;){var se=G.nextSibling;this.insertBefore(G,P),G=se}return R}return yt(this,R,P),be(R,this),this.documentElement===null&&R.nodeType===h&&(this.documentElement=R),R},removeChild:function(R){return this.documentElement==R&&(this.documentElement=null),ke(this,R)},replaceChild:function(R,P){yt(this,R,P,Xe),be(R,this),P&&this.removeChild(P),Ct(R)&&(this.documentElement=R)},importNode:function(R,P){return na(this,R,P)},getElementById:function(R){var P=null;return de(this.documentElement,function(G){if(G.nodeType==h&&G.getAttribute("id")==R)return P=G,!0}),P},getElementsByClassName:function(R){var P=a(R);return new Y(this,function(G){var se=[];return P.length>0&&de(G.documentElement,function(he){if(he!==G&&he.nodeType===h){var Ae=he.getAttribute("class");if(Ae){var We=R===Ae;if(!We){var wt=a(Ae);We=P.every(o(wt))}We&&se.push(he)}}}),se})},createElement:function(R){var P=new Ne;P.ownerDocument=this,P.nodeName=R,P.tagName=R,P.localName=R,P.childNodes=new q;var G=P.attributes=new Q;return G._ownerElement=P,P},createDocumentFragment:function(){var R=new Be;return R.ownerDocument=this,R.childNodes=new q,R},createTextNode:function(R){var P=new Ri;return P.ownerDocument=this,P.appendData(R),P},createComment:function(R){var P=new zt;return P.ownerDocument=this,P.appendData(R),P},createCDATASection:function(R){var P=new vi;return P.ownerDocument=this,P.appendData(R),P},createProcessingInstruction:function(R,P){var G=new Zr;return G.ownerDocument=this,G.tagName=G.nodeName=G.target=R,G.nodeValue=G.data=P,G},createAttribute:function(R){var P=new _i;return P.ownerDocument=this,P.name=R,P.nodeName=R,P.localName=R,P.specified=!0,P},createEntityReference:function(R){var P=new oi;return P.ownerDocument=this,P.nodeName=R,P},createElementNS:function(R,P){var G=new Ne,se=P.split(":"),he=G.attributes=new Q;return G.childNodes=new q,G.ownerDocument=this,G.nodeName=P,G.tagName=P,G.namespaceURI=R,se.length==2?(G.prefix=se[0],G.localName=se[1]):G.localName=P,he._ownerElement=G,G},createAttributeNS:function(R,P){var G=new _i,se=P.split(":");return G.ownerDocument=this,G.nodeName=P,G.name=P,G.namespaceURI=R,G.specified=!0,se.length==2?(G.prefix=se[0],G.localName=se[1]):G.localName=P,G}},u(ge,W);function Ne(){this._nsMap={}}Ne.prototype={nodeType:h,hasAttribute:function(R){return this.getAttributeNode(R)!=null},getAttribute:function(R){var P=this.getAttributeNode(R);return P&&P.value||""},getAttributeNode:function(R){return this.attributes.getNamedItem(R)},setAttribute:function(R,P){var G=this.ownerDocument.createAttribute(R);G.value=G.nodeValue=""+P,this.setAttributeNode(G)},removeAttribute:function(R){var P=this.getAttributeNode(R);P&&this.removeAttributeNode(P)},appendChild:function(R){return R.nodeType===k?this.insertBefore(R,null):Fe(this,R)},setAttributeNode:function(R){return this.attributes.setNamedItem(R)},setAttributeNodeNS:function(R){return this.attributes.setNamedItemNS(R)},removeAttributeNode:function(R){return this.attributes.removeNamedItem(R.nodeName)},removeAttributeNS:function(R,P){var G=this.getAttributeNodeNS(R,P);G&&this.removeAttributeNode(G)},hasAttributeNS:function(R,P){return this.getAttributeNodeNS(R,P)!=null},getAttributeNS:function(R,P){var G=this.getAttributeNodeNS(R,P);return G&&G.value||""},setAttributeNS:function(R,P,G){var se=this.ownerDocument.createAttributeNS(R,P);se.value=se.nodeValue=""+G,this.setAttributeNode(se)},getAttributeNodeNS:function(R,P){return this.attributes.getNamedItemNS(R,P)},getElementsByTagName:function(R){return new Y(this,function(P){var G=[];return de(P,function(se){se!==P&&se.nodeType==h&&(R==="*"||se.tagName==R)&&G.push(se)}),G})},getElementsByTagNameNS:function(R,P){return new Y(this,function(G){var se=[];return de(G,function(he){he!==G&&he.nodeType===h&&(R==="*"||he.namespaceURI===R)&&(P==="*"||he.localName==P)&&se.push(he)}),se})}},ge.prototype.getElementsByTagName=Ne.prototype.getElementsByTagName,ge.prototype.getElementsByTagNameNS=Ne.prototype.getElementsByTagNameNS,u(Ne,W);function _i(){}_i.prototype.nodeType=f,u(_i,W);function Vt(){}Vt.prototype={data:"",substringData:function(R,P){return this.data.substring(R,R+P)},appendData:function(R){R=this.data+R,this.nodeValue=this.data=R,this.length=R.length},insertData:function(R,P){this.replaceData(R,0,P)},appendChild:function(R){throw new Error(M[C])},deleteData:function(R,P){this.replaceData(R,P,"")},replaceData:function(R,P,G){var se=this.data.substring(0,R),he=this.data.substring(R+P);G=se+G+he,this.nodeValue=this.data=G,this.length=G.length}},u(Vt,W);function Ri(){}Ri.prototype={nodeName:"#text",nodeType:p,splitText:function(R){var P=this.data,G=P.substring(R);P=P.substring(0,R),this.data=this.nodeValue=P,this.length=P.length;var se=this.ownerDocument.createTextNode(G);return this.parentNode&&this.parentNode.insertBefore(se,this.nextSibling),se}},u(Ri,Vt);function zt(){}zt.prototype={nodeName:"#comment",nodeType:A},u(zt,Vt);function vi(){}vi.prototype={nodeName:"#cdata-section",nodeType:m},u(vi,Vt);function wi(){}wi.prototype.nodeType=w,u(wi,W);function fs(){}fs.prototype.nodeType=F,u(fs,W);function ps(){}ps.prototype.nodeType=v,u(ps,W);function oi(){}oi.prototype.nodeType=y,u(oi,W);function Be(){}Be.prototype.nodeName="#document-fragment",Be.prototype.nodeType=k,u(Be,W);function Zr(){}Zr.prototype.nodeType=E,u(Zr,W);function Os(){}Os.prototype.serializeToString=function(R,P,G){return sa.call(R,P,G)},W.prototype.toString=sa;function sa(R,P){var G=[],se=this.nodeType==9&&this.documentElement||this,he=se.prefix,Ae=se.namespaceURI;if(Ae&&he==null){var he=se.lookupPrefix(Ae);if(he==null)var We=[{namespace:Ae,prefix:null}]}return gs(this,G,R,P,We),G.join("")}function ra(R,P,G){var se=R.prefix||"",he=R.namespaceURI;if(!he||se==="xml"&&he===t.XML||he===t.XMLNS)return!1;for(var Ae=G.length;Ae--;){var We=G[Ae];if(We.prefix===se)return We.namespace!==he}return!0}function en(R,P,G){R.push(" ",P,'="',G.replace(/[<>&"\t\n\r]/g,ae),'"')}function gs(R,P,G,se,he){if(he||(he=[]),se)if(R=se(R),R){if(typeof R=="string"){P.push(R);return}}else return;switch(R.nodeType){case h:var Ae=R.attributes,We=Ae.length,Qe=R.firstChild,wt=R.tagName;G=t.isHTML(R.namespaceURI)||G;var Yt=wt;if(!G&&!R.prefix&&R.namespaceURI){for(var ki,li=0;li<Ae.length;li++)if(Ae.item(li).name==="xmlns"){ki=Ae.item(li).value;break}if(!ki)for(var Si=he.length-1;Si>=0;Si--){var ui=he[Si];if(ui.prefix===""&&ui.namespace===R.namespaceURI){ki=ui.namespace;break}}if(ki!==R.namespaceURI)for(var Si=he.length-1;Si>=0;Si--){var ui=he[Si];if(ui.namespace===R.namespaceURI){ui.prefix&&(Yt=ui.prefix+":"+wt);break}}}P.push("<",Yt);for(var ht=0;ht<We;ht++){var ci=Ae.item(ht);ci.prefix=="xmlns"?he.push({prefix:ci.localName,namespace:ci.value}):ci.nodeName=="xmlns"&&he.push({prefix:"",namespace:ci.value})}for(var ht=0;ht<We;ht++){var ci=Ae.item(ht);if(ra(ci,G,he)){var es=ci.prefix||"",Pi=ci.namespaceURI;en(P,es?"xmlns:"+es:"xmlns",Pi),he.push({prefix:es,namespace:Pi})}gs(ci,P,G,se,he)}if(wt===Yt&&ra(R,G,he)){var es=R.prefix||"",Pi=R.namespaceURI;en(P,es?"xmlns:"+es:"xmlns",Pi),he.push({prefix:es,namespace:Pi})}if(Qe||G&&!/^(?:meta|link|img|br|hr|input)$/i.test(wt)){if(P.push(">"),G&&/^script$/i.test(wt))for(;Qe;)Qe.data?P.push(Qe.data):gs(Qe,P,G,se,he.slice()),Qe=Qe.nextSibling;else for(;Qe;)gs(Qe,P,G,se,he.slice()),Qe=Qe.nextSibling;P.push("</",Yt,">")}else P.push("/>");return;case x:case k:for(var Qe=R.firstChild;Qe;)gs(Qe,P,G,se,he.slice()),Qe=Qe.nextSibling;return;case f:return en(P,R.name,R.value);case p:return P.push(R.data.replace(/[<&>]/g,ae));case m:return P.push("<![CDATA[",R.data,"]]>");case A:return P.push("<!--",R.data,"-->");case w:var Ms=R.publicId,Oe=R.systemId;if(P.push("<!DOCTYPE ",R.name),Ms)P.push(" PUBLIC ",Ms),Oe&&Oe!="."&&P.push(" ",Oe),P.push(">");else if(Oe&&Oe!=".")P.push(" SYSTEM ",Oe,">");else{var oa=R.internalSubset;oa&&P.push(" [",oa,"]"),P.push(">")}return;case E:return P.push("<?",R.target," ",R.data,"?>");case y:return P.push("&",R.nodeName,";");default:P.push("??",R.nodeName)}}function na(R,P,G){var se;switch(P.nodeType){case h:se=P.cloneNode(!1),se.ownerDocument=R;case k:break;case f:G=!0;break}if(se||(se=P.cloneNode(!1)),se.ownerDocument=R,se.parentNode=null,G)for(var he=P.firstChild;he;)se.appendChild(na(R,he,G)),he=he.nextSibling;return se}function tn(R,P,G){var se=new P.constructor;for(var he in P)if(Object.prototype.hasOwnProperty.call(P,he)){var Ae=P[he];typeof Ae!="object"&&Ae!=se[he]&&(se[he]=Ae)}switch(P.childNodes&&(se.childNodes=new q),se.ownerDocument=R,se.nodeType){case h:var We=P.attributes,wt=se.attributes=new Q,Yt=We.length;wt._ownerElement=se;for(var ki=0;ki<Yt;ki++)se.setAttributeNode(tn(R,We.item(ki),!0));break;case f:G=!0}if(G)for(var li=P.firstChild;li;)se.appendChild(tn(R,li,G)),li=li.nextSibling;return se}function aa(R,P,G){R[P]=G}try{if(Object.defineProperty){let R=function(P){switch(P.nodeType){case h:case k:var G=[];for(P=P.firstChild;P;)P.nodeType!==7&&P.nodeType!==8&&G.push(R(P)),P=P.nextSibling;return G.join("");default:return P.nodeValue}};Object.defineProperty(Y.prototype,"length",{get:function(){return Z(this),this.$$length}}),Object.defineProperty(W.prototype,"textContent",{get:function(){return R(this)},set:function(P){switch(this.nodeType){case h:case k:for(;this.firstChild;)this.removeChild(this.firstChild);(P||String(P))&&this.appendChild(this.ownerDocument.createTextNode(P));break;default:this.data=P,this.value=P,this.nodeValue=P}}}),aa=function(P,G,se){P["$$"+G]=se}}}catch{}return rs.DocumentType=wi,rs.DOMException=H,rs.DOMImplementation=ie,rs.Element=Ne,rs.Node=W,rs.NodeList=q,rs.XMLSerializer=Os,rs}var Sn={},pu={},cp;function CA(){return cp||(cp=1,(function(r){var e=Yo().freeze;r.XML_ENTITIES=e({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),r.HTML_ENTITIES=e({Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",AMP:"&",amp:"&",And:"",and:"",andand:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsd:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",ap:"",apacir:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",Barwed:"",barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",Because:"",because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxDL:"",boxDl:"",boxdL:"",boxdl:"",boxDR:"",boxDr:"",boxdR:"",boxdr:"",boxH:"",boxh:"",boxHD:"",boxHd:"",boxhD:"",boxhd:"",boxHU:"",boxHu:"",boxhU:"",boxhu:"",boxminus:"",boxplus:"",boxtimes:"",boxUL:"",boxUl:"",boxuL:"",boxul:"",boxUR:"",boxUr:"",boxuR:"",boxur:"",boxV:"",boxv:"",boxVH:"",boxVh:"",boxvH:"",boxvh:"",boxVL:"",boxVl:"",boxvL:"",boxvl:"",boxVR:"",boxVr:"",boxvR:"",boxvr:"",bprime:"",Breve:"",breve:"",brvbar:"",Bscr:"",bscr:"",bsemi:"",bsim:"",bsime:"",bsol:"\\",bsolb:"",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",Cap:"",cap:"",capand:"",capbrcup:"",capcap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",CenterDot:"",centerdot:"",Cfr:"",cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",cir:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",Colon:"",colon:":",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",Conint:"",conint:"",ContourIntegral:"",Copf:"",copf:"",coprod:"",Coproduct:"",COPY:"",copy:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",Cross:"",cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",Cup:"",cup:"",cupbrcap:"",CupCap:"",cupcap:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",Dagger:"",dagger:"",daleth:"",Darr:"",dArr:"",darr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",DD:"",dd:"",ddagger:"",ddarr:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",Diamond:"",diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrow:"",Downarrow:"",downarrow:"",DownArrowBar:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVector:"",DownLeftVectorBar:"",DownRightTeeVector:"",DownRightVector:"",DownRightVectorBar:"",DownTee:"",DownTeeArrow:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",ecir:"",Ecirc:"",ecirc:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",eDot:"",edot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp:"",emsp13:"",emsp14:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",Escr:"",escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",ExponentialE:"",exponentiale:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",ForAll:"",forall:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",Fscr:"",fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",gE:"",ge:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",ges:"",gescc:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",Gg:"",gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gl:"",gla:"",glE:"",glj:"",gnap:"",gnapprox:"",gnE:"",gne:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",Gt:"",GT:">",gt:">",gtcc:"",gtcir:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",hArr:"",harr:"",harrcir:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",Hfr:"",hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",Hopf:"",hopf:"",horbar:"",HorizontalLine:"",Hscr:"",hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",Ifr:"",ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Im:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",imof:"",imped:"",Implies:"",in:"",incare:"",infin:"",infintie:"",inodot:"",Int:"",int:"",intcal:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",Iscr:"",iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",Lang:"",lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",Larr:"",lArr:"",larr:"",larrb:"",larrbfs:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",lat:"",lAtail:"",latail:"",late:"",lates:"",lBarr:"",lbarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",lE:"",le:"",LeftAngleBracket:"",LeftArrow:"",Leftarrow:"",leftarrow:"",LeftArrowBar:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVector:"",LeftDownVectorBar:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTee:"",LeftTeeArrow:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangle:"",LeftTriangleBar:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVector:"",LeftUpVectorBar:"",LeftVector:"",LeftVectorBar:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",les:"",lescc:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",Ll:"",ll:"",llarr:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoust:"",lmoustache:"",lnap:"",lnapprox:"",lnE:"",lne:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",LongLeftArrow:"",Longleftarrow:"",longleftarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longleftrightarrow:"",longmapsto:"",LongRightArrow:"",Longrightarrow:"",longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",Lscr:"",lscr:"",Lsh:"",lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",Lt:"",LT:"<",lt:"<",ltcc:"",ltcir:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",mid:"",midast:"*",midcir:"",middot:"",minus:"",minusb:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",Mscr:"",mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natur:"",natural:"",naturals:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",ne:"",nearhk:"",neArr:"",nearr:"",nearrow:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:`
`,nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nhArr:"",nharr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlArr:"",nlarr:"",nldr:"",nlE:"",nle:"",nLeftarrow:"",nleftarrow:"",nLeftrightarrow:"",nleftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",Nopf:"",nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangle:"",NotLeftTriangleBar:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangle:"",NotRightTriangleBar:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",npar:"",nparallel:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",npre:"",nprec:"",npreceq:"",nrArr:"",nrarr:"",nrarrc:"",nrarrw:"",nRightarrow:"",nrightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nVDash:"",nVdash:"",nvDash:"",nvdash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwArr:"",nwarr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",ocir:"",Ocirc:"",ocirc:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",Or:"",or:"",orarr:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",Otimes:"",otimes:"",otimesas:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",par:"",para:"",parallel:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plus:"+",plusacir:"",plusb:"",pluscir:"",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",Popf:"",popf:"",pound:"",Pr:"",pr:"",prap:"",prcue:"",prE:"",pre:"",prec:"",precapprox:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",precsim:"",Prime:"",prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportion:"",Proportional:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",Qopf:"",qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",QUOT:'"',quot:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",Rang:"",rang:"",rangd:"",range:"",rangle:"",raquo:"",Rarr:"",rArr:"",rarr:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",rAtail:"",ratail:"",ratio:"",rationals:"",RBarr:"",rBarr:"",rbarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",Re:"",real:"",realine:"",realpart:"",reals:"",rect:"",REG:"",reg:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",Rfr:"",rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrow:"",Rightarrow:"",rightarrow:"",RightArrowBar:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVector:"",RightDownVectorBar:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTee:"",RightTeeArrow:"",RightTeeVector:"",rightthreetimes:"",RightTriangle:"",RightTriangleBar:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVector:"",RightUpVectorBar:"",RightVector:"",RightVectorBar:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoust:"",rmoustache:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",Ropf:"",ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",Rscr:"",rscr:"",Rsh:"",rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",Sc:"",sc:"",scap:"",Scaron:"",scaron:"",sccue:"",scE:"",sce:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdot:"",sdotb:"",sdote:"",searhk:"",seArr:"",searr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",sol:"/",solb:"",solbar:"",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",squ:"",Square:"",square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",Sub:"",sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",Subset:"",subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succ:"",succapprox:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",Sum:"",sum:"",sung:"",Sup:"",sup:"",sup1:"",sup2:"",sup3:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",Supset:"",supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swArr:"",swarr:"",swarrow:"",swnwar:"",szlig:"",Tab:"	",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",Therefore:"",therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",thinsp:"",ThinSpace:"",thkap:"",thksim:"",THORN:"",thorn:"",Tilde:"",tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",times:"",timesb:"",timesbar:"",timesd:"",tint:"",toea:"",top:"",topbot:"",topcir:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",TRADE:"",trade:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",Uarr:"",uArr:"",uarr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrow:"",Uparrow:"",uparrow:"",UpArrowBar:"",UpArrowDownArrow:"",UpDownArrow:"",Updownarrow:"",updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",Upsi:"",upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTee:"",UpTeeArrow:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",vArr:"",varr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",Vbar:"",vBar:"",vBarv:"",Vcy:"",vcy:"",VDash:"",Vdash:"",vDash:"",vdash:"",Vdashl:"",Vee:"",vee:"",veebar:"",veeeq:"",vellip:"",Verbar:"",verbar:"|",Vert:"",vert:"|",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",Wedge:"",wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xhArr:"",xharr:"",Xi:"",xi:"",xlArr:"",xlarr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrArr:"",xrarr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",Yuml:"",yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",Zfr:"",zfr:"",ZHcy:"",zhcy:"",zigrarr:"",Zopf:"",zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}),r.entityMap=r.HTML_ENTITIES})(pu)),pu}var za={},hp;function IA(){if(hp)return za;hp=1;var r=Yo().NAMESPACE,e=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,t=new RegExp("[\\-\\.0-9"+e.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),i=new RegExp("^"+e.source+t.source+"*(?::"+e.source+t.source+"*)?$"),s=0,n=1,a=2,o=3,l=4,u=5,c=6,h=7;function f(C,D){this.message=C,this.locator=D,Error.captureStackTrace&&Error.captureStackTrace(this,f)}f.prototype=new Error,f.prototype.name=f.name;function p(){}p.prototype={parse:function(C,D,B){var H=this.domBuilder;H.startDocument(),w(D,D={}),m(C,D,B,H,this.errorHandler),H.endDocument()}};function m(C,D,B,H,q){function Y(Fe){if(Fe>65535){Fe-=65536;var Ne=55296+(Fe>>10),_i=56320+(Fe&1023);return String.fromCharCode(Ne,_i)}else return String.fromCharCode(Fe)}function Z(Fe){var Ne=Fe.slice(1,-1);return Object.hasOwnProperty.call(B,Ne)?B[Ne]:Ne.charAt(0)==="#"?Y(parseInt(Ne.substr(1).replace("x","0x"))):(q.error("entity not found:"+Fe),Fe)}function Q(Fe){if(Fe>ge){var Ne=C.substring(ge,Fe).replace(/&#?\w+;/g,Z);W&&K(ge),H.characters(Ne,0,Fe-ge),ge=Fe}}function K(Fe,Ne){for(;Fe>=X&&(Ne=ie.exec(C));)z=Ne.index,X=z+Ne[0].length,W.lineNumber++;W.columnNumber=Fe-z+1}for(var z=0,X=0,ie=/.*(?:\r\n?|\n)|.*$/g,W=H.locator,ae=[{currentNSMap:D}],de={},ge=0;;){try{var ce=C.indexOf("<",ge);if(ce<0){if(!C.substr(ge).match(/^\s*$/)){var ve=H.doc,Me=ve.createTextNode(C.substr(ge));ve.appendChild(Me),H.currentElement=Me}return}switch(ce>ge&&Q(ce),C.charAt(ce+1)){case"/":var Ee=C.indexOf(">",ce+3),ke=C.substring(ce+2,Ee).replace(/[ \t\n\r]+$/g,""),Ve=ae.pop();Ee<0?(ke=C.substring(ce+2).replace(/[\s<].*/,""),q.error("end tag name: "+ke+" is not complete:"+Ve.tagName),Ee=ce+1+ke.length):ke.match(/\s</)&&(ke=ke.replace(/[\s<].*/,""),q.error("end tag name: "+ke+" maybe not complete"),Ee=ce+1+ke.length);var rt=Ve.localNSMap,Ze=Ve.tagName==ke,Ct=Ze||Ve.tagName&&Ve.tagName.toLowerCase()==ke.toLowerCase();if(Ct){if(H.endElement(Ve.uri,Ve.localName,ke),rt)for(var ai in rt)Object.prototype.hasOwnProperty.call(rt,ai)&&H.endPrefixMapping(ai);Ze||q.fatalError("end tag name: "+ke+" is not match the current start tagName:"+Ve.tagName)}else ae.push(Ve);Ee++;break;case"?":W&&K(ce),Ee=F(C,ce,H);break;case"!":W&&K(ce),Ee=k(C,ce,H,q);break;default:W&&K(ce);var ct=new L,Zi=ae[ae.length-1].currentNSMap,Ee=v(C,ce,ct,Zi,Z,q),nt=ct.length;if(!ct.closed&&x(C,Ee,ct.tagName,de)&&(ct.closed=!0,B.nbsp||q.warning("unclosed xml attribute")),W&&nt){for(var Xe=y(W,{}),yt=0;yt<nt;yt++){var be=ct[yt];K(be.offset),be.locator=y(W,{})}H.locator=Xe,E(ct,H,Zi)&&ae.push(ct),H.locator=W}else E(ct,H,Zi)&&ae.push(ct);r.isHTML(ct.uri)&&!ct.closed?Ee=A(C,Ee,ct.tagName,Z,H):Ee++}}catch(Fe){if(Fe instanceof f)throw Fe;q.error("element parse error: "+Fe),Ee=-1}Ee>ge?ge=Ee:Q(Math.max(ce,ge)+1)}}function y(C,D){return D.lineNumber=C.lineNumber,D.columnNumber=C.columnNumber,D}function v(C,D,B,H,q,Y){function Z(W,ae,de){B.attributeNames.hasOwnProperty(W)&&Y.fatalError("Attribute "+W+" redefined"),B.addValue(W,ae.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,q),de)}for(var Q,K,z=++D,X=s;;){var ie=C.charAt(z);switch(ie){case"=":if(X===n)Q=C.slice(D,z),X=o;else if(X===a)X=o;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(X===o||X===n)if(X===n&&(Y.warning('attribute value must after "="'),Q=C.slice(D,z)),D=z+1,z=C.indexOf(ie,D),z>0)K=C.slice(D,z),Z(Q,K,D-1),X=u;else throw new Error("attribute value no end '"+ie+"' match");else if(X==l)K=C.slice(D,z),Z(Q,K,D),Y.warning('attribute "'+Q+'" missed start quot('+ie+")!!"),D=z+1,X=u;else throw new Error('attribute value must after "="');break;case"/":switch(X){case s:B.setTagName(C.slice(D,z));case u:case c:case h:X=h,B.closed=!0;case l:case n:break;case a:B.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return Y.error("unexpected end of input"),X==s&&B.setTagName(C.slice(D,z)),z;case">":switch(X){case s:B.setTagName(C.slice(D,z));case u:case c:case h:break;case l:case n:K=C.slice(D,z),K.slice(-1)==="/"&&(B.closed=!0,K=K.slice(0,-1));case a:X===a&&(K=Q),X==l?(Y.warning('attribute "'+K+'" missed quot(")!'),Z(Q,K,D)):((!r.isHTML(H[""])||!K.match(/^(?:disabled|checked|selected)$/i))&&Y.warning('attribute "'+K+'" missed value!! "'+K+'" instead!!'),Z(K,K,D));break;case o:throw new Error("attribute value missed!!")}return z;case"":ie=" ";default:if(ie<=" ")switch(X){case s:B.setTagName(C.slice(D,z)),X=c;break;case n:Q=C.slice(D,z),X=a;break;case l:var K=C.slice(D,z);Y.warning('attribute "'+K+'" missed quot(")!!'),Z(Q,K,D);case u:X=c;break}else switch(X){case a:B.tagName,(!r.isHTML(H[""])||!Q.match(/^(?:disabled|checked|selected)$/i))&&Y.warning('attribute "'+Q+'" missed value!! "'+Q+'" instead2!!'),Z(Q,Q,D),D=z,X=n;break;case u:Y.warning('attribute space is required"'+Q+'"!!');case c:X=n,D=z;break;case o:X=l,D=z;break;case h:throw new Error("elements closed character '/' and '>' must be connected to")}}z++}}function E(C,D,B){for(var H=C.tagName,q=null,ie=C.length;ie--;){var Y=C[ie],Z=Y.qName,Q=Y.value,W=Z.indexOf(":");if(W>0)var K=Y.prefix=Z.slice(0,W),z=Z.slice(W+1),X=K==="xmlns"&&z;else z=Z,K=null,X=Z==="xmlns"&&"";Y.localName=z,X!==!1&&(q==null&&(q={},w(B,B={})),B[X]=q[X]=Q,Y.uri=r.XMLNS,D.startPrefixMapping(X,Q))}for(var ie=C.length;ie--;){Y=C[ie];var K=Y.prefix;K&&(K==="xml"&&(Y.uri=r.XML),K!=="xmlns"&&(Y.uri=B[K||""]))}var W=H.indexOf(":");W>0?(K=C.prefix=H.slice(0,W),z=C.localName=H.slice(W+1)):(K=null,z=C.localName=H);var ae=C.uri=B[K||""];if(D.startElement(ae,z,H,C),C.closed){if(D.endElement(ae,z,H),q)for(K in q)Object.prototype.hasOwnProperty.call(q,K)&&D.endPrefixMapping(K)}else return C.currentNSMap=B,C.localNSMap=q,!0}function A(C,D,B,H,q){if(/^(?:script|textarea)$/i.test(B)){var Y=C.indexOf("</"+B+">",D),Z=C.substring(D+1,Y);if(/[&<]/.test(Z))return/^script$/i.test(B)?(q.characters(Z,0,Z.length),Y):(Z=Z.replace(/&#?\w+;/g,H),q.characters(Z,0,Z.length),Y)}return D+1}function x(C,D,B,H){var q=H[B];return q==null&&(q=C.lastIndexOf("</"+B+">"),q<D&&(q=C.lastIndexOf("</"+B)),H[B]=q),q<D}function w(C,D){for(var B in C)Object.prototype.hasOwnProperty.call(C,B)&&(D[B]=C[B])}function k(C,D,B,H){var q=C.charAt(D+2);switch(q){case"-":if(C.charAt(D+3)==="-"){var Y=C.indexOf("-->",D+4);return Y>D?(B.comment(C,D+4,Y-D-4),Y+3):(H.error("Unclosed comment"),-1)}else return-1;default:if(C.substr(D+3,6)=="CDATA["){var Y=C.indexOf("]]>",D+9);return B.startCDATA(),B.characters(C,D+9,Y-D-9),B.endCDATA(),Y+3}var Z=M(C,D),Q=Z.length;if(Q>1&&/!doctype/i.test(Z[0][0])){var K=Z[1][0],z=!1,X=!1;Q>3&&(/^public$/i.test(Z[2][0])?(z=Z[3][0],X=Q>4&&Z[4][0]):/^system$/i.test(Z[2][0])&&(X=Z[3][0]));var ie=Z[Q-1];return B.startDTD(K,z,X),B.endDTD(),ie.index+ie[0].length}}return-1}function F(C,D,B){var H=C.indexOf("?>",D);if(H){var q=C.substring(D,H).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return q?(q[0].length,B.processingInstruction(q[1],q[2]),H+2):-1}return-1}function L(){this.attributeNames={}}L.prototype={setTagName:function(C){if(!i.test(C))throw new Error("invalid tagName:"+C);this.tagName=C},addValue:function(C,D,B){if(!i.test(C))throw new Error("invalid attribute:"+C);this.attributeNames[C]=this.length,this[this.length++]={qName:C,value:D,offset:B}},length:0,getLocalName:function(C){return this[C].localName},getLocator:function(C){return this[C].locator},getQName:function(C){return this[C].qName},getURI:function(C){return this[C].uri},getValue:function(C){return this[C].value}};function M(C,D){var B,H=[],q=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(q.lastIndex=D,q.exec(C);B=q.exec(C);)if(H.push(B),B[1])return H}return za.XMLReader=p,za.ParseError=f,za}var dp;function DA(){if(dp)return Sn;dp=1;var r=Yo(),e=a0(),t=CA(),i=IA(),s=e.DOMImplementation,n=r.NAMESPACE,a=i.ParseError,o=i.XMLReader;function l(v){return v.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function u(v){this.options=v||{locator:{}}}u.prototype.parseFromString=function(v,E){var A=this.options,x=new o,w=A.domBuilder||new h,k=A.errorHandler,F=A.locator,L=A.xmlns||{},M=/\/x?html?$/.test(E),C=M?t.HTML_ENTITIES:t.XML_ENTITIES;F&&w.setDocumentLocator(F),x.errorHandler=c(k,w,F),x.domBuilder=A.domBuilder||w,M&&(L[""]=n.HTML),L.xml=L.xml||n.XML;var D=A.normalizeLineEndings||l;return v&&typeof v=="string"?x.parse(D(v),L,C):x.errorHandler.error("invalid doc source"),w.doc};function c(v,E,A){if(!v){if(E instanceof h)return E;v=E}var x={},w=v instanceof Function;A=A||{};function k(F){var L=v[F];!L&&w&&(L=v.length==2?function(M){v(F,M)}:v),x[F]=L&&function(M){L("[xmldom "+F+"]	"+M+p(A))}||function(){}}return k("warning"),k("error"),k("fatalError"),x}function h(){this.cdata=!1}function f(v,E){E.lineNumber=v.lineNumber,E.columnNumber=v.columnNumber}h.prototype={startDocument:function(){this.doc=new s().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(v,E,A,x){var w=this.doc,k=w.createElementNS(v,A||E),F=x.length;y(this,k),this.currentElement=k,this.locator&&f(this.locator,k);for(var L=0;L<F;L++){var v=x.getURI(L),M=x.getValue(L),A=x.getQName(L),C=w.createAttributeNS(v,A);this.locator&&f(x.getLocator(L),C),C.value=C.nodeValue=M,k.setAttributeNode(C)}},endElement:function(v,E,A){var x=this.currentElement;x.tagName,this.currentElement=x.parentNode},startPrefixMapping:function(v,E){},endPrefixMapping:function(v){},processingInstruction:function(v,E){var A=this.doc.createProcessingInstruction(v,E);this.locator&&f(this.locator,A),y(this,A)},ignorableWhitespace:function(v,E,A){},characters:function(v,E,A){if(v=m.apply(this,arguments),v){if(this.cdata)var x=this.doc.createCDATASection(v);else var x=this.doc.createTextNode(v);this.currentElement?this.currentElement.appendChild(x):/^\s*$/.test(v)&&this.doc.appendChild(x),this.locator&&f(this.locator,x)}},skippedEntity:function(v){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(v){(this.locator=v)&&(v.lineNumber=0)},comment:function(v,E,A){v=m.apply(this,arguments);var x=this.doc.createComment(v);this.locator&&f(this.locator,x),y(this,x)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(v,E,A){var x=this.doc.implementation;if(x&&x.createDocumentType){var w=x.createDocumentType(v,E,A);this.locator&&f(this.locator,w),y(this,w),this.doc.doctype=w}},warning:function(v){console.warn("[xmldom warning]	"+v,p(this.locator))},error:function(v){console.error("[xmldom error]	"+v,p(this.locator))},fatalError:function(v){throw new a(v,this.locator)}};function p(v){if(v)return`
@`+(v.systemId||"")+"#[line:"+v.lineNumber+",col:"+v.columnNumber+"]"}function m(v,E,A){return typeof v=="string"?v.substr(E,A):v.length>=E+A||E?new java.lang.String(v,E,A)+"":v}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(v){h.prototype[v]=function(){return null}});function y(v,E){v.currentElement?v.currentElement.appendChild(E):v.doc.appendChild(E)}return Sn.__DOMHandler=h,Sn.normalizeLineEndings=l,Sn.DOMParser=u,Sn}var fp;function LA(){if(fp)return vn;fp=1;var r=a0();return vn.DOMImplementation=r.DOMImplementation,vn.XMLSerializer=r.XMLSerializer,vn.DOMParser=DA().DOMParser,vn}var RA=LA();const pp=r=>!!r&&typeof r=="object",xt=(...r)=>r.reduce((e,t)=>(typeof t!="object"||Object.keys(t).forEach(i=>{Array.isArray(e[i])&&Array.isArray(t[i])?e[i]=e[i].concat(t[i]):pp(e[i])&&pp(t[i])?e[i]=xt(e[i],t[i]):e[i]=t[i]}),e),{}),o0=r=>Object.keys(r).map(e=>r[e]),wA=(r,e)=>{const t=[];for(let i=r;i<e;i++)t.push(i);return t},Br=r=>r.reduce((e,t)=>e.concat(t),[]),l0=r=>{if(!r.length)return[];const e=[];for(let t=0;t<r.length;t++)e.push(r[t]);return e},kA=(r,e)=>r.reduce((t,i,s)=>(i[e]&&t.push(s),t),[]),PA=(r,e)=>o0(r.reduce((t,i)=>(i.forEach(s=>{t[e(s)]=s}),t),{}));var Ur={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"};const jn=({baseUrl:r="",source:e="",range:t="",indexRange:i=""})=>{const s={uri:e,resolvedUri:zo(r||"",e)};if(t||i){const a=(t||i).split("-");let o=$.BigInt?$.BigInt(a[0]):parseInt(a[0],10),l=$.BigInt?$.BigInt(a[1]):parseInt(a[1],10);o<Number.MAX_SAFE_INTEGER&&typeof o=="bigint"&&(o=Number(o)),l<Number.MAX_SAFE_INTEGER&&typeof l=="bigint"&&(l=Number(l));let u;typeof l=="bigint"||typeof o=="bigint"?u=$.BigInt(l)-$.BigInt(o)+$.BigInt(1):u=l-o+1,typeof u=="bigint"&&u<Number.MAX_SAFE_INTEGER&&(u=Number(u)),s.byterange={length:u,offset:o}}return s},OA=r=>{let e;return typeof r.offset=="bigint"||typeof r.length=="bigint"?e=$.BigInt(r.offset)+$.BigInt(r.length)-$.BigInt(1):e=r.offset+r.length-1,`${r.offset}-${e}`},gp=r=>(r&&typeof r!="number"&&(r=parseInt(r,10)),isNaN(r)?null:r),MA={static(r){const{duration:e,timescale:t=1,sourceDuration:i,periodDuration:s}=r,n=gp(r.endNumber),a=e/t;return typeof n=="number"?{start:0,end:n}:typeof s=="number"?{start:0,end:s/a}:{start:0,end:i/a}},dynamic(r){const{NOW:e,clientOffset:t,availabilityStartTime:i,timescale:s=1,duration:n,periodStart:a=0,minimumUpdatePeriod:o=0,timeShiftBufferDepth:l=1/0}=r,u=gp(r.endNumber),c=(e+t)/1e3,h=i+a,p=c+o-h,m=Math.ceil(p*s/n),y=Math.floor((c-h-l)*s/n),v=Math.floor((c-h)*s/n);return{start:Math.max(0,y),end:typeof u=="number"?u:Math.min(m,v)}}},FA=r=>e=>{const{duration:t,timescale:i=1,periodStart:s,startNumber:n=1}=r;return{number:n+e,duration:t/i,timeline:s,time:e*t}},Jc=r=>{const{type:e,duration:t,timescale:i=1,periodDuration:s,sourceDuration:n}=r,{start:a,end:o}=MA[e](r),l=wA(a,o).map(FA(r));if(e==="static"){const u=l.length-1,c=typeof s=="number"?s:n;l[u].duration=c-t/i*u}return l},u0=r=>{const{baseUrl:e,initialization:t={},sourceDuration:i,indexRange:s="",periodStart:n,presentationTime:a,number:o=0,duration:l}=r;if(!e)throw new Error(Ur.NO_BASE_URL);const u=jn({baseUrl:e,source:t.sourceURL,range:t.range}),c=jn({baseUrl:e,source:e,indexRange:s});if(c.map=u,l){const h=Jc(r);h.length&&(c.duration=h[0].duration,c.timeline=h[0].timeline)}else i&&(c.duration=i,c.timeline=n);return c.presentationTime=a||n,c.number=o,[c]},Zc=(r,e,t)=>{const i=r.sidx.map?r.sidx.map:null,s=r.sidx.duration,n=r.timeline||0,a=r.sidx.byterange,o=a.offset+a.length,l=e.timescale,u=e.references.filter(v=>v.referenceType!==1),c=[],h=r.endList?"static":"dynamic",f=r.sidx.timeline;let p=f,m=r.mediaSequence||0,y;typeof e.firstOffset=="bigint"?y=$.BigInt(o)+e.firstOffset:y=o+e.firstOffset;for(let v=0;v<u.length;v++){const E=e.references[v],A=E.referencedSize,x=E.subsegmentDuration;let w;typeof y=="bigint"?w=y+$.BigInt(A)-$.BigInt(1):w=y+A-1;const k=`${y}-${w}`,L=u0({baseUrl:t,timescale:l,timeline:n,periodStart:f,presentationTime:p,number:m,duration:x,sourceDuration:s,indexRange:k,type:h})[0];i&&(L.map=i),c.push(L),typeof y=="bigint"?y+=$.BigInt(A):y+=A,p+=x/l,m++}return r.segments=c,r},NA=["AUDIO","SUBTITLES"],BA=1/60,c0=r=>PA(r,({timeline:e})=>e).sort((e,t)=>e.timeline>t.timeline?1:-1),UA=(r,e)=>{for(let t=0;t<r.length;t++)if(r[t].attributes.NAME===e)return r[t];return null},mp=r=>{let e=[];return AA(r,NA,(t,i,s,n)=>{e=e.concat(t.playlists||[])}),e},yp=({playlist:r,mediaSequence:e})=>{r.mediaSequence=e,r.segments.forEach((t,i)=>{t.number=r.mediaSequence+i})},$A=({oldPlaylists:r,newPlaylists:e,timelineStarts:t})=>{e.forEach(i=>{i.discontinuitySequence=t.findIndex(function({timeline:l}){return l===i.timeline});const s=UA(r,i.attributes.NAME);if(!s||i.sidx)return;const n=i.segments[0],a=s.segments.findIndex(function(l){return Math.abs(l.presentationTime-n.presentationTime)<BA});if(a===-1){yp({playlist:i,mediaSequence:s.mediaSequence+s.segments.length}),i.segments[0].discontinuity=!0,i.discontinuityStarts.unshift(0),(!s.segments.length&&i.timeline>s.timeline||s.segments.length&&i.timeline>s.segments[s.segments.length-1].timeline)&&i.discontinuitySequence--;return}s.segments[a].discontinuity&&!n.discontinuity&&(n.discontinuity=!0,i.discontinuityStarts.unshift(0),i.discontinuitySequence--),yp({playlist:i,mediaSequence:s.segments[a].number})})},VA=({oldManifest:r,newManifest:e})=>{const t=r.playlists.concat(mp(r)),i=e.playlists.concat(mp(e));return e.timelineStarts=c0([r.timelineStarts,e.timelineStarts]),$A({oldPlaylists:t,newPlaylists:i,timelineStarts:e.timelineStarts}),e},Xo=r=>r&&r.uri+"-"+OA(r.byterange),gu=r=>{const e=r.reduce(function(i,s){return i[s.attributes.baseUrl]||(i[s.attributes.baseUrl]=[]),i[s.attributes.baseUrl].push(s),i},{});let t=[];return Object.values(e).forEach(i=>{const s=o0(i.reduce((n,a)=>{const o=a.attributes.id+(a.attributes.lang||"");return n[o]?(a.segments&&(a.segments[0]&&(a.segments[0].discontinuity=!0),n[o].segments.push(...a.segments)),a.attributes.contentProtection&&(n[o].attributes.contentProtection=a.attributes.contentProtection)):(n[o]=a,n[o].attributes.timelineStarts=[]),n[o].attributes.timelineStarts.push({start:a.attributes.periodStart,timeline:a.attributes.periodStart}),n},{}));t=t.concat(s)}),t.map(i=>(i.discontinuityStarts=kA(i.segments||[],"discontinuity"),i))},eh=(r,e)=>{const t=Xo(r.sidx),i=t&&e[t]&&e[t].sidx;return i&&Zc(r,i,r.sidx.resolvedUri),r},GA=(r,e={})=>{if(!Object.keys(e).length)return r;for(const t in r)r[t]=eh(r[t],e);return r},HA=({attributes:r,segments:e,sidx:t,mediaSequence:i,discontinuitySequence:s,discontinuityStarts:n},a)=>{const o={attributes:{NAME:r.id,BANDWIDTH:r.bandwidth,CODECS:r.codecs,"PROGRAM-ID":1},uri:"",endList:r.type==="static",timeline:r.periodStart,resolvedUri:r.baseUrl||"",targetDuration:r.duration,discontinuitySequence:s,discontinuityStarts:n,timelineStarts:r.timelineStarts,mediaSequence:i,segments:e};return r.contentProtection&&(o.contentProtection=r.contentProtection),r.serviceLocation&&(o.attributes.serviceLocation=r.serviceLocation),t&&(o.sidx=t),a&&(o.attributes.AUDIO="audio",o.attributes.SUBTITLES="subs"),o},qA=({attributes:r,segments:e,mediaSequence:t,discontinuityStarts:i,discontinuitySequence:s})=>{typeof e>"u"&&(e=[{uri:r.baseUrl,timeline:r.periodStart,resolvedUri:r.baseUrl||"",duration:r.sourceDuration,number:0}],r.duration=r.sourceDuration);const n={NAME:r.id,BANDWIDTH:r.bandwidth,"PROGRAM-ID":1};r.codecs&&(n.CODECS=r.codecs);const a={attributes:n,uri:"",endList:r.type==="static",timeline:r.periodStart,resolvedUri:r.baseUrl||"",targetDuration:r.duration,timelineStarts:r.timelineStarts,discontinuityStarts:i,discontinuitySequence:s,mediaSequence:t,segments:e};return r.serviceLocation&&(a.attributes.serviceLocation=r.serviceLocation),a},jA=(r,e={},t=!1)=>{let i;const s=r.reduce((n,a)=>{const o=a.attributes.role&&a.attributes.role.value||"",l=a.attributes.lang||"";let u=a.attributes.label||"main";if(l&&!a.attributes.label){const h=o?` (${o})`:"";u=`${a.attributes.lang}${h}`}n[u]||(n[u]={language:l,autoselect:!0,default:o==="main",playlists:[],uri:""});const c=eh(HA(a,t),e);return n[u].playlists.push(c),typeof i>"u"&&o==="main"&&(i=a,i.default=!0),n},{});if(!i){const n=Object.keys(s)[0];s[n].default=!0}return s},KA=(r,e={})=>r.reduce((t,i)=>{const s=i.attributes.label||i.attributes.lang||"text",n=i.attributes.lang||"und";return t[s]||(t[s]={language:n,default:!1,autoselect:!1,playlists:[],uri:""}),t[s].playlists.push(eh(qA(i),e)),t},{}),WA=r=>r.reduce((e,t)=>(t&&t.forEach(i=>{const{channel:s,language:n}=i;e[n]={autoselect:!1,default:!1,instreamId:s,language:n},i.hasOwnProperty("aspectRatio")&&(e[n].aspectRatio=i.aspectRatio),i.hasOwnProperty("easyReader")&&(e[n].easyReader=i.easyReader),i.hasOwnProperty("3D")&&(e[n]["3D"]=i["3D"])}),e),{}),zA=({attributes:r,segments:e,sidx:t,discontinuityStarts:i})=>{const s={attributes:{NAME:r.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:r.width,height:r.height},CODECS:r.codecs,BANDWIDTH:r.bandwidth,"PROGRAM-ID":1},uri:"",endList:r.type==="static",timeline:r.periodStart,resolvedUri:r.baseUrl||"",targetDuration:r.duration,discontinuityStarts:i,timelineStarts:r.timelineStarts,segments:e};return r.frameRate&&(s.attributes["FRAME-RATE"]=r.frameRate),r.contentProtection&&(s.contentProtection=r.contentProtection),r.serviceLocation&&(s.attributes.serviceLocation=r.serviceLocation),t&&(s.sidx=t),s},YA=({attributes:r})=>r.mimeType==="video/mp4"||r.mimeType==="video/webm"||r.contentType==="video",XA=({attributes:r})=>r.mimeType==="audio/mp4"||r.mimeType==="audio/webm"||r.contentType==="audio",QA=({attributes:r})=>r.mimeType==="text/vtt"||r.contentType==="text",JA=(r,e)=>{r.forEach(t=>{t.mediaSequence=0,t.discontinuitySequence=e.findIndex(function({timeline:i}){return i===t.timeline}),t.segments&&t.segments.forEach((i,s)=>{i.number=s})})},Tp=r=>r?Object.keys(r).reduce((e,t)=>{const i=r[t];return e.concat(i.playlists)},[]):[],ZA=({dashPlaylists:r,locations:e,contentSteering:t,sidxMapping:i={},previousManifest:s,eventStream:n})=>{if(!r.length)return{};const{sourceDuration:a,type:o,suggestedPresentationDelay:l,minimumUpdatePeriod:u}=r[0].attributes,c=gu(r.filter(YA)).map(zA),h=gu(r.filter(XA)),f=gu(r.filter(QA)),p=r.map(w=>w.attributes.captionServices).filter(Boolean),m={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:"",duration:a,playlists:GA(c,i)};u>=0&&(m.minimumUpdatePeriod=u*1e3),e&&(m.locations=e),t&&(m.contentSteering=t),o==="dynamic"&&(m.suggestedPresentationDelay=l),n&&n.length>0&&(m.eventStream=n);const y=m.playlists.length===0,v=h.length?jA(h,i,y):null,E=f.length?KA(f,i):null,A=c.concat(Tp(v),Tp(E)),x=A.map(({timelineStarts:w})=>w);return m.timelineStarts=c0(x),JA(A,m.timelineStarts),v&&(m.mediaGroups.AUDIO.audio=v),E&&(m.mediaGroups.SUBTITLES.subs=E),p.length&&(m.mediaGroups["CLOSED-CAPTIONS"].cc=WA(p)),s?VA({oldManifest:s,newManifest:m}):m},eC=(r,e,t)=>{const{NOW:i,clientOffset:s,availabilityStartTime:n,timescale:a=1,periodStart:o=0,minimumUpdatePeriod:l=0}=r,u=(i+s)/1e3,c=n+o,f=u+l-c;return Math.ceil((f*a-e)/t)},h0=(r,e)=>{const{type:t,minimumUpdatePeriod:i=0,media:s="",sourceDuration:n,timescale:a=1,startNumber:o=1,periodStart:l}=r,u=[];let c=-1;for(let h=0;h<e.length;h++){const f=e[h],p=f.d,m=f.r||0,y=f.t||0;c<0&&(c=y),y&&y>c&&(c=y);let v;if(m<0){const x=h+1;x===e.length?t==="dynamic"&&i>0&&s.indexOf("$Number$")>0?v=eC(r,c,p):v=(n*a-c)/p:v=(e[x].t-c)/p}else v=m+1;const E=o+u.length+v;let A=o+u.length;for(;A<E;)u.push({number:A,duration:p/a,time:c,timeline:l}),c+=p,A++}return u},tC=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,iC=r=>(e,t,i,s)=>{if(e==="$$")return"$";if(typeof r[t]>"u")return e;const n=""+r[t];return t==="RepresentationID"||(i?s=parseInt(s,10):s=1,n.length>=s)?n:`${new Array(s-n.length+1).join("0")}${n}`},_p=(r,e)=>r.replace(tC,iC(e)),sC=(r,e)=>!r.duration&&!e?[{number:r.startNumber||1,duration:r.sourceDuration,time:0,timeline:r.periodStart}]:r.duration?Jc(r):h0(r,e),rC=(r,e)=>{const t={RepresentationID:r.id,Bandwidth:r.bandwidth||0},{initialization:i={sourceURL:"",range:""}}=r,s=jn({baseUrl:r.baseUrl,source:_p(i.sourceURL,t),range:i.range});return sC(r,e).map(a=>{t.Number=a.number,t.Time=a.time;const o=_p(r.media||"",t),l=r.timescale||1,u=r.presentationTimeOffset||0,c=r.periodStart+(a.time-u)/l;return{uri:o,timeline:a.timeline,duration:a.duration,resolvedUri:zo(r.baseUrl||"",o),map:s,number:a.number,presentationTime:c}})},nC=(r,e)=>{const{baseUrl:t,initialization:i={}}=r,s=jn({baseUrl:t,source:i.sourceURL,range:i.range}),n=jn({baseUrl:t,source:e.media,range:e.mediaRange});return n.map=s,n},aC=(r,e)=>{const{duration:t,segmentUrls:i=[],periodStart:s}=r;if(!t&&!e||t&&e)throw new Error(Ur.SEGMENT_TIME_UNSPECIFIED);const n=i.map(l=>nC(r,l));let a;return t&&(a=Jc(r)),e&&(a=h0(r,e)),a.map((l,u)=>{if(n[u]){const c=n[u],h=r.timescale||1,f=r.presentationTimeOffset||0;return c.timeline=l.timeline,c.duration=l.duration,c.number=l.number,c.presentationTime=s+(l.time-f)/h,c}}).filter(l=>l)},oC=({attributes:r,segmentInfo:e})=>{let t,i;e.template?(i=rC,t=xt(r,e.template)):e.base?(i=u0,t=xt(r,e.base)):e.list&&(i=aC,t=xt(r,e.list));const s={attributes:r};if(!i)return s;const n=i(t,e.segmentTimeline);if(t.duration){const{duration:a,timescale:o=1}=t;t.duration=a/o}else n.length?t.duration=n.reduce((a,o)=>Math.max(a,Math.ceil(o.duration)),0):t.duration=0;return s.attributes=t,s.segments=n,e.base&&t.indexRange&&(s.sidx=n[0],s.segments=[]),s},lC=r=>r.map(oC),st=(r,e)=>l0(r.childNodes).filter(({tagName:t})=>t===e),Qn=r=>r.textContent.trim(),uC=r=>parseFloat(r.split("/").reduce((e,t)=>e/t)),fr=r=>{const o=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(r);if(!o)return 0;const[l,u,c,h,f,p]=o.slice(1);return parseFloat(l||0)*31536e3+parseFloat(u||0)*2592e3+parseFloat(c||0)*86400+parseFloat(h||0)*3600+parseFloat(f||0)*60+parseFloat(p||0)},cC=r=>(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(r)&&(r+="Z"),Date.parse(r)),vp={mediaPresentationDuration(r){return fr(r)},availabilityStartTime(r){return cC(r)/1e3},minimumUpdatePeriod(r){return fr(r)},suggestedPresentationDelay(r){return fr(r)},type(r){return r},timeShiftBufferDepth(r){return fr(r)},start(r){return fr(r)},width(r){return parseInt(r,10)},height(r){return parseInt(r,10)},bandwidth(r){return parseInt(r,10)},frameRate(r){return uC(r)},startNumber(r){return parseInt(r,10)},timescale(r){return parseInt(r,10)},presentationTimeOffset(r){return parseInt(r,10)},duration(r){const e=parseInt(r,10);return isNaN(e)?fr(r):e},d(r){return parseInt(r,10)},t(r){return parseInt(r,10)},r(r){return parseInt(r,10)},presentationTime(r){return parseInt(r,10)},DEFAULT(r){return r}},Tt=r=>r&&r.attributes?l0(r.attributes).reduce((e,t)=>{const i=vp[t.name]||vp.DEFAULT;return e[t.name]=i(t.value),e},{}):{},hC={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime","urn:mpeg:dash:mp4protection:2011":"mp4protection"},Qo=(r,e)=>e.length?Br(r.map(function(t){return e.map(function(i){const s=Qn(i),n=zo(t.baseUrl,s),a=xt(Tt(i),{baseUrl:n});return n!==s&&!a.serviceLocation&&t.serviceLocation&&(a.serviceLocation=t.serviceLocation),a})})):r,th=r=>{const e=st(r,"SegmentTemplate")[0],t=st(r,"SegmentList")[0],i=t&&st(t,"SegmentURL").map(h=>xt({tag:"SegmentURL"},Tt(h))),s=st(r,"SegmentBase")[0],n=t||e,a=n&&st(n,"SegmentTimeline")[0],o=t||s||e,l=o&&st(o,"Initialization")[0],u=e&&Tt(e);u&&l?u.initialization=l&&Tt(l):u&&u.initialization&&(u.initialization={sourceURL:u.initialization});const c={template:u,segmentTimeline:a&&st(a,"S").map(h=>Tt(h)),list:t&&xt(Tt(t),{segmentUrls:i,initialization:Tt(l)}),base:s&&xt(Tt(s),{initialization:Tt(l)})};return Object.keys(c).forEach(h=>{c[h]||delete c[h]}),c},dC=(r,e,t)=>i=>{const s=st(i,"BaseURL"),n=Qo(e,s),a=xt(r,Tt(i)),o=th(i);return n.map(l=>({segmentInfo:xt(t,o),attributes:xt(a,l)}))},fC=r=>r.reduce((e,t)=>{const i=Tt(t);i.schemeIdUri&&(i.schemeIdUri=i.schemeIdUri.toLowerCase());const s=hC[i.schemeIdUri];if(s){e[s]={attributes:i};const n=st(t,"cenc:pssh")[0];if(n){const a=Qn(n);e[s].pssh=a&&e0(a)}}return e},{}),pC=r=>{if(r.schemeIdUri==="urn:scte:dash:cc:cea-608:2015")return(typeof r.value!="string"?[]:r.value.split(";")).map(t=>{let i,s;return s=t,/^CC\d=/.test(t)?[i,s]=t.split("="):/^CC\d$/.test(t)&&(i=t),{channel:i,language:s}});if(r.schemeIdUri==="urn:scte:dash:cc:cea-708:2015")return(typeof r.value!="string"?[]:r.value.split(";")).map(t=>{const i={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(t)){const[s,n=""]=t.split("=");i.channel=s,i.language=t,n.split(",").forEach(a=>{const[o,l]=a.split(":");o==="lang"?i.language=l:o==="er"?i.easyReader=Number(l):o==="war"?i.aspectRatio=Number(l):o==="3D"&&(i["3D"]=Number(l))})}else i.language=t;return i.channel&&(i.channel="SERVICE"+i.channel),i})},gC=r=>Br(st(r.node,"EventStream").map(e=>{const t=Tt(e),i=t.schemeIdUri;return st(e,"Event").map(s=>{const n=Tt(s),a=n.presentationTime||0,o=t.timescale||1,l=n.duration||0,u=a/o+r.attributes.start;return{schemeIdUri:i,value:t.value,id:n.id,start:u,end:u+l/o,messageData:Qn(s)||n.messageData,contentEncoding:t.contentEncoding,presentationTimeOffset:t.presentationTimeOffset||0}})})),mC=(r,e,t)=>i=>{const s=Tt(i),n=Qo(e,st(i,"BaseURL")),a=st(i,"Role")[0],o={role:Tt(a)};let l=xt(r,s,o);const u=st(i,"Accessibility")[0],c=pC(Tt(u));c&&(l=xt(l,{captionServices:c}));const h=st(i,"Label")[0];if(h&&h.childNodes.length){const v=h.childNodes[0].nodeValue.trim();l=xt(l,{label:v})}const f=fC(st(i,"ContentProtection"));Object.keys(f).length&&(l=xt(l,{contentProtection:f}));const p=th(i),m=st(i,"Representation"),y=xt(t,p);return Br(m.map(dC(l,n,y)))},yC=(r,e)=>(t,i)=>{const s=Qo(e,st(t.node,"BaseURL")),n=xt(r,{periodStart:t.attributes.start});typeof t.attributes.duration=="number"&&(n.periodDuration=t.attributes.duration);const a=st(t.node,"AdaptationSet"),o=th(t.node);return Br(a.map(mC(n,s,o)))},TC=(r,e)=>{if(r.length>1&&e({type:"warn",message:"The MPD manifest should contain no more than one ContentSteering tag"}),!r.length)return null;const t=xt({serverURL:Qn(r[0])},Tt(r[0]));return t.queryBeforeStart=t.queryBeforeStart==="true",t},_C=({attributes:r,priorPeriodAttributes:e,mpdType:t})=>typeof r.start=="number"?r.start:e&&typeof e.start=="number"&&typeof e.duration=="number"?e.start+e.duration:!e&&t==="static"?0:null,vC=(r,e={})=>{const{manifestUri:t="",NOW:i=Date.now(),clientOffset:s=0,eventHandler:n=function(){}}=e,a=st(r,"Period");if(!a.length)throw new Error(Ur.INVALID_NUMBER_OF_PERIOD);const o=st(r,"Location"),l=Tt(r),u=Qo([{baseUrl:t}],st(r,"BaseURL")),c=st(r,"ContentSteering");l.type=l.type||"static",l.sourceDuration=l.mediaPresentationDuration||0,l.NOW=i,l.clientOffset=s,o.length&&(l.locations=o.map(Qn));const h=[];return a.forEach((f,p)=>{const m=Tt(f),y=h[p-1];m.start=_C({attributes:m,priorPeriodAttributes:y?y.attributes:null,mpdType:l.type}),h.push({node:f,attributes:m})}),{locations:l.locations,contentSteeringInfo:TC(c,n),representationInfo:Br(h.map(yC(l,u))),eventStream:Br(h.map(gC))}},d0=r=>{if(r==="")throw new Error(Ur.DASH_EMPTY_MANIFEST);const e=new RA.DOMParser;let t,i;try{t=e.parseFromString(r,"application/xml"),i=t&&t.documentElement.tagName==="MPD"?t.documentElement:null}catch{}if(!i||i&&i.getElementsByTagName("parsererror").length>0)throw new Error(Ur.DASH_INVALID_XML);return i},SC=r=>{const e=st(r,"UTCTiming")[0];if(!e)return null;const t=Tt(e);switch(t.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":t.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":t.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":t.method="DIRECT",t.value=Date.parse(t.value);break;default:throw new Error(Ur.UNSUPPORTED_UTC_TIMING_SCHEME)}return t},EC=(r,e={})=>{const t=vC(d0(r),e),i=lC(t.representationInfo);return ZA({dashPlaylists:i,locations:t.locations,contentSteering:t.contentSteeringInfo,sidxMapping:e.sidxMapping,previousManifest:e.previousManifest,eventStream:t.eventStream})},bC=r=>SC(d0(r));var mu,Sp;function xC(){if(Sp)return mu;Sp=1;var r=Math.pow(2,32),e=function(t){var i=new DataView(t.buffer,t.byteOffset,t.byteLength),s;return i.getBigUint64?(s=i.getBigUint64(0),s<Number.MAX_SAFE_INTEGER?Number(s):s):i.getUint32(0)*r+i.getUint32(4)};return mu={getUint64:e,MAX_UINT32:r},mu}var yu,Ep;function AC(){if(Ep)return yu;Ep=1;var r=xC().getUint64,e=function(t){var i=new DataView(t.buffer,t.byteOffset,t.byteLength),s={version:t[0],flags:new Uint8Array(t.subarray(1,4)),references:[],referenceId:i.getUint32(4),timescale:i.getUint32(8)},n=12;s.version===0?(s.earliestPresentationTime=i.getUint32(n),s.firstOffset=i.getUint32(n+4),n+=8):(s.earliestPresentationTime=r(t.subarray(n)),s.firstOffset=r(t.subarray(n+8)),n+=16),n+=2;var a=i.getUint16(n);for(n+=2;a>0;n+=12,a--)s.references.push({referenceType:(t[n]&128)>>>7,referencedSize:i.getUint32(n)&2147483647,subsegmentDuration:i.getUint32(n+4),startsWithSap:!!(t[n+8]&128),sapType:(t[n+8]&112)>>>4,sapDeltaTime:i.getUint32(n+8)&268435455});return s};return yu=e,yu}var CC=AC();const IC=Xn(CC);var DC=Se([73,68,51]),LC=function(e,t){t===void 0&&(t=0),e=Se(e);var i=e[t+5],s=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],n=(i&16)>>4;return n?s+20:s+10},Cn=function r(e,t){return t===void 0&&(t=0),e=Se(e),e.length-t<10||!it(e,DC,{offset:t})?t:(t+=LC(e,t),r(e,t))},bp=function(e){return typeof e=="string"?n0(e):e},RC=function(e){return Array.isArray(e)?e.map(function(t){return bp(t)}):[bp(e)]},wC=function r(e,t,i){i===void 0&&(i=!1),t=RC(t),e=Se(e);var s=[];if(!t.length)return s;for(var n=0;n<e.length;){var a=(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3])>>>0,o=e.subarray(n+4,n+8);if(a===0)break;var l=n+a;if(l>e.length){if(i)break;l=e.length}var u=e.subarray(n+8,l);it(o,t[0])&&(t.length===1?s.push(u):s.push.apply(s,r(u,t.slice(1),i))),n=l}return s},Ya={EBML:Se([26,69,223,163]),DocType:Se([66,130]),Segment:Se([24,83,128,103]),SegmentInfo:Se([21,73,169,102]),Tracks:Se([22,84,174,107]),Track:Se([174]),TrackNumber:Se([215]),DefaultDuration:Se([35,227,131]),TrackEntry:Se([174]),TrackType:Se([131]),FlagDefault:Se([136]),CodecID:Se([134]),CodecPrivate:Se([99,162]),VideoTrack:Se([224]),AudioTrack:Se([225]),Cluster:Se([31,67,182,117]),Timestamp:Se([231]),TimestampScale:Se([42,215,177]),BlockGroup:Se([160]),BlockDuration:Se([155]),Block:Se([161]),SimpleBlock:Se([163])},tc=[128,64,32,16,8,4,2,1],kC=function(e){for(var t=1,i=0;i<tc.length&&!(e&tc[i]);i++)t++;return t},xo=function(e,t,i,s){i===void 0&&(i=!0),s===void 0&&(s=!1);var n=kC(e[t]),a=e.subarray(t,t+n);return i&&(a=Array.prototype.slice.call(e,t,t+n),a[0]^=tc[n-1]),{length:n,value:EA(a,{signed:s}),bytes:a}},xp=function r(e){return typeof e=="string"?e.match(/.{1,2}/g).map(function(t){return r(t)}):typeof e=="number"?bA(e):e},PC=function(e){return Array.isArray(e)?e.map(function(t){return xp(t)}):[xp(e)]},OC=function r(e,t,i){if(i>=t.length)return t.length;var s=xo(t,i,!1);if(it(e.bytes,s.bytes))return i;var n=xo(t,i+s.length);return r(e,t,i+n.length+n.value+s.length)},Ap=function r(e,t){t=PC(t),e=Se(e);var i=[];if(!t.length)return i;for(var s=0;s<e.length;){var n=xo(e,s,!1),a=xo(e,s+n.length),o=s+n.length+a.length;a.value===127&&(a.value=OC(n,e,o),a.value!==e.length&&(a.value-=o));var l=o+a.value>e.length?e.length:o+a.value,u=e.subarray(o,l);it(t[0],n.bytes)&&(t.length===1?i.push(u):i=i.concat(r(u,t.slice(1))));var c=n.length+a.length+u.length;s+=c}return i},MC=Se([0,0,0,1]),FC=Se([0,0,1]),NC=Se([0,0,3]),BC=function(e){for(var t=[],i=1;i<e.length-2;)it(e.subarray(i,i+3),NC)&&(t.push(i+2),i++),i++;if(t.length===0)return e;var s=e.length-t.length,n=new Uint8Array(s),a=0;for(i=0;i<s;a++,i++)a===t[0]&&(a++,t.shift()),n[i]=e[a];return n},f0=function(e,t,i,s){e=Se(e),i=[].concat(i);for(var n=0,a,o=0;n<e.length&&(o<s||a);){var l=void 0;if(it(e.subarray(n),MC)?l=4:it(e.subarray(n),FC)&&(l=3),!l){n++;continue}if(o++,a)return BC(e.subarray(a,n));var u=void 0;t==="h264"?u=e[n+l]&31:t==="h265"&&(u=e[n+l]>>1&63),i.indexOf(u)!==-1&&(a=n+l),n+=l+(t==="h264"?1:2)}return e.subarray(0,0)},UC=function(e,t,i){return f0(e,"h264",t,i)},$C=function(e,t,i){return f0(e,"h265",t,i)},Nt={webm:Se([119,101,98,109]),matroska:Se([109,97,116,114,111,115,107,97]),flac:Se([102,76,97,67]),ogg:Se([79,103,103,83]),ac3:Se([11,119]),riff:Se([82,73,70,70]),avi:Se([65,86,73]),wav:Se([87,65,86,69]),"3gp":Se([102,116,121,112,51,103]),mp4:Se([102,116,121,112]),fmp4:Se([115,116,121,112]),mov:Se([102,116,121,112,113,116]),moov:Se([109,111,111,118]),moof:Se([109,111,111,102])},$r={aac:function(e){var t=Cn(e);return it(e,[255,16],{offset:t,mask:[255,22]})},mp3:function(e){var t=Cn(e);return it(e,[255,2],{offset:t,mask:[255,6]})},webm:function(e){var t=Ap(e,[Ya.EBML,Ya.DocType])[0];return it(t,Nt.webm)},mkv:function(e){var t=Ap(e,[Ya.EBML,Ya.DocType])[0];return it(t,Nt.matroska)},mp4:function(e){if($r["3gp"](e)||$r.mov(e))return!1;if(it(e,Nt.mp4,{offset:4})||it(e,Nt.fmp4,{offset:4})||it(e,Nt.moof,{offset:4})||it(e,Nt.moov,{offset:4}))return!0},mov:function(e){return it(e,Nt.mov,{offset:4})},"3gp":function(e){return it(e,Nt["3gp"],{offset:4})},ac3:function(e){var t=Cn(e);return it(e,Nt.ac3,{offset:t})},ts:function(e){if(e.length<189&&e.length>=1)return e[0]===71;for(var t=0;t+188<e.length&&t<188;){if(e[t]===71&&e[t+188]===71)return!0;t+=1}return!1},flac:function(e){var t=Cn(e);return it(e,Nt.flac,{offset:t})},ogg:function(e){return it(e,Nt.ogg)},avi:function(e){return it(e,Nt.riff)&&it(e,Nt.avi,{offset:8})},wav:function(e){return it(e,Nt.riff)&&it(e,Nt.wav,{offset:8})},h264:function(e){return UC(e,7,3).length},h265:function(e){return $C(e,[32,33],3).length}},ic=Object.keys($r).filter(function(r){return r!=="ts"&&r!=="h264"&&r!=="h265"}).concat(["ts","h264","h265"]);ic.forEach(function(r){var e=$r[r];$r[r]=function(t){return e(Se(t))}});var VC=$r,ih=function(e){e=Se(e);for(var t=0;t<ic.length;t++){var i=ic[t];if(VC[i](e))return i}return""},GC=function(e){return wC(e,["moof"]).length>0},Tu,Cp;function HC(){if(Cp)return Tu;Cp=1;var r=9e4,e,t,i,s,n,a,o;return e=function(l){return l*r},t=function(l,u){return l*u},i=function(l){return l/r},s=function(l,u){return l/u},n=function(l,u){return e(s(l,u))},a=function(l,u){return t(i(l),u)},o=function(l,u,c){return i(c?l:l-u)},Tu={ONE_SECOND_IN_TS:r,secondsToVideoTs:e,secondsToAudioTs:t,videoTsToSeconds:i,audioTsToSeconds:s,audioTsToVideoTs:n,videoTsToAudioTs:a,metadataTsToSeconds:o},Tu}var Ws=HC();var sc="8.23.7";const us={},ws=function(r,e){return us[r]=us[r]||[],e&&(us[r]=us[r].concat(e)),us[r]},qC=function(r,e){ws(r,e)},p0=function(r,e){const t=ws(r).indexOf(e);return t<=-1?!1:(us[r]=us[r].slice(),us[r].splice(t,1),!0)},jC=function(r,e){ws(r,[].concat(e).map(t=>{const i=(...s)=>(p0(r,i),t(...s));return i}))},Ao={prefixed:!0},lo=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"]],Ip=lo[0];let In;for(let r=0;r<lo.length;r++)if(lo[r][1]in ue){In=lo[r];break}if(In){for(let r=0;r<In.length;r++)Ao[Ip[r]]=In[r];Ao.prefixed=In[0]!==Ip[0]}let Ht=[];const KC=(r,e,t)=>(i,s,n)=>{const a=e.levels[s],o=new RegExp(`^(${a})$`);let l=r;if(i!=="log"&&n.unshift(i.toUpperCase()+":"),t&&(l=`%c${r}`,n.unshift(t)),n.unshift(l+":"),Ht){Ht.push([].concat(n));const c=Ht.length-1e3;Ht.splice(0,c>0?c:0)}if(!$.console)return;let u=$.console[i];!u&&i==="debug"&&(u=$.console.info||$.console.log),!(!u||!a||!o.test(i))&&u[Array.isArray(n)?"apply":"call"]($.console,n)};function rc(r,e=":",t=""){let i="info",s;function n(...a){s("log",i,a)}return s=KC(r,n,t),n.createLogger=(a,o,l)=>{const u=o!==void 0?o:e,c=l!==void 0?l:t,h=`${r} ${u} ${a}`;return rc(h,u,c)},n.createNewLogger=(a,o,l)=>rc(a,o,l),n.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:i},n.level=a=>{if(typeof a=="string"){if(!n.levels.hasOwnProperty(a))throw new Error(`"${a}" in not a valid log level`);i=a}return i},n.history=()=>Ht?[].concat(Ht):[],n.history.filter=a=>(Ht||[]).filter(o=>new RegExp(`.*${a}.*`).test(o[0])),n.history.clear=()=>{Ht&&(Ht.length=0)},n.history.disable=()=>{Ht!==null&&(Ht.length=0,Ht=null)},n.history.enable=()=>{Ht===null&&(Ht=[])},n.error=(...a)=>s("error",i,a),n.warn=(...a)=>s("warn",i,a),n.debug=(...a)=>s("debug",i,a),n}const Re=rc("VIDEOJS"),g0=Re.createLogger,WC=Object.prototype.toString,m0=function(r){return Xi(r)?Object.keys(r):[]};function Cr(r,e){m0(r).forEach(t=>e(r[t],t))}function y0(r,e,t=0){return m0(r).reduce((i,s)=>e(i,r[s],s),t)}function Xi(r){return!!r&&typeof r=="object"}function Vr(r){return Xi(r)&&WC.call(r)==="[object Object]"&&r.constructor===Object}function je(...r){const e={};return r.forEach(t=>{t&&Cr(t,(i,s)=>{if(!Vr(i)){e[s]=i;return}Vr(e[s])||(e[s]={}),e[s]=je(e[s],i)})}),e}function T0(r={}){const e=[];for(const t in r)if(r.hasOwnProperty(t)){const i=r[t];e.push(i)}return e}function Jo(r,e,t,i=!0){const s=a=>Object.defineProperty(r,e,{value:a,enumerable:!0,writable:!0}),n={configurable:!0,enumerable:!0,get(){const a=t();return s(a),a}};return i&&(n.set=s),Object.defineProperty(r,e,n)}var zC=Object.freeze({__proto__:null,each:Cr,reduce:y0,isObject:Xi,isPlain:Vr,merge:je,values:T0,defineLazyProperty:Jo});let sh=!1,_0=null,Di=!1,v0,S0=!1,Ir=!1,Dr=!1,Qi=!1,rh=null,Zo=null;const YC=!!($.cast&&$.cast.framework&&$.cast.framework.CastReceiverContext);let E0=null,Co=!1,el=!1,Io=!1,tl=!1,Do=!1,Lo=!1,Ro=!1;const Kn=!!(Kr()&&("ontouchstart"in $||$.navigator.maxTouchPoints||$.DocumentTouch&&$.document instanceof $.DocumentTouch)),Es=$.navigator&&$.navigator.userAgentData;Es&&Es.platform&&Es.brands&&(Di=Es.platform==="Android",Ir=!!Es.brands.find(r=>r.brand==="Microsoft Edge"),Dr=!!Es.brands.find(r=>r.brand==="Chromium"),Qi=!Ir&&Dr,rh=Zo=(Es.brands.find(r=>r.brand==="Chromium")||{}).version||null,el=Es.platform==="Windows");if(!Dr){const r=$.navigator&&$.navigator.userAgent||"";sh=/iPod/i.test(r),_0=(function(){const e=r.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null})(),Di=/Android/i.test(r),v0=(function(){const e=r.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const t=e[1]&&parseFloat(e[1]),i=e[2]&&parseFloat(e[2]);return t&&i?parseFloat(e[1]+"."+e[2]):t||null})(),S0=/Firefox/i.test(r),Ir=/Edg/i.test(r),Dr=/Chrome/i.test(r)||/CriOS/i.test(r),Qi=!Ir&&Dr,rh=Zo=(function(){const e=r.match(/(Chrome|CriOS)\/(\d+)/);return e&&e[2]?parseFloat(e[2]):null})(),E0=(function(){const e=/MSIE\s(\d+)\.\d/.exec(r);let t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(r)&&/rv:11.0/.test(r)&&(t=11),t})(),Do=/Tizen/i.test(r),Lo=/Web0S/i.test(r),Ro=Do||Lo,Co=/Safari/i.test(r)&&!Qi&&!Di&&!Ir&&!Ro,el=/Windows/i.test(r),Io=/iPad/i.test(r)||Co&&Kn&&!/iPhone/i.test(r),tl=/iPhone/i.test(r)&&!Io}const kt=tl||Io||sh,il=(Co||kt)&&!Qi;var b0=Object.freeze({__proto__:null,get IS_IPOD(){return sh},get IOS_VERSION(){return _0},get IS_ANDROID(){return Di},get ANDROID_VERSION(){return v0},get IS_FIREFOX(){return S0},get IS_EDGE(){return Ir},get IS_CHROMIUM(){return Dr},get IS_CHROME(){return Qi},get CHROMIUM_VERSION(){return rh},get CHROME_VERSION(){return Zo},IS_CHROMECAST_RECEIVER:YC,get IE_VERSION(){return E0},get IS_SAFARI(){return Co},get IS_WINDOWS(){return el},get IS_IPAD(){return Io},get IS_IPHONE(){return tl},get IS_TIZEN(){return Do},get IS_WEBOS(){return Lo},get IS_SMART_TV(){return Ro},TOUCH_ENABLED:Kn,IS_IOS:kt,IS_ANY_SAFARI:il});function Dp(r){return typeof r=="string"&&!!r.trim()}function XC(r){if(r.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function Kr(){return ue===$.document}function Wr(r){return Xi(r)&&r.nodeType===1}function x0(){try{return $.parent!==$.self}catch{return!0}}function A0(r){return function(e,t){if(!Dp(e))return ue[r](null);Dp(t)&&(t=ue.querySelector(t));const i=Wr(t)?t:ue;return i[r]&&i[r](e)}}function xe(r="div",e={},t={},i){const s=ue.createElement(r);return Object.getOwnPropertyNames(e).forEach(function(n){const a=e[n];n==="textContent"?Ps(s,a):(s[n]!==a||n==="tabIndex")&&(s[n]=a)}),Object.getOwnPropertyNames(t).forEach(function(n){s.setAttribute(n,t[n])}),i&&nh(s,i),s}function Ps(r,e){return typeof r.textContent>"u"?r.innerText=e:r.textContent=e,r}function nc(r,e){e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r)}function Pn(r,e){return XC(e),r.classList.contains(e)}function Qs(r,...e){return r.classList.add(...e.reduce((t,i)=>t.concat(i.split(/\s+/)),[])),r}function sl(r,...e){return r?(r.classList.remove(...e.reduce((t,i)=>t.concat(i.split(/\s+/)),[])),r):(Re.warn("removeClass was called with an element that doesn't exist"),null)}function C0(r,e,t){return typeof t=="function"&&(t=t(r,e)),typeof t!="boolean"&&(t=void 0),e.split(/\s+/).forEach(i=>r.classList.toggle(i,t)),r}function I0(r,e){Object.getOwnPropertyNames(e).forEach(function(t){const i=e[t];i===null||typeof i>"u"||i===!1?r.removeAttribute(t):r.setAttribute(t,i===!0?"":i)})}function Cs(r){const e={},t=["autoplay","controls","playsinline","loop","muted","default","defaultMuted"];if(r&&r.attributes&&r.attributes.length>0){const i=r.attributes;for(let s=i.length-1;s>=0;s--){const n=i[s].name;let a=i[s].value;t.includes(n)&&(a=a!==null),e[n]=a}}return e}function D0(r,e){return r.getAttribute(e)}function Gr(r,e,t){r.setAttribute(e,t)}function rl(r,e){r.removeAttribute(e)}function L0(){ue.body.focus(),ue.onselectstart=function(){return!1}}function R0(){ue.onselectstart=function(){return!0}}function Hr(r){if(r&&r.getBoundingClientRect&&r.parentNode){const e=r.getBoundingClientRect(),t={};return["bottom","height","left","right","top","width"].forEach(i=>{e[i]!==void 0&&(t[i]=e[i])}),t.height||(t.height=parseFloat(qr(r,"height"))),t.width||(t.width=parseFloat(qr(r,"width"))),t}}function Wn(r){if(!r||r&&!r.offsetParent)return{left:0,top:0,width:0,height:0};const e=r.offsetWidth,t=r.offsetHeight;let i=0,s=0;for(;r.offsetParent&&r!==ue[Ao.fullscreenElement];)i+=r.offsetLeft,s+=r.offsetTop,r=r.offsetParent;return{left:i,top:s,width:e,height:t}}function nl(r,e){const t={x:0,y:0};if(kt){let c=r;for(;c&&c.nodeName.toLowerCase()!=="html";){const h=qr(c,"transform");if(/^matrix/.test(h)){const f=h.slice(7,-1).split(/,\s/).map(Number);t.x+=f[4],t.y+=f[5]}else if(/^matrix3d/.test(h)){const f=h.slice(9,-1).split(/,\s/).map(Number);t.x+=f[12],t.y+=f[13]}if(c.assignedSlot&&c.assignedSlot.parentElement&&$.WebKitCSSMatrix){const f=$.getComputedStyle(c.assignedSlot.parentElement).transform,p=new $.WebKitCSSMatrix(f);t.x+=p.m41,t.y+=p.m42}c=c.parentNode||c.host}}const i={},s=Wn(e.target),n=Wn(r),a=n.width,o=n.height;let l=e.offsetY-(n.top-s.top),u=e.offsetX-(n.left-s.left);return e.changedTouches&&(u=e.changedTouches[0].pageX-n.left,l=e.changedTouches[0].pageY+n.top,kt&&(u-=t.x,l-=t.y)),i.y=1-Math.max(0,Math.min(1,l/o)),i.x=Math.max(0,Math.min(1,u/a)),i}function w0(r){return Xi(r)&&r.nodeType===3}function al(r){for(;r.firstChild;)r.removeChild(r.firstChild);return r}function k0(r){return typeof r=="function"&&(r=r()),(Array.isArray(r)?r:[r]).map(e=>{if(typeof e=="function"&&(e=e()),Wr(e)||w0(e))return e;if(typeof e=="string"&&/\S/.test(e))return ue.createTextNode(e)}).filter(e=>e)}function nh(r,e){return k0(e).forEach(t=>r.appendChild(t)),r}function P0(r,e){return nh(al(r),e)}function zn(r){return r.button===void 0&&r.buttons===void 0||r.button===0&&r.buttons===void 0||r.type==="mouseup"&&r.button===0&&r.buttons===0||r.type==="mousedown"&&r.button===0&&r.buttons===0?!0:!(r.button!==0||r.buttons!==1)}const ks=A0("querySelector"),O0=A0("querySelectorAll");function qr(r,e){if(!r||!e)return"";if(typeof $.getComputedStyle=="function"){let t;try{t=$.getComputedStyle(r)}catch{return""}return t?t.getPropertyValue(e)||t[e]:""}return""}function M0(r){[...ue.styleSheets].forEach(e=>{try{const t=[...e.cssRules].map(s=>s.cssText).join(""),i=ue.createElement("style");i.textContent=t,r.document.head.appendChild(i)}catch{const i=ue.createElement("link");i.rel="stylesheet",i.type=e.type,i.media=e.media.mediaText,i.href=e.href,r.document.head.appendChild(i)}})}var F0=Object.freeze({__proto__:null,isReal:Kr,isEl:Wr,isInFrame:x0,createEl:xe,textContent:Ps,prependTo:nc,hasClass:Pn,addClass:Qs,removeClass:sl,toggleClass:C0,setAttributes:I0,getAttributes:Cs,getAttribute:D0,setAttribute:Gr,removeAttribute:rl,blockTextSelection:L0,unblockTextSelection:R0,getBoundingClientRect:Hr,findPosition:Wn,getPointerPosition:nl,isTextNode:w0,emptyEl:al,normalizeContent:k0,appendContent:nh,insertContent:P0,isSingleLeftClick:zn,$:ks,$$:O0,computedStyle:qr,copyStyleSheetsToWindow:M0});let N0=!1,ac;const QC=function(){if(ac.options.autoSetup===!1)return;const r=Array.prototype.slice.call(ue.getElementsByTagName("video")),e=Array.prototype.slice.call(ue.getElementsByTagName("audio")),t=Array.prototype.slice.call(ue.getElementsByTagName("video-js")),i=r.concat(e,t);if(i&&i.length>0)for(let s=0,n=i.length;s<n;s++){const a=i[s];if(a&&a.getAttribute)a.player===void 0&&a.getAttribute("data-setup")!==null&&ac(a);else{oc(1);break}}else N0||oc(1)};function oc(r,e){Kr()&&(e&&(ac=e),$.setTimeout(QC,r))}function lc(){N0=!0,$.removeEventListener("load",lc)}Kr()&&(ue.readyState==="complete"?lc():$.addEventListener("load",lc));const B0=function(r){const e=ue.createElement("style");return e.className=r,e},U0=function(r,e){r.styleSheet?r.styleSheet.cssText=e:r.textContent=e};var Ut=new WeakMap;const JC=3;let ZC=JC;function gi(){return ZC++}function Lp(r,e){if(!Ut.has(r))return;const t=Ut.get(r);t.handlers[e].length===0&&(delete t.handlers[e],r.removeEventListener?r.removeEventListener(e,t.dispatcher,!1):r.detachEvent&&r.detachEvent("on"+e,t.dispatcher)),Object.getOwnPropertyNames(t.handlers).length<=0&&(delete t.handlers,delete t.dispatcher,delete t.disabled),Object.getOwnPropertyNames(t).length===0&&Ut.delete(r)}function ah(r,e,t,i){t.forEach(function(s){r(e,s,i)})}function ol(r){if(r.fixed_)return r;function e(){return!0}function t(){return!1}if(!r||!r.isPropagationStopped||!r.isImmediatePropagationStopped){const i=r||$.event;r={};const s=["layerX","layerY","keyLocation","path","webkitMovementX","webkitMovementY","mozPressure","mozInputSource"];for(const n in i)s.includes(n)||n==="returnValue"&&i.preventDefault||(r[n]=i[n]);if(r.target||(r.target=r.srcElement||ue),r.relatedTarget||(r.relatedTarget=r.fromElement===r.target?r.toElement:r.fromElement),r.preventDefault=function(){i.preventDefault&&i.preventDefault(),r.returnValue=!1,i.returnValue=!1,r.defaultPrevented=!0},r.defaultPrevented=!1,r.stopPropagation=function(){i.stopPropagation&&i.stopPropagation(),r.cancelBubble=!0,i.cancelBubble=!0,r.isPropagationStopped=e},r.isPropagationStopped=t,r.stopImmediatePropagation=function(){i.stopImmediatePropagation&&i.stopImmediatePropagation(),r.isImmediatePropagationStopped=e,r.stopPropagation()},r.isImmediatePropagationStopped=t,r.clientX!==null&&r.clientX!==void 0){const n=ue.documentElement,a=ue.body;r.pageX=r.clientX+(n&&n.scrollLeft||a&&a.scrollLeft||0)-(n&&n.clientLeft||a&&a.clientLeft||0),r.pageY=r.clientY+(n&&n.scrollTop||a&&a.scrollTop||0)-(n&&n.clientTop||a&&a.clientTop||0)}r.which=r.charCode||r.keyCode,r.button!==null&&r.button!==void 0&&(r.button=r.button&1?0:r.button&4?1:r.button&2?2:0)}return r.fixed_=!0,r}let Xa;const e2=function(){if(typeof Xa!="boolean"){Xa=!1;try{const r=Object.defineProperty({},"passive",{get(){Xa=!0}});$.addEventListener("test",null,r),$.removeEventListener("test",null,r)}catch{}}return Xa},t2=["touchstart","touchmove"];function ri(r,e,t){if(Array.isArray(e))return ah(ri,r,e,t);Ut.has(r)||Ut.set(r,{});const i=Ut.get(r);if(i.handlers||(i.handlers={}),i.handlers[e]||(i.handlers[e]=[]),t.guid||(t.guid=gi()),i.handlers[e].push(t),i.dispatcher||(i.disabled=!1,i.dispatcher=function(s,n){if(i.disabled)return;s=ol(s);const a=i.handlers[s.type];if(a){const o=a.slice(0);for(let l=0,u=o.length;l<u&&!s.isImmediatePropagationStopped();l++)try{o[l].call(r,s,n)}catch(c){Re.error(c)}}}),i.handlers[e].length===1)if(r.addEventListener){let s=!1;e2()&&t2.indexOf(e)>-1&&(s={passive:!0}),r.addEventListener(e,i.dispatcher,s)}else r.attachEvent&&r.attachEvent("on"+e,i.dispatcher)}function Pt(r,e,t){if(!Ut.has(r))return;const i=Ut.get(r);if(!i.handlers)return;if(Array.isArray(e))return ah(Pt,r,e,t);const s=function(a,o){i.handlers[o]=[],Lp(a,o)};if(e===void 0){for(const a in i.handlers)Object.prototype.hasOwnProperty.call(i.handlers||{},a)&&s(r,a);return}const n=i.handlers[e];if(n){if(!t){s(r,e);return}if(t.guid)for(let a=0;a<n.length;a++)n[a].guid===t.guid&&n.splice(a--,1);Lp(r,e)}}function zr(r,e,t){const i=Ut.has(r)?Ut.get(r):{},s=r.parentNode||r.ownerDocument;if(typeof e=="string"?e={type:e,target:r}:e.target||(e.target=r),e=ol(e),i.dispatcher&&i.dispatcher.call(r,e,t),s&&!e.isPropagationStopped()&&e.bubbles===!0)zr.call(null,s,e,t);else if(!s&&!e.defaultPrevented&&e.target&&e.target[e.type]){Ut.has(e.target)||Ut.set(e.target,{});const n=Ut.get(e.target);e.target[e.type]&&(n.disabled=!0,typeof e.target[e.type]=="function"&&e.target[e.type](),n.disabled=!1)}return!e.defaultPrevented}function ll(r,e,t){if(Array.isArray(e))return ah(ll,r,e,t);const i=function(){Pt(r,e,i),t.apply(this,arguments)};i.guid=t.guid=t.guid||gi(),ri(r,e,i)}function oh(r,e,t){const i=function(){Pt(r,e,i),t.apply(this,arguments)};i.guid=t.guid=t.guid||gi(),ri(r,e,i)}var i2=Object.freeze({__proto__:null,fixEvent:ol,on:ri,off:Pt,trigger:zr,one:ll,any:oh});const mi=30,Je=function(r,e,t){e.guid||(e.guid=gi());const i=e.bind(r);return i.guid=t?t+"_"+e.guid:e.guid,i},Ji=function(r,e){let t=$.performance.now();return function(...s){const n=$.performance.now();n-t>=e&&(r(...s),t=n)}},$0=function(r,e,t,i=$){let s;const n=()=>{i.clearTimeout(s),s=null},a=function(){const o=this,l=arguments;let u=function(){s=null,u=null,t||r.apply(o,l)};!s&&t&&r.apply(o,l),i.clearTimeout(s),s=i.setTimeout(u,e)};return a.cancel=n,a};var s2=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL:mi,bind_:Je,throttle:Ji,debounce:$0});let En;class ni{on(e,t){const i=this.addEventListener;this.addEventListener=()=>{},ri(this,e,t),this.addEventListener=i}off(e,t){Pt(this,e,t)}one(e,t){const i=this.addEventListener;this.addEventListener=()=>{},ll(this,e,t),this.addEventListener=i}any(e,t){const i=this.addEventListener;this.addEventListener=()=>{},oh(this,e,t),this.addEventListener=i}trigger(e){const t=e.type||e;typeof e=="string"&&(e={type:t}),e=ol(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),zr(this,e)}queueTrigger(e){En||(En=new Map);const t=e.type||e;let i=En.get(this);i||(i=new Map,En.set(this,i));const s=i.get(t);i.delete(t),$.clearTimeout(s);const n=$.setTimeout(()=>{i.delete(t),i.size===0&&(i=null,En.delete(this)),this.trigger(e)},0);i.set(t,n)}}ni.prototype.allowedEvents_={};ni.prototype.addEventListener=ni.prototype.on;ni.prototype.removeEventListener=ni.prototype.off;ni.prototype.dispatchEvent=ni.prototype.trigger;const ul=r=>typeof r.name=="function"?r.name():typeof r.name=="string"?r.name:r.name_?r.name_:r.constructor&&r.constructor.name?r.constructor.name:typeof r,hs=r=>r instanceof ni||!!r.eventBusEl_&&["on","one","off","trigger"].every(e=>typeof r[e]=="function"),r2=(r,e)=>{hs(r)?e():(r.eventedCallbacks||(r.eventedCallbacks=[]),r.eventedCallbacks.push(e))},uc=r=>typeof r=="string"&&/\S/.test(r)||Array.isArray(r)&&!!r.length,wo=(r,e,t)=>{if(!r||!r.nodeName&&!hs(r))throw new Error(`Invalid target for ${ul(e)}#${t}; must be a DOM node or evented object.`)},V0=(r,e,t)=>{if(!uc(r))throw new Error(`Invalid event type for ${ul(e)}#${t}; must be a non-empty string or array.`)},G0=(r,e,t)=>{if(typeof r!="function")throw new Error(`Invalid listener for ${ul(e)}#${t}; must be a function.`)},_u=(r,e,t)=>{const i=e.length<3||e[0]===r||e[0]===r.eventBusEl_;let s,n,a;return i?(s=r.eventBusEl_,e.length>=3&&e.shift(),[n,a]=e):(s=e[0],n=e[1],a=e[2]),wo(s,r,t),V0(n,r,t),G0(a,r,t),a=Je(r,a),{isTargetingSelf:i,target:s,type:n,listener:a}},Gs=(r,e,t,i)=>{wo(r,r,e),r.nodeName?i2[e](r,t,i):r[e](t,i)},n2={on(...r){const{isTargetingSelf:e,target:t,type:i,listener:s}=_u(this,r,"on");if(Gs(t,"on",i,s),!e){const n=()=>this.off(t,i,s);n.guid=s.guid;const a=()=>this.off("dispose",n);a.guid=s.guid,Gs(this,"on","dispose",n),Gs(t,"on","dispose",a)}},one(...r){const{isTargetingSelf:e,target:t,type:i,listener:s}=_u(this,r,"one");if(e)Gs(t,"one",i,s);else{const n=(...a)=>{this.off(t,i,n),s.apply(null,a)};n.guid=s.guid,Gs(t,"one",i,n)}},any(...r){const{isTargetingSelf:e,target:t,type:i,listener:s}=_u(this,r,"any");if(e)Gs(t,"any",i,s);else{const n=(...a)=>{this.off(t,i,n),s.apply(null,a)};n.guid=s.guid,Gs(t,"any",i,n)}},off(r,e,t){if(!r||uc(r))Pt(this.eventBusEl_,r,e);else{const i=r,s=e;wo(i,this,"off"),V0(s,this,"off"),G0(t,this,"off"),t=Je(this,t),this.off("dispose",t),i.nodeName?(Pt(i,s,t),Pt(i,"dispose",t)):hs(i)&&(i.off(s,t),i.off("dispose",t))}},trigger(r,e){wo(this.eventBusEl_,this,"trigger");const t=r&&typeof r!="string"?r.type:r;if(!uc(t))throw new Error(`Invalid event type for ${ul(this)}#trigger; must be a non-empty string or object with a type key that has a non-empty value.`);return zr(this.eventBusEl_,r,e)}};function lh(r,e={}){const{eventBusKey:t}=e;if(t){if(!r[t].nodeName)throw new Error(`The eventBusKey "${t}" does not refer to an element.`);r.eventBusEl_=r[t]}else r.eventBusEl_=xe("span",{className:"vjs-event-bus"});return Object.assign(r,n2),r.eventedCallbacks&&r.eventedCallbacks.forEach(i=>{i()}),r.on("dispose",()=>{r.off(),[r,r.el_,r.eventBusEl_].forEach(function(i){i&&Ut.has(i)&&Ut.delete(i)}),$.setTimeout(()=>{r.eventBusEl_=null},0)}),r}const a2={state:{},setState(r){typeof r=="function"&&(r=r());let e;return Cr(r,(t,i)=>{this.state[i]!==t&&(e=e||{},e[i]={from:this.state[i],to:t}),this.state[i]=t}),e&&hs(this)&&this.trigger({changes:e,type:"statechanged"}),e}};function H0(r,e){return Object.assign(r,a2),r.state=Object.assign({},r.state,e),typeof r.handleStateChanged=="function"&&hs(r)&&r.on("statechanged",r.handleStateChanged),r}const On=function(r){return typeof r!="string"?r:r.replace(/./,e=>e.toLowerCase())},ft=function(r){return typeof r!="string"?r:r.replace(/./,e=>e.toUpperCase())},q0=function(r,e){return ft(r)===ft(e)};var o2=Object.freeze({__proto__:null,toLowerCase:On,toTitleCase:ft,titleCaseEquals:q0});class ne{constructor(e,t,i){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=je({},this.options_),t=this.options_=je(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const s=e&&e.id&&e.id()||"no_player";this.id_=`${s}_component_${gi()}`}this.name_=t.name||null,t.el?this.el_=t.el:t.createEl!==!1&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach(s=>this.addClass(s)),["on","off","one","any","trigger"].forEach(s=>{this[s]=void 0}),t.evented!==!1&&(lh(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),H0(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,t.initChildren!==!1&&this.initChildren(),this.ready(i),t.reportTouchActivity!==!1&&this.enableTouchActivity()}dispose(e={}){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let t=this.children_.length-1;t>=0;t--)this.children_[t].dispose&&this.children_[t].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return!!this.isDisposed_}player(){return this.player_}options(e){return e?(this.options_=je(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,i){return xe(e,t,i)}localize(e,t,i=e){const s=this.player_.language&&this.player_.language(),n=this.player_.languages&&this.player_.languages(),a=n&&n[s],o=s&&s.split("-")[0],l=n&&n[o];let u=i;return a&&a[e]?u=a[e]:l&&l[e]&&(u=l[e]),t&&(u=u.replace(/\{(\d+)\}/g,function(c,h){const f=t[h-1];let p=f;return typeof f>"u"&&(p=c),p})),u}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce((i,s)=>i.concat(s),[]);let t=this;for(let i=0;i<e.length;i++)if(t=t.getChild(e[i]),!t||!t.getChild)return;return t}setIcon(e,t=this.el()){if(!this.player_.options_.experimentalSvgIcons)return;const i="http://www.w3.org/2000/svg",s=xe("span",{className:"vjs-icon-placeholder vjs-svg-icon"},{"aria-hidden":"true"}),n=ue.createElementNS(i,"svg");n.setAttributeNS(null,"viewBox","0 0 512 512");const a=ue.createElementNS(i,"use");return n.appendChild(a),a.setAttributeNS(null,"href",`#vjs-icon-${e}`),s.appendChild(n),this.iconIsSet_?t.replaceChild(s,t.querySelector(".vjs-icon-placeholder")):t.appendChild(s),this.iconIsSet_=!0,s}addChild(e,t={},i=this.children_.length){let s,n;if(typeof e=="string"){n=ft(e);const a=t.componentClass||n;t.name=n;const o=ne.getComponent(a);if(!o)throw new Error(`Component ${a} does not exist`);if(typeof o!="function")return null;s=new o(this.player_||this,t)}else s=e;if(s.parentComponent_&&s.parentComponent_.removeChild(s),this.children_.splice(i,0,s),s.parentComponent_=this,typeof s.id=="function"&&(this.childIndex_[s.id()]=s),n=n||s.name&&ft(s.name()),n&&(this.childNameIndex_[n]=s,this.childNameIndex_[On(n)]=s),typeof s.el=="function"&&s.el()){let a=null;this.children_[i+1]&&(this.children_[i+1].el_?a=this.children_[i+1].el_:Wr(this.children_[i+1])&&(a=this.children_[i+1])),this.contentEl().insertBefore(s.el(),a)}return s}removeChild(e){if(typeof e=="string"&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let s=this.children_.length-1;s>=0;s--)if(this.children_[s]===e){t=!0,this.children_.splice(s,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[ft(e.name())]=null,this.childNameIndex_[On(e.name())]=null;const i=e.el();i&&i.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const t=this.options_,i=a=>{const o=a.name;let l=a.opts;if(t[o]!==void 0&&(l=t[o]),l===!1)return;l===!0&&(l={}),l.playerOptions=this.options_.playerOptions;const u=this.addChild(o,l);u&&(this[o]=u)};let s;const n=ne.getComponent("Tech");Array.isArray(e)?s=e:s=Object.keys(e),s.concat(Object.keys(this.options_).filter(function(a){return!s.some(function(o){return typeof o=="string"?a===o:a===o.name})})).map(a=>{let o,l;return typeof a=="string"?(o=a,l=e[o]||this.options_[o]||{}):(o=a.name,l=a),{name:o,opts:l}}).filter(a=>{const o=ne.getComponent(a.opts.componentClass||ft(a.name));return o&&!n.isTech(o)}).forEach(i)}}buildCSSClass(){return""}ready(e,t=!1){if(e){if(!this.isReady_){this.readyQueue_=this.readyQueue_||[],this.readyQueue_.push(e);return}t?e.call(this):this.setTimeout(e,1)}}triggerReady(){this.isReady_=!0,this.setTimeout(function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(t){t.call(this)},this),this.trigger("ready")},1)}$(e,t){return ks(e,t||this.contentEl())}$$(e,t){return O0(e,t||this.contentEl())}hasClass(e){return Pn(this.el_,e)}addClass(...e){Qs(this.el_,...e)}removeClass(...e){sl(this.el_,...e)}toggleClass(e,t){C0(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return D0(this.el_,e)}setAttribute(e,t){Gr(this.el_,e,t)}removeAttribute(e){rl(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,i){if(t!==void 0){(t===null||t!==t)&&(t=0),(""+t).indexOf("%")!==-1||(""+t).indexOf("px")!==-1?this.el_.style[e]=t:t==="auto"?this.el_.style[e]="":this.el_.style[e]=t+"px",i||this.trigger("componentresize");return}if(!this.el_)return 0;const s=this.el_.style[e],n=s.indexOf("px");return parseInt(n!==-1?s.slice(0,n):this.el_["offset"+ft(e)],10)}currentDimension(e){let t=0;if(e!=="width"&&e!=="height")throw new Error("currentDimension only accepts width or height value");if(t=qr(this.el_,e),t=parseFloat(t),t===0||isNaN(t)){const i=`offset${ft(e)}`;t=this.el_[i]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}getPositions(){const e=this.el_.getBoundingClientRect(),t={x:e.x,y:e.y,width:e.width,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left},i={x:e.left+e.width/2,y:e.top+e.height/2,width:0,height:0,top:e.top+e.height/2,right:e.left+e.width/2,bottom:e.top+e.height/2,left:e.left+e.width/2};return{boundingClientRect:t,center:i}}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&(e.key!=="Tab"&&!(this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled)&&e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,t=null;const i=10,s=200;let n;this.on("touchstart",function(o){o.touches.length===1&&(t={pageX:o.touches[0].pageX,pageY:o.touches[0].pageY},e=$.performance.now(),n=!0)}),this.on("touchmove",function(o){if(o.touches.length>1)n=!1;else if(t){const l=o.touches[0].pageX-t.pageX,u=o.touches[0].pageY-t.pageY;Math.sqrt(l*l+u*u)>i&&(n=!1)}});const a=function(){n=!1};this.on("touchleave",a),this.on("touchcancel",a),this.on("touchend",function(o){t=null,n===!0&&$.performance.now()-e<s&&(o.preventDefault(),this.trigger("tap"))})}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=Je(this.player(),this.player().reportUserActivity);let t;this.on("touchstart",function(){e(),this.clearInterval(t),t=this.setInterval(e,250)});const i=function(s){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",i),this.on("touchcancel",i)}setTimeout(e,t){var i;return e=Je(this,e),this.clearTimersOnDispose_(),i=$.setTimeout(()=>{this.setTimeoutIds_.has(i)&&this.setTimeoutIds_.delete(i),e()},t),this.setTimeoutIds_.add(i),i}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),$.clearTimeout(e)),e}setInterval(e,t){e=Je(this,e),this.clearTimersOnDispose_();const i=$.setInterval(e,t);return this.setIntervalIds_.add(i),i}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),$.clearInterval(e)),e}requestAnimationFrame(e){this.clearTimersOnDispose_();var t;return e=Je(this,e),t=$.requestAnimationFrame(()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()}),this.rafIds_.add(t),t}requestNamedAnimationFrame(e,t){this.namedRafs_.has(e)&&this.cancelNamedAnimationFrame(e),this.clearTimersOnDispose_(),t=Je(this,t);const i=this.requestAnimationFrame(()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)});return this.namedRafs_.set(e,i),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),$.cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(([e,t])=>{this[e].forEach((i,s)=>this[t](s))}),this.clearingTimersOnDispose_=!1}))}getIsDisabled(){return!!this.el_.disabled}getIsExpresslyInert(){return this.el_.inert&&!this.el_.ownerDocument.documentElement.inert}getIsFocusable(e){return(e||this.el_).tabIndex>=0&&!(this.getIsDisabled()||this.getIsExpresslyInert())}getIsAvailableToBeFocused(e){function t(n){const a=$.getComputedStyle(n,null),o=a.getPropertyValue("visibility");return a.getPropertyValue("display")!=="none"&&!["hidden","collapse"].includes(o)}function i(n){return!(!t(n.parentElement)||!t(n)||n.style.opacity==="0"||$.getComputedStyle(n).height==="0px"||$.getComputedStyle(n).width==="0px")}function s(n){if(n.offsetWidth+n.offsetHeight+n.getBoundingClientRect().height+n.getBoundingClientRect().width===0)return!1;const a={x:n.getBoundingClientRect().left+n.offsetWidth/2,y:n.getBoundingClientRect().top+n.offsetHeight/2};if(a.x<0||a.x>(ue.documentElement.clientWidth||$.innerWidth)||a.y<0||a.y>(ue.documentElement.clientHeight||$.innerHeight))return!1;let o=ue.elementFromPoint(a.x,a.y);for(;o;){if(o===n)return!0;if(o.parentNode)o=o.parentNode;else return!1}}return e||(e=this.el()),!!(s(e)&&i(e)&&(!e.parentElement||e.tabIndex>=0))}static registerComponent(e,t){if(typeof e!="string"||!e)throw new Error(`Illegal component name, "${e}"; must be a non-empty string.`);const i=ne.getComponent("Tech"),s=i&&i.isTech(t),n=ne===t||ne.prototype.isPrototypeOf(t.prototype);if(s||!n){let o;throw s?o="techs must be registered using Tech.registerTech()":o="must be a Component subclass",new Error(`Illegal component, "${e}"; ${o}.`)}e=ft(e),ne.components_||(ne.components_={});const a=ne.getComponent("Player");if(e==="Player"&&a&&a.players){const o=a.players,l=Object.keys(o);if(o&&l.length>0){for(let u=0;u<l.length;u++)if(o[l[u]]!==null)throw new Error("Can not register Player component after player has been created.")}}return ne.components_[e]=t,ne.components_[On(e)]=t,t}static getComponent(e){if(!(!e||!ne.components_))return ne.components_[e]}}ne.registerComponent("Component",ne);function l2(r,e,t){if(typeof e!="number"||e<0||e>t)throw new Error(`Failed to execute '${r}' on 'TimeRanges': The index provided (${e}) is non-numeric or out of bounds (0-${t}).`)}function Rp(r,e,t,i){return l2(r,i,t.length-1),t[i][e]}function vu(r){let e;return r===void 0||r.length===0?e={length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:e={length:r.length,start:Rp.bind(null,"start",0,r),end:Rp.bind(null,"end",1,r)},$.Symbol&&$.Symbol.iterator&&(e[$.Symbol.iterator]=()=>(r||[]).values()),e}function Ii(r,e){return Array.isArray(r)?vu(r):r===void 0||e===void 0?vu():vu([[r,e]])}const j0=function(r,e){r=r<0?0:r;let t=Math.floor(r%60),i=Math.floor(r/60%60),s=Math.floor(r/3600);const n=Math.floor(e/60%60),a=Math.floor(e/3600);return(isNaN(r)||r===1/0)&&(s=i=t="-"),s=s>0||a>0?s+":":"",i=((s||n>=10)&&i<10?"0"+i:i)+":",t=t<10?"0"+t:t,s+i+t};let uh=j0;function K0(r){uh=r}function W0(){uh=j0}function ir(r,e=r){return uh(r,e)}var u2=Object.freeze({__proto__:null,createTimeRanges:Ii,createTimeRange:Ii,setFormatTime:K0,resetFormatTime:W0,formatTime:ir});function z0(r,e){let t=0,i,s;if(!e)return 0;(!r||!r.length)&&(r=Ii(0,0));for(let n=0;n<r.length;n++)i=r.start(n),s=r.end(n),s>e&&(s=e),t+=s-i;return t/e}function ut(r){if(r instanceof ut)return r;typeof r=="number"?this.code=r:typeof r=="string"?this.message=r:Xi(r)&&(typeof r.code=="number"&&(this.code=r.code),Object.assign(this,r)),this.message||(this.message=ut.defaultMessages[this.code]||"")}ut.prototype.code=0;ut.prototype.message="";ut.prototype.status=null;ut.prototype.metadata=null;ut.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"];ut.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};ut.MEDIA_ERR_CUSTOM=0;ut.prototype.MEDIA_ERR_CUSTOM=0;ut.MEDIA_ERR_ABORTED=1;ut.prototype.MEDIA_ERR_ABORTED=1;ut.MEDIA_ERR_NETWORK=2;ut.prototype.MEDIA_ERR_NETWORK=2;ut.MEDIA_ERR_DECODE=3;ut.prototype.MEDIA_ERR_DECODE=3;ut.MEDIA_ERR_SRC_NOT_SUPPORTED=4;ut.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED=4;ut.MEDIA_ERR_ENCRYPTED=5;ut.prototype.MEDIA_ERR_ENCRYPTED=5;function Mn(r){return r!=null&&typeof r.then=="function"}function qi(r){Mn(r)&&r.then(null,e=>{})}const cc=function(r){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce((t,i,s)=>(r[i]&&(t[i]=r[i]),t),{cues:r.cues&&Array.prototype.map.call(r.cues,function(t){return{startTime:t.startTime,endTime:t.endTime,text:t.text,id:t.id}})})},c2=function(r){const e=r.$$("track"),t=Array.prototype.map.call(e,s=>s.track);return Array.prototype.map.call(e,function(s){const n=cc(s.track);return s.src&&(n.src=s.src),n}).concat(Array.prototype.filter.call(r.textTracks(),function(s){return t.indexOf(s)===-1}).map(cc))},h2=function(r,e){return r.forEach(function(t){const i=e.addRemoteTextTrack(t).track;!t.src&&t.cues&&t.cues.forEach(s=>i.addCue(s))}),e.textTracks()};var hc={textTracksToJson:c2,jsonToTextTracks:h2,trackToJson:cc};const Su="vjs-modal-dialog";class Yr extends ne{constructor(e,t){super(e,t),this.handleKeyDown_=i=>this.handleKeyDown(i),this.close_=i=>this.close(i),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=xe("div",{className:`${Su}-content`},{role:"document"}),this.descEl_=xe("p",{className:`${Su}-description vjs-control-text`,id:this.el().getAttribute("aria-describedby")}),Ps(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":`${this.id()}_description`,"aria-hidden":"true","aria-label":this.label(),role:"dialog","aria-live":"polite"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return`${Su} vjs-hidden ${super.buildCSSClass()}`}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(this.opened_){this.options_.fillAlways&&this.fill();return}const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}opened(e){return typeof e=="boolean"&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger({type:"modalclose",bubbles:!0}),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if(typeof e=="boolean"){const t=this.closeable_=!!e;let i=this.getChild("closeButton");if(t&&!i){const s=this.contentEl_;this.contentEl_=this.el_,i=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=s,this.on(i,"close",this.close_)}!t&&i&&(this.off(i,"close",this.close_),this.removeChild(i),i.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const t=this.contentEl(),i=t.parentNode,s=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,i.removeChild(t),this.empty(),P0(t,e),this.trigger("modalfill"),s?i.insertBefore(t,s):i.appendChild(t);const n=this.getChild("closeButton");n&&i.appendChild(n.el_),this.trigger("aftermodalfill")}empty(){this.trigger("beforemodalempty"),al(this.contentEl()),this.trigger("modalempty")}content(e){return typeof e<"u"&&(this.content_=e),this.content_}conditionalFocus_(){const e=ue.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(this.trigger({type:"modalKeydown",originalEvent:e,target:this,bubbles:!0}),e.stopPropagation(),e.key==="Escape"&&this.closeable()){e.preventDefault(),this.close();return}if(e.key!=="Tab")return;const t=this.focusableEls_(),i=this.el_.querySelector(":focus");let s;for(let n=0;n<t.length;n++)if(i===t[n]){s=n;break}ue.activeElement===this.el_&&(s=0),e.shiftKey&&s===0?(t[t.length-1].focus(),e.preventDefault()):!e.shiftKey&&s===t.length-1&&(t[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,t=>(t instanceof $.HTMLAnchorElement||t instanceof $.HTMLAreaElement)&&t.hasAttribute("href")||(t instanceof $.HTMLInputElement||t instanceof $.HTMLSelectElement||t instanceof $.HTMLTextAreaElement||t instanceof $.HTMLButtonElement)&&!t.hasAttribute("disabled")||t instanceof $.HTMLIFrameElement||t instanceof $.HTMLObjectElement||t instanceof $.HTMLEmbedElement||t.hasAttribute("tabindex")&&t.getAttribute("tabindex")!==-1||t.hasAttribute("contenteditable"))}}Yr.prototype.options_={pauseOnOpen:!0,temporary:!0};ne.registerComponent("ModalDialog",Yr);class sr extends ni{constructor(e=[]){super(),this.tracks_=[];for(let t=0;t<e.length;t++)this.addTrack(e[t])}get length(){return this.tracks_.length}addTrack(e){const t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.tracks_[t]}}),this.tracks_.indexOf(e)===-1&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=()=>{this.trigger({track:e,type:"labelchange",target:this})},hs(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let t;for(let i=0,s=this.length;i<s;i++)if(this[i]===e){t=this[i],t.off&&t.off(),this.tracks_.splice(i,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})}getTrackById(e){let t=null;for(let i=0,s=this.length;i<s;i++){const n=this[i];if(n.id===e){t=n;break}}return t}}sr.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const r in sr.prototype.allowedEvents_)sr.prototype["on"+r]=null;const Eu=function(r,e){for(let t=0;t<r.length;t++)!Object.keys(r[t]).length||e.id===r[t].id||(r[t].enabled=!1)};class Y0 extends sr{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].enabled){Eu(e,e[t]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&Eu(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=()=>{this.changing_||(this.changing_=!0,Eu(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}}const bu=function(r,e){for(let t=0;t<r.length;t++)!Object.keys(r[t]).length||e.id===r[t].id||(r[t].selected=!1)};class X0 extends sr{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].selected){bu(e,e[t]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let t=0;t<this.length;t++)if(this[t].selected)return t;return-1},set(){}})}addTrack(e){e.selected&&bu(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=()=>{this.changing_||(this.changing_=!0,bu(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}}class ch extends sr{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=()=>this.queueTrigger("change")),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=()=>this.trigger("selectedlanguagechange")),e.addEventListener("modechange",this.queueChange_),["metadata","chapters"].indexOf(e.kind)===-1&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}toJSON(){return this.tracks_.map(e=>e.toJSON())}}class d2{constructor(e=[]){this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let t=0,i=e.length;t<i;t++)this.addTrackElement_(e[t])}addTrackElement_(e){const t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.trackElements_[t]}}),this.trackElements_.indexOf(e)===-1&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let t;for(let i=0,s=this.trackElements_.length;i<s;i++)if(e===this.trackElements_[i].track){t=this.trackElements_[i];break}return t}removeTrackElement_(e){for(let t=0,i=this.trackElements_.length;t<i;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&typeof this.trackElements_[t].track.off=="function"&&this.trackElements_[t].track.off(),typeof this.trackElements_[t].off=="function"&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}}}class ko{constructor(e){ko.prototype.setCues_.call(this,e),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const t=this.length||0;let i=0;const s=e.length;this.cues_=e,this.length_=e.length;const n=function(a){""+a in this||Object.defineProperty(this,""+a,{get(){return this.cues_[a]}})};if(t<s)for(i=t;i<s;i++)n.call(this,i)}getCueById(e){let t=null;for(let i=0,s=this.length;i<s;i++){const n=this[i];if(n.id===e){t=n;break}}return t}}const f2={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},p2={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},g2={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},wp={disabled:"disabled",hidden:"hidden",showing:"showing"};class hh extends ni{constructor(e={}){super();const t={id:e.id||"vjs_track_"+gi(),kind:e.kind||"",language:e.language||""};let i=e.label||"";for(const s in t)Object.defineProperty(this,s,{get(){return t[s]},set(){}});Object.defineProperty(this,"label",{get(){return i},set(s){s!==i&&(i=s,this.trigger("labelchange"))}})}}const dh=function(r){return new URL(r,ue.baseURI)},Q0=function(r){return new URL(r,ue.baseURI).href},fh=function(r){if(typeof r=="string"){const t=r.split("?")[0].replace(/\/+$/,"").match(/\.([^.\/]+)$/);return t?t[1].toLowerCase():""}return""},cl=function(r,e=$.location){return dh(r).origin!==e.origin};var m2=Object.freeze({__proto__:null,parseUrl:dh,getAbsoluteURL:Q0,getFileExtension:fh,isCrossOrigin:cl});const kp=function(r,e){const t=new $.WebVTT.Parser($,$.vttjs,$.WebVTT.StringDecoder()),i=[];t.oncue=function(s){e.addCue(s)},t.onparsingerror=function(s){i.push(s)},t.onflush=function(){e.trigger({type:"loadeddata",target:e})},t.parse(r),i.length>0&&($.console&&$.console.groupCollapsed&&$.console.groupCollapsed(`Text Track parsing errors for ${e.src}`),i.forEach(s=>Re.error(s)),$.console&&$.console.groupEnd&&$.console.groupEnd()),t.flush()},Pp=function(r,e){const t={uri:r},i=cl(r);i&&(t.cors=i);const s=e.tech_.crossOrigin()==="use-credentials";s&&(t.withCredentials=s),Zm(t,Je(this,function(n,a,o){if(n)return Re.error(n,a);e.loaded_=!0,typeof $.WebVTT!="function"?e.tech_&&e.tech_.any(["vttjsloaded","vttjserror"],l=>{if(l.type==="vttjserror"){Re.error(`vttjs failed to load, stopping trying to process ${e.src}`);return}return kp(o,e)}):kp(o,e)}))};class Jn extends hh{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const t=je(e,{kind:g2[e.kind]||"subtitles",language:e.language||e.srclang||""});let i=wp[t.mode]||"disabled";const s=t.default;(t.kind==="metadata"||t.kind==="chapters")&&(i="hidden"),super(t),this.tech_=t.tech,this.cues_=[],this.activeCues_=[],this.preload_=this.tech_.preloadTextTracks!==!1;const n=new ko(this.cues_),a=new ko(this.activeCues_);let o=!1;this.timeupdateHandler=Je(this,function(u={}){if(!this.tech_.isDisposed()){if(!this.tech_.isReady_){u.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler));return}this.activeCues=this.activeCues,o&&(this.trigger("cuechange"),o=!1),u.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))}});const l=()=>{this.stopTracking()};this.tech_.one("dispose",l),i!=="disabled"&&this.startTracking(),Object.defineProperties(this,{default:{get(){return s},set(){}},mode:{get(){return i},set(u){wp[u]&&i!==u&&(i=u,!this.preload_&&i!=="disabled"&&this.cues.length===0&&Pp(this.src,this),this.stopTracking(),i!=="disabled"&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?n:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(this.cues.length===0)return a;const u=this.tech_.currentTime(),c=[];for(let h=0,f=this.cues.length;h<f;h++){const p=this.cues[h];p.startTime<=u&&p.endTime>=u&&c.push(p)}if(o=!1,c.length!==this.activeCues_.length)o=!0;else for(let h=0;h<c.length;h++)this.activeCues_.indexOf(c[h])===-1&&(o=!0);return this.activeCues_=c,a.setCues_(this.activeCues_),a},set(){}}}),t.src?(this.src=t.src,this.preload_||(this.loaded_=!0),(this.preload_||t.kind!=="subtitles"&&t.kind!=="captions")&&Pp(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let t=e;if(!("getCueAsHTML"in t)){t=new $.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(const s in e)s in t||(t[s]=e[s]);t.id=e.id,t.originalCue_=e}const i=this.tech_.textTracks();for(let s=0;s<i.length;s++)i[s]!==this&&i[s].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)}toJSON(){return hc.trackToJson(this)}removeCue(e){let t=this.cues_.length;for(;t--;){const i=this.cues_[t];if(i===e||i.originalCue_&&i.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}}Jn.prototype.allowedEvents_={cuechange:"cuechange"};class J0 extends hh{constructor(e={}){const t=je(e,{kind:p2[e.kind]||""});super(t);let i=!1;Object.defineProperty(this,"enabled",{get(){return i},set(s){typeof s!="boolean"||s===i||(i=s,this.trigger("enabledchange"))}}),t.enabled&&(this.enabled=t.enabled),this.loaded_=!0}}class Z0 extends hh{constructor(e={}){const t=je(e,{kind:f2[e.kind]||""});super(t);let i=!1;Object.defineProperty(this,"selected",{get(){return i},set(s){typeof s!="boolean"||s===i||(i=s,this.trigger("selectedchange"))}}),t.selected&&(this.selected=t.selected)}}class ds extends ni{constructor(e={}){super();let t;const i=new Jn(e);this.kind=i.kind,this.src=i.src,this.srclang=i.language,this.label=i.label,this.default=i.default,Object.defineProperties(this,{readyState:{get(){return t}},track:{get(){return i}}}),t=ds.NONE,i.addEventListener("loadeddata",()=>{t=ds.LOADED,this.trigger({type:"load",target:this})})}}ds.prototype.allowedEvents_={load:"load"};ds.NONE=0;ds.LOADING=1;ds.LOADED=2;ds.ERROR=3;const fi={audio:{ListClass:Y0,TrackClass:J0,capitalName:"Audio"},video:{ListClass:X0,TrackClass:Z0,capitalName:"Video"},text:{ListClass:ch,TrackClass:Jn,capitalName:"Text"}};Object.keys(fi).forEach(function(r){fi[r].getterName=`${r}Tracks`,fi[r].privateName=`${r}Tracks_`});const jr={remoteText:{ListClass:ch,TrackClass:Jn,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:d2,TrackClass:ds,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},Bt=Object.assign({},fi,jr);jr.names=Object.keys(jr);fi.names=Object.keys(fi);Bt.names=[].concat(jr.names).concat(fi.names);function y2(r,e,t,i,s={}){const n=r.textTracks();s.kind=e,t&&(s.label=t),i&&(s.language=i),s.tech=r;const a=new Bt.text.TrackClass(s);return n.addTrack(a),a}class De extends ne{constructor(e={},t=function(){}){e.reportTouchActivity=!1,super(null,e,t),this.onDurationChange_=i=>this.onDurationChange(i),this.trackProgress_=i=>this.trackProgress(i),this.trackCurrentTime_=i=>this.trackCurrentTime(i),this.stopTrackingCurrentTime_=i=>this.stopTrackingCurrentTime(i),this.disposeSourceHandler_=i=>this.disposeSourceHandler(i),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",function(){this.hasStarted_=!0}),this.on("loadstart",function(){this.hasStarted_=!1}),Bt.names.forEach(i=>{const s=Bt[i];e&&e[s.getterName]&&(this[s.privateName]=e[s.getterName])}),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(i=>{e[`native${i}Tracks`]===!1&&(this[`featuresNative${i}Tracks`]=!1)}),e.nativeCaptions===!1||e.nativeTextTracks===!1?this.featuresNativeTextTracks=!1:(e.nativeCaptions===!0||e.nativeTextTracks===!0)&&(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=e.preloadTextTracks!==!1,this.autoRemoteTextTracks_=new Bt.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",()=>this.setTimeout(()=>this.triggerSourceset(e),1)),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(Je(this,function(){const t=this.bufferedPercent();this.bufferedPercent_!==t&&this.trigger("progress"),this.bufferedPercent_=t,t===1&&this.stopTrackingProgress()}),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return Ii(0,0)}bufferedPercent(){return z0(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(fi.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){e=[].concat(e),e.forEach(t=>{const i=this[`${t}Tracks`]()||[];let s=i.length;for(;s--;){const n=i[s];t==="text"&&this.removeRemoteTextTrack(n),i.removeTrack(n)}})}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let t=e.length;for(;t--;){const i=e[t];this.removeRemoteTextTrack(i)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return e!==void 0&&(this.error_=new ut(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?Ii(0,0):Ii()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){fi.names.forEach(e=>{const t=fi[e],i=()=>{this.trigger(`${e}trackchange`)},s=this[t.getterName]();s.addEventListener("removetrack",i),s.addEventListener("addtrack",i),this.on("dispose",()=>{s.removeEventListener("removetrack",i),s.removeEventListener("addtrack",i)})})}addWebVttScript_(){if(!$.WebVTT)if(ue.body.contains(this.el())){if(!this.options_["vtt.js"]&&Vr(sp)&&Object.keys(sp).length>0){this.trigger("vttjsloaded");return}const e=ue.createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=()=>{this.trigger("vttjsloaded")},e.onerror=()=>{this.trigger("vttjserror")},this.on("dispose",()=>{e.onload=null,e.onerror=null}),$.WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),t=this.remoteTextTracks(),i=o=>e.addTrack(o.track),s=o=>e.removeTrack(o.track);t.on("addtrack",i),t.on("removetrack",s),this.addWebVttScript_();const n=()=>this.trigger("texttrackchange"),a=()=>{n();for(let o=0;o<e.length;o++){const l=e[o];l.removeEventListener("cuechange",n),l.mode==="showing"&&l.addEventListener("cuechange",n)}};a(),e.addEventListener("change",a),e.addEventListener("addtrack",a),e.addEventListener("removetrack",a),this.on("dispose",function(){t.off("addtrack",i),t.off("removetrack",s),e.removeEventListener("change",a),e.removeEventListener("addtrack",a),e.removeEventListener("removetrack",a);for(let o=0;o<e.length;o++)e[o].removeEventListener("cuechange",n)})}addTextTrack(e,t,i){if(!e)throw new Error("TextTrack kind is required but was not provided");return y2(this,e,t,i)}createRemoteTextTrack(e){const t=je(e,{tech:this});return new jr.remoteTextEl.TrackClass(t)}addRemoteTextTrack(e={},t){const i=this.createRemoteTextTrack(e);return typeof t!="boolean"&&(t=!1),this.remoteTextTrackEls().addTrackElement_(i),this.remoteTextTracks().addTrack(i.track),t===!1&&this.ready(()=>this.autoRemoteTextTracks_.addTrack(i.track)),i}removeRemoteTextTrack(e){const t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const t=gi();return!this.isReady_||this.paused()?(this.queuedHanders_.add(t),this.one("playing",()=>{this.queuedHanders_.has(t)&&(this.queuedHanders_.delete(t),e())})):this.requestNamedAnimationFrame(t,e),t}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(e,t){return De.canPlayType(e.type)}static isTech(e){return e.prototype instanceof De||e instanceof De||e===De}static registerTech(e,t){if(De.techs_||(De.techs_={}),!De.isTech(t))throw new Error(`Tech ${e} must be a Tech`);if(!De.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!De.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=ft(e),De.techs_[e]=t,De.techs_[On(e)]=t,e!=="Tech"&&De.defaultTechOrder_.push(e),t}static getTech(e){if(e){if(De.techs_&&De.techs_[e])return De.techs_[e];if(e=ft(e),$&&$.videojs&&$.videojs[e])return Re.warn(`The ${e} tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)`),$.videojs[e]}}}Bt.names.forEach(function(r){const e=Bt[r];De.prototype[e.getterName]=function(){return this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName]}});De.prototype.featuresVolumeControl=!0;De.prototype.featuresMuteControl=!0;De.prototype.featuresFullscreenResize=!1;De.prototype.featuresPlaybackRate=!1;De.prototype.featuresProgressEvents=!1;De.prototype.featuresSourceset=!1;De.prototype.featuresTimeupdateEvents=!1;De.prototype.featuresNativeTextTracks=!1;De.prototype.featuresVideoFrameCallback=!1;De.withSourceHandlers=function(r){r.registerSourceHandler=function(t,i){let s=r.sourceHandlers;s||(s=r.sourceHandlers=[]),i===void 0&&(i=s.length),s.splice(i,0,t)},r.canPlayType=function(t){const i=r.sourceHandlers||[];let s;for(let n=0;n<i.length;n++)if(s=i[n].canPlayType(t),s)return s;return""},r.selectSourceHandler=function(t,i){const s=r.sourceHandlers||[];let n;for(let a=0;a<s.length;a++)if(n=s[a].canHandleSource(t,i),n)return s[a];return null},r.canPlaySource=function(t,i){const s=r.selectSourceHandler(t,i);return s?s.canHandleSource(t,i):""},["seekable","seeking","duration"].forEach(function(t){const i=this[t];typeof i=="function"&&(this[t]=function(){return this.sourceHandler_&&this.sourceHandler_[t]?this.sourceHandler_[t].apply(this.sourceHandler_,arguments):i.apply(this,arguments)})},r.prototype),r.prototype.setSource=function(t){let i=r.selectSourceHandler(t,this.options_);i||(r.nativeSourceHandler?i=r.nativeSourceHandler:Re.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),i!==r.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=i.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},r.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}};ne.registerComponent("Tech",De);De.registerTech("Tech",De);De.defaultTechOrder_=[];const Js={},Po={},Oo={};function T2(r,e){Js[r]=Js[r]||[],Js[r].push(e)}function _2(r,e,t){r.setTimeout(()=>qs(e,Js[e.type],t,r),1)}function v2(r,e){r.forEach(t=>t.setTech&&t.setTech(e))}function S2(r,e,t){return r.reduceRight(ph(t),e[t]())}function E2(r,e,t,i){return e[t](r.reduce(ph(t),i))}function Op(r,e,t,i=null){const s="call"+ft(t),n=r.reduce(ph(s),i),a=n===Oo,o=a?null:e[t](n);return A2(r,t,o,a),o}const b2={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},x2={setCurrentTime:1,setMuted:1,setVolume:1},Mp={play:1,pause:1};function ph(r){return(e,t)=>e===Oo?Oo:t[r]?t[r](e):e}function A2(r,e,t,i){for(let s=r.length-1;s>=0;s--){const n=r[s];n[e]&&n[e](i,t)}}function C2(r){Po.hasOwnProperty(r.id())&&delete Po[r.id()]}function I2(r,e){const t=Po[r.id()];let i=null;if(t==null)return i=e(r),Po[r.id()]=[[e,i]],i;for(let s=0;s<t.length;s++){const[n,a]=t[s];n===e&&(i=a)}return i===null&&(i=e(r),t.push([e,i])),i}function qs(r={},e=[],t,i,s=[],n=!1){const[a,...o]=e;if(typeof a=="string")qs(r,Js[a],t,i,s,n);else if(a){const l=I2(i,a);if(!l.setSource)return s.push(l),qs(r,o,t,i,s,n);l.setSource(Object.assign({},r),function(u,c){if(u)return qs(r,o,t,i,s,n);s.push(l),qs(c,r.type===c.type?o:Js[c.type],t,i,s,n)})}else o.length?qs(r,o,t,i,s,n):n?t(r,s):qs(r,Js["*"],t,i,s,!0)}const D2={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},Mo=function(r=""){const e=fh(r);return D2[e.toLowerCase()]||""},L2=(r,e)=>{if(!e)return"";if(r.cache_.source.src===e&&r.cache_.source.type)return r.cache_.source.type;const t=r.cache_.sources.filter(s=>s.src===e);if(t.length)return t[0].type;const i=r.$$("source");for(let s=0;s<i.length;s++){const n=i[s];if(n.type&&n.src&&n.src===e)return n.type}return Mo(e)},ey=function(r){if(Array.isArray(r)){let e=[];r.forEach(function(t){t=ey(t),Array.isArray(t)?e=e.concat(t):Xi(t)&&e.push(t)}),r=e}else typeof r=="string"&&r.trim()?r=[Fp({src:r})]:Xi(r)&&typeof r.src=="string"&&r.src&&r.src.trim()?r=[Fp(r)]:r=[];return r};function Fp(r){if(!r.type){const e=Mo(r.src);e&&(r.type=e)}return r}var R2=`<svg xmlns="http://www.w3.org/2000/svg">
  <defs>
    <symbol viewBox="0 0 48 48" id="vjs-icon-play">
      <path d="M16 10v28l22-14z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-pause">
      <path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-audio">
      <path d="M24 2C14.06 2 6 10.06 6 20v14c0 3.31 2.69 6 6 6h6V24h-8v-4c0-7.73 6.27-14 14-14s14 6.27 14 14v4h-8v16h6c3.31 0 6-2.69 6-6V20c0-9.94-8.06-18-18-18z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-captions">
      <path d="M38 8H10c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM22 22h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2zm14 0h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-subtitles">
      <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-enter">
      <path d="M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-exit">
      <path d="M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-play-circle">
      <path d="M20 33l12-9-12-9v18zm4-29C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-mute">
      <path d="M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13a17.94 17.94 0 0 0 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-low">
      <path d="M14 18v12h8l10 10V8L22 18h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-medium">
      <path d="M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-high">
      <path d="M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-spinner">
      <path d="M18.8 21l9.53-16.51C26.94 4.18 25.49 4 24 4c-4.8 0-9.19 1.69-12.64 4.51l7.33 12.69.11-.2zm24.28-3c-1.84-5.85-6.3-10.52-11.99-12.68L23.77 18h19.31zm.52 2H28.62l.58 1 9.53 16.5C41.99 33.94 44 29.21 44 24c0-1.37-.14-2.71-.4-4zm-26.53 4l-7.8-13.5C6.01 14.06 4 18.79 4 24c0 1.37.14 2.71.4 4h14.98l-2.31-4zM4.92 30c1.84 5.85 6.3 10.52 11.99 12.68L24.23 30H4.92zm22.54 0l-7.8 13.51c1.4.31 2.85.49 4.34.49 4.8 0 9.19-1.69 12.64-4.51L29.31 26.8 27.46 30z"></path>
    </symbol>
    <symbol viewBox="0 0 24 24" id="vjs-icon-hd">
      <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-chapters">
      <path d="M6 26h4v-4H6v4zm0 8h4v-4H6v4zm0-16h4v-4H6v4zm8 8h28v-4H14v4zm0 8h28v-4H14v4zm0-20v4h28v-4H14z"></path>
    </symbol>
    <symbol viewBox="0 0 40 40" id="vjs-icon-downloading">
      <path d="M18.208 36.875q-3.208-.292-5.979-1.729-2.771-1.438-4.812-3.729-2.042-2.292-3.188-5.229-1.146-2.938-1.146-6.23 0-6.583 4.334-11.416 4.333-4.834 10.833-5.5v3.166q-5.167.75-8.583 4.646Q6.25 14.75 6.25 19.958q0 5.209 3.396 9.104 3.396 3.896 8.562 4.646zM20 28.417L11.542 20l2.083-2.083 4.917 4.916v-11.25h2.916v11.25l4.875-4.916L28.417 20zm1.792 8.458v-3.167q1.833-.25 3.541-.958 1.709-.708 3.167-1.875l2.333 2.292q-1.958 1.583-4.25 2.541-2.291.959-4.791 1.167zm6.791-27.792q-1.541-1.125-3.25-1.854-1.708-.729-3.541-1.021V3.042q2.5.25 4.77 1.208 2.271.958 4.271 2.5zm4.584 21.584l-2.25-2.25q1.166-1.5 1.854-3.209.687-1.708.937-3.541h3.209q-.292 2.5-1.229 4.791-.938 2.292-2.521 4.209zm.541-12.417q-.291-1.833-.958-3.562-.667-1.73-1.833-3.188l2.375-2.208q1.541 1.916 2.458 4.208.917 2.292 1.167 4.75z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download">
      <path d="M10.8 40.55q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h26.35v-7.7h3.4v7.7q0 1.4-1 2.4t-2.4 1zM24 32.1L13.9 22.05l2.45-2.45 5.95 5.95V7.15h3.4v18.4l5.95-5.95 2.45 2.45z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-done">
      <path d="M9.8 40.5v-3.45h28.4v3.45zm9.2-9.05L7.4 19.85l2.45-2.35L19 26.65l19.2-19.2 2.4 2.4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-off">
      <path d="M4.9 4.75L43.25 43.1 41 45.3l-4.75-4.75q-.05.05-.075.025-.025-.025-.075-.025H10.8q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h22.05l-7-7-1.85 1.8L13.9 21.9l1.85-1.85L2.7 7zm26.75 14.7l2.45 2.45-3.75 3.8-2.45-2.5zM25.7 7.15V21.1l-3.4-3.45V7.15z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-share">
      <path d="M36 32.17c-1.52 0-2.89.59-3.93 1.54L17.82 25.4c.11-.45.18-.92.18-1.4s-.07-.95-.18-1.4l14.1-8.23c1.07 1 2.5 1.62 4.08 1.62 3.31 0 6-2.69 6-6s-2.69-6-6-6-6 2.69-6 6c0 .48.07.95.18 1.4l-14.1 8.23c-1.07-1-2.5-1.62-4.08-1.62-3.31 0-6 2.69-6 6s2.69 6 6 6c1.58 0 3.01-.62 4.08-1.62l14.25 8.31c-.1.42-.16.86-.16 1.31A5.83 5.83 0 1 0 36 32.17z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cog">
      <path d="M38.86 25.95c.08-.64.14-1.29.14-1.95s-.06-1.31-.14-1.95l4.23-3.31c.38-.3.49-.84.24-1.28l-4-6.93c-.25-.43-.77-.61-1.22-.43l-4.98 2.01c-1.03-.79-2.16-1.46-3.38-1.97L29 4.84c-.09-.47-.5-.84-1-.84h-8c-.5 0-.91.37-.99.84l-.75 5.3a14.8 14.8 0 0 0-3.38 1.97L9.9 10.1a1 1 0 0 0-1.22.43l-4 6.93c-.25.43-.14.97.24 1.28l4.22 3.31C9.06 22.69 9 23.34 9 24s.06 1.31.14 1.95l-4.22 3.31c-.38.3-.49.84-.24 1.28l4 6.93c.25.43.77.61 1.22.43l4.98-2.01c1.03.79 2.16 1.46 3.38 1.97l.75 5.3c.08.47.49.84.99.84h8c.5 0 .91-.37.99-.84l.75-5.3a14.8 14.8 0 0 0 3.38-1.97l4.98 2.01a1 1 0 0 0 1.22-.43l4-6.93c.25-.43.14-.97-.24-1.28l-4.22-3.31zM24 31c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-square">
      <path d="M36 8H12c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h24c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm0 28H12V12h24v24z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle">
      <circle cx="24" cy="24" r="20"></circle>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-outline">
      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-inner-circle">
      <path d="M24 4C12.97 4 4 12.97 4 24s8.97 20 20 20 20-8.97 20-20S35.03 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm6-16c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6 6 2.69 6 6z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cancel">
      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm10 27.17L31.17 34 24 26.83 16.83 34 14 31.17 21.17 24 14 16.83 16.83 14 24 21.17 31.17 14 34 16.83 26.83 24 34 31.17z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-replay">
      <path d="M24 10V2L14 12l10 10v-8c6.63 0 12 5.37 12 12s-5.37 12-12 12-12-5.37-12-12H8c0 8.84 7.16 16 16 16s16-7.16 16-16-7.16-16-16-16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-repeat">
      <path d="M14 14h20v6l8-8-8-8v6H10v12h4v-8zm20 20H14v-6l-8 8 8 8v-6h24V26h-4v8z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-5">
      <path d="M17.689 98l-8.697 8.696 8.697 8.697 2.486-2.485-4.32-4.319h1.302c4.93 0 9.071 1.722 12.424 5.165 3.352 3.443 5.029 7.638 5.029 12.584h3.55c0-2.958-.553-5.73-1.658-8.313-1.104-2.583-2.622-4.841-4.555-6.774-1.932-1.932-4.19-3.45-6.773-4.555-2.584-1.104-5.355-1.657-8.313-1.657H15.5l4.615-4.615zm-8.08 21.659v13.861h11.357v5.008H9.609V143h12.7c.834 0 1.55-.298 2.146-.894.596-.597.895-1.31.895-2.145v-7.781c0-.835-.299-1.55-.895-2.147a2.929 2.929 0 0 0-2.147-.894h-8.227v-5.096H25.35v-4.384z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-10">
      <path d="M42.315 125.63c0-4.997-1.694-9.235-5.08-12.713-3.388-3.479-7.571-5.218-12.552-5.218h-1.315l4.363 4.363-2.51 2.51-8.787-8.786L25.221 97l2.45 2.45-4.662 4.663h1.375c2.988 0 5.788.557 8.397 1.673 2.61 1.116 4.892 2.65 6.844 4.602 1.953 1.953 3.487 4.234 4.602 6.844 1.116 2.61 1.674 5.41 1.674 8.398zM8.183 142v-19.657H3.176V117.8h9.643V142zm13.63 0c-1.156 0-2.127-.393-2.912-1.178-.778-.778-1.168-1.746-1.168-2.902v-16.04c0-1.156.393-2.127 1.178-2.912.779-.779 1.746-1.168 2.902-1.168h7.696c1.156 0 2.126.392 2.911 1.177.779.78 1.168 1.747 1.168 2.903v16.04c0 1.156-.392 2.127-1.177 2.912-.779.779-1.746 1.168-2.902 1.168zm.556-4.636h6.583v-15.02H22.37z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-30">
      <path d="M26.047 97l-8.733 8.732 8.733 8.733 2.496-2.494-4.336-4.338h1.307c4.95 0 9.108 1.73 12.474 5.187 3.367 3.458 5.051 7.668 5.051 12.635h3.565c0-2.97-.556-5.751-1.665-8.346-1.109-2.594-2.633-4.862-4.574-6.802-1.94-1.941-4.208-3.466-6.803-4.575-2.594-1.109-5.375-1.664-8.345-1.664H23.85l4.634-4.634zM2.555 117.531v4.688h10.297v5.25H5.873v4.687h6.979v5.156H2.555V142H13.36c1.061 0 1.95-.395 2.668-1.186.718-.79 1.076-1.772 1.076-2.94v-16.218c0-1.168-.358-2.149-1.076-2.94-.717-.79-1.607-1.185-2.668-1.185zm22.482.14c-1.149 0-2.11.39-2.885 1.165-.78.78-1.172 1.744-1.172 2.893v15.943c0 1.149.388 2.11 1.163 2.885.78.78 1.745 1.172 2.894 1.172h7.649c1.148 0 2.11-.388 2.884-1.163.78-.78 1.17-1.745 1.17-2.894v-15.943c0-1.15-.386-2.111-1.16-2.885-.78-.78-1.746-1.172-2.894-1.172zm.553 4.518h6.545v14.93H25.59z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-5">
      <path d="M29.508 97l-2.431 2.43 4.625 4.625h-1.364c-2.965 0-5.742.554-8.332 1.66-2.589 1.107-4.851 2.629-6.788 4.566-1.937 1.937-3.458 4.2-4.565 6.788-1.107 2.59-1.66 5.367-1.66 8.331h3.557c0-4.957 1.68-9.16 5.04-12.611 3.36-3.45 7.51-5.177 12.451-5.177h1.304l-4.326 4.33 2.49 2.49 8.715-8.716zm-9.783 21.61v13.89h11.382v5.018H19.725V142h12.727a2.93 2.93 0 0 0 2.15-.896 2.93 2.93 0 0 0 .896-2.15v-7.798c0-.837-.299-1.554-.896-2.152a2.93 2.93 0 0 0-2.15-.896h-8.245V123h11.29v-4.392z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-10">
      <path d="M23.119 97l-2.386 2.383 4.538 4.538h-1.339c-2.908 0-5.633.543-8.173 1.63-2.54 1.085-4.76 2.577-6.66 4.478-1.9 1.9-3.392 4.12-4.478 6.66-1.085 2.54-1.629 5.264-1.629 8.172h3.49c0-4.863 1.648-8.986 4.944-12.372 3.297-3.385 7.368-5.078 12.216-5.078h1.279l-4.245 4.247 2.443 2.442 8.55-8.55zm-9.52 21.45v4.42h4.871V142h4.513v-23.55zm18.136 0c-1.125 0-2.066.377-2.824 1.135-.764.764-1.148 1.709-1.148 2.834v15.612c0 1.124.38 2.066 1.139 2.824.764.764 1.708 1.145 2.833 1.145h7.489c1.125 0 2.066-.378 2.824-1.136.764-.764 1.145-1.709 1.145-2.833v-15.612c0-1.125-.378-2.067-1.136-2.825-.764-.764-1.708-1.145-2.833-1.145zm.54 4.42h6.408v14.617h-6.407z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-30">
      <path d="M25.549 97l-2.437 2.434 4.634 4.635H26.38c-2.97 0-5.753.555-8.347 1.664-2.594 1.109-4.861 2.633-6.802 4.574-1.94 1.94-3.465 4.207-4.574 6.802-1.109 2.594-1.664 5.377-1.664 8.347h3.565c0-4.967 1.683-9.178 5.05-12.636 3.366-3.458 7.525-5.187 12.475-5.187h1.307l-4.335 4.338 2.495 2.494 8.732-8.732zm-11.553 20.53v4.689h10.297v5.249h-6.978v4.688h6.978v5.156H13.996V142h10.808c1.06 0 1.948-.395 2.666-1.186.718-.79 1.077-1.771 1.077-2.94v-16.217c0-1.169-.36-2.15-1.077-2.94-.718-.79-1.605-1.186-2.666-1.186zm21.174.168c-1.149 0-2.11.389-2.884 1.163-.78.78-1.172 1.745-1.172 2.894v15.942c0 1.15.388 2.11 1.162 2.885.78.78 1.745 1.17 2.894 1.17h7.649c1.149 0 2.11-.386 2.885-1.16.78-.78 1.17-1.746 1.17-2.895v-15.942c0-1.15-.387-2.11-1.161-2.885-.78-.78-1.745-1.172-2.894-1.172zm.552 4.516h6.542v14.931h-6.542z"></path>
    </symbol>
    <symbol viewBox="0 0 512 512" id="vjs-icon-audio-description">
      <g fill-rule="evenodd"><path d="M227.29 381.351V162.993c50.38-1.017 89.108-3.028 117.631 17.126 27.374 19.342 48.734 56.965 44.89 105.325-4.067 51.155-41.335 94.139-89.776 98.475-24.085 2.155-71.972 0-71.972 0s-.84-1.352-.773-2.568m48.755-54.804c31.43 1.26 53.208-16.633 56.495-45.386 4.403-38.51-21.188-63.552-58.041-60.796v103.612c-.036 1.466.575 2.22 1.546 2.57"></path><path d="M383.78 381.328c13.336 3.71 17.387-11.06 23.215-21.408 12.722-22.571 22.294-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.226 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M425.154 381.328c13.336 3.71 17.384-11.061 23.215-21.408 12.721-22.571 22.291-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.511c-.586 3.874 2.226 7.315 3.866 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M466.26 381.328c13.337 3.71 17.385-11.061 23.216-21.408 12.722-22.571 22.292-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.225 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894M4.477 383.005H72.58l18.573-28.484 64.169-.135s.065 19.413.065 28.62h48.756V160.307h-58.816c-5.653 9.537-140.85 222.697-140.85 222.697zm152.667-145.282v71.158l-40.453-.27 40.453-70.888z"></path></g>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-next-item">
      <path d="M12 36l17-12-17-12v24zm20-24v24h4V12h-4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-previous-item">
      <path d="M12 12h4v24h-4zm7 12l17 12V12z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-shuffle">
      <path d="M21.17 18.34L10.83 8 8 10.83l10.34 10.34 2.83-2.83zM29 8l4.09 4.09L8 37.17 10.83 40l25.09-25.09L40 19V8H29zm.66 18.83l-2.83 2.83 6.26 6.26L29 40h11V29l-4.09 4.09-6.25-6.26z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cast">
      <path d="M42 6H6c-2.21 0-4 1.79-4 4v6h4v-6h36v28H28v4h14c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM2 36v6h6c0-3.31-2.69-6-6-6zm0-8v4c5.52 0 10 4.48 10 10h4c0-7.73-6.27-14-14-14zm0-8v4c9.94 0 18 8.06 18 18h4c0-12.15-9.85-22-22-22z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-picture-in-picture-enter">
      <path d="M38 22H22v11.99h16V22zm8 16V9.96C46 7.76 44.2 6 42 6H6C3.8 6 2 7.76 2 9.96V38c0 2.2 1.8 4 4 4h36c2.2 0 4-1.8 4-4zm-4 .04H6V9.94h36v28.1z"></path>
    </symbol>
    <symbol viewBox="0 0 22 18" id="vjs-icon-picture-in-picture-exit">
      <path d="M18 4H4v10h14V4zm4 12V1.98C22 .88 21.1 0 20 0H2C.9 0 0 .88 0 1.98V16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H2V1.97h18v14.05z"></path>
      <path fill="none" d="M-1-3h24v24H-1z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-facebook">
      <path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-linkedin">
      <path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"></path>
    </symbol>
    <symbol viewBox="0 0 1200 1227" id="vjs-icon-twitter">
      <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"/>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-tumblr">
      <path d="M1328 1329l80 237q-23 35-111 66t-177 32q-104 2-190.5-26T787 1564t-95-106-55.5-120-16.5-118V676H452V461q72-26 129-69.5t91-90 58-102 34-99T779 12q1-5 4.5-8.5T791 0h244v424h333v252h-334v518q0 30 6.5 56t22.5 52.5 49.5 41.5 81.5 14q78-2 134-29z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-pinterest">
      <path d="M1664 896q0 209-103 385.5T1281.5 1561 896 1664q-111 0-218-32 59-93 78-164 9-34 54-211 20 39 73 67.5t114 28.5q121 0 216-68.5t147-188.5 52-270q0-114-59.5-214T1180 449t-255-63q-105 0-196 29t-154.5 77-109 110.5-67 129.5T377 866q0 104 40 183t117 111q30 12 38-20 2-7 8-31t8-30q6-23-11-43-51-61-51-151 0-151 104.5-259.5T904 517q151 0 235.5 82t84.5 213q0 170-68.5 289T980 1220q-61 0-98-43.5T859 1072q8-35 26.5-93.5t30-103T927 800q0-50-27-83t-77-33q-62 0-105 57t-43 142q0 73 25 122l-99 418q-17 70-13 177-206-91-333-281T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z"></path>
    </symbol>
  </defs>
</svg>`;const Np=Do?10009:Lo?461:8,pr={codes:{play:415,pause:19,ff:417,rw:412,back:Np},names:{415:"play",19:"pause",417:"ff",412:"rw",[Np]:"back"},isEventKey(r,e){return e=e.toLowerCase(),!!(this.names[r.keyCode]&&this.names[r.keyCode]===e)},getEventName(r){if(this.names[r.keyCode])return this.names[r.keyCode];if(this.codes[r.code]){const e=this.codes[r.code];return this.names[e]}return null}},Bp=5;class w2 extends ni{constructor(e){super(),this.player_=e,this.focusableComponents=[],this.isListening_=!1,this.isPaused_=!1,this.onKeyDown_=this.onKeyDown_.bind(this),this.lastFocusedComponent_=null}start(){this.isListening_||(this.player_.on("keydown",this.onKeyDown_),this.player_.on("modalKeydown",this.onKeyDown_),this.player_.on("loadedmetadata",()=>{this.focus(this.updateFocusableComponents()[0])}),this.player_.on("modalclose",()=>{this.refocusComponent()}),this.player_.on("focusin",this.handlePlayerFocus_.bind(this)),this.player_.on("focusout",this.handlePlayerBlur_.bind(this)),this.isListening_=!0,this.player_.errorDisplay&&this.player_.errorDisplay.on("aftermodalfill",()=>{this.updateFocusableComponents(),this.focusableComponents.length&&(this.focusableComponents.length>1?this.focusableComponents[1].focus():this.focusableComponents[0].focus())}))}stop(){this.player_.off("keydown",this.onKeyDown_),this.isListening_=!1}onKeyDown_(e){const t=e.originalEvent?e.originalEvent:e;if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)){if(this.isPaused_)return;t.preventDefault();const i=t.key.substring(5).toLowerCase();this.move(i)}else if(pr.isEventKey(t,"play")||pr.isEventKey(t,"pause")||pr.isEventKey(t,"ff")||pr.isEventKey(t,"rw")){t.preventDefault();const i=pr.getEventName(t);this.performMediaAction_(i)}else pr.isEventKey(t,"Back")&&e.target&&typeof e.target.closeable=="function"&&e.target.closeable()&&(t.preventDefault(),e.target.close())}performMediaAction_(e){if(this.player_)switch(e){case"play":this.player_.paused()&&this.player_.play();break;case"pause":this.player_.paused()||this.player_.pause();break;case"ff":this.userSeek_(this.player_.currentTime()+Bp);break;case"rw":this.userSeek_(this.player_.currentTime()-Bp);break}}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}pause(){this.isPaused_=!0}resume(){this.isPaused_=!1}handlePlayerBlur_(e){const t=e.relatedTarget;let i=null;const s=this.getCurrentComponent(e.target);t&&(i=!!t.closest(".video-js"),t.classList.contains("vjs-text-track-settings")&&!this.isPaused_&&this.searchForTrackSelect_()),(!e.currentTarget.contains(e.relatedTarget)&&!i||!t)&&(s&&s.name()==="CloseButton"?this.refocusComponent():(this.pause(),s&&s.el()&&(this.lastFocusedComponent_=s)))}handlePlayerFocus_(){this.getCurrentComponent()&&this.getCurrentComponent().getIsFocusable()&&this.resume()}updateFocusableComponents(){const e=this.player_,t=[];function i(s){for(const n of s)n.hasOwnProperty("el_")&&n.getIsFocusable()&&n.getIsAvailableToBeFocused(n.el())&&t.push(n),n.hasOwnProperty("children_")&&n.children_.length>0&&i(n.children_)}return e.children_.forEach(s=>{if(s.hasOwnProperty("el_"))if(s.getIsFocusable&&s.getIsAvailableToBeFocused&&s.getIsFocusable()&&s.getIsAvailableToBeFocused(s.el())){t.push(s);return}else s.hasOwnProperty("children_")&&s.children_.length>0?i(s.children_):s.hasOwnProperty("items")&&s.items.length>0?i(s.items):this.findSuitableDOMChild(s)&&t.push(s);if(s.name_==="ErrorDisplay"&&s.opened_){const n=s.el_.querySelector(".vjs-errors-ok-button-container");n&&n.querySelectorAll("button").forEach((o,l)=>{t.push({name:()=>"ModalButton"+(l+1),el:()=>o,getPositions:()=>{const u=o.getBoundingClientRect(),c={x:u.x,y:u.y,width:u.width,height:u.height,top:u.top,right:u.right,bottom:u.bottom,left:u.left},h={x:u.left+u.width/2,y:u.top+u.height/2,width:0,height:0,top:u.top+u.height/2,right:u.left+u.width/2,bottom:u.top+u.height/2,left:u.left+u.width/2};return{boundingClientRect:c,center:h}},getIsAvailableToBeFocused:()=>!0,getIsFocusable:u=>!0,focus:()=>o.focus()})})}}),this.focusableComponents=t,this.focusableComponents}findSuitableDOMChild(e){function t(i){if(e.getIsFocusable(i)&&e.getIsAvailableToBeFocused(i))return i;for(let s=0;s<i.children.length;s++){const n=i.children[s],a=t(n);if(a)return a}return null}return e.el()?t(e.el()):null}getCurrentComponent(e){this.updateFocusableComponents();const t=e||document.activeElement;if(this.focusableComponents.length){for(const i of this.focusableComponents)if(i.el()===t)return i}}add(e){const t=[...this.focusableComponents];e.hasOwnProperty("el_")&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el())&&t.push(e),this.focusableComponents=t,this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}remove(e){for(let t=0;t<this.focusableComponents.length;t++)if(this.focusableComponents[t].name()===e.name()){this.focusableComponents.splice(t,1),this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents});return}}clear(){this.focusableComponents.length>0&&(this.focusableComponents=[],this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents}))}move(e){const t=this.getCurrentComponent();if(!t)return;const i=t.getPositions(),s=this.focusableComponents.filter(a=>a!==t&&this.isInDirection_(i.boundingClientRect,a.getPositions().boundingClientRect,e)),n=this.findBestCandidate_(i.center,s,e);n?this.focus(n):this.trigger({type:"endOfFocusableComponents",direction:e,focusedComponent:t})}findBestCandidate_(e,t,i){let s=1/0,n=null;for(const a of t){const o=a.getPositions().center,l=this.calculateDistance_(e,o,i);l<s&&(s=l,n=a)}return n}isInDirection_(e,t,i){switch(i){case"right":return t.left>=e.right;case"left":return t.right<=e.left;case"down":return t.top>=e.bottom;case"up":return t.bottom<=e.top;default:return!1}}refocusComponent(){if(this.lastFocusedComponent_){this.player_.userActive()||this.player_.userActive(!0),this.updateFocusableComponents();for(let e=0;e<this.focusableComponents.length;e++)if(this.focusableComponents[e].name()===this.lastFocusedComponent_.name()){this.focus(this.focusableComponents[e]);return}}else this.focus(this.updateFocusableComponents()[0])}focus(e){typeof e=="object"&&(e.getIsAvailableToBeFocused(e.el())?e.focus():this.findSuitableDOMChild(e)&&this.findSuitableDOMChild(e).focus())}calculateDistance_(e,t,i){const s=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);let a;switch(i){case"right":case"left":a=s+n*100;break;case"up":a=n*2+s*.5;break;case"down":a=n*5+s;break;default:a=s+n}return a}searchForTrackSelect_(){const e=this;for(const t of e.updateFocusableComponents())if(t.constructor.name==="TextTrackSelect"){e.focus(t);break}}}class k2 extends ne{constructor(e,t,i){const s=je({createEl:!1},t);if(super(e,s,i),!t.playerOptions.sources||t.playerOptions.sources.length===0)for(let n=0,a=t.playerOptions.techOrder;n<a.length;n++){const o=ft(a[n]);let l=De.getTech(o);if(o||(l=ne.getComponent(o)),l&&l.isSupported()){e.loadTech_(o);break}}else e.src(t.playerOptions.sources)}}ne.registerComponent("MediaLoader",k2);class hl extends ne{constructor(e,t){super(e,t),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=i=>this.handleMouseOver(i),this.handleMouseOut_=i=>this.handleMouseOut(i),this.handleClick_=i=>this.handleClick(i),this.handleKeyDown_=i=>this.handleKeyDown(i),this.emitTapEvents(),this.enable()}createEl(e="div",t={},i={}){t=Object.assign({className:this.buildCSSClass(),tabIndex:0},t),e==="button"&&Re.error(`Creating a ClickableComponent with an HTML element of ${e} is not supported; use a Button instead.`),i=Object.assign({role:"button"},i),this.tabIndex_=t.tabIndex;const s=xe(e,t,i);return this.player_.options_.experimentalSvgIcons||s.appendChild(xe("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(s),s}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=xe("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e,t=this.el()){if(e===void 0)return this.controlText_||"Need Text";const i=this.localize(e);this.controlText_=e,Ps(this.controlTextEl_,i),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&t.setAttribute("title",i)}buildCSSClass(){return`vjs-control vjs-button ${super.buildCSSClass()}`}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),typeof this.tabIndex_<"u"&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),typeof this.tabIndex_<"u"&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){e.key===" "||e.key==="Enter"?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}ne.registerComponent("ClickableComponent",hl);class dc extends hl{constructor(e,t){super(e,t),this.update(),this.update_=i=>this.update(i),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return xe("div",{className:"vjs-poster"})}crossOrigin(e){if(typeof e>"u")return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){this.player_.log.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.$("img")&&(this.$("img").crossOrigin=e)}update(e){const t=this.player().poster();this.setSrc(t),t?this.show():this.hide()}setSrc(e){if(!e){this.el_.textContent="";return}this.$("img")||this.el_.appendChild(xe("picture",{className:"vjs-poster",tabIndex:-1},{},xe("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?qi(this.player_.play()):this.player_.pause())}}dc.prototype.crossorigin=dc.prototype.crossOrigin;ne.registerComponent("PosterImage",dc);const di="#222",Up="#ccc",P2={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function xu(r,e){let t;if(r.length===4)t=r[1]+r[1]+r[2]+r[2]+r[3]+r[3];else if(r.length===7)t=r.slice(1);else throw new Error("Invalid color code provided, "+r+"; must be formatted as e.g. #f0e or #f604e2.");return"rgba("+parseInt(t.slice(0,2),16)+","+parseInt(t.slice(2,4),16)+","+parseInt(t.slice(4,6),16)+","+e+")"}function Ni(r,e,t){try{r.style[e]=t}catch{return}}function $p(r){return r?`${r}px`:""}class O2 extends ne{constructor(e,t,i){super(e,t,i);const s=a=>this.updateDisplay(a),n=a=>{this.updateDisplayOverlay(),this.updateDisplay(a)};e.on("loadstart",a=>this.toggleDisplay(a)),e.on("useractive",s),e.on("userinactive",s),e.on("texttrackchange",s),e.on("loadedmetadata",a=>{this.updateDisplayOverlay(),this.preselectTrack(a)}),e.ready(Je(this,function(){if(e.tech_&&e.tech_.featuresNativeTextTracks){this.hide();return}e.on("fullscreenchange",n),e.on("playerresize",n);const a=$.screen.orientation||$,o=$.screen.orientation?"change":"orientationchange";a.addEventListener(o,n),e.on("dispose",()=>a.removeEventListener(o,n));const l=this.options_.playerOptions.tracks||[];for(let u=0;u<l.length;u++)this.player_.addRemoteTextTrack(l[u],!0);this.preselectTrack()}))}preselectTrack(){const e={captions:1,subtitles:1},t=this.player_.textTracks(),i=this.player_.cache_.selectedLanguage;let s,n,a;for(let o=0;o<t.length;o++){const l=t[o];i&&i.enabled&&i.language&&i.language===l.language&&l.kind in e?l.kind===i.kind?a=l:a||(a=l):i&&!i.enabled?(a=null,s=null,n=null):l.default&&(l.kind==="descriptions"&&!s?s=l:l.kind in e&&!n&&(n=l))}a?a.mode="showing":n?n.mode="showing":s&&(s.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){typeof $.WebVTT=="function"&&$.WebVTT.processCues($,[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){const a=[];for(let o=0;o<e.length;++o){const l=e[o];l.mode==="showing"&&a.push(l)}this.updateForTrack(a);return}let i=null,s=null,n=e.length;for(;n--;){const a=e[n];a.mode==="showing"&&(a.kind==="descriptions"?i=a:s=a)}if(s?(this.getAttribute("aria-live")!=="off"&&this.setAttribute("aria-live","off"),this.updateForTrack(s)):i&&(this.getAttribute("aria-live")!=="assertive"&&this.setAttribute("aria-live","assertive"),this.updateForTrack(i)),!($.CSS!==void 0&&$.CSS.supports("inset","10px"))){const a=this.el_,o=a.querySelectorAll(".vjs-text-track-cue"),l=this.player_.controlBar.el_.getBoundingClientRect().height,u=this.player_.el_.getBoundingClientRect().height;a.style="",Ni(a,"position","relative"),Ni(a,"height",u-l+"px"),Ni(a,"top","unset"),Ro?Ni(a,"bottom",u+"px"):Ni(a,"bottom","0px"),o.length>0&&o.forEach(c=>{if(c.style.inset){const h=c.style.inset.split(" ");h.length===3&&Object.assign(c.style,{top:h[0],right:h[1],bottom:h[2],left:"unset"})}})}}updateDisplayOverlay(){if(!this.player_.videoHeight()||!($.CSS!==void 0&&$.CSS.supports("inset-inline: 10px")))return;const e=this.player_.currentWidth(),t=this.player_.currentHeight(),i=e/t,s=this.player_.videoWidth()/this.player_.videoHeight();let n=0,a=0;Math.abs(i-s)>.1&&(i>s?n=Math.round((e-t*s)/2):a=Math.round((t-e/s)/2)),Ni(this.el_,"insetInline",$p(n)),Ni(this.el_,"insetBlock",$p(a))}updateDisplayState(e){const t=this.player_.textTrackSettings.getValues(),i=e.activeCues;let s=i.length;for(;s--;){const n=i[s];if(!n)continue;const a=n.displayState;if(t.color&&(a.firstChild.style.color=t.color),t.textOpacity&&Ni(a.firstChild,"color",xu(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(a.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&Ni(a.firstChild,"backgroundColor",xu(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?Ni(a,"backgroundColor",xu(t.windowColor,t.windowOpacity)):a.style.backgroundColor=t.windowColor),t.edgeStyle&&(t.edgeStyle==="dropshadow"?a.firstChild.style.textShadow=`2px 2px 3px ${di}, 2px 2px 4px ${di}, 2px 2px 5px ${di}`:t.edgeStyle==="raised"?a.firstChild.style.textShadow=`1px 1px ${di}, 2px 2px ${di}, 3px 3px ${di}`:t.edgeStyle==="depressed"?a.firstChild.style.textShadow=`1px 1px ${Up}, 0 1px ${Up}, -1px -1px ${di}, 0 -1px ${di}`:t.edgeStyle==="uniform"&&(a.firstChild.style.textShadow=`0 0 4px ${di}, 0 0 4px ${di}, 0 0 4px ${di}, 0 0 4px ${di}`)),t.fontPercent&&t.fontPercent!==1){const o=$.parseFloat(a.style.fontSize);a.style.fontSize=o*t.fontPercent+"px",a.style.height="auto",a.style.top="auto"}t.fontFamily&&t.fontFamily!=="default"&&(t.fontFamily==="small-caps"?a.firstChild.style.fontVariant="small-caps":a.firstChild.style.fontFamily=P2[t.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),typeof $.WebVTT!="function"||e.every(i=>!i.activeCues))return;const t=[];for(let i=0;i<e.length;++i){const s=e[i];for(let n=0;n<s.activeCues.length;++n)t.push(s.activeCues[n])}$.WebVTT.processCues($,t,this.el_);for(let i=0;i<e.length;++i){const s=e[i];for(let n=0;n<s.activeCues.length;++n){const a=s.activeCues[n].displayState;Qs(a,"vjs-text-track-cue","vjs-text-track-cue-"+(s.language?s.language:i)),s.language&&Gr(a,"lang",s.language)}this.player_.textTrackSettings&&this.updateDisplayState(s)}}}ne.registerComponent("TextTrackDisplay",O2);class M2 extends ne{createEl(){const e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),i=xe("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),s=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return s.appendChild(i),s}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}}ne.registerComponent("LoadingSpinner",M2);class Ot extends hl{createEl(e,t={},i={}){e="button",t=Object.assign({className:this.buildCSSClass()},t),i=Object.assign({type:"button"},i);const s=xe(e,t,i);return this.player_.options_.experimentalSvgIcons||s.appendChild(xe("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(s),s}addChild(e,t={}){const i=this.constructor.name;return Re.warn(`Adding an actionable (user controllable) child to a Button (${i}) is not supported; use a ClickableComponent instead.`),ne.prototype.addChild.call(this,e,t)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){if(e.key===" "||e.key==="Enter"){e.stopPropagation();return}super.handleKeyDown(e)}}ne.registerComponent("Button",Ot);class ty extends Ot{constructor(e,t){super(e,t),this.mouseused_=!1,this.setIcon("play"),this.on("mousedown",i=>this.handleMouseDown(i))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const t=this.player_.play();if(e.type==="tap"||this.mouseused_&&"clientX"in e&&"clientY"in e){qi(t),this.player_.tech(!0)&&this.player_.tech(!0).focus();return}const i=this.player_.getChild("controlBar"),s=i&&i.getChild("playToggle");if(!s){this.player_.tech(!0).focus();return}const n=()=>s.focus();Mn(t)?t.then(n,()=>{}):this.setTimeout(n,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}}ty.prototype.controlText_="Play Video";ne.registerComponent("BigPlayButton",ty);class F2 extends Ot{constructor(e,t){super(e,t),this.setIcon("cancel"),this.controlText(t&&t.controlText||this.localize("Close"))}buildCSSClass(){return`vjs-close-button ${super.buildCSSClass()}`}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){e.key==="Escape"?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}ne.registerComponent("CloseButton",F2);class iy extends Ot{constructor(e,t={}){super(e,t),t.replay=t.replay===void 0||t.replay,this.setIcon("play"),this.on(e,"play",i=>this.handlePlay(i)),this.on(e,"pause",i=>this.handlePause(i)),t.replay&&this.on(e,"ended",i=>this.handleEnded(i))}buildCSSClass(){return`vjs-play-control ${super.buildCSSClass()}`}handleClick(e){this.player_.paused()?qi(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.setIcon("pause"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.setIcon("play"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.setIcon("replay"),this.controlText("Replay"),this.one(this.player_,"seeked",t=>this.handleSeeked(t))}}iy.prototype.controlText_="Play";ne.registerComponent("PlayToggle",iy);class Xr extends ne{constructor(e,t){super(e,t),this.on(e,["timeupdate","ended","seeking"],i=>this.update(i)),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),t=super.createEl("div",{className:`${e} vjs-time-control vjs-control`}),i=xe("span",{className:"vjs-control-text",textContent:`${this.localize(this.labelText_)}`},{role:"presentation"});return t.appendChild(i),this.contentEl_=xe("span",{className:`${e}-display`},{role:"presentation"}),t.appendChild(this.contentEl_),t}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}update(e){!this.player_.options_.enableSmoothSeeking&&e.type==="seeking"||this.updateContent(e)}updateTextNode_(e=0){e=ir(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",()=>{if(!this.contentEl_)return;let t=this.textNode_;t&&this.contentEl_.firstChild!==t&&(t=null,Re.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=ue.createTextNode(this.formattedTime_),this.textNode_&&(t?this.contentEl_.replaceChild(this.textNode_,t):this.contentEl_.appendChild(this.textNode_))}))}updateContent(e){}}Xr.prototype.labelText_="Time";Xr.prototype.controlText_="Time";ne.registerComponent("TimeDisplay",Xr);class gh extends Xr{buildCSSClass(){return"vjs-current-time"}updateContent(e){let t;this.player_.ended()?t=this.player_.duration():e&&e.target&&typeof e.target.pendingSeekTime=="function"&&e.target.pendingSeekTime()!==null?t=e.target.pendingSeekTime():t=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)}}gh.prototype.labelText_="Current Time";gh.prototype.controlText_="Current Time";ne.registerComponent("CurrentTimeDisplay",gh);class mh extends Xr{constructor(e,t){super(e,t);const i=s=>this.updateContent(s);this.on(e,"durationchange",i),this.on(e,"loadstart",i),this.on(e,"loadedmetadata",i)}buildCSSClass(){return"vjs-duration"}updateContent(e){const t=this.player_.duration();this.updateTextNode_(t)}}mh.prototype.labelText_="Duration";mh.prototype.controlText_="Duration";ne.registerComponent("DurationDisplay",mh);class N2 extends ne{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=super.createEl("div"),i=super.createEl("span",{textContent:"/"});return t.appendChild(i),e.appendChild(t),e}}ne.registerComponent("TimeDivider",N2);class yh extends Xr{constructor(e,t){super(e,t),this.on(e,"durationchange",i=>this.updateContent(i))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return this.options_.displayNegative!==!1&&e.insertBefore(xe("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if(typeof this.player_.duration()!="number")return;let t;this.player_.ended()?t=0:this.player_.remainingTimeDisplay?t=this.player_.remainingTimeDisplay():t=this.player_.remainingTime(),this.updateTextNode_(t)}}yh.prototype.labelText_="Remaining Time";yh.prototype.controlText_="Remaining Time";ne.registerComponent("RemainingTimeDisplay",yh);class B2 extends ne{constructor(e,t){super(e,t),this.updateShowing(),this.on(this.player(),"durationchange",i=>this.updateShowing(i))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=xe("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(xe("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")}`})),this.contentEl_.appendChild(ue.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}}ne.registerComponent("LiveDisplay",B2);class sy extends Ot{constructor(e,t){super(e,t),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=i=>this.updateLiveEdgeStatus(i),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.setIcon("circle",e),this.textEl_=xe("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}}sy.prototype.controlText_="Seek to live, currently playing live";ne.registerComponent("SeekToLive",sy);function Zn(r,e,t){return r=Number(r),Math.min(t,Math.max(e,isNaN(r)?e:r))}var U2=Object.freeze({__proto__:null,clamp:Zn});class Th extends ne{constructor(e,t){super(e,t),this.handleMouseDown_=i=>this.handleMouseDown(i),this.handleMouseUp_=i=>this.handleMouseUp(i),this.handleKeyDown_=i=>this.handleKeyDown(i),this.handleClick_=i=>this.handleClick(i),this.handleMouseMove_=i=>this.handleMouseMove(i),this.update_=i=>this.update(i),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e,t={},i={}){return t.className=t.className+" vjs-slider",t=Object.assign({tabIndex:0},t),i=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},i),super.createEl(e,t,i)}handleMouseDown(e){const t=this.bar.el_.ownerDocument;e.type==="mousedown"&&e.preventDefault(),e.type==="touchstart"&&!Qi&&e.preventDefault(),L0(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const t=this.bar.el_.ownerDocument;R0(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove_),this.off(t,"mouseup",this.handleMouseUp_),this.off(t,"touchmove",this.handleMouseMove_),this.off(t,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_||(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",()=>{const t=this.vertical()?"height":"width";this.bar.el().style[t]=(e*100).toFixed(2)+"%"})),e}getProgress(){return Number(Zn(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const t=nl(this.el_,e);return this.vertical()?t.y:t.x}handleKeyDown(e){const t=this.options_.playerOptions.spatialNavigation,i=t&&t.enabled,s=t&&t.horizontalSeek;i?s&&e.key==="ArrowLeft"||!s&&e.key==="ArrowDown"?(e.preventDefault(),e.stopPropagation(),this.stepBack()):s&&e.key==="ArrowRight"||!s&&e.key==="ArrowUp"?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(this.pendingSeekTime()&&(this.pendingSeekTime(null),this.userSeek_(this.player_.currentTime())),super.handleKeyDown(e)):e.key==="ArrowLeft"||e.key==="ArrowDown"?(e.preventDefault(),e.stopPropagation(),this.stepBack()):e.key==="ArrowUp"||e.key==="ArrowRight"?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(e===void 0)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}}ne.registerComponent("Slider",Th);const Au=(r,e)=>Zn(r/e*100,0,100).toFixed(2)+"%";class $2 extends ne{constructor(e,t){super(e,t),this.partEls_=[],this.on(e,"progress",i=>this.update(i))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),t=xe("span",{className:"vjs-control-text"}),i=xe("span",{textContent:this.localize("Loaded")}),s=ue.createTextNode(": ");return this.percentageEl_=xe("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(i),t.appendChild(s),t.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",()=>{const t=this.player_.liveTracker,i=this.player_.buffered(),s=t&&t.isLive()?t.seekableEnd():this.player_.duration(),n=this.player_.bufferedEnd(),a=this.partEls_,o=Au(n,s);this.percent_!==o&&(this.el_.style.width=o,Ps(this.percentageEl_,o),this.percent_=o);for(let l=0;l<i.length;l++){const u=i.start(l),c=i.end(l);let h=a[l];h||(h=this.el_.appendChild(xe()),a[l]=h),!(h.dataset.start===u&&h.dataset.end===c)&&(h.dataset.start=u,h.dataset.end=c,h.style.left=Au(u,n),h.style.width=Au(c-u,n))}for(let l=a.length;l>i.length;l--)this.el_.removeChild(a[l-1]);a.length=i.length})}}ne.registerComponent("LoadProgressBar",$2);class V2 extends ne{constructor(e,t){super(e,t),this.update=Ji(Je(this,this.update),mi)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,t,i){const s=Wn(this.el_),n=Hr(this.player_.el()),a=e.width*t;if(!n||!s)return;let o=e.left-n.left+a,l=e.width-a+(n.right-e.right);l||(l=e.width-a,o=a);let u=s.width/2;o<u?u+=u-o:l<u&&(u=l),u<0?u=0:u>s.width&&(u=s.width),u=Math.round(u),this.el_.style.right=`-${u}px`,this.write(i)}write(e){Ps(this.el_,e)}updateTime(e,t,i,s){this.requestNamedAnimationFrame("TimeTooltip#updateTime",()=>{let n;const a=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const o=this.player_.liveTracker.liveWindow(),l=o-t*o;n=(l<1?"":"-")+ir(l,o)}else n=ir(i,a);this.update(e,t,n),s&&s()})}}ne.registerComponent("TimeTooltip",V2);class _h extends ne{constructor(e,t){super(e,t),this.setIcon("circle"),this.update=Ji(Je(this,this.update),mi)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,t,i){const s=this.getChild("timeTooltip");if(!s)return;const n=i&&i.target&&typeof i.target.pendingSeekTime=="function"?i.target.pendingSeekTime():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();s.updateTime(e,t,n)}}_h.prototype.options_={children:[]};!kt&&!Di&&_h.prototype.options_.children.push("timeTooltip");ne.registerComponent("PlayProgressBar",_h);class ry extends ne{constructor(e,t){super(e,t),this.update=Ji(Je(this,this.update),mi)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t){const i=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,i,()=>{this.el_.style.left=`${e.width*t}px`})}}ry.prototype.options_={children:["timeTooltip"]};ne.registerComponent("MouseTimeDisplay",ry);class dl extends Th{constructor(e,t){t=je(dl.prototype.options_,t),t.children=[...t.children];const i=e.options_.disableSeekWhileScrubbingOnMobile&&(kt||Di)||e.options_.disableSeekWhileScrubbingOnSTV;(!kt&&!Di||i)&&t.children.splice(1,0,"mouseTimeDisplay"),super(e,t),this.shouldDisableSeekWhileScrubbing_=i,this.pendingSeekTime_=null,this.setEventHandlers_()}setEventHandlers_(){this.update_=Je(this,this.update),this.update=Ji(this.update_,mi),this.on(this.player_,["durationchange","timeupdate"],this.update),this.on(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in ue&&"visibilityState"in ue&&this.on(ue,"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){ue.visibilityState==="hidden"?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,mi))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&e.type!=="ended"||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if(ue.visibilityState==="hidden")return;const t=super.update();return this.requestNamedAnimationFrame("SeekBar#update",()=>{const i=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),s=this.player_.liveTracker;let n=this.player_.duration();s&&s.isLive()&&(n=this.player_.liveTracker.liveCurrentTime()),this.percent_!==t&&(this.el_.setAttribute("aria-valuenow",(t*100).toFixed(2)),this.percent_=t),(this.currentTime_!==i||this.duration_!==n)&&(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[ir(i,n),ir(n,n)],"{1} of {2}")),this.currentTime_=i,this.duration_=n),this.bar&&this.bar.update(Hr(this.el()),this.getProgress(),e)}),t}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}pendingSeekTime(e){if(e!==void 0)if(e!==null){const t=this.player_.duration();this.pendingSeekTime_=Math.max(0,Math.min(e,t))}else this.pendingSeekTime_=null;return this.pendingSeekTime_}getPercent(){if(this.pendingSeekTime()!==null)return this.pendingSeekTime()/this.player_.duration();const e=this.getCurrentTime_();let t;const i=this.player_.liveTracker;return i&&i.isLive()?(t=(e-i.seekableStart())/i.liveWindow(),i.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t}handleMouseDown(e){zn(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.shouldDisableSeekWhileScrubbing_||this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e,t=!1){if(!zn(e)||isNaN(this.player_.duration()))return;!t&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);let i;const s=this.calculateDistance(e),n=this.player_.liveTracker;if(!n||!n.isLive())i=s*this.player_.duration(),i===this.player_.duration()&&(i=i-.1);else{if(s>=.99){n.seekToLiveEdge();return}const a=n.seekableStart(),o=n.liveCurrentTime();if(i=a+s*n.liveWindow(),i>=o&&(i=o),i<=a&&(i=a+.1),i===1/0)return}this.shouldDisableSeekWhileScrubbing_?this.pendingSeekTime(i):this.userSeek_(i),this.player_.options_.enableSmoothSeeking&&this.update()}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.pendingSeekTime()!==null&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?qi(this.player_.play()):this.update_()}handlePendingSeek_(e){this.player_.paused()||this.player_.pause();const t=this.pendingSeekTime()!==null?this.pendingSeekTime():this.player_.currentTime();this.pendingSeekTime(t+e),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}stepForward(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(this.options().stepSeconds):this.userSeek_(this.player_.currentTime()+this.options().stepSeconds)}stepBack(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(-this.options().stepSeconds):this.userSeek_(this.player_.currentTime()-this.options().stepSeconds)}handleAction(e){this.pendingSeekTime()!==null&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const t=this.player_.liveTracker;if(e.key===" "||e.key==="Enter")e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if(e.key==="Home")e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if(e.key==="End")e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(e.key)){e.preventDefault(),e.stopPropagation();const i=parseInt(e.key,10)*.1;t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*i):this.userSeek_(this.player_.duration()*i)}else e.key==="PageDown"?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-this.options().stepSeconds*this.options().pageMultiplier)):e.key==="PageUp"?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+this.options().stepSeconds*this.options().pageMultiplier)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["durationchange","timeupdate"],this.update),this.off(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in ue&&"visibilityState"in ue&&this.off(ue,"visibilitychange",this.toggleVisibility_),super.dispose()}}dl.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar",stepSeconds:5,pageMultiplier:12};ne.registerComponent("SeekBar",dl);class ny extends ne{constructor(e,t){super(e,t),this.handleMouseMove=Ji(Je(this,this.handleMouseMove),mi),this.throttledHandleMouseSeek=Ji(Je(this,this.handleMouseSeek),mi),this.handleMouseUpHandler_=i=>this.handleMouseUp(i),this.handleMouseDownHandler_=i=>this.handleMouseDown(i),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const t=this.getChild("seekBar");if(!t)return;const i=t.getChild("playProgressBar"),s=t.getChild("mouseTimeDisplay");if(!i&&!s)return;const n=t.el(),a=Wn(n);let o=nl(n,e).x;o=Zn(o,0,1),s&&s.update(a,o),i&&i.update(a,t.getProgress())}handleMouseSeek(e){const t=this.getChild("seekBar");t&&t.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach(e=>e.disable&&e.disable()),!!this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&qi(this.player_.play())}}enable(){this.children().forEach(e=>e.enable&&e.enable()),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const t=this.el_.ownerDocument,i=this.getChild("seekBar");i&&i.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}}ny.prototype.options_={children:["seekBar"]};ne.registerComponent("ProgressControl",ny);class ay extends Ot{constructor(e,t){super(e,t),this.setIcon("picture-in-picture-enter"),this.on(e,["enterpictureinpicture","leavepictureinpicture"],i=>this.handlePictureInPictureChange(i)),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],i=>this.handlePictureInPictureEnabledChange(i)),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],()=>this.handlePictureInPictureAudioModeChange()),this.disable()}buildCSSClass(){return`vjs-picture-in-picture-control vjs-hidden ${super.buildCSSClass()}`}handlePictureInPictureAudioModeChange(){if(!(this.player_.currentType().substring(0,5)==="audio"||this.player_.audioPosterMode()||this.player_.audioOnlyMode())){this.show();return}this.player_.isInPictureInPicture()&&this.player_.exitPictureInPicture(),this.hide()}handlePictureInPictureEnabledChange(){ue.pictureInPictureEnabled&&this.player_.disablePictureInPicture()===!1||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in $?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?(this.setIcon("picture-in-picture-exit"),this.controlText("Exit Picture-in-Picture")):(this.setIcon("picture-in-picture-enter"),this.controlText("Picture-in-Picture")),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}show(){typeof ue.exitPictureInPicture=="function"&&super.show()}}ay.prototype.controlText_="Picture-in-Picture";ne.registerComponent("PictureInPictureToggle",ay);class oy extends Ot{constructor(e,t){super(e,t),this.setIcon("fullscreen-enter"),this.on(e,"fullscreenchange",i=>this.handleFullscreenChange(i)),ue[e.fsApi_.fullscreenEnabled]===!1&&this.disable()}buildCSSClass(){return`vjs-fullscreen-control ${super.buildCSSClass()}`}handleFullscreenChange(e){this.player_.isFullscreen()?(this.controlText("Exit Fullscreen"),this.setIcon("fullscreen-exit")):(this.controlText("Fullscreen"),this.setIcon("fullscreen-enter"))}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}oy.prototype.controlText_="Fullscreen";ne.registerComponent("FullscreenToggle",oy);const G2=function(r,e){e.tech_&&!e.tech_.featuresVolumeControl&&r.addClass("vjs-hidden"),r.on(e,"loadstart",function(){e.tech_.featuresVolumeControl?r.removeClass("vjs-hidden"):r.addClass("vjs-hidden")})};class H2 extends ne{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return this.setIcon("circle",e),e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}}ne.registerComponent("VolumeLevel",H2);class q2 extends ne{constructor(e,t){super(e,t),this.update=Ji(Je(this,this.update),mi)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,t,i,s){if(!i){const n=Hr(this.el_),a=Hr(this.player_.el()),o=e.width*t;if(!a||!n)return;const l=e.left-a.left+o,u=e.width-o+(a.right-e.right);let c=n.width/2;l<c?c+=c-l:u<c&&(c=u),c<0?c=0:c>n.width&&(c=n.width),this.el_.style.right=`-${c}px`}this.write(`${s}%`)}write(e){Ps(this.el_,e)}updateVolume(e,t,i,s,n){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",()=>{this.update(e,t,i,s.toFixed(0)),n&&n()})}}ne.registerComponent("VolumeLevelTooltip",q2);class ly extends ne{constructor(e,t){super(e,t),this.update=Ji(Je(this,this.update),mi)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t,i){const s=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,i,s,()=>{i?this.el_.style.bottom=`${e.height*t}px`:this.el_.style.left=`${e.width*t}px`})}}ly.prototype.options_={children:["volumeLevelTooltip"]};ne.registerComponent("MouseVolumeLevelDisplay",ly);class fl extends Th{constructor(e,t){super(e,t),this.on("slideractive",i=>this.updateLastVolume_(i)),this.on(e,"volumechange",i=>this.updateARIAAttributes(i)),e.ready(()=>this.updateARIAAttributes())}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){zn(e)&&super.handleMouseDown(e)}handleMouseMove(e){const t=this.getChild("mouseVolumeLevelDisplay");if(t){const i=this.el(),s=Hr(i),n=this.vertical();let a=nl(i,e);a=n?a.y:a.x,a=Zn(a,0,1),t.update(s,a,n)}zn(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")}volumeAsPercentage_(){return Math.round(this.player_.volume()*100)}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",()=>{this.player_.volume()===0&&this.player_.lastVolume_(e)})}}fl.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"};!kt&&!Di&&fl.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay");fl.prototype.playerEvent="volumechange";ne.registerComponent("VolumeBar",fl);class uy extends ne{constructor(e,t={}){t.vertical=t.vertical||!1,(typeof t.volumeBar>"u"||Vr(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),super(e,t),G2(this,e),this.throttledHandleMouseMove=Ji(Je(this,this.handleMouseMove),mi),this.handleMouseUpHandler_=i=>this.handleMouseUp(i),this.on("mousedown",i=>this.handleMouseDown(i)),this.on("touchstart",i=>this.handleMouseDown(i)),this.on("mousemove",i=>this.handleMouseMove(i)),this.on(this.volumeBar,["focus","slideractive"],()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")}),this.on(this.volumeBar,["blur","sliderinactive"],()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")})}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:`vjs-volume-control vjs-control ${e}`})}handleMouseDown(e){const t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}}uy.prototype.options_={children:["volumeBar"]};ne.registerComponent("VolumeControl",uy);const j2=function(r,e){e.tech_&&!e.tech_.featuresMuteControl&&r.addClass("vjs-hidden"),r.on(e,"loadstart",function(){e.tech_.featuresMuteControl?r.removeClass("vjs-hidden"):r.addClass("vjs-hidden")})};class cy extends Ot{constructor(e,t){super(e,t),j2(this,e),this.on(e,["loadstart","volumechange"],i=>this.update(i))}buildCSSClass(){return`vjs-mute-control ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.volume(),i=this.player_.lastVolume_();if(t===0){const s=i<.1?.1:i;this.player_.volume(s),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let t=3;this.setIcon("volume-high"),kt&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),e===0||this.player_.muted()?(this.setIcon("volume-mute"),t=0):e<.33?(this.setIcon("volume-low"),t=1):e<.67&&(this.setIcon("volume-medium"),t=2),sl(this.el_,[0,1,2,3].reduce((i,s)=>i+`${s?" ":""}vjs-vol-${s}`,"")),Qs(this.el_,`vjs-vol-${t}`)}updateControlText_(){const t=this.player_.muted()||this.player_.volume()===0?"Unmute":"Mute";this.controlText()!==t&&this.controlText(t)}}cy.prototype.controlText_="Mute";ne.registerComponent("MuteToggle",cy);class hy extends ne{constructor(e,t={}){typeof t.inline<"u"?t.inline=t.inline:t.inline=!0,(typeof t.volumeControl>"u"||Vr(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),super(e,t),this.handleKeyPressHandler_=i=>this.handleKeyPress(i),this.on(e,["loadstart"],i=>this.volumePanelState_(i)),this.on(this.muteToggle,"keyup",i=>this.handleKeyPress(i)),this.on(this.volumeControl,"keyup",i=>this.handleVolumeControlKeyUp(i)),this.on("keydown",i=>this.handleKeyPress(i)),this.on("mouseover",i=>this.handleMouseOver(i)),this.on("mouseout",i=>this.handleMouseOut(i)),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:`vjs-volume-panel vjs-control ${e}`})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){e.key==="Escape"&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),ri(ue,"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),Pt(ue,"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){e.key==="Escape"&&this.handleMouseOut()}}hy.prototype.options_={children:["muteToggle","volumeControl"]};ne.registerComponent("VolumePanel",hy);class dy extends Ot{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`forward-${this.skipTime}`),this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return`vjs-skip-forward-${this.getSkipForwardTime()} ${super.buildCSSClass()}`}handleClick(e){if(isNaN(this.player_.duration()))return;const t=this.player_.currentTime(),i=this.player_.liveTracker,s=i&&i.isLive()?i.seekableEnd():this.player_.duration();let n;t+this.skipTime<=s?n=t+this.skipTime:n=s,this.player_.currentTime(n)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}}dy.prototype.controlText_="Skip Forward";ne.registerComponent("SkipForward",dy);class fy extends Ot{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`replay-${this.skipTime}`),this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return`vjs-skip-backward-${this.getSkipBackwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),i=this.player_.liveTracker,s=i&&i.isLive()&&i.seekableStart();let n;s&&t-this.skipTime<=s?n=s:t>=this.skipTime?n=t-this.skipTime:n=0,this.player_.currentTime(n)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}fy.prototype.controlText_="Skip Backward";ne.registerComponent("SkipBackward",fy);class py extends ne{constructor(e,t){super(e,t),t&&(this.menuButton_=t.menuButton),this.focusedChild_=-1,this.on("keydown",i=>this.handleKeyDown(i)),this.boundHandleBlur_=i=>this.handleBlur(i),this.boundHandleTapClick_=i=>this.handleTapClick(i)}addEventListenerForItem(e){e instanceof ne&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof ne&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){typeof e=="string"&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const t=this.addChild(e);t&&this.addEventListenerForItem(t)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=xe(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const t=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),ri(t,"click",function(i){i.preventDefault(),i.stopImmediatePropagation()}),t}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const t=e.relatedTarget||ue.activeElement;if(!this.children().some(i=>i.el()===t)){const i=this.menuButton_;i&&i.buttonPressed_&&t!==i.el().firstChild&&i.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const t=this.children();if(!Array.isArray(t))return;const i=t.filter(s=>s.el()===e.target)[0];if(!i)return;i.name()!=="CaptionSettingsMenuItem"&&this.menuButton_.focus()}}handleKeyDown(e){e.key==="ArrowLeft"||e.key==="ArrowDown"?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(e.key==="ArrowRight"||e.key==="ArrowUp")&&(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_-1),this.focus(e)}focus(e=0){const t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())}}ne.registerComponent("Menu",py);class vh extends ne{constructor(e,t={}){super(e,t),this.menuButton_=new Ot(e,t),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const i=Ot.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+i,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const s=n=>this.handleClick(n);this.handleMenuKeyUp_=n=>this.handleMenuKeyUp(n),this.on(this.menuButton_,"tap",s),this.on(this.menuButton_,"click",s),this.on(this.menuButton_,"keydown",n=>this.handleKeyDown(n)),this.on(this.menuButton_,"mouseenter",()=>{this.addClass("vjs-hover"),this.menu.show(),ri(ue,"keyup",this.handleMenuKeyUp_)}),this.on("mouseleave",n=>this.handleMouseLeave(n)),this.on("keydown",n=>this.handleSubmenuKeyDown(n))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new py(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const t=xe("li",{className:"vjs-menu-title",textContent:ft(this.options_.title),tabIndex:-1}),i=new ne(this.player_,{el:t});e.addItem(i)}if(this.items=this.createItems(),this.items)for(let t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}setIcon(e){return super.setIcon(e,this.menuButton_.el_)}buildWrapperCSSClass(){let e="vjs-menu-button";this.options_.inline===!0?e+="-inline":e+="-popup";const t=Ot.prototype.buildCSSClass();return`vjs-menu-button ${e} ${t} ${super.buildCSSClass()}`}buildCSSClass(){let e="vjs-menu-button";return this.options_.inline===!0?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${super.buildCSSClass()}`}controlText(e,t=this.menuButton_.el()){return this.menuButton_.controlText(e,t)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),Pt(ue,"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){e.key==="Escape"||e.key==="Tab"?(this.buttonPressed_&&this.unpressButton(),!e.key==="Tab"&&(e.preventDefault(),this.menuButton_.focus())):(e.key==="Up"||e.key==="Down"&&!(this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))}handleMenuKeyUp(e){(e.key==="Escape"||e.key==="Tab")&&this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){(e.key==="Escape"||e.key==="Tab")&&(this.buttonPressed_&&this.unpressButton(),!e.key==="Tab"&&(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),kt&&x0())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}}ne.registerComponent("MenuButton",vh);class Sh extends vh{constructor(e,t){const i=t.tracks;if(super(e,t),this.items.length<=1&&this.hide(),!i)return;const s=Je(this,this.update);i.addEventListener("removetrack",s),i.addEventListener("addtrack",s),i.addEventListener("labelchange",s),this.player_.on("ready",s),this.player_.on("dispose",function(){i.removeEventListener("removetrack",s),i.removeEventListener("addtrack",s),i.removeEventListener("labelchange",s)})}}ne.registerComponent("TrackButton",Sh);class ea extends hl{constructor(e,t){super(e,t),this.selectable=t.selectable,this.isSelected_=t.selected||!1,this.multiSelectable=t.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,t,i){this.nonIconControl=!0;const s=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},t),i),n=xe("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)});return this.player_.options_.experimentalSvgIcons?s.appendChild(n):s.replaceChild(n,s.querySelector(".vjs-icon-placeholder")),s}handleKeyDown(e){["Tab","Escape","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"].includes(e.key)||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}}ne.registerComponent("MenuItem",ea);class ta extends ea{constructor(e,t){const i=t.track,s=e.textTracks();t.label=i.label||i.language||"Unknown",t.selected=i.mode==="showing",super(e,t),this.track=i,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const n=(...o)=>{this.handleTracksChange.apply(this,o)},a=(...o)=>{this.handleSelectedLanguageChange.apply(this,o)};if(e.on(["loadstart","texttrackchange"],n),s.addEventListener("change",n),s.addEventListener("selectedlanguagechange",a),this.on("dispose",function(){e.off(["loadstart","texttrackchange"],n),s.removeEventListener("change",n),s.removeEventListener("selectedlanguagechange",a)}),s.onchange===void 0){let o;this.on(["tap","click"],function(){if(typeof $.Event!="object")try{o=new $.Event("change")}catch{}o||(o=ue.createEvent("Event"),o.initEvent("change",!0,!0)),s.dispatchEvent(o)})}this.handleTracksChange()}handleClick(e){const t=this.track,i=this.player_.textTracks();if(super.handleClick(e),!!i)for(let s=0;s<i.length;s++){const n=i[s];this.kinds.indexOf(n.kind)!==-1&&(n===t?n.mode!=="showing"&&(n.mode="showing"):n.mode!=="disabled"&&(n.mode="disabled"))}}handleTracksChange(e){const t=this.track.mode==="showing";t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if(this.track.mode==="showing"){const t=this.player_.cache_.selectedLanguage;if(t&&t.enabled&&t.language===this.track.language&&t.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}ne.registerComponent("TextTrackMenuItem",ta);class gy extends ta{constructor(e,t){t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleTracksChange(e){const t=this.player().textTracks();let i=!0;for(let s=0,n=t.length;s<n;s++){const a=t[s];if(this.options_.kinds.indexOf(a.kind)>-1&&a.mode==="showing"){i=!1;break}}i!==this.isSelected_&&this.selected(i)}handleSelectedLanguageChange(e){const t=this.player().textTracks();let i=!0;for(let s=0,n=t.length;s<n;s++){const a=t[s];if(["captions","descriptions","subtitles"].indexOf(a.kind)>-1&&a.mode==="showing"){i=!1;break}}i&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}}ne.registerComponent("OffTextTrackMenuItem",gy);class Qr extends Sh{constructor(e,t={}){t.tracks=e.textTracks(),super(e,t)}createItems(e=[],t=ta){let i;this.label_&&(i=`${this.label_} off`),e.push(new gy(this.player_,{kinds:this.kinds_,kind:this.kind_,label:i})),this.hideThreshold_+=1;const s=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let n=0;n<s.length;n++){const a=s[n];if(this.kinds_.indexOf(a.kind)>-1){const o=new t(this.player_,{track:a,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});o.addClass(`vjs-${a.kind}-menu-item`),e.push(o)}}return e}}ne.registerComponent("TextTrackButton",Qr);class my extends ea{constructor(e,t){const i=t.track,s=t.cue,n=e.currentTime();t.selectable=!0,t.multiSelectable=!1,t.label=s.text,t.selected=s.startTime<=n&&n<s.endTime,super(e,t),this.track=i,this.cue=s}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}}ne.registerComponent("ChaptersTrackMenuItem",my);class Eh extends Qr{constructor(e,t,i){super(e,t,i),this.setIcon("chapters"),this.selectCurrentItem_=()=>{this.items.forEach(s=>{s.selected(this.track_.activeCues[0]===s.cue)})}}buildCSSClass(){return`vjs-chapters-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-chapters-button ${super.buildWrapperCSSClass()}`}update(e){if(e&&e.track&&e.track.kind!=="chapters")return;const t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),super.update()):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let t=e.length-1;t>=0;t--){const i=e[t];if(i.kind===this.kind_)return i}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize(ft(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const t=this.track_.cues;if(!t)return e;for(let i=0,s=t.length;i<s;i++){const n=t[i],a=new my(this.player_,{track:this.track_,cue:n});e.push(a)}return e}}Eh.prototype.kind_="chapters";Eh.prototype.controlText_="Chapters";ne.registerComponent("ChaptersButton",Eh);class bh extends Qr{constructor(e,t,i){super(e,t,i),this.setIcon("audio-description");const s=e.textTracks(),n=Je(this,this.handleTracksChange);s.addEventListener("change",n),this.on("dispose",function(){s.removeEventListener("change",n)})}handleTracksChange(e){const t=this.player().textTracks();let i=!1;for(let s=0,n=t.length;s<n;s++){const a=t[s];if(a.kind!==this.kind_&&a.mode==="showing"){i=!0;break}}i?this.disable():this.enable()}buildCSSClass(){return`vjs-descriptions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-descriptions-button ${super.buildWrapperCSSClass()}`}}bh.prototype.kind_="descriptions";bh.prototype.controlText_="Descriptions";ne.registerComponent("DescriptionsButton",bh);class xh extends Qr{constructor(e,t,i){super(e,t,i),this.setIcon("subtitles")}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}}xh.prototype.kind_="subtitles";xh.prototype.controlText_="Subtitles";ne.registerComponent("SubtitlesButton",xh);class Ah extends ta{constructor(e,t){t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",super(e,t),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+t.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}}ne.registerComponent("CaptionSettingsMenuItem",Ah);class Ch extends Qr{constructor(e,t,i){super(e,t,i),this.setIcon("captions")}buildCSSClass(){return`vjs-captions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-captions-button ${super.buildWrapperCSSClass()}`}createItems(){const e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new Ah(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}}Ch.prototype.kind_="captions";Ch.prototype.controlText_="Captions";ne.registerComponent("CaptionsButton",Ch);class yy extends ta{createEl(e,t,i){const s=super.createEl(e,t,i),n=s.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="captions"&&(this.player_.options_.experimentalSvgIcons?this.setIcon("captions",s):n.appendChild(xe("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),n.appendChild(xe("span",{className:"vjs-control-text",textContent:` ${this.localize("Captions")}`}))),s}}ne.registerComponent("SubsCapsMenuItem",yy);class Ih extends Qr{constructor(e,t={}){super(e,t),this.label_="subtitles",this.setIcon("subtitles"),["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions",this.setIcon("captions")),this.menuButton_.controlText(ft(this.label_))}buildCSSClass(){return`vjs-subs-caps-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subs-caps-button ${super.buildWrapperCSSClass()}`}createItems(){let e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new Ah(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,yy),e}}Ih.prototype.kinds_=["captions","subtitles"];Ih.prototype.controlText_="Subtitles";ne.registerComponent("SubsCapsButton",Ih);class Ty extends ea{constructor(e,t){const i=t.track,s=e.audioTracks();t.label=i.label||i.language||"Unknown",t.selected=i.enabled,super(e,t),this.track=i,this.addClass(`vjs-${i.kind}-menu-item`);const n=(...a)=>{this.handleTracksChange.apply(this,a)};s.addEventListener("change",n),this.on("dispose",()=>{s.removeEventListener("change",n)})}createEl(e,t,i){const s=super.createEl(e,t,i),n=s.querySelector(".vjs-menu-item-text");return["main-desc","descriptions"].indexOf(this.options_.track.kind)>=0&&(n.appendChild(xe("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),n.appendChild(xe("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),s}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const t=this.player_.audioTracks();for(let i=0;i<t.length;i++){const s=t[i];s!==this.track&&(s.enabled=s===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}ne.registerComponent("AudioTrackMenuItem",Ty);class _y extends Sh{constructor(e,t={}){t.tracks=e.audioTracks(),super(e,t),this.setIcon("audio")}buildCSSClass(){return`vjs-audio-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-audio-button ${super.buildWrapperCSSClass()}`}createItems(e=[]){this.hideThreshold_=1;const t=this.player_.audioTracks();for(let i=0;i<t.length;i++){const s=t[i];e.push(new Ty(this.player_,{track:s,selectable:!0,multiSelectable:!1}))}return e}}_y.prototype.controlText_="Audio Track";ne.registerComponent("AudioTrackButton",_y);class Dh extends ea{constructor(e,t){const i=t.rate,s=parseFloat(i,10);t.label=i,t.selected=s===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,super(e,t),this.label=i,this.rate=s,this.on(e,"ratechange",n=>this.update(n))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}}Dh.prototype.contentElType="button";ne.registerComponent("PlaybackRateMenuItem",Dh);class vy extends vh{constructor(e,t){super(e,t),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",i=>this.updateVisibility(i)),this.on(e,"ratechange",i=>this.updateLabel(i)),this.on(e,"playbackrateschange",i=>this.handlePlaybackRateschange(i))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=xe("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return`vjs-playback-rate ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-playback-rate ${super.buildWrapperCSSClass()}`}createItems(){const e=this.playbackRates(),t=[];for(let i=e.length-1;i>=0;i--)t.push(new Dh(this.player(),{rate:e[i]+"x"}));return t}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}}vy.prototype.controlText_="Playback Rate";ne.registerComponent("PlaybackRateMenuButton",vy);class Sy extends ne{buildCSSClass(){return`vjs-spacer ${super.buildCSSClass()}`}createEl(e="div",t={},i={}){return t.className||(t.className=this.buildCSSClass()),super.createEl(e,t,i)}}ne.registerComponent("Spacer",Sy);class K2 extends Sy{buildCSSClass(){return`vjs-custom-control-spacer ${super.buildCSSClass()}`}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:""})}}ne.registerComponent("CustomControlSpacer",K2);class Ey extends ne{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}}Ey.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","pictureInPictureToggle","fullscreenToggle"]};ne.registerComponent("ControlBar",Ey);class by extends Yr{constructor(e,t){super(e,t),this.on(e,"error",i=>{this.open(i)})}buildCSSClass(){return`vjs-error-display ${super.buildCSSClass()}`}content(){const e=this.player().error();return e?this.localize(e.message):""}}by.prototype.options_=Object.assign({},Yr.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0});ne.registerComponent("ErrorDisplay",by);class xy extends ne{constructor(e,t={}){super(e,t),this.el_.setAttribute("aria-labelledby",this.selectLabelledbyIds)}createEl(){return this.selectLabelledbyIds=[this.options_.legendId,this.options_.labelId].join(" ").trim(),xe("select",{id:this.options_.id},{},this.options_.SelectOptions.map(t=>{const i=(this.options_.labelId?this.options_.labelId:`vjs-track-option-${gi()}`)+"-"+t[1].replace(/\W+/g,""),s=xe("option",{id:i,value:this.localize(t[0]),textContent:this.localize(t[1])});return s.setAttribute("aria-labelledby",`${this.selectLabelledbyIds} ${i}`),s}))}}ne.registerComponent("TextTrackSelect",xy);class Zs extends ne{constructor(e,t={}){super(e,t);const i=xe("legend",{textContent:this.localize(this.options_.legendText),id:this.options_.legendId});this.el().appendChild(i);const s=this.options_.selects;for(const n of s){const a=this.options_.selectConfigs[n],o=a.className,l=a.id.replace("%s",this.options_.id_);let u=null;const c=`vjs_select_${gi()}`;if(this.options_.type==="colors"){u=xe("span",{className:o});const f=xe("label",{id:l,className:"vjs-label",textContent:this.localize(a.label)});f.setAttribute("for",c),u.appendChild(f)}const h=new xy(e,{SelectOptions:a.options,legendId:this.options_.legendId,id:c,labelId:l});this.addChild(h),this.options_.type==="colors"&&(u.appendChild(h.el()),this.el().appendChild(u))}}createEl(){return xe("fieldset",{className:this.options_.className})}}ne.registerComponent("TextTrackFieldset",Zs);class Ay extends ne{constructor(e,t={}){super(e,t);const i=this.options_.textTrackComponentid,s=new Zs(e,{id_:i,legendId:`captions-text-legend-${i}`,legendText:this.localize("Text"),className:"vjs-fg vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(s);const n=new Zs(e,{id_:i,legendId:`captions-background-${i}`,legendText:this.localize("Text Background"),className:"vjs-bg vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(n);const a=new Zs(e,{id_:i,legendId:`captions-window-${i}`,legendText:this.localize("Caption Area Background"),className:"vjs-window vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(a)}createEl(){return xe("div",{className:"vjs-track-settings-colors"})}}ne.registerComponent("TextTrackSettingsColors",Ay);class Cy extends ne{constructor(e,t={}){super(e,t);const i=this.options_.textTrackComponentid,s=new Zs(e,{id_:i,legendId:`captions-font-size-${i}`,legendText:"Font Size",className:"vjs-font-percent vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(s);const n=new Zs(e,{id_:i,legendId:`captions-edge-style-${i}`,legendText:this.localize("Text Edge Style"),className:"vjs-edge-style vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(n);const a=new Zs(e,{id_:i,legendId:`captions-font-family-${i}`,legendText:this.localize("Font Family"),className:"vjs-font-family vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(a)}createEl(){return xe("div",{className:"vjs-track-settings-font"})}}ne.registerComponent("TextTrackSettingsFont",Cy);class Iy extends ne{constructor(e,t={}){super(e,t);const i=new Ot(e,{controlText:this.localize("restore all settings to the default values"),className:"vjs-default-button"});i.el().classList.remove("vjs-control","vjs-button"),i.el().textContent=this.localize("Reset"),this.addChild(i);const s=this.localize("Done"),n=new Ot(e,{controlText:s,className:"vjs-done-button"});n.el().classList.remove("vjs-control","vjs-button"),n.el().textContent=s,this.addChild(n)}createEl(){return xe("div",{className:"vjs-track-settings-controls"})}}ne.registerComponent("TrackSettingsControls",Iy);const Cu="vjs-text-track-settings",Vp=["#000","Black"],Gp=["#00F","Blue"],Hp=["#0FF","Cyan"],qp=["#0F0","Green"],jp=["#F0F","Magenta"],Kp=["#F00","Red"],Wp=["#FFF","White"],zp=["#FF0","Yellow"],Iu=["1","Opaque"],Du=["0.5","Semi-Transparent"],Yp=["0","Transparent"],Is={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[Vp,Wp,Kp,qp,Gp,zp,jp,Hp],className:"vjs-bg-color"},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[Iu,Du,Yp],className:"vjs-bg-opacity vjs-opacity"},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[Wp,Vp,Kp,qp,Gp,zp,jp,Hp],className:"vjs-text-color"},edgeStyle:{selector:".vjs-edge-style > select",id:"",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Drop shadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:r=>r==="1.00"?null:Number(r)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[Iu,Du],className:"vjs-text-opacity vjs-opacity"},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color",className:"vjs-window-color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[Yp,Du,Iu],className:"vjs-window-opacity vjs-opacity"}};Is.windowColor.options=Is.backgroundColor.options;function Dy(r,e){if(e&&(r=e(r)),r&&r!=="none")return r}function W2(r,e){const t=r.options[r.options.selectedIndex].value;return Dy(t,e)}function z2(r,e,t){if(e){for(let i=0;i<r.options.length;i++)if(Dy(r.options[i].value,t)===e){r.selectedIndex=i;break}}}class Y2 extends Yr{constructor(e,t){t.temporary=!1,super(e,t),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.renderModalComponents(e),this.endDialog=xe("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),t.persistTextTrackSettings===void 0&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.bindFunctionsToSelectsAndButtons(),this.options_.persistTextTrackSettings&&this.restoreSettings()}renderModalComponents(e){const t=new Ay(e,{textTrackComponentid:this.id_,selectConfigs:Is,fieldSets:[["color","textOpacity"],["backgroundColor","backgroundOpacity"],["windowColor","windowOpacity"]]});this.addChild(t);const i=new Cy(e,{textTrackComponentid:this.id_,selectConfigs:Is,fieldSets:[["fontPercent"],["edgeStyle"],["fontFamily"]]});this.addChild(i);const s=new Iy(e);this.addChild(s)}bindFunctionsToSelectsAndButtons(){this.on(this.$(".vjs-done-button"),["click","tap"],()=>{this.saveSettings(),this.close()}),this.on(this.$(".vjs-default-button"),["click","tap"],()=>{this.setDefaults(),this.updateDisplay()}),Cr(Is,e=>{this.on(this.$(e.selector),"change",this.updateDisplay)})}dispose(){this.endDialog=null,super.dispose()}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return y0(Is,(e,t,i)=>{const s=W2(this.$(t.selector),t.parser);return s!==void 0&&(e[i]=s),e},{})}setValues(e){Cr(Is,(t,i)=>{z2(this.$(t.selector),e[i],t.parser)})}setDefaults(){Cr(Is,e=>{const t=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=t})}restoreSettings(){let e;try{e=JSON.parse($.localStorage.getItem(Cu))}catch(t){Re.warn(t)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?$.localStorage.setItem(Cu,JSON.stringify(e)):$.localStorage.removeItem(Cu)}catch(t){Re.warn(t)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}handleLanguagechange(){this.fill(),this.renderModalComponents(this.player_),this.bindFunctionsToSelectsAndButtons()}}ne.registerComponent("TextTrackSettings",Y2);class X2 extends ne{constructor(e,t){let i=t.ResizeObserver||$.ResizeObserver;t.ResizeObserver===null&&(i=!1);const s=je({createEl:!i,reportTouchActivity:!1},t);super(e,s),this.ResizeObserver=t.ResizeObserver||$.ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=$0(()=>{this.resizeHandler()},100,!1,this),i?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=()=>{if(!this.el_||!this.el_.contentWindow)return;const n=this.debouncedHandler_;let a=this.unloadListener_=function(){Pt(this,"resize",n),Pt(this,"unload",a),a=null};ri(this.el_.contentWindow,"unload",a),ri(this.el_.contentWindow,"resize",n)},this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}}ne.registerComponent("ResizeManager",X2);const Q2={trackingThreshold:20,liveTolerance:15};class J2 extends ne{constructor(e,t){const i=je(Q2,t,{createEl:!1});super(e,i),this.trackLiveHandler_=()=>this.trackLive_(),this.handlePlay_=s=>this.handlePlay(s),this.handleFirstTimeupdate_=s=>this.handleFirstTimeupdate(s),this.handleSeeked_=s=>this.handleSeeked(s),this.seekToLiveEdge_=s=>this.seekToLiveEdge(s),this.reset_(),this.on(this.player_,"durationchange",s=>this.handleDurationchange(s)),this.on(this.player_,"canplay",()=>this.toggleTracking())}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const t=Number($.performance.now().toFixed(4)),i=this.lastTime_===-1?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+i;const s=this.liveCurrentTime(),n=this.player_.currentTime();let a=this.player_.paused()||this.seekedBehindLive_||Math.abs(s-n)>this.options_.liveTolerance;(!this.timeupdateSeen_||s===1/0)&&(a=!1),a!==this.behindLiveEdge_&&(this.behindLiveEdge_=a,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,mi),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),t=[];let i=e?e.length:0;for(;i--;)t.push(e.end(i));return t.length?t.sort()[t.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),t=[];let i=e?e.length:0;for(;i--;)t.push(e.start(i));return t.length?t.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return this.lastSeekEnd_!==-1&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return typeof this.trackingInterval_=="number"}seekToLiveEdge(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}}ne.registerComponent("LiveTracker",J2);class Z2 extends ne{constructor(e,t){super(e,t),this.on("statechanged",i=>this.updateDom_()),this.updateDom_()}createEl(){return this.els={title:xe("div",{className:"vjs-title-bar-title",id:`vjs-title-bar-title-${gi()}`}),description:xe("div",{className:"vjs-title-bar-description",id:`vjs-title-bar-description-${gi()}`})},xe("div",{className:"vjs-title-bar"},{},T0(this.els))}updateDom_(){const e=this.player_.tech_,t=e&&e.el_,i={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach(s=>{const n=this.state[s],a=this.els[s],o=i[s];al(a),n&&Ps(a,n),t&&(t.removeAttribute(o),n&&t.setAttribute(o,a.id))}),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,t=e&&e.el_;t&&(t.removeAttribute("aria-labelledby"),t.removeAttribute("aria-describedby")),super.dispose(),this.els=null}}ne.registerComponent("TitleBar",Z2);const eI={initialDisplay:4e3,position:[],takeFocus:!1};class tI extends Ot{constructor(e,t){t=je(eI,t),super(e,t),this.controlText(t.controlText),this.hide(),this.on(this.player_,["useractive","userinactive"],i=>{this.removeClass("force-display")})}buildCSSClass(){return`vjs-transient-button focus-visible ${this.options_.position.map(e=>`vjs-${e}`).join(" ")}`}createEl(){const e=xe("button",{},{type:"button",class:this.buildCSSClass()},xe("span"));return this.controlTextEl_=e.querySelector("span"),e}show(){super.show(),this.addClass("force-display"),this.options_.takeFocus&&this.el().focus({preventScroll:!0}),this.forceDisplayTimeout=this.player_.setTimeout(()=>{this.removeClass("force-display")},this.options_.initialDisplay)}hide(){this.removeClass("force-display"),super.hide()}dispose(){this.player_.clearTimeout(this.forceDisplayTimeout),super.dispose()}}ne.registerComponent("TransientButton",tI);const fc=r=>{const e=r.el();if(e.hasAttribute("src"))return r.triggerSourceset(e.src),!0;const t=r.$$("source"),i=[];let s="";if(!t.length)return!1;for(let n=0;n<t.length;n++){const a=t[n].src;a&&i.indexOf(a)===-1&&i.push(a)}return i.length?(i.length===1&&(s=i[0]),r.triggerSourceset(s),!0):!1},iI=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(r){const e=ue.createElement(this.nodeName.toLowerCase());e.innerHTML=r;const t=ue.createDocumentFragment();for(;e.childNodes.length;)t.appendChild(e.childNodes[0]);return this.innerText="",$.Element.prototype.appendChild.call(this,t),this.innerHTML}}),Ly=(r,e)=>{let t={};for(let i=0;i<r.length&&(t=Object.getOwnPropertyDescriptor(r[i],e),!(t&&t.set&&t.get));i++);return t.enumerable=!0,t.configurable=!0,t},sI=r=>Ly([r.el(),$.HTMLMediaElement.prototype,$.Element.prototype,iI],"innerHTML"),Xp=function(r){const e=r.el();if(e.resetSourceWatch_)return;const t={},i=sI(r),s=n=>(...a)=>{const o=n.apply(e,a);return fc(r),o};["append","appendChild","insertAdjacentHTML"].forEach(n=>{e[n]&&(t[n]=e[n],e[n]=s(t[n]))}),Object.defineProperty(e,"innerHTML",je(i,{set:s(i.set)})),e.resetSourceWatch_=()=>{e.resetSourceWatch_=null,Object.keys(t).forEach(n=>{e[n]=t[n]}),Object.defineProperty(e,"innerHTML",i)},r.one("sourceset",e.resetSourceWatch_)},rI=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?Q0($.Element.prototype.getAttribute.call(this,"src")):""},set(r){return $.Element.prototype.setAttribute.call(this,"src",r),r}}),nI=r=>Ly([r.el(),$.HTMLMediaElement.prototype,rI],"src"),aI=function(r){if(!r.featuresSourceset)return;const e=r.el();if(e.resetSourceset_)return;const t=nI(r),i=e.setAttribute,s=e.load;Object.defineProperty(e,"src",je(t,{set:n=>{const a=t.set.call(e,n);return r.triggerSourceset(e.src),a}})),e.setAttribute=(n,a)=>{const o=i.call(e,n,a);return/src/i.test(n)&&r.triggerSourceset(e.src),o},e.load=()=>{const n=s.call(e);return fc(r)||(r.triggerSourceset(""),Xp(r)),n},e.currentSrc?r.triggerSourceset(e.currentSrc):fc(r)||Xp(r),e.resetSourceset_=()=>{e.resetSourceset_=null,e.load=s,e.setAttribute=i,Object.defineProperty(e,"src",t),e.resetSourceWatch_&&e.resetSourceWatch_()}};class me extends De{constructor(e,t){super(e,t);const i=e.source;let s=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&this.el_.tagName==="VIDEO",i&&(this.el_.currentSrc!==i.src||e.tag&&e.tag.initNetworkState_===3)?this.setSource(i):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const n=this.el_.childNodes;let a=n.length;const o=[];for(;a--;){const l=n[a];l.nodeName.toLowerCase()==="track"&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(l),this.remoteTextTracks().addTrack(l.track),this.textTracks().addTrack(l.track),!s&&!this.el_.hasAttribute("crossorigin")&&cl(l.src)&&(s=!0)):o.push(l))}for(let l=0;l<o.length;l++)this.el_.removeChild(o[l])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&s&&Re.warn(`Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.
This may prevent text tracks from loading.`),this.restoreMetadataTracksInIOSNativePlayer_(),(Kn||tl)&&e.nativeControlsForTouch===!0&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),me.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){aI(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let t;const i=()=>{t=[];for(let n=0;n<e.length;n++){const a=e[n];a.kind==="metadata"&&t.push({track:a,storedMode:a.mode})}};i(),e.addEventListener("change",i),this.on("dispose",()=>e.removeEventListener("change",i));const s=()=>{for(let n=0;n<t.length;n++){const a=t[n];a.track.mode==="disabled"&&a.track.mode!==a.storedMode&&(a.track.mode=a.storedMode)}e.removeEventListener("change",s)};this.on("webkitbeginfullscreen",()=>{e.removeEventListener("change",i),e.removeEventListener("change",s),e.addEventListener("change",s)}),this.on("webkitendfullscreen",()=>{e.removeEventListener("change",i),e.addEventListener("change",i),e.removeEventListener("change",s)})}overrideNative_(e,t){if(t!==this[`featuresNative${e}Tracks`])return;const i=e.toLowerCase();this[`${i}TracksListeners_`]&&Object.keys(this[`${i}TracksListeners_`]).forEach(s=>{this.el()[`${i}Tracks`].removeEventListener(s,this[`${i}TracksListeners_`][s])}),this[`featuresNative${e}Tracks`]=!t,this[`${i}TracksListeners_`]=null,this.proxyNativeTracksForType_(i)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const t=fi[e],i=this.el()[t.getterName],s=this[t.getterName]();if(!this[`featuresNative${t.capitalName}Tracks`]||!i||!i.addEventListener)return;const n={change:o=>{const l={type:"change",target:s,currentTarget:s,srcElement:s};s.trigger(l),e==="text"&&this[jr.remoteText.getterName]().trigger(l)},addtrack(o){s.addTrack(o.track)},removetrack(o){s.removeTrack(o.track)}},a=function(){const o=[];for(let l=0;l<s.length;l++){let u=!1;for(let c=0;c<i.length;c++)if(i[c]===s[l]){u=!0;break}u||o.push(s[l])}for(;o.length;)s.removeTrack(o.shift())};this[t.getterName+"Listeners_"]=n,Object.keys(n).forEach(o=>{const l=n[o];i.addEventListener(o,l),this.on("dispose",u=>i.removeEventListener(o,l))}),this.on("loadstart",a),this.on("dispose",o=>this.off("loadstart",a))}proxyNativeTracks_(){fi.names.forEach(e=>{this.proxyNativeTracksForType_(e)})}createEl(){let e=this.options_.tag;if(!e||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(e){const i=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(i,e),me.disposeMediaElement(e),e=i}else{e=ue.createElement("video");const i=this.options_.tag&&Cs(this.options_.tag),s=je({},i);(!Kn||this.options_.nativeControlsForTouch!==!0)&&delete s.controls,I0(e,Object.assign(s,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}typeof this.options_.preload<"u"&&Gr(e,"preload",this.options_.preload),this.options_.disablePictureInPicture!==void 0&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);const t=["loop","muted","playsinline","autoplay"];for(let i=0;i<t.length;i++){const s=t[i],n=this.options_[s];typeof n<"u"&&(n?Gr(e,s,s):rl(e,s),e[s]=n)}return e}handleLateInit_(e){if(e.networkState===0||e.networkState===3)return;if(e.readyState===0){let i=!1;const s=function(){i=!0};this.on("loadstart",s);const n=function(){i||this.trigger("loadstart")};this.on("loadedmetadata",n),this.ready(function(){this.off("loadstart",s),this.off("loadedmetadata",n),i||this.trigger("loadstart")});return}const t=["loadstart"];t.push("loadedmetadata"),e.readyState>=2&&t.push("loadeddata"),e.readyState>=3&&t.push("canplay"),e.readyState>=4&&t.push("canplaythrough"),this.ready(function(){t.forEach(function(i){this.trigger(i)},this)})}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&il?this.el_.fastSeek(e):this.el_.currentTime=e}catch(t){Re(t,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&Di&&Qi&&this.el_.currentTime===0){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){"webkitPresentationMode"in this.el_&&this.el_.webkitPresentationMode!=="picture-in-picture"&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",t),this.on("dispose",()=>{this.off("webkitbeginfullscreen",t),this.off("webkitendfullscreen",e)})}supportsFullScreen(){return typeof this.el_.webkitEnterFullScreen=="function"}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)qi(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},0);else try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}}exitFullScreen(){if(!this.el_.webkitDisplayingFullscreen){this.trigger("fullscreenerror",new Error("The video is not fullscreen"));return}this.el_.webkitExitFullScreen()}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(e===void 0)return this.el_.src;this.setSrc(e)}addSourceElement(e,t){if(!e)return Re.error("Invalid source URL."),!1;const i={src:e};t&&(i.type=t);const s=xe("source",{},i);return this.el_.appendChild(s),!0}removeSourceElement(e){if(!e)return Re.error("Source URL is required to remove the source element."),!1;const t=this.el_.querySelectorAll("source");for(const i of t)if(i.src===e)return this.el_.removeChild(i),!0;return Re.warn(`No matching source element found with src: ${e}`),!1}reset(){me.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,t,i){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,i):super.addTextTrack(e,t,i)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const t=ue.createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t}addRemoteTextTrack(e,t){const i=super.addRemoteTextTrack(e,t);return this.featuresNativeTextTracks&&this.el().appendChild(i),i}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const t=this.$$("track");let i=t.length;for(;i--;)(e===t[i]||e===t[i].track)&&this.el().removeChild(t[i])}}getVideoPlaybackQuality(){if(typeof this.el().getVideoPlaybackQuality=="function")return this.el().getVideoPlaybackQuality();const e={};return typeof this.el().webkitDroppedFrameCount<"u"&&typeof this.el().webkitDecodedFrameCount<"u"&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),$.performance&&(e.creationTime=$.performance.now()),e}}Jo(me,"TEST_VID",function(){if(!Kr())return;const r=ue.createElement("video"),e=ue.createElement("track");return e.kind="captions",e.srclang="en",e.label="English",r.appendChild(e),r});me.isSupported=function(){try{me.TEST_VID.volume=.5}catch{return!1}return!!(me.TEST_VID&&me.TEST_VID.canPlayType)};me.canPlayType=function(r){return me.TEST_VID.canPlayType(r)};me.canPlaySource=function(r,e){return me.canPlayType(r.type)};me.canControlVolume=function(){try{const r=me.TEST_VID.volume;me.TEST_VID.volume=r/2+.1;const e=r!==me.TEST_VID.volume;return e&&kt?($.setTimeout(()=>{me&&me.prototype&&(me.prototype.featuresVolumeControl=r!==me.TEST_VID.volume)}),!1):e}catch{return!1}};me.canMuteVolume=function(){try{const r=me.TEST_VID.muted;return me.TEST_VID.muted=!r,me.TEST_VID.muted?Gr(me.TEST_VID,"muted","muted"):rl(me.TEST_VID,"muted","muted"),r!==me.TEST_VID.muted}catch{return!1}};me.canControlPlaybackRate=function(){if(Di&&Qi&&Zo<58)return!1;try{const r=me.TEST_VID.playbackRate;return me.TEST_VID.playbackRate=r/2+.1,r!==me.TEST_VID.playbackRate}catch{return!1}};me.canOverrideAttributes=function(){try{const r=()=>{};Object.defineProperty(ue.createElement("video"),"src",{get:r,set:r}),Object.defineProperty(ue.createElement("audio"),"src",{get:r,set:r}),Object.defineProperty(ue.createElement("video"),"innerHTML",{get:r,set:r}),Object.defineProperty(ue.createElement("audio"),"innerHTML",{get:r,set:r})}catch{return!1}return!0};me.supportsNativeTextTracks=function(){return il||kt&&Qi};me.supportsNativeVideoTracks=function(){return!!(me.TEST_VID&&me.TEST_VID.videoTracks)};me.supportsNativeAudioTracks=function(){return!!(me.TEST_VID&&me.TEST_VID.audioTracks)};me.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"];[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function([r,e]){Jo(me.prototype,r,()=>me[e](),!0)});me.prototype.featuresVolumeControl=me.canControlVolume();me.prototype.movingMediaElementInDOM=!kt;me.prototype.featuresFullscreenResize=!0;me.prototype.featuresProgressEvents=!0;me.prototype.featuresTimeupdateEvents=!0;me.prototype.featuresVideoFrameCallback=!!(me.TEST_VID&&me.TEST_VID.requestVideoFrameCallback);me.disposeMediaElement=function(r){if(r){for(r.parentNode&&r.parentNode.removeChild(r);r.hasChildNodes();)r.removeChild(r.firstChild);r.removeAttribute("src"),typeof r.load=="function"&&(function(){try{r.load()}catch{}})()}};me.resetMediaElement=function(r){if(!r)return;const e=r.querySelectorAll("source");let t=e.length;for(;t--;)r.removeChild(e[t]);r.removeAttribute("src"),typeof r.load=="function"&&(function(){try{r.load()}catch{}})()};["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(r){me.prototype[r]=function(){return this.el_[r]||this.el_.hasAttribute(r)}});["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(r){me.prototype["set"+ft(r)]=function(e){this.el_[r]=e,e?this.el_.setAttribute(r,r):this.el_.removeAttribute(r)}});["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(r){me.prototype[r]=function(){return this.el_[r]}});["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(r){me.prototype["set"+ft(r)]=function(e){this.el_[r]=e}});["pause","load","play"].forEach(function(r){me.prototype[r]=function(){return this.el_[r]()}});De.withSourceHandlers(me);me.nativeSourceHandler={};me.nativeSourceHandler.canPlayType=function(r){try{return me.TEST_VID.canPlayType(r)}catch{return""}};me.nativeSourceHandler.canHandleSource=function(r,e){if(r.type)return me.nativeSourceHandler.canPlayType(r.type);if(r.src){const t=fh(r.src);return me.nativeSourceHandler.canPlayType(`video/${t}`)}return""};me.nativeSourceHandler.handleSource=function(r,e,t){e.setSrc(r.src)};me.nativeSourceHandler.dispose=function(){};me.registerSourceHandler(me.nativeSourceHandler);De.registerTech("Html5",me);const Ry=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],Lu={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},pc=["tiny","xsmall","small","medium","large","xlarge","huge"],uo={};pc.forEach(r=>{const e=r.charAt(0)==="x"?`x-${r.substring(1)}`:r;uo[r]=`vjs-layout-${e}`});const oI={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};class Ue extends ne{constructor(e,t,i){if(e.id=e.id||t.id||`vjs_video_${gi()}`,t=Object.assign(Ue.getTagSettings(e),t),t.initChildren=!1,t.createEl=!1,t.evented=!1,t.reportTouchActivity=!1,!t.language){const a=e.closest("[lang]");a&&(t.language=a.getAttribute("lang"))}if(super(null,t,i),this.boundDocumentFullscreenChange_=a=>this.documentFullscreenChange_(a),this.boundFullWindowOnEscKey_=a=>this.fullWindowOnEscKey(a),this.boundUpdateStyleEl_=a=>this.updateStyleEl_(a),this.boundApplyInitTime_=a=>this.applyInitTime_(a),this.boundUpdateCurrentBreakpoint_=a=>this.updateCurrentBreakpoint_(a),this.boundHandleTechClick_=a=>this.handleTechClick_(a),this.boundHandleTechDoubleClick_=a=>this.handleTechDoubleClick_(a),this.boundHandleTechTouchStart_=a=>this.handleTechTouchStart_(a),this.boundHandleTechTouchMove_=a=>this.handleTechTouchMove_(a),this.boundHandleTechTouchEnd_=a=>this.handleTechTouchEnd_(a),this.boundHandleTechTap_=a=>this.handleTechTap_(a),this.boundUpdatePlayerHeightOnAudioOnlyMode_=a=>this.updatePlayerHeightOnAudioOnlyMode_(a),this.isFullscreen_=!1,this.log=g0(this.id_),this.fsApi_=Ao,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={controlBarHeight:null,playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=e,this.tagAttributes=e&&Cs(e),this.language(this.options_.language),t.languages){const a={};Object.getOwnPropertyNames(t.languages).forEach(function(o){a[o.toLowerCase()]=t.languages[o]}),this.languages_=a}else this.languages_=Ue.prototype.options_.languages;this.resetCache_(),this.poster_=t.poster||"",this.controls_=!!t.controls,e.controls=!1,e.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],e.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),t.plugins&&Object.keys(t.plugins).forEach(a=>{if(typeof this[a]!="function")throw new Error(`plugin "${a}" does not exist`)}),this.scrubbing_=!1,this.el_=this.createEl(),lh(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&(ri(ue,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const s=je(this.options_);if(t.plugins&&Object.keys(t.plugins).forEach(a=>{this[a](t.plugins[a])}),t.debug&&this.debug(!0),this.options_.playerOptions=s,this.middleware_=[],this.playbackRates(t.playbackRates),t.experimentalSvgIcons){const o=new $.DOMParser().parseFromString(R2,"image/svg+xml");if(o.querySelector("parsererror"))Re.warn("Failed to load SVG Icons. Falling back to Font Icons."),this.options_.experimentalSvgIcons=null;else{const u=o.documentElement;u.style.display="none",this.el_.appendChild(u),this.addClass("vjs-svg-icons-enabled")}}this.initChildren(),this.isAudio(e.nodeName.toLowerCase()==="audio"),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),t.spatialNavigation&&t.spatialNavigation.enabled&&(this.spatialNavigation=new w2(this),this.addClass("vjs-spatial-navigation-enabled")),Kn&&this.addClass("vjs-touch-enabled"),kt||this.addClass("vjs-workinghover"),Ue.players[this.id_]=this;const n=sc.split(".")[0];this.addClass(`vjs-v${n}`),this.userActive(!0),this.reportUserActivity(),this.one("play",a=>this.listenForUserActivity_(a)),this.on("keydown",a=>this.handleKeyDown(a)),this.on("languagechange",a=>this.handleLanguagechange(a)),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)})}dispose(){this.trigger("dispose"),this.off("dispose"),Pt(ue,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),Pt(ue,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),Ue.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),C2(this),Bt.names.forEach(e=>{const t=Bt[e],i=this[t.getterName]();i&&i.off&&i.off()}),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e=this.tag,t,i=this.playerElIngest_=e.parentNode&&e.parentNode.hasAttribute&&e.parentNode.hasAttribute("data-vjs-player");const s=this.tag.tagName.toLowerCase()==="video-js";i?t=this.el_=e.parentNode:s||(t=this.el_=super.createEl("div"));const n=Cs(e);if(s){for(t=this.el_=e,e=this.tag=ue.createElement("video");t.children.length;)e.appendChild(t.firstChild);Pn(t,"video-js")||Qs(t,"video-js"),t.appendChild(e),i=this.playerElIngest_=t,Object.keys(t).forEach(l=>{try{e[l]=t[l]}catch{}})}e.setAttribute("tabindex","-1"),n.tabindex="-1",Qi&&el&&(e.setAttribute("role","application"),n.role="application"),e.removeAttribute("width"),e.removeAttribute("height"),"width"in n&&delete n.width,"height"in n&&delete n.height,Object.getOwnPropertyNames(n).forEach(function(l){s&&l==="class"||t.setAttribute(l,n[l]),s&&e.setAttribute(l,n[l])}),e.playerId=e.id,e.id+="_html5_api",e.className="vjs-tech",e.player=t.player=this,this.addClass("vjs-paused");const a=["IS_SMART_TV","IS_TIZEN","IS_WEBOS","IS_ANDROID","IS_IPAD","IS_IPHONE","IS_CHROMECAST_RECEIVER"].filter(l=>b0[l]).map(l=>"vjs-device-"+l.substring(3).toLowerCase().replace(/\_/g,"-"));if(this.addClass(...a),$.VIDEOJS_NO_DYNAMIC_STYLE!==!0){this.styleEl_=B0("vjs-styles-dimensions");const l=ks(".vjs-styles-defaults"),u=ks("head");u.insertBefore(this.styleEl_,l?l.nextSibling:u.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const o=e.getElementsByTagName("a");for(let l=0;l<o.length;l++){const u=o.item(l);Qs(u,"vjs-hidden"),u.setAttribute("hidden","hidden")}return e.initNetworkState_=e.networkState,e.parentNode&&!i&&e.parentNode.insertBefore(t,e),nc(e,t),this.children_.unshift(e),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=t,t}crossOrigin(e){if(typeof e>"u")return this.techGet_("crossOrigin");if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){Re.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,t){const i=e+"_";if(t===void 0)return this[i]||0;if(t===""||t==="auto"){this[i]=void 0,this.updateStyleEl_();return}const s=parseFloat(t);if(isNaN(s)){Re.error(`Improper value "${t}" supplied for for ${e}`);return}this[i]=s,this.updateStyleEl_()}fluid(e){if(e===void 0)return!!this.fluid_;this.fluid_=!!e,hs(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),r2(this,()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(e===void 0)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(e===void 0)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if($.VIDEOJS_NO_DYNAMIC_STYLE===!0){const o=typeof this.width_=="number"?this.width_:this.options_.width,l=typeof this.height_=="number"?this.height_:this.options_.height,u=this.tech_&&this.tech_.el();u&&(o>=0&&(u.width=o),l>=0&&(u.height=l));return}let e,t,i,s;this.aspectRatio_!==void 0&&this.aspectRatio_!=="auto"?i=this.aspectRatio_:this.videoWidth()>0?i=this.videoWidth()+":"+this.videoHeight():i="16:9";const n=i.split(":"),a=n[1]/n[0];this.width_!==void 0?e=this.width_:this.height_!==void 0?e=this.height_/a:e=this.videoWidth()||300,this.height_!==void 0?t=this.height_:t=e*a,/^[^a-zA-Z]/.test(this.id())?s="dimensions-"+this.id():s=this.id()+"-dimensions",this.addClass(s),U0(this.styleEl_,`
      .${s} {
        width: ${e}px;
        height: ${t}px;
      }

      .${s}.vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: ${a*100}%;
      }
    `)}loadTech_(e,t){this.tech_&&this.unloadTech_();const i=ft(e),s=e.charAt(0).toLowerCase()+e.slice(1);i!=="Html5"&&this.tag&&(De.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=i,this.isReady_=!1;let n=this.autoplay();(typeof this.autoplay()=="string"||this.autoplay()===!0&&this.options_.normalizeAutoplay)&&(n=!1);const a={source:t,autoplay:n,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${s}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};Bt.names.forEach(l=>{const u=Bt[l];a[u.getterName]=this[u.privateName]}),Object.assign(a,this.options_[i]),Object.assign(a,this.options_[s]),Object.assign(a,this.options_[e.toLowerCase()]),this.tag&&(a.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(a.startTime=this.cache_.currentTime);const o=De.getTech(e);if(!o)throw new Error(`No Tech named '${i}' exists! '${i}' should be registered using videojs.registerTech()'`);this.tech_=new o(a),this.tech_.ready(Je(this,this.handleTechReady_),!0),hc.jsonToTextTracks(this.textTracksJson_||[],this.tech_),Ry.forEach(l=>{this.on(this.tech_,l,u=>this[`handleTech${ft(l)}_`](u))}),Object.keys(Lu).forEach(l=>{this.on(this.tech_,l,u=>{if(this.tech_.playbackRate()===0&&this.tech_.seeking()){this.queuedCallbacks_.push({callback:this[`handleTech${Lu[l]}_`].bind(this),event:u});return}this[`handleTech${Lu[l]}_`](u)})}),this.on(this.tech_,"loadstart",l=>this.handleTechLoadStart_(l)),this.on(this.tech_,"sourceset",l=>this.handleTechSourceset_(l)),this.on(this.tech_,"waiting",l=>this.handleTechWaiting_(l)),this.on(this.tech_,"ended",l=>this.handleTechEnded_(l)),this.on(this.tech_,"seeking",l=>this.handleTechSeeking_(l)),this.on(this.tech_,"play",l=>this.handleTechPlay_(l)),this.on(this.tech_,"pause",l=>this.handleTechPause_(l)),this.on(this.tech_,"durationchange",l=>this.handleTechDurationChange_(l)),this.on(this.tech_,"fullscreenchange",(l,u)=>this.handleTechFullscreenChange_(l,u)),this.on(this.tech_,"fullscreenerror",(l,u)=>this.handleTechFullscreenError_(l,u)),this.on(this.tech_,"enterpictureinpicture",l=>this.handleTechEnterPictureInPicture_(l)),this.on(this.tech_,"leavepictureinpicture",l=>this.handleTechLeavePictureInPicture_(l)),this.on(this.tech_,"error",l=>this.handleTechError_(l)),this.on(this.tech_,"posterchange",l=>this.handleTechPosterChange_(l)),this.on(this.tech_,"textdata",l=>this.handleTechTextData_(l)),this.on(this.tech_,"ratechange",l=>this.handleTechRateChange_(l)),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&(i!=="Html5"||!this.tag)&&nc(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){Bt.names.forEach(e=>{const t=Bt[e];this[t.privateName]=this[t.getterName]()}),this.textTracksJson_=hc.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return e===void 0&&Re.warn(`Using the tech directly can be dangerous. I hope you know what you're doing.
See https://github.com/videojs/video.js/issues/2617 for more info.
`),this.tech_}version(){return{"video.js":sc}}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(this.autoplay()===!0&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||typeof e!="string")return;const t=()=>{const s=this.muted();this.muted(!0);const n=()=>{this.muted(s)};this.playTerminatedQueue_.push(n);const a=this.play();if(Mn(a))return a.catch(o=>{throw n(),new Error(`Rejection at manualAutoplay. Restoring muted value. ${o||""}`)})};let i;if(e==="any"&&!this.muted()?(i=this.play(),Mn(i)&&(i=i.catch(t))):e==="muted"&&!this.muted()?i=t():i=this.play(),!!Mn(i))return i.then(()=>{this.trigger({type:"autoplay-success",autoplay:e})}).catch(()=>{this.trigger({type:"autoplay-failure",autoplay:e})})}updateSourceCaches_(e=""){let t=e,i="";typeof t!="string"&&(t=e.src,i=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!i&&(i=L2(this,t)),this.cache_.source=je({},e,{src:t,type:i});const s=this.cache_.sources.filter(l=>l.src&&l.src===t),n=[],a=this.$$("source"),o=[];for(let l=0;l<a.length;l++){const u=Cs(a[l]);n.push(u),u.src&&u.src===t&&o.push(u.src)}o.length&&!s.length?this.cache_.sources=n:s.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}handleTechSourceset_(e){if(!this.changingSrc_){let t=n=>this.updateSourceCaches_(n);const i=this.currentSource().src,s=e.src;i&&!/^blob:/.test(i)&&/^blob:/.test(s)&&(!this.lastSource_||this.lastSource_.tech!==s&&this.lastSource_.player!==i)&&(t=()=>{}),t(s),e.src||this.tech_.any(["sourceset","loadstart"],n=>{if(n.type==="sourceset")return;const a=this.techGet_("currentSrc");this.lastSource_.tech=a,this.updateSourceCaches_(a)})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(e===void 0)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&this.cache_.lastPlaybackRate===0&&(this.queuedCallbacks_.forEach(e=>e.callback(e.event)),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),t=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",t))};this.on("timeupdate",t)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.click===void 0||this.options_.userActions.click!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.click=="function"?this.options_.userActions.click.call(this,e):this.paused()?qi(this.play()):this.pause())}handleTechDoubleClick_(e){if(!this.controls_)return;Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),i=>i.contains(e.target))||(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.doubleClick===void 0||this.options_.userActions.doubleClick!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.doubleClick=="function"?this.options_.userActions.doubleClick.call(this,e):this.isInPictureInPicture()&&!ue.pictureInPictureElement?this.exitPictureInPicture():this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const t=e.target.player;if(t&&t!==this)return;const i=this.el();let s=ue[this.fsApi_.fullscreenElement]===i;!s&&i.matches&&(s=i.matches(":"+this.fsApi_.fullscreen)),this.isFullscreen(s)}handleTechFullscreenChange_(e,t){t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",()=>{this.removeClass("vjs-ios-native-fs")})),this.isFullscreen(t.isFullscreen))}handleTechFullscreenError_(e,t){this.trigger("fullscreenerror",t)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();e&&this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,t){this.ready(function(){if(e in x2)return E2(this.middleware_,this.tech_,e,t);if(e in Mp)return Op(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(i){throw Re(i),i}},!0)}techGet_(e){if(!(!this.tech_||!this.tech_.isReady_)){if(e in b2)return S2(this.middleware_,this.tech_,e);if(e in Mp)return Op(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){throw this.tech_[e]===void 0?(Re(`Video.js: ${e} method not defined for ${this.techName_} playback technology.`,t),t):t.name==="TypeError"?(Re(`Video.js: ${e} unavailable on ${this.techName_} playback technology element.`,t),this.tech_.isReady_=!1,t):(Re(t),t)}}}play(){return new Promise(e=>{this.play_(e)})}play_(e=qi){this.playCallbacks_.push(e);const t=!!(!this.changingSrc_&&(this.src()||this.currentSrc())),i=!!(il||kt);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t){this.waitToPlay_=a=>{this.play_()},this.one(["ready","loadstart"],this.waitToPlay_),!t&&i&&this.load();return}const s=this.techGet_("play");i&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),s===null?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(s)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(t){t()})}runPlayCallbacks_(e){const t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(i){i(e)})}pause(){this.techCall_("pause")}paused(){return this.techGet_("paused")!==!1}played(){return this.techGet_("played")||Ii(0,0)}scrubbing(e){if(typeof e>"u")return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){if(e===void 0)return this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime;if(e<0&&(e=0),!this.isReady_||this.changingSrc_||!this.tech_||!this.tech_.isReady_){this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),this.one("canplay",this.boundApplyInitTime_);return}this.techCall_("setCurrentTime",e),this.cache_.initTime=0,isFinite(e)&&(this.cache_.currentTime=Number(e))}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(e===void 0)return this.cache_.duration!==void 0?this.cache_.duration:NaN;e=parseFloat(e),e<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return(!e||!e.length)&&(e=Ii(0,0)),e}seekable(){let e=this.techGet_("seekable");return(!e||!e.length)&&(e=Ii(0,0)),e}seeking(){return this.techGet_("seeking")}ended(){return this.techGet_("ended")}networkState(){return this.techGet_("networkState")}readyState(){return this.techGet_("readyState")}bufferedPercent(){return z0(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),t=this.duration();let i=e.end(e.length-1);return i>t&&(i=t),i}volume(e){let t;if(e!==void 0){t=Math.max(0,Math.min(1,e)),this.cache_.volume=t,this.techCall_("setVolume",t),t>0&&this.lastVolume_(t);return}return t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t}muted(e){if(e!==void 0){this.techCall_("setMuted",e);return}return this.techGet_("muted")||!1}defaultMuted(e){return e!==void 0&&this.techCall_("setDefaultMuted",e),this.techGet_("defaultMuted")||!1}lastVolume_(e){if(e!==void 0&&e!==0){this.cache_.lastVolume=e;return}return this.cache_.lastVolume}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(e!==void 0){const t=this.isFullscreen_;this.isFullscreen_=!!e,this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),this.toggleFullscreenClass_();return}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const t=this;return new Promise((i,s)=>{function n(){t.off("fullscreenerror",o),t.off("fullscreenchange",a)}function a(){n(),i()}function o(u,c){n(),s(c)}t.one("fullscreenchange",a),t.one("fullscreenerror",o);const l=t.requestFullscreenHelper_(e);l&&(l.then(n,n),l.then(i,s))})}requestFullscreenHelper_(e){let t;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},e!==void 0&&(t=e)),this.fsApi_.requestFullscreen){const i=this.el_[this.fsApi_.requestFullscreen](t);return i&&i.then(()=>this.isFullscreen(!0),()=>this.isFullscreen(!1)),i}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise((t,i)=>{function s(){e.off("fullscreenerror",a),e.off("fullscreenchange",n)}function n(){s(),t()}function a(l,u){s(),i(u)}e.one("fullscreenchange",n),e.one("fullscreenerror",a);const o=e.exitFullscreenHelper_();o&&(o.then(s,s),o.then(t,i))})}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=ue[this.fsApi_.exitFullscreen]();return e&&qi(e.then(()=>this.isFullscreen(!1))),e}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=ue.documentElement.style.overflow,ri(ue,"keydown",this.boundFullWindowOnEscKey_),ue.documentElement.style.overflow="hidden",Qs(ue.body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){e.key==="Escape"&&this.isFullscreen()===!0&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,Pt(ue,"keydown",this.boundFullWindowOnEscKey_),ue.documentElement.style.overflow=this.docOrigOverflow,sl(ue.body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(e===void 0)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){if(e!==void 0){this.isInPictureInPicture_=!!e,this.togglePictureInPictureClass_();return}return!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&$.documentPictureInPicture){const e=ue.createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(xe("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),$.documentPictureInPicture.requestWindow({width:this.videoWidth(),height:this.videoHeight()}).then(t=>(M0(t),this.el_.parentNode.insertBefore(e,this.el_),t.document.body.appendChild(this.el_),t.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger({type:"enterpictureinpicture",pipWindow:t}),t.addEventListener("pagehide",i=>{const s=i.target.querySelector(".video-js");e.parentNode.replaceChild(s,e),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")}),t))}return"pictureInPictureEnabled"in ue&&this.disablePictureInPicture()===!1?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){if($.documentPictureInPicture&&$.documentPictureInPicture.window)return $.documentPictureInPicture.window.close(),Promise.resolve();if("pictureInPictureEnabled"in ue)return ue.exitPictureInPicture()}handleKeyDown(e){const{userActions:t}=this.options_;!t||!t.hotkeys||(s=>{const n=s.tagName.toLowerCase();if(s.isContentEditable)return!0;const a=["button","checkbox","hidden","radio","reset","submit"];return n==="input"?a.indexOf(s.type)===-1:["textarea"].indexOf(n)!==-1})(this.el_.ownerDocument.activeElement)||(typeof t.hotkeys=="function"?t.hotkeys.call(this,e):this.handleHotkeys(e))}handleHotkeys(e){const t=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:i=a=>e.key.toLowerCase()==="f",muteKey:s=a=>e.key.toLowerCase()==="m",playPauseKey:n=a=>e.key.toLowerCase()==="k"||e.key.toLowerCase()===" "}=t;if(i.call(this,e)){e.preventDefault(),e.stopPropagation();const a=ne.getComponent("FullscreenToggle");ue[this.fsApi_.fullscreenEnabled]!==!1&&a.prototype.handleClick.call(this,e)}else s.call(this,e)?(e.preventDefault(),e.stopPropagation(),ne.getComponent("MuteToggle").prototype.handleClick.call(this,e)):n.call(this,e)&&(e.preventDefault(),e.stopPropagation(),ne.getComponent("PlayToggle").prototype.handleClick.call(this,e))}canPlayType(e){let t;for(let i=0,s=this.options_.techOrder;i<s.length;i++){const n=s[i];let a=De.getTech(n);if(a||(a=ne.getComponent(n)),!a){Re.error(`The "${n}" tech is undefined. Skipped browser support check for that tech.`);continue}if(a.isSupported()&&(t=a.canPlayType(e),t))return t}return""}selectSource(e){const t=this.options_.techOrder.map(o=>[o,De.getTech(o)]).filter(([o,l])=>l?l.isSupported():(Re.error(`The "${o}" tech is undefined. Skipped browser support check for that tech.`),!1)),i=function(o,l,u){let c;return o.some(h=>l.some(f=>{if(c=u(h,f),c)return!0})),c};let s;const n=o=>(l,u)=>o(u,l),a=([o,l],u)=>{if(l.canPlaySource(u,this.options_[o.toLowerCase()]))return{source:u,tech:o}};return this.options_.sourceOrder?s=i(e,t,n(a)):s=i(t,e,a),s||!1}handleSrc_(e,t){if(typeof e>"u")return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const i=ey(e);if(!i.length){this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0);return}if(this.changingSrc_=!0,t||(this.cache_.sources=i),this.updateSourceCaches_(i[0]),_2(this,i[0],(s,n)=>{if(this.middleware_=n,t||(this.cache_.sources=i),this.updateSourceCaches_(s),this.src_(s)){if(i.length>1)return this.handleSrc_(i.slice(1));this.changingSrc_=!1,this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),this.triggerReady();return}v2(n,this.tech_)}),i.length>1){const s=()=>{this.error(null),this.handleSrc_(i.slice(1),!0)},n=()=>{this.off("error",s)};this.one("error",s),this.one("playing",n),this.resetRetryOnError_=()=>{this.off("error",s),this.off("playing",n)}}}src(e){return this.handleSrc_(e,!1)}src_(e){const t=this.selectSource([e]);return t?q0(t.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(t.tech,t.source),this.tech_.ready(()=>{this.changingSrc_=!1}),!1):!0}addSourceElement(e,t){return this.tech_?this.tech_.addSourceElement(e,t):!1}removeSourceElement(e){return this.tech_?this.tech_.removeSourceElement(e):!1}load(){if(this.tech_&&this.tech_.vhs){this.src(this.currentSource());return}this.techCall_("load")}reset(){if(this.paused())this.doReset_();else{const e=this.play();qi(e.then(()=>this.doReset_()))}}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),this.error(null),this.titleBar&&this.titleBar.update({title:void 0,description:void 0}),hs(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:t,progressControl:i,remainingTimeDisplay:s}=this.controlBar||{},{seekBar:n}=i||{};e&&e.updateContent(),t&&t.updateContent(),s&&s.updateContent(),n&&(n.update(),n.loadProgressBar&&n.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),t=[];return Object.keys(e).length!==0&&t.push(e),this.cache_.sources||t}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){if(e!==void 0){this.techCall_("setPreload",e),this.options_.preload=e;return}return this.techGet_("preload")}autoplay(e){if(e===void 0)return this.options_.autoplay||!1;let t;typeof e=="string"&&/(any|play|muted)/.test(e)||e===!0&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_(typeof e=="string"?e:"play"),t=!1):e?this.options_.autoplay=!0:this.options_.autoplay=!1,t=typeof t>"u"?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)}playsinline(e){return e!==void 0&&(this.techCall_("setPlaysinline",e),this.options_.playsinline=e),this.techGet_("playsinline")}loop(e){if(e!==void 0){this.techCall_("setLoop",e),this.options_.loop=e;return}return this.techGet_("loop")}poster(e){if(e===void 0)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(e===void 0)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(e===void 0)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(e===void 0)return this.error_||null;if(ws("beforeerror").forEach(t=>{const i=t(this,e);if(!(Xi(i)&&!Array.isArray(i)||typeof i=="string"||typeof i=="number"||i===null)){this.log.error("please return a value that MediaError expects in beforeerror hooks");return}e=i}),this.options_.suppressNotSupportedError&&e&&e.code===4){const t=function(){this.error(e)};this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),this.one("loadstart",function(){this.off(["click","touchstart"],t)});return}if(e===null){this.error_=null,this.removeClass("vjs-error"),this.errorDisplay&&this.errorDisplay.close();return}this.error_=new ut(e),this.addClass("vjs-error"),Re.error(`(CODE:${this.error_.code} ${ut.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error"),ws("error").forEach(t=>t(this,this.error_))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(e===void 0)return this.userActive_;if(e=!!e,e!==this.userActive_){if(this.userActive_=e,this.userActive_){this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive");return}this.tech_&&this.tech_.one("mousemove",function(t){t.stopPropagation(),t.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,t,i;const s=Je(this,this.reportUserActivity),n=function(h){(h.screenX!==t||h.screenY!==i)&&(t=h.screenX,i=h.screenY,s())},a=function(){s(),this.clearInterval(e),e=this.setInterval(s,250)},o=function(h){s(),this.clearInterval(e)};this.on("mousedown",a),this.on("mousemove",n),this.on("mouseup",o),this.on("mouseleave",o);const l=this.getChild("controlBar");l&&!kt&&!Di&&(l.on("mouseenter",function(h){this.player().options_.inactivityTimeout!==0&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),l.on("mouseleave",function(h){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",s),this.on("keyup",s);let u;const c=function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(u);const h=this.options_.inactivityTimeout;h<=0||(u=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},h))};this.setInterval(c,250)}playbackRate(e){if(e!==void 0){this.techCall_("setPlaybackRate",e);return}return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1}defaultPlaybackRate(e){return e!==void 0?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(e!==void 0){this.isAudio_=!!e;return}return!!this.isAudio_}updatePlayerHeightOnAudioOnlyMode_(){const e=this.getChild("ControlBar");!e||this.audioOnlyCache_.controlBarHeight===e.currentHeight()||(this.audioOnlyCache_.controlBarHeight=e.currentHeight(),this.height(this.audioOnlyCache_.controlBarHeight))}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),t=this.getChild("ControlBar"),i=t&&t.currentHeight();e.forEach(s=>{s!==t&&s.el_&&!s.hasClass("vjs-hidden")&&(s.hide(),this.audioOnlyCache_.hiddenChildren.push(s))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.audioOnlyCache_.controlBarHeight=i,this.on("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.height(i),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.off("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.audioOnlyCache_.hiddenChildren.forEach(e=>e.show()),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if(typeof e!="boolean"||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const t=[];return this.isInPictureInPicture()&&t.push(this.exitPictureInPicture()),this.isFullscreen()&&t.push(this.exitFullscreen()),this.audioPosterMode()&&t.push(this.audioPosterMode(!1)),Promise.all(t).then(()=>this.enableAudioOnlyUI_())}return Promise.resolve().then(()=>this.disableAudioOnlyUI_())}enablePosterModeUI_(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){return typeof e!="boolean"||e===this.audioPosterMode_?this.audioPosterMode_:(this.audioPosterMode_=e,e?this.audioOnlyMode()?this.audioOnlyMode(!1).then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.disablePosterModeUI_()}))}addTextTrack(e,t,i){if(this.tech_)return this.tech_.addTextTrack(e,t,i)}addRemoteTextTrack(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)}removeRemoteTextTrack(e={}){let{track:t}=e;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(e===void 0)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),hs(this)&&this.trigger("languagechange"))}languages(){return je(Ue.prototype.options_.languages,this.languages_)}toJSON(){const e=je(this.options_),t=e.tracks;e.tracks=[];for(let i=0;i<t.length;i++){let s=t[i];s=je(s),s.player=void 0,e.tracks[i]=s}return e}createModal(e,t){t=t||{},t.content=e||"";const i=new Yr(this,t);return this.addChild(i),i.on("dispose",()=>{this.removeChild(i)}),i.open(),i}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),t=this.currentWidth();for(let i=0;i<pc.length;i++){const s=pc[i],n=this.breakpoints_[s];if(t<=n){if(e===s)return;e&&this.removeClass(uo[e]),this.addClass(uo[s]),this.breakpoint_=s;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return e===void 0?Object.assign(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=Object.assign({},oI,e),this.updateCurrentBreakpoint_(),Object.assign(this.breakpoints_))}responsive(e){if(e===void 0)return this.responsive_;e=!!e;const t=this.responsive_;if(e!==t)return this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return uo[this.breakpoint_]||""}loadMedia(e,t){if(!e||typeof e!="object")return;const i=this.crossOrigin();this.reset(),this.cache_.media=je(e);const{artist:s,artwork:n,description:a,poster:o,src:l,textTracks:u,title:c}=this.cache_.media;!n&&o&&(this.cache_.media.artwork=[{src:o,type:Mo(o)}]),i&&this.crossOrigin(i),l&&this.src(l),o&&this.poster(o),Array.isArray(u)&&u.forEach(h=>this.addRemoteTextTrack(h,!1)),this.titleBar&&this.titleBar.update({title:c,description:a||s||""}),this.ready(t)}getMedia(){if(!this.cache_.media){const e=this.poster(),t=this.currentSources(),i=Array.prototype.map.call(this.remoteTextTracks(),n=>({kind:n.kind,label:n.label,language:n.language,src:n.src})),s={src:t,textTracks:i};return e&&(s.poster=e,s.artwork=[{src:s.poster,type:Mo(s.poster)}]),s}return je(this.cache_.media)}static getTagSettings(e){const t={sources:[],tracks:[]},i=Cs(e),s=i["data-setup"];if(Pn(e,"vjs-fill")&&(i.fill=!0),Pn(e,"vjs-fluid")&&(i.fluid=!0),s!==null)try{Object.assign(i,JSON.parse(s||"{}"))}catch(n){Re.error("data-setup",n)}if(Object.assign(t,i),e.hasChildNodes()){const n=e.childNodes;for(let a=0,o=n.length;a<o;a++){const l=n[a],u=l.nodeName.toLowerCase();u==="source"?t.sources.push(Cs(l)):u==="track"&&t.tracks.push(Cs(l))}}return t}debug(e){if(e===void 0)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(e===void 0)return this.cache_.playbackRates;Array.isArray(e)&&e.every(t=>typeof t=="number")&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}}Ue.prototype.videoTracks=()=>{};Ue.prototype.audioTracks=()=>{};Ue.prototype.textTracks=()=>{};Ue.prototype.remoteTextTracks=()=>{};Ue.prototype.remoteTextTrackEls=()=>{};Bt.names.forEach(function(r){const e=Bt[r];Ue.prototype[e.getterName]=function(){return this.tech_?this.tech_[e.getterName]():(this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName])}});Ue.prototype.crossorigin=Ue.prototype.crossOrigin;Ue.players={};const bn=$.navigator;Ue.prototype.options_={techOrder:De.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:bn&&(bn.languages&&bn.languages[0]||bn.userLanguage||bn.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1,spatialNavigation:{enabled:!1,horizontalSeek:!1},enableSmoothSeeking:!1,disableSeekWhileScrubbingOnMobile:!1,disableSeekWhileScrubbingOnSTV:!1};Ry.forEach(function(r){Ue.prototype[`handleTech${ft(r)}_`]=function(){return this.trigger(r)}});ne.registerComponent("Player",Ue);const Fo="plugin",Lr="activePlugins_",Tr={},No=r=>Tr.hasOwnProperty(r),co=r=>No(r)?Tr[r]:void 0,wy=(r,e)=>{r[Lr]=r[Lr]||{},r[Lr][e]=!0},Bo=(r,e,t)=>{const i=(t?"before":"")+"pluginsetup";r.trigger(i,e),r.trigger(i+":"+e.name,e)},lI=function(r,e){const t=function(){Bo(this,{name:r,plugin:e,instance:null},!0);const i=e.apply(this,arguments);return wy(this,r),Bo(this,{name:r,plugin:e,instance:i}),i};return Object.keys(e).forEach(function(i){t[i]=e[i]}),t},Qp=(r,e)=>(e.prototype.name=r,function(...t){Bo(this,{name:r,plugin:e,instance:null},!0);const i=new e(this,...t);return this[r]=()=>i,Bo(this,i.getEventHash()),i});class Wt{constructor(e){if(this.constructor===Wt)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),lh(this),delete this.trigger,H0(this,this.constructor.defaultState),wy(e,this.name),this.dispose=this.dispose.bind(this),e.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(e={}){return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e,t={}){return zr(this.eventBusEl_,e,this.getEventHash(t))}handleStateChanged(e){}dispose(){const{name:e,player:t}=this;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[Lr][e]=!1,this.player=this.state=null,t[e]=Qp(e,Tr[e])}static isBasic(e){const t=typeof e=="string"?co(e):e;return typeof t=="function"&&!Wt.prototype.isPrototypeOf(t.prototype)}static registerPlugin(e,t){if(typeof e!="string")throw new Error(`Illegal plugin name, "${e}", must be a string, was ${typeof e}.`);if(No(e))Re.warn(`A plugin named "${e}" already exists. You may want to avoid re-registering plugins!`);else if(Ue.prototype.hasOwnProperty(e))throw new Error(`Illegal plugin name, "${e}", cannot share a name with an existing player method!`);if(typeof t!="function")throw new Error(`Illegal plugin for "${e}", must be a function, was ${typeof t}.`);return Tr[e]=t,e!==Fo&&(Wt.isBasic(t)?Ue.prototype[e]=lI(e,t):Ue.prototype[e]=Qp(e,t)),t}static deregisterPlugin(e){if(e===Fo)throw new Error("Cannot de-register base plugin.");No(e)&&(delete Tr[e],delete Ue.prototype[e])}static getPlugins(e=Object.keys(Tr)){let t;return e.forEach(i=>{const s=co(i);s&&(t=t||{},t[i]=s)}),t}static getPluginVersion(e){const t=co(e);return t&&t.VERSION||""}}Wt.getPlugin=co;Wt.BASE_PLUGIN_NAME=Fo;Wt.registerPlugin(Fo,Wt);Ue.prototype.usingPlugin=function(r){return!!this[Lr]&&this[Lr][r]===!0};Ue.prototype.hasPlugin=function(r){return!!No(r)};function uI(r,e){let t=!1;return function(...i){return t||Re.warn(r),t=!0,e.apply(this,i)}}function Li(r,e,t,i){return uI(`${e} is deprecated and will be removed in ${r}.0; please use ${t} instead.`,i)}var cI={NetworkBadStatus:"networkbadstatus",NetworkRequestFailed:"networkrequestfailed",NetworkRequestAborted:"networkrequestaborted",NetworkRequestTimeout:"networkrequesttimeout",NetworkBodyParserFailed:"networkbodyparserfailed",StreamingHlsPlaylistParserError:"streaminghlsplaylistparsererror",StreamingDashManifestParserError:"streamingdashmanifestparsererror",StreamingContentSteeringParserError:"streamingcontentsteeringparsererror",StreamingVttParserError:"streamingvttparsererror",StreamingFailedToSelectNextSegment:"streamingfailedtoselectnextsegment",StreamingFailedToDecryptSegment:"streamingfailedtodecryptsegment",StreamingFailedToTransmuxSegment:"streamingfailedtotransmuxsegment",StreamingFailedToAppendSegment:"streamingfailedtoappendsegment",StreamingCodecsChangeError:"streamingcodecschangeerror"};const ky=r=>r.indexOf("#")===0?r.slice(1):r;function te(r,e,t){let i=te.getPlayer(r);if(i)return e&&Re.warn(`Player "${r}" is already initialised. Options will not be applied.`),t&&i.ready(t),i;const s=typeof r=="string"?ks("#"+ky(r)):r;if(!Wr(s))throw new TypeError("The element or ID supplied is not valid. (videojs)");const a=("getRootNode"in s?s.getRootNode()instanceof $.ShadowRoot:!1)?s.getRootNode():s.ownerDocument.body;(!s.ownerDocument.defaultView||!a.contains(s))&&Re.warn("The element supplied is not included in the DOM"),e=e||{},e.restoreEl===!0&&(e.restoreEl=(s.parentNode&&s.parentNode.hasAttribute&&s.parentNode.hasAttribute("data-vjs-player")?s.parentNode:s).cloneNode(!0)),ws("beforesetup").forEach(l=>{const u=l(s,je(e));if(!Xi(u)||Array.isArray(u)){Re.error("please return an object in beforesetup hooks");return}e=je(e,u)});const o=ne.getComponent("Player");return i=new o(s,e,t),ws("setup").forEach(l=>l(i)),i}te.hooks_=us;te.hooks=ws;te.hook=qC;te.hookOnce=jC;te.removeHook=p0;if($.VIDEOJS_NO_DYNAMIC_STYLE!==!0&&Kr()){let r=ks(".vjs-styles-defaults");if(!r){r=B0("vjs-styles-defaults");const e=ks("head");e&&e.insertBefore(r,e.firstChild),U0(r,`
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: 56.25%
      }
    `)}}oc(1,te);te.VERSION=sc;te.options=Ue.prototype.options_;te.getPlayers=()=>Ue.players;te.getPlayer=r=>{const e=Ue.players;let t;if(typeof r=="string"){const i=ky(r),s=e[i];if(s)return s;t=ks("#"+i)}else t=r;if(Wr(t)){const{player:i,playerId:s}=t;if(i||e[s])return i||e[s]}};te.getAllPlayers=()=>Object.keys(Ue.players).map(r=>Ue.players[r]).filter(Boolean);te.players=Ue.players;te.getComponent=ne.getComponent;te.registerComponent=(r,e)=>(De.isTech(e)&&Re.warn(`The ${r} tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)`),ne.registerComponent.call(ne,r,e));te.getTech=De.getTech;te.registerTech=De.registerTech;te.use=T2;Object.defineProperty(te,"middleware",{value:{},writeable:!1,enumerable:!0});Object.defineProperty(te.middleware,"TERMINATOR",{value:Oo,writeable:!1,enumerable:!0});te.browser=b0;te.obj=zC;te.mergeOptions=Li(9,"videojs.mergeOptions","videojs.obj.merge",je);te.defineLazyProperty=Li(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",Jo);te.bind=Li(9,"videojs.bind","native Function.prototype.bind",Je);te.registerPlugin=Wt.registerPlugin;te.deregisterPlugin=Wt.deregisterPlugin;te.plugin=(r,e)=>(Re.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),Wt.registerPlugin(r,e));te.getPlugins=Wt.getPlugins;te.getPlugin=Wt.getPlugin;te.getPluginVersion=Wt.getPluginVersion;te.addLanguage=function(r,e){return r=(""+r).toLowerCase(),te.options.languages=je(te.options.languages,{[r]:e}),te.options.languages[r]};te.log=Re;te.createLogger=g0;te.time=u2;te.createTimeRange=Li(9,"videojs.createTimeRange","videojs.time.createTimeRanges",Ii);te.createTimeRanges=Li(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",Ii);te.formatTime=Li(9,"videojs.formatTime","videojs.time.formatTime",ir);te.setFormatTime=Li(9,"videojs.setFormatTime","videojs.time.setFormatTime",K0);te.resetFormatTime=Li(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",W0);te.parseUrl=Li(9,"videojs.parseUrl","videojs.url.parseUrl",dh);te.isCrossOrigin=Li(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",cl);te.EventTarget=ni;te.any=oh;te.on=ri;te.one=ll;te.off=Pt;te.trigger=zr;te.xhr=Zm;te.TrackList=sr;te.TextTrack=Jn;te.TextTrackList=ch;te.AudioTrack=J0;te.AudioTrackList=Y0;te.VideoTrack=Z0;te.VideoTrackList=X0;["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(r=>{te[r]=function(){return Re.warn(`videojs.${r}() is deprecated; use videojs.dom.${r}() instead`),F0[r].apply(null,arguments)}});te.computedStyle=Li(9,"videojs.computedStyle","videojs.dom.computedStyle",qr);te.dom=F0;te.fn=s2;te.num=U2;te.str=o2;te.url=m2;te.Error=cI;class hI{constructor(e){let t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get(){return t.enabled_()},set(i){t.enabled_(i)}}),t}}class Uo extends te.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get(){return e.selectedIndex_}}),Object.defineProperty(e,"length",{get(){return e.levels_.length}}),e[Symbol.iterator]=()=>e.levels_.values(),e}addQualityLevel(e){let t=this.getQualityLevelById(e.id);if(t)return t;const i=this.levels_.length;return t=new hI(e),""+i in this||Object.defineProperty(this,i,{get(){return this.levels_[i]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t}removeQualityLevel(e){let t=null;for(let i=0,s=this.length;i<s;i++)if(this[i]===e){t=this.levels_.splice(i,1)[0],this.selectedIndex_===i?this.selectedIndex_=-1:this.selectedIndex_>i&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t}getQualityLevelById(e){for(let t=0,i=this.length;t<i;t++){const s=this[t];if(s.id===e)return s}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}Uo.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const r in Uo.prototype.allowedEvents_)Uo.prototype["on"+r]=null;var Py="4.1.0";const dI=function(r,e){const t=r.qualityLevels,i=new Uo,s=function(){i.dispose(),r.qualityLevels=t,r.off("dispose",s)};return r.on("dispose",s),r.qualityLevels=()=>i,r.qualityLevels.VERSION=Py,i},Oy=function(r){return dI(this,te.obj.merge({},r))};te.registerPlugin("qualityLevels",Oy);Oy.VERSION=Py;const qt=zo,$o=(r,e)=>e&&e.responseURL&&r!==e.responseURL?e.responseURL:r,Ti=r=>te.log.debug?te.log.debug.bind(te,"VHS:",`${r} >`):function(){};function $e(...r){const e=te.obj||te;return(e.merge||e.mergeOptions).apply(e,r)}function At(...r){const e=te.time||te;return(e.createTimeRanges||e.createTimeRanges).apply(e,r)}function fI(r){if(r.length===0)return"Buffered Ranges are empty";let e=`Buffered Ranges: 
`;for(let t=0;t<r.length;t++){const i=r.start(t),s=r.end(t);e+=`${i} --> ${s}. Duration (${s-i})
`}return e}const ji=1/30,Ki=ji*3,My=function(r,e){const t=[];let i;if(r&&r.length)for(i=0;i<r.length;i++)e(r.start(i),r.end(i))&&t.push([r.start(i),r.end(i)]);return At(t)},_r=function(r,e){return My(r,function(t,i){return t-Ki<=e&&i+Ki>=e})},Qa=function(r,e){return My(r,function(t){return t-ji>=e})},pI=function(r){if(r.length<2)return At();const e=[];for(let t=1;t<r.length;t++){const i=r.end(t-1),s=r.start(t);e.push([i,s])}return At(e)},gI=function(r,e){let t=null,i=null,s=0;const n=[],a=[];if(!r||!r.length||!e||!e.length)return At();let o=r.length;for(;o--;)n.push({time:r.start(o),type:"start"}),n.push({time:r.end(o),type:"end"});for(o=e.length;o--;)n.push({time:e.start(o),type:"start"}),n.push({time:e.end(o),type:"end"});for(n.sort(function(l,u){return l.time-u.time}),o=0;o<n.length;o++)n[o].type==="start"?(s++,s===2&&(t=n[o].time)):n[o].type==="end"&&(s--,s===1&&(i=n[o].time)),t!==null&&i!==null&&(a.push([t,i]),t=null,i=null);return At(a)},Fy=r=>{const e=[];if(!r||!r.length)return"";for(let t=0;t<r.length;t++)e.push(r.start(t)+" => "+r.end(t));return e.join(", ")},mI=function(r,e,t=1){return((r.length?r.end(r.length-1):0)-e)/t},zs=r=>{const e=[];for(let t=0;t<r.length;t++)e.push({start:r.start(t),end:r.end(t)});return e},yI=function(r,e){if(r===e)return!1;if(!r&&e||!e&&r||r.length!==e.length)return!0;for(let t=0;t<r.length;t++)if(r.start(t)!==e.start(t)||r.end(t)!==e.end(t))return!0;return!1},Ru=function(r){if(!(!r||!r.length||!r.end))return r.end(r.length-1)},Lh=function(r,e){let t=0;if(!r||!r.length)return t;for(let i=0;i<r.length;i++){const s=r.start(i),n=r.end(i);if(!(e>n)){if(e>s&&e<=n){t+=n-e;continue}t+=n-s}}return t},Rh=(r,e)=>{if(!e.preload)return e.duration;let t=0;return(e.parts||[]).forEach(function(i){t+=i.duration}),(e.preloadHints||[]).forEach(function(i){i.type==="PART"&&(t+=r.partTargetDuration)}),t},gc=r=>(r.segments||[]).reduce((e,t,i)=>(t.parts?t.parts.forEach(function(s,n){e.push({duration:s.duration,segmentIndex:i,partIndex:n,part:s,segment:t})}):e.push({duration:t.duration,segmentIndex:i,partIndex:null,segment:t,part:null}),e),[]),Ny=r=>{const e=r.segments&&r.segments.length&&r.segments[r.segments.length-1];return e&&e.parts||[]},By=({preloadSegment:r})=>{if(!r)return;const{parts:e,preloadHints:t}=r;let i=(t||[]).reduce((s,n)=>s+(n.type==="PART"?1:0),0);return i+=e&&e.length?e.length:0,i},Uy=(r,e)=>{if(e.endList)return 0;if(r&&r.suggestedPresentationDelay)return r.suggestedPresentationDelay;const t=Ny(e).length>0;return t&&e.serverControl&&e.serverControl.partHoldBack?e.serverControl.partHoldBack:t&&e.partTargetDuration?e.partTargetDuration*3:e.serverControl&&e.serverControl.holdBack?e.serverControl.holdBack:e.targetDuration?e.targetDuration*3:0},TI=function(r,e){let t=0,i=e-r.mediaSequence,s=r.segments[i];if(s){if(typeof s.start<"u")return{result:s.start,precise:!0};if(typeof s.end<"u")return{result:s.end-s.duration,precise:!0}}for(;i--;){if(s=r.segments[i],typeof s.end<"u")return{result:t+s.end,precise:!0};if(t+=Rh(r,s),typeof s.start<"u")return{result:t+s.start,precise:!0}}return{result:t,precise:!1}},_I=function(r,e){let t=0,i,s=e-r.mediaSequence;for(;s<r.segments.length;s++){if(i=r.segments[s],typeof i.start<"u")return{result:i.start-t,precise:!0};if(t+=Rh(r,i),typeof i.end<"u")return{result:i.end-t,precise:!0}}return{result:-1,precise:!1}},$y=function(r,e,t){if(typeof e>"u"&&(e=r.mediaSequence+r.segments.length),e<r.mediaSequence)return 0;const i=TI(r,e);if(i.precise)return i.result;const s=_I(r,e);return s.precise?s.result:i.result+t},Vy=function(r,e,t){if(!r)return 0;if(typeof t!="number"&&(t=0),typeof e>"u"){if(r.totalDuration)return r.totalDuration;if(!r.endList)return $.Infinity}return $y(r,e,t)},Fn=function({defaultDuration:r,durationList:e,startIndex:t,endIndex:i}){let s=0;if(t>i&&([t,i]=[i,t]),t<0){for(let n=t;n<Math.min(0,i);n++)s+=r;t=0}for(let n=t;n<i;n++)s+=e[n].duration;return s},Gy=function(r,e,t,i){if(!r||!r.segments)return null;if(r.endList)return Vy(r);if(e===null)return null;e=e||0;let s=$y(r,r.mediaSequence+r.segments.length,e);return t&&(i=typeof i=="number"?i:Uy(null,r),s-=i),Math.max(0,s)},vI=function(r,e,t){const s=e||0;let n=Gy(r,e,!0,t);return n===null?At():(n<s&&(n=s),At(s,n))},SI=function({playlist:r,currentTime:e,startingSegmentIndex:t,startingPartIndex:i,startTime:s,exactManifestTimings:n}){let a=e-s;const o=gc(r);let l=0;for(let u=0;u<o.length;u++){const c=o[u];if(t===c.segmentIndex&&!(typeof i=="number"&&typeof c.partIndex=="number"&&i!==c.partIndex)){l=u;break}}if(a<0){if(l>0)for(let u=l-1;u>=0;u--){const c=o[u];if(a+=c.duration,n){if(a<0)continue}else if(a+ji<=0)continue;return{partIndex:c.partIndex,segmentIndex:c.segmentIndex,startTime:s-Fn({defaultDuration:r.targetDuration,durationList:o,startIndex:l,endIndex:u})}}return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:e}}if(l<0){for(let u=l;u<0;u++)if(a-=r.targetDuration,a<0)return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:e};l=0}for(let u=l;u<o.length;u++){const c=o[u];a-=c.duration;const h=c.duration>ji,f=a===0,p=h&&a+ji>=0;if(!((f||p)&&u!==o.length-1)){if(n){if(a>0)continue}else if(a-ji>=0)continue;return{partIndex:c.partIndex,segmentIndex:c.segmentIndex,startTime:s+Fn({defaultDuration:r.targetDuration,durationList:o,startIndex:l,endIndex:u})}}}return{segmentIndex:o[o.length-1].segmentIndex,partIndex:o[o.length-1].partIndex,startTime:e}},Hy=function(r){return r.excludeUntil&&r.excludeUntil>Date.now()},wh=function(r){return r.excludeUntil&&r.excludeUntil===1/0},pl=function(r){const e=Hy(r);return!r.disabled&&!e},EI=function(r){return r.disabled},bI=function(r){for(let e=0;e<r.segments.length;e++)if(r.segments[e].key)return!0;return!1},qy=function(r,e){return e.attributes&&e.attributes[r]},xI=function(r,e,t,i=0){return qy("BANDWIDTH",t)?(r*t.attributes.BANDWIDTH-i*8)/e:NaN},mc=(r,e)=>{if(r.playlists.length===1)return!0;const t=e.attributes.BANDWIDTH||Number.MAX_VALUE;return r.playlists.filter(i=>pl(i)?(i.attributes.BANDWIDTH||0)<t:!1).length===0},kh=(r,e)=>!r&&!e||!r&&e||r&&!e?!1:!!(r===e||r.id&&e.id&&r.id===e.id||r.resolvedUri&&e.resolvedUri&&r.resolvedUri===e.resolvedUri||r.uri&&e.uri&&r.uri===e.uri),Jp=function(r,e){const t=r&&r.mediaGroups&&r.mediaGroups.AUDIO||{};let i=!1;for(const s in t){for(const n in t[s])if(i=e(t[s][n]),i)break;if(i)break}return!!i},ia=r=>{if(!r||!r.playlists||!r.playlists.length)return Jp(r,t=>t.playlists&&t.playlists.length||t.uri);for(let e=0;e<r.playlists.length;e++){const t=r.playlists[e],i=t.attributes&&t.attributes.CODECS;if(!(i&&i.split(",").every(n=>i0(n))||Jp(r,n=>kh(t,n))))return!1}return!0};var jt={liveEdgeDelay:Uy,duration:Vy,seekable:vI,getMediaInfoForTime:SI,isEnabled:pl,isDisabled:EI,isExcluded:Hy,isIncompatible:wh,playlistEnd:Gy,isAes:bI,hasAttribute:qy,estimateSegmentRequestTime:xI,isLowestEnabledRendition:mc,isAudioOnly:ia,playlistMatch:kh,segmentDurationWithParts:Rh};const{log:jy}=te,Rr=(r,e)=>`${r}-${e}`,Ky=(r,e,t)=>`placeholder-uri-${r}-${e}-${t}`,AI=({onwarn:r,oninfo:e,manifestString:t,customTagParsers:i=[],customTagMappers:s=[],llhls:n})=>{const a=new dA;r&&a.on("warn",r),e&&a.on("info",e),i.forEach(u=>a.addParser(u)),s.forEach(u=>a.addTagMapper(u)),a.push(t),a.end();const o=a.manifest;if(n||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(u){o.hasOwnProperty(u)&&delete o[u]}),o.segments&&o.segments.forEach(function(u){["parts","preloadHints"].forEach(function(c){u.hasOwnProperty(c)&&delete u[c]})})),!o.targetDuration){let u=10;o.segments&&o.segments.length&&(u=o.segments.reduce((c,h)=>Math.max(c,h.duration),0)),r&&r({message:`manifest has no targetDuration defaulting to ${u}`}),o.targetDuration=u}const l=Ny(o);if(l.length&&!o.partTargetDuration){const u=l.reduce((c,h)=>Math.max(c,h.duration),0);r&&(r({message:`manifest has no partTargetDuration defaulting to ${u}`}),jy.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),o.partTargetDuration=u}return o},Jr=(r,e)=>{r.mediaGroups&&["AUDIO","SUBTITLES"].forEach(t=>{if(r.mediaGroups[t])for(const i in r.mediaGroups[t])for(const s in r.mediaGroups[t][i]){const n=r.mediaGroups[t][i][s];e(n,t,i,s)}})},Wy=({playlist:r,uri:e,id:t})=>{r.id=t,r.playlistErrors_=0,e&&(r.uri=e),r.attributes=r.attributes||{}},CI=r=>{let e=r.playlists.length;for(;e--;){const t=r.playlists[e];Wy({playlist:t,id:Rr(e,t.uri)}),t.resolvedUri=qt(r.uri,t.uri),r.playlists[t.id]=t,r.playlists[t.uri]=t,t.attributes.BANDWIDTH||jy.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}},II=r=>{Jr(r,e=>{e.uri&&(e.resolvedUri=qt(r.uri,e.uri))})},DI=(r,e)=>{const t=Rr(0,e),i={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:$.location.href,resolvedUri:$.location.href,playlists:[{uri:e,id:t,resolvedUri:e,attributes:{}}]};return i.playlists[t]=i.playlists[0],i.playlists[e]=i.playlists[0],i},zy=(r,e,t=Ky)=>{r.uri=e;for(let s=0;s<r.playlists.length;s++)if(!r.playlists[s].uri){const n=`placeholder-uri-${s}`;r.playlists[s].uri=n}const i=ia(r);Jr(r,(s,n,a,o)=>{if(!s.playlists||!s.playlists.length){if(i&&n==="AUDIO"&&!s.uri)for(let l=0;l<r.playlists.length;l++){const u=r.playlists[l];if(u.attributes&&u.attributes.AUDIO&&u.attributes.AUDIO===a)return}s.playlists=[mt({},s)]}s.playlists.forEach(function(l,u){const c=t(n,a,o,l),h=Rr(u,c);l.uri?l.resolvedUri=l.resolvedUri||qt(r.uri,l.uri):(l.uri=u===0?c:h,l.resolvedUri=l.uri),l.id=l.id||h,l.attributes=l.attributes||{},r.playlists[l.id]=l,r.playlists[l.uri]=l})}),CI(r),II(r)};class Zp{constructor(){this.offset_=null,this.pendingDateRanges_=new Map,this.processedDateRanges_=new Map}setOffset(e=[]){if(this.offset_!==null||!e.length)return;const[t]=e;t.programDateTime!==void 0&&(this.offset_=t.programDateTime/1e3)}setPendingDateRanges(e=[]){if(!e.length)return;const[t]=e,i=t.startDate.getTime();this.trimProcessedDateRanges_(i),this.pendingDateRanges_=e.reduce((s,n)=>(s.set(n.id,n),s),new Map)}processDateRange(e){this.pendingDateRanges_.delete(e.id),this.processedDateRanges_.set(e.id,e)}getDateRangesToProcess(){if(this.offset_===null)return[];const e={},t=[];this.pendingDateRanges_.forEach((i,s)=>{if(!this.processedDateRanges_.has(s)&&(i.startTime=i.startDate.getTime()/1e3-this.offset_,i.processDateRange=()=>this.processDateRange(i),t.push(i),!!i.class))if(e[i.class]){const n=e[i.class].push(i);i.classListIndex=n-1}else e[i.class]=[i],i.classListIndex=0});for(const i of t){const s=e[i.class]||[];i.endDate?i.endTime=i.endDate.getTime()/1e3-this.offset_:i.endOnNext&&s[i.classListIndex+1]?i.endTime=s[i.classListIndex+1].startTime:i.duration?i.endTime=i.startTime+i.duration:i.plannedDuration?i.endTime=i.startTime+i.plannedDuration:i.endTime=i.startTime}return t}trimProcessedDateRanges_(e){new Map(this.processedDateRanges_).forEach((i,s)=>{i.startDate.getTime()<e&&this.processedDateRanges_.delete(s)})}}const Yy=22,er=({requestType:r,request:e,error:t,parseFailure:i})=>{const s=e.status<200||e.status>299,n=e.status>=400&&e.status<=499,a={uri:e.uri,requestType:r},o=s&&!n||i;if(t&&n)a.error=mt({},t),a.errorType=te.Error.NetworkRequestFailed;else if(e.aborted)a.errorType=te.Error.NetworkRequestAborted;else if(e.timedout)a.errorType=te.Error.NetworkRequestTimeout;else if(o){const l=i?te.Error.NetworkBodyParserFailed:te.Error.NetworkBadStatus;a.errorType=l,a.status=e.status,a.headers=e.headers}return a},LI=Ti("CodecUtils"),Xy=function(r){const e=r.attributes||{};if(e.CODECS)return Ui(e.CODECS)},Qy=(r,e)=>{const t=e.attributes||{};return r&&r.mediaGroups&&r.mediaGroups.AUDIO&&t.AUDIO&&r.mediaGroups.AUDIO[t.AUDIO]},RI=(r,e)=>{if(!Qy(r,e))return!0;const t=e.attributes||{},i=r.mediaGroups.AUDIO[t.AUDIO];for(const s in i)if(!i[s].uri&&!i[s].playlists)return!0;return!1},Yn=function(r){const e={};return r.forEach(({mediaType:t,type:i,details:s})=>{e[t]=e[t]||[],e[t].push(t0(`${i}${s}`))}),Object.keys(e).forEach(function(t){if(e[t].length>1){LI(`multiple ${t} codecs found as attributes: ${e[t].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),e[t]=null;return}e[t]=e[t][0]}),e},eg=function(r){let e=0;return r.audio&&e++,r.video&&e++,e},Nn=function(r,e){const t=e.attributes||{},i=Yn(Xy(e)||[]);if(Qy(r,e)&&!i.audio&&!RI(r,e)){const s=Yn(pA(r,t.AUDIO)||[]);s.audio&&(i.audio=s.audio)}return i},{EventTarget:wI}=te,kI=(r,e)=>{if(e.endList||!e.serverControl)return r;const t={};if(e.serverControl.canBlockReload){const{preloadSegment:i}=e;let s=e.mediaSequence+e.segments.length;if(i){const n=i.parts||[],a=By(e)-1;a>-1&&a!==n.length-1&&(t._HLS_part=a),(a>-1||n.length)&&s--}t._HLS_msn=s}if(e.serverControl&&e.serverControl.canSkipUntil&&(t._HLS_skip=e.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(t).length){const i=new $.URL(r);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(s){t.hasOwnProperty(s)&&i.searchParams.set(s,t[s])}),r=i.toString()}return r},PI=(r,e)=>{if(!r)return e;const t=$e(r,e);if(r.preloadHints&&!e.preloadHints&&delete t.preloadHints,r.parts&&!e.parts)delete t.parts;else if(r.parts&&e.parts)for(let i=0;i<e.parts.length;i++)r.parts&&r.parts[i]&&(t.parts[i]=$e(r.parts[i],e.parts[i]));return!r.skipped&&e.skipped&&(t.skipped=!1),r.preload&&!e.preload&&(t.preload=!1),t},OI=(r,e,t)=>{const i=r.slice(),s=e.slice();t=t||0;const n=[];let a;for(let o=0;o<s.length;o++){const l=i[o+t],u=s[o];l?(a=l.map||a,n.push(PI(l,u))):(a&&!u.map&&(u.map=a),n.push(u))}return n},Jy=(r,e)=>{!r.resolvedUri&&r.uri&&(r.resolvedUri=qt(e,r.uri)),r.key&&!r.key.resolvedUri&&(r.key.resolvedUri=qt(e,r.key.uri)),r.map&&!r.map.resolvedUri&&(r.map.resolvedUri=qt(e,r.map.uri)),r.map&&r.map.key&&!r.map.key.resolvedUri&&(r.map.key.resolvedUri=qt(e,r.map.key.uri)),r.parts&&r.parts.length&&r.parts.forEach(t=>{t.resolvedUri||(t.resolvedUri=qt(e,t.uri))}),r.preloadHints&&r.preloadHints.length&&r.preloadHints.forEach(t=>{t.resolvedUri||(t.resolvedUri=qt(e,t.uri))})},Zy=function(r){const e=r.segments||[],t=r.preloadSegment;if(t&&t.parts&&t.parts.length){if(t.preloadHints){for(let i=0;i<t.preloadHints.length;i++)if(t.preloadHints[i].type==="MAP")return e}t.duration=r.targetDuration,t.preload=!0,e.push(t)}return e},eT=(r,e)=>r===e||r.segments&&e.segments&&r.segments.length===e.segments.length&&r.endList===e.endList&&r.mediaSequence===e.mediaSequence&&r.preloadSegment===e.preloadSegment,yc=(r,e,t=eT)=>{const i=$e(r,{}),s=i.playlists[e.id];if(!s||t(s,e))return null;e.segments=Zy(e);const n=$e(s,e);if(n.preloadSegment&&!e.preloadSegment&&delete n.preloadSegment,s.segments){if(e.skip){e.segments=e.segments||[];for(let a=0;a<e.skip.skippedSegments;a++)e.segments.unshift({skipped:!0})}n.segments=OI(s.segments,e.segments,e.mediaSequence-s.mediaSequence)}n.segments.forEach(a=>{Jy(a,n.resolvedUri)});for(let a=0;a<i.playlists.length;a++)i.playlists[a].id===e.id&&(i.playlists[a]=n);return i.playlists[e.id]=n,i.playlists[e.uri]=n,Jr(r,(a,o,l,u)=>{if(a.playlists)for(let c=0;c<a.playlists.length;c++)e.id===a.playlists[c].id&&(a.playlists[c]=n)}),i},Tc=(r,e)=>{const t=r.segments||[],i=t[t.length-1],s=i&&i.parts&&i.parts[i.parts.length-1],n=s&&s.duration||i&&i.duration;return e&&n?n*1e3:(r.partTargetDuration||r.targetDuration||10)*500},tg=(r,e,t)=>{if(!r)return;const i=[];return r.forEach(s=>{if(!s.attributes)return;const{BANDWIDTH:n,RESOLUTION:a,CODECS:o}=s.attributes;i.push({id:s.id,bandwidth:n,resolution:a,codecs:o})}),{type:e,isLive:t,renditions:i}};class vr extends wI{constructor(e,t,i={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=Ti("PlaylistLoader");const{withCredentials:s=!1}=i;this.src=e,this.vhs_=t,this.withCredentials=s,this.addDateRangesToTextTrack_=i.addDateRangesToTextTrack;const n=t.options_;this.customTagParsers=n&&n.customTagParsers||[],this.customTagMappers=n&&n.customTagMappers||[],this.llhls=n&&n.llhls,this.dateRangesStorage_=new Zp,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_),this.on("loadedplaylist",this.handleLoadedPlaylist_.bind(this))}handleLoadedPlaylist_(){const e=this.media();if(!e)return;this.dateRangesStorage_.setOffset(e.segments),this.dateRangesStorage_.setPendingDateRanges(e.dateRanges);const t=this.dateRangesStorage_.getDateRangesToProcess();!t.length||!this.addDateRangesToTextTrack_||this.addDateRangesToTextTrack_(t)}handleMediaupdatetimeout_(){if(this.state!=="HAVE_METADATA")return;const e=this.media();let t=qt(this.main.uri,e.uri);this.llhls&&(t=kI(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials,requestType:"hls-playlist"},(i,s)=>{if(this.request){if(i)return this.playlistRequestError(this.request,this.media(),"HAVE_METADATA");this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})}})}playlistRequestError(e,t,i){const{uri:s,id:n}=t;this.request=null,i&&(this.state=i),this.error={playlist:this.main.playlists[n],status:e.status,message:`HLS playlist request error at URL: ${s}.`,responseText:e.responseText,code:e.status>=500?4:2,metadata:er({requestType:e.requestType,request:e,error:e.error})},this.trigger("error")}parseManifest_({url:e,manifestString:t}){try{const i=AI({onwarn:({message:s})=>this.logger_(`m3u8-parser warn for ${e}: ${s}`),oninfo:({message:s})=>this.logger_(`m3u8-parser info for ${e}: ${s}`),manifestString:t,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls});return!i.playlists||!i.playlists.length||this.excludeAudioOnlyVariants(i.playlists),i}catch(i){this.error=i,this.error.metadata={errorType:te.Error.StreamingHlsPlaylistParserError,error:i}}}excludeAudioOnlyVariants(e){const t=i=>{const s=i.attributes||{},{width:n,height:a}=s.RESOLUTION||{};if(n&&a)return!0;const o=Xy(i)||[];return!!Yn(o).video};e.some(t)&&e.forEach(i=>{t(i)||(i.excludeUntil=1/0)})}haveMetadata({playlistString:e,playlistObject:t,url:i,id:s}){this.request=null,this.state="HAVE_METADATA";const n={playlistInfo:{type:"media",uri:i}};this.trigger({type:"playlistparsestart",metadata:n});const a=t||this.parseManifest_({url:i,manifestString:e});a.lastRequest=Date.now(),Wy({playlist:a,uri:i,id:s});const o=yc(this.main,a);this.targetDuration=a.partTargetDuration||a.targetDuration,this.pendingMedia_=null,o?(this.main=o,this.media_=this.main.playlists[s]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(Tc(this.media(),!!o)),n.parsedPlaylist=tg(this.main.playlists,n.playlistInfo.type,!this.media_.endList),this.trigger({type:"playlistparsecomplete",metadata:n}),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),$.clearTimeout(this.mediaUpdateTimeout),$.clearTimeout(this.finalRenditionTimeout),this.dateRangesStorage_=new Zp,this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);if(typeof e=="string"){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if($.clearTimeout(this.finalRenditionTimeout),t){const o=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=$.setTimeout(this.media.bind(this,e,!1),o);return}const i=this.state,s=!this.media_||e.id!==this.media_.id,n=this.main.playlists[e.id];if(n&&n.endList||e.endList&&e.segments.length){this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,s&&(this.trigger("mediachanging"),i==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange"));return}if(this.updateMediaUpdateTimeout_(Tc(e,!0)),!s)return;if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e;const a={playlistInfo:{type:"media",uri:e.uri}};this.trigger({type:"playlistrequeststart",metadata:a}),this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials,requestType:"hls-playlist"},(o,l)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=$o(e.resolvedUri,l),o)return this.playlistRequestError(this.request,e,i);this.trigger({type:"playlistrequestcomplete",metadata:a}),this.haveMetadata({playlistString:l.responseText,url:e.uri,id:e.id}),i==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}})}pause(){this.mediaUpdateTimeout&&($.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),this.state==="HAVE_NOTHING"&&(this.started=!1),this.state==="SWITCHING_MEDIA"?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":this.state==="HAVE_CURRENT_METADATA"&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&($.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const i=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=$.setTimeout(()=>{this.mediaUpdateTimeout=null,this.load()},i);return}if(!this.started){this.start();return}t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist")}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&($.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),!(!this.media()||this.media().endList)&&(this.mediaUpdateTimeout=$.setTimeout(()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)},e))}start(){if(this.started=!0,typeof this.src=="object"){this.src.uri||(this.src.uri=$.location.href),this.src.resolvedUri=this.src.uri,setTimeout(()=>{this.setupInitialPlaylist(this.src)},0);return}const e={playlistInfo:{type:"multivariant",uri:this.src}};this.trigger({type:"playlistrequeststart",metadata:e}),this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials,requestType:"hls-playlist"},(t,i)=>{if(!this.request)return;if(this.request=null,t)return this.error={status:i.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:i.responseText,code:2,metadata:er({requestType:i.requestType,request:i,error:t})},this.state==="HAVE_NOTHING"&&(this.started=!1),this.trigger("error");this.trigger({type:"playlistrequestcomplete",metadata:e}),this.src=$o(this.src,i),this.trigger({type:"playlistparsestart",metadata:e});const s=this.parseManifest_({manifestString:i.responseText,url:this.src});e.parsedPlaylist=tg(s.playlists,e.playlistInfo.type,!1),this.trigger({type:"playlistparsecomplete",metadata:e}),this.setupInitialPlaylist(s)})}srcUri(){return typeof this.src=="string"?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists){this.main=e,zy(this.main,this.srcUri()),e.playlists.forEach(i=>{i.segments=Zy(i),i.segments.forEach(s=>{Jy(s,i.resolvedUri)})}),this.trigger("loadedplaylist"),this.request||this.media(this.main.playlists[0]);return}const t=this.srcUri()||$.location.href;this.main=DI(e,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}updateOrDeleteClone(e,t){const i=this.main,s=e.ID;let n=i.playlists.length;for(;n--;){const a=i.playlists[n];if(a.attributes["PATHWAY-ID"]===s){const o=a.resolvedUri,l=a.id;if(t){const u=this.createCloneURI_(a.resolvedUri,e),c=Rr(s,u),h=this.createCloneAttributes_(s,a.attributes),f=this.createClonePlaylist_(a,c,e,h);i.playlists[n]=f,i.playlists[c]=f,i.playlists[u]=f}else i.playlists.splice(n,1);delete i.playlists[l],delete i.playlists[o]}}this.updateOrDeleteCloneMedia(e,t)}updateOrDeleteCloneMedia(e,t){const i=this.main,s=e.ID;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(n=>{if(!(!i.mediaGroups[n]||!i.mediaGroups[n][s])){for(const a in i.mediaGroups[n])if(a===s){for(const o in i.mediaGroups[n][a])i.mediaGroups[n][a][o].playlists.forEach((u,c)=>{const h=i.playlists[u.id],f=h.id,p=h.resolvedUri;delete i.playlists[f],delete i.playlists[p]});delete i.mediaGroups[n][a]}}}),t&&this.createClonedMediaGroups_(e)}addClonePathway(e,t={}){const i=this.main,s=i.playlists.length,n=this.createCloneURI_(t.resolvedUri,e),a=Rr(e.ID,n),o=this.createCloneAttributes_(e.ID,t.attributes),l=this.createClonePlaylist_(t,a,e,o);i.playlists[s]=l,i.playlists[a]=l,i.playlists[n]=l,this.createClonedMediaGroups_(e)}createClonedMediaGroups_(e){const t=e.ID,i=e["BASE-ID"],s=this.main;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(n=>{if(!(!s.mediaGroups[n]||s.mediaGroups[n][t]))for(const a in s.mediaGroups[n]){if(a===i)s.mediaGroups[n][t]={};else continue;for(const o in s.mediaGroups[n][a]){const l=s.mediaGroups[n][a][o];s.mediaGroups[n][t][o]=mt({},l);const u=s.mediaGroups[n][t][o],c=this.createCloneURI_(l.resolvedUri,e);u.resolvedUri=c,u.uri=c,u.playlists=[],l.playlists.forEach((h,f)=>{const p=s.playlists[h.id],m=Ky(n,t,o),y=Rr(t,m);if(p&&!s.playlists[y]){const v=this.createClonePlaylist_(p,y,e),E=v.resolvedUri;s.playlists[y]=v,s.playlists[E]=v}u.playlists[f]=this.createClonePlaylist_(h,y,e)})}}})}createClonePlaylist_(e,t,i,s){const n=this.createCloneURI_(e.resolvedUri,i),a={resolvedUri:n,uri:n,id:t};return e.segments&&(a.segments=[]),s&&(a.attributes=s),$e(e,a)}createCloneURI_(e,t){const i=new URL(e);i.hostname=t["URI-REPLACEMENT"].HOST;const s=t["URI-REPLACEMENT"].PARAMS;for(const n of Object.keys(s))i.searchParams.set(n,s[n]);return i.href}createCloneAttributes_(e,t){const i={"PATHWAY-ID":e};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(s=>{t[s]&&(i[s]=e)}),i}getKeyIdSet(e){const t=new Set;if(!e||!e.contentProtection)return t;for(const i in e.contentProtection)if(e.contentProtection[i]&&e.contentProtection[i].attributes&&e.contentProtection[i].attributes.keyId){const s=e.contentProtection[i].attributes.keyId;t.add(s.toLowerCase())}return t}}const _c=function(r,e,t,i){const s=r.responseType==="arraybuffer"?r.response:r.responseText;!e&&s&&(r.responseTime=Date.now(),r.roundTripTime=r.responseTime-r.requestTime,r.bytesReceived=s.byteLength||s.length,r.bandwidth||(r.bandwidth=Math.floor(r.bytesReceived/r.roundTripTime*8*1e3))),t.headers&&(r.responseHeaders=t.headers),e&&e.code==="ETIMEDOUT"&&(r.timedout=!0),!e&&!r.aborted&&t.statusCode!==200&&t.statusCode!==206&&t.statusCode!==0&&(e=new Error("XHR Failed with a response of: "+(r&&(s||r.responseText)))),i(e,r)},MI=(r,e)=>{if(!r||!r.size)return;let t=e;return r.forEach(i=>{t=i(t)}),t},FI=(r,e,t,i)=>{!r||!r.size||r.forEach(s=>{s(e,t,i)})},tT=function(){const r=function e(t,i){t=$e({timeout:45e3},t);const s=e.beforeRequest||te.Vhs.xhr.beforeRequest,n=e._requestCallbackSet||te.Vhs.xhr._requestCallbackSet||new Set,a=e._responseCallbackSet||te.Vhs.xhr._responseCallbackSet;s&&typeof s=="function"&&(te.log.warn("beforeRequest is deprecated, use onRequest instead."),n.add(s));const o=te.Vhs.xhr.original===!0?te.xhr:te.Vhs.xhr,l=MI(n,t);n.delete(s);const u=o(l||t,function(h,f){return FI(a,u,h,f),_c(u,h,f,i)}),c=u.abort;return u.abort=function(){return u.aborted=!0,c.apply(u,arguments)},u.uri=t.uri,u.requestType=t.requestType,u.requestTime=Date.now(),u};return r.original=!0,r},NI=function(r){let e;const t=r.offset;return typeof r.offset=="bigint"||typeof r.length=="bigint"?e=$.BigInt(r.offset)+$.BigInt(r.length)-$.BigInt(1):e=r.offset+r.length-1,"bytes="+t+"-"+e},vc=function(r){const e={};return r.byterange&&(e.Range=NI(r.byterange)),e},BI=function(r,e){return r.start(e)+"-"+r.end(e)},UI=function(r,e){const t=r.toString(16);return"00".substring(0,2-t.length)+t+(e%2?" ":"")},$I=function(r){return r>=32&&r<126?String.fromCharCode(r):"."},iT=function(r){const e={};return Object.keys(r).forEach(t=>{const i=r[t];r0(i)?e[t]={bytes:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}:e[t]=i}),e},Vo=function(r){const e=r.byterange||{length:1/0,offset:0};return[e.length,e.offset,r.resolvedUri].join(",")},sT=function(r){return r.resolvedUri},rT=r=>{const e=Array.prototype.slice.call(r),t=16;let i="",s,n;for(let a=0;a<e.length/t;a++)s=e.slice(a*t,a*t+t).map(UI).join(""),n=e.slice(a*t,a*t+t).map($I).join(""),i+=s+" "+n+`
`;return i},VI=({bytes:r})=>rT(r),GI=r=>{let e="",t;for(t=0;t<r.length;t++)e+=BI(r,t)+" ";return e};var HI=Object.freeze({__proto__:null,createTransferableMessage:iT,initSegmentId:Vo,segmentKeyId:sT,hexDump:rT,tagDump:VI,textRanges:GI});const nT=.25,qI=(r,e)=>{if(!e.dateTimeObject)return null;const t=e.videoTimingInfo.transmuxerPrependedSeconds,s=e.videoTimingInfo.transmuxedPresentationStart+t,n=r-s;return new Date(e.dateTimeObject.getTime()+n*1e3)},jI=r=>r.transmuxedPresentationEnd-r.transmuxedPresentationStart-r.transmuxerPrependedSeconds,KI=(r,e)=>{let t;try{t=new Date(r)}catch{return null}if(!e||!e.segments||e.segments.length===0)return null;let i=e.segments[0];if(t<new Date(i.dateTimeObject))return null;for(let l=0;l<e.segments.length-1;l++){i=e.segments[l];const u=new Date(e.segments[l+1].dateTimeObject);if(t<u)break}const s=e.segments[e.segments.length-1],n=s.dateTimeObject,a=s.videoTimingInfo?jI(s.videoTimingInfo):s.duration+s.duration*nT,o=new Date(n.getTime()+a*1e3);return t>o?null:(t>new Date(n)&&(i=s),{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:jt.duration(e,e.mediaSequence+e.segments.indexOf(i)),type:i.videoTimingInfo?"accurate":"estimate"})},WI=(r,e)=>{if(!e||!e.segments||e.segments.length===0)return null;let t=0,i;for(let n=0;n<e.segments.length&&(i=e.segments[n],t=i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationEnd:t+i.duration,!(r<=t));n++);const s=e.segments[e.segments.length-1];if(s.videoTimingInfo&&s.videoTimingInfo.transmuxedPresentationEnd<r)return null;if(r>t){if(r>t+s.duration*nT)return null;i=s}return{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:t-i.duration,type:i.videoTimingInfo?"accurate":"estimate"}},zI=(r,e)=>{let t,i;try{t=new Date(r),i=new Date(e)}catch{}const s=t.getTime();return(i.getTime()-s)/1e3},YI=r=>{if(!r.segments||r.segments.length===0)return!1;for(let e=0;e<r.segments.length;e++)if(!r.segments[e].dateTimeObject)return!1;return!0},XI=({playlist:r,time:e=void 0,callback:t})=>{if(!t)throw new Error("getProgramTime: callback must be provided");if(!r||e===void 0)return t({message:"getProgramTime: playlist and time must be provided"});const i=WI(e,r);if(!i)return t({message:"valid programTime was not found"});if(i.type==="estimate")return t({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:i.estimatedStart});const s={mediaSeconds:e},n=qI(e,i.segment);return n&&(s.programDateTime=n.toISOString()),t(null,s)},aT=({programTime:r,playlist:e,retryCount:t=2,seekTo:i,pauseAfterSeek:s=!0,tech:n,callback:a})=>{if(!a)throw new Error("seekToProgramTime: callback must be provided");if(typeof r>"u"||!e||!i)return a({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!e.endList&&!n.hasStarted_)return a({message:"player must be playing a live stream to start buffering"});if(!YI(e))return a({message:"programDateTime tags must be provided in the manifest "+e.resolvedUri});const o=KI(r,e);if(!o)return a({message:`${r} was not found in the stream`});const l=o.segment,u=zI(l.dateTimeObject,r);if(o.type==="estimate"){if(t===0)return a({message:`${r} is not buffered yet. Try again`});i(o.estimatedStart+u),n.one("seeked",()=>{aT({programTime:r,playlist:e,retryCount:t-1,seekTo:i,pauseAfterSeek:s,tech:n,callback:a})});return}const c=l.start+u,h=()=>a(null,n.currentTime());n.one("seeked",h),s&&n.pause(),i(c)},wu=(r,e)=>{if(r.readyState===4)return e()},QI=(r,e,t,i)=>{let s=[],n,a=!1;const o=function(h,f,p,m){return f.abort(),a=!0,t(h,f,p,m)},l=function(h,f){if(a)return;if(h)return h.metadata=er({requestType:i,request:f,error:h}),o(h,f,"",s);const p=f.responseText.substring(s&&s.byteLength||0,f.responseText.length);if(s=xA(s,n0(p,!0)),n=n||Cn(s),s.length<10||n&&s.length<n+2)return wu(f,()=>o(h,f,"",s));const m=ih(s);return m==="ts"&&s.length<188?wu(f,()=>o(h,f,"",s)):!m&&s.length<376?wu(f,()=>o(h,f,"",s)):o(null,f,m,s)},c=e({uri:r,beforeSend(h){h.overrideMimeType("text/plain; charset=x-user-defined"),h.addEventListener("progress",function({total:f,loaded:p}){return _c(h,null,{statusCode:h.status},l)})}},function(h,f){return _c(c,h,f,l)});return c},{EventTarget:JI}=te,ig=function(r,e){if(!eT(r,e)||r.sidx&&e.sidx&&(r.sidx.offset!==e.sidx.offset||r.sidx.length!==e.sidx.length))return!1;if(!r.sidx&&e.sidx||r.sidx&&!e.sidx||r.segments&&!e.segments||!r.segments&&e.segments)return!1;if(!r.segments&&!e.segments)return!0;for(let t=0;t<r.segments.length;t++){const i=r.segments[t],s=e.segments[t];if(i.uri!==s.uri)return!1;if(!i.byterange&&!s.byterange)continue;const n=i.byterange,a=s.byterange;if(n&&!a||!n&&a||n.offset!==a.offset||n.length!==a.length)return!1}return!0},ZI=(r,e,t,i)=>{const s=i.attributes.NAME||t;return`placeholder-uri-${r}-${e}-${s}`},eD=({mainXml:r,srcUrl:e,clientOffset:t,sidxMapping:i,previousManifest:s})=>{const n=EC(r,{manifestUri:e,clientOffset:t,sidxMapping:i,previousManifest:s});return zy(n,e,ZI),n},tD=(r,e)=>{Jr(r,(t,i,s,n)=>{(!e.mediaGroups[i][s]||!(n in e.mediaGroups[i][s]))&&delete r.mediaGroups[i][s][n]})},iD=(r,e,t)=>{let i=!0,s=$e(r,{duration:e.duration,minimumUpdatePeriod:e.minimumUpdatePeriod,timelineStarts:e.timelineStarts});for(let n=0;n<e.playlists.length;n++){const a=e.playlists[n];if(a.sidx){const l=Xo(a.sidx);t&&t[l]&&t[l].sidx&&Zc(a,t[l].sidx,a.sidx.resolvedUri)}const o=yc(s,a,ig);o&&(s=o,i=!1)}return Jr(e,(n,a,o,l)=>{if(n.playlists&&n.playlists.length){const u=n.playlists[0].id,c=yc(s,n.playlists[0],ig);c&&(s=c,l in s.mediaGroups[a][o]||(s.mediaGroups[a][o][l]=n),s.mediaGroups[a][o][l].playlists[0]=s.playlists[u],i=!1)}}),tD(s,e),e.minimumUpdatePeriod!==r.minimumUpdatePeriod&&(i=!1),i?null:s},sD=(r,e)=>(!r.map&&!e.map||!!(r.map&&e.map&&r.map.byterange.offset===e.map.byterange.offset&&r.map.byterange.length===e.map.byterange.length))&&r.uri===e.uri&&r.byterange.offset===e.byterange.offset&&r.byterange.length===e.byterange.length,sg=(r,e)=>{const t={};for(const i in r){const n=r[i].sidx;if(n){const a=Xo(n);if(!e[a])break;const o=e[a].sidxInfo;sD(o,n)&&(t[a]=e[a])}}return t},rD=(r,e)=>{let i=sg(r.playlists,e);return Jr(r,(s,n,a,o)=>{if(s.playlists&&s.playlists.length){const l=s.playlists;i=$e(i,sg(l,e))}}),i};class Sc extends JI{constructor(e,t,i={},s){super(),this.isPaused_=!0,this.mainPlaylistLoader_=s||this,s||(this.isMain_=!0);const{withCredentials:n=!1}=i;if(this.vhs_=t,this.withCredentials=n,this.addMetadataToTextTrack=i.addMetadataToTextTrack,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",()=>{this.refreshXml_()}),this.on("mediaupdatetimeout",()=>{this.refreshMedia_(this.media().id)}),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=Ti("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}get isPaused(){return this.isPaused_}requestErrored_(e,t,i){if(!this.request)return!0;if(this.request=null,e)return this.error=typeof e=="object"&&!(e instanceof Error)?e:{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2,metadata:e.metadata},i&&(this.state=i),this.trigger("error"),!0}addSidxSegments_(e,t,i){const s=e.sidx&&Xo(e.sidx);if(!e.sidx||!s||this.mainPlaylistLoader_.sidxMapping_[s]){$.clearTimeout(this.mediaRequest_),this.mediaRequest_=$.setTimeout(()=>i(!1),0);return}const n=$o(e.sidx.resolvedUri),a=(l,u)=>{if(this.requestErrored_(l,u,t))return;const c=this.mainPlaylistLoader_.sidxMapping_,{requestType:h}=u;let f;try{f=IC(Se(u.response).subarray(8))}catch(p){p.metadata=er({requestType:h,request:u,parseFailure:!0}),this.requestErrored_(p,u,t);return}return c[s]={sidxInfo:e.sidx,sidx:f},Zc(e,f,e.sidx.resolvedUri),i(!0)},o="dash-sidx";this.request=QI(n,this.vhs_.xhr,(l,u,c,h)=>{if(l)return a(l,u);if(!c||c!=="mp4"){const m=c||"unknown";return a({status:u.status,message:`Unsupported ${m} container type for sidx segment at URL: ${n}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},u)}const{offset:f,length:p}=e.sidx.byterange;if(h.length>=p+f)return a(l,{response:h.subarray(f,f+p),status:u.status,uri:u.uri});this.request=this.vhs_.xhr({uri:n,responseType:"arraybuffer",requestType:"dash-sidx",headers:vc({byterange:e.sidx.byterange})},a)},o)}dispose(){this.isPaused_=!0,this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},$.clearTimeout(this.minimumUpdatePeriodTimeout_),$.clearTimeout(this.mediaRequest_),$.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if(typeof e=="string"){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const i=!this.media_||e.id!==this.media_.id;if(i&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList){this.state="HAVE_METADATA",this.media_=e,i&&(this.trigger("mediachanging"),this.trigger("mediachange"));return}i&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,s=>{this.haveMetadata({startingState:t,playlist:e})}))}haveMetadata({startingState:e,playlist:t}){this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,$.clearTimeout(this.mediaRequest_),this.mediaRequest_=null,this.refreshMedia_(t.id),e==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.isPaused_=!0,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),$.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&($.clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),this.state==="HAVE_NOTHING"&&(this.started=!1)}load(e){this.isPaused_=!1,$.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const i=t?t.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=$.setTimeout(()=>this.load(),i);return}if(!this.started){this.start();return}t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist")}start(){if(this.started=!0,!this.isMain_){$.clearTimeout(this.mediaRequest_),this.mediaRequest_=$.setTimeout(()=>this.haveMain_(),0);return}this.requestMain_((e,t)=>{this.haveMain_(),!this.hasPendingRequest()&&!this.media_&&this.media(this.mainPlaylistLoader_.main.playlists[0])})}requestMain_(e){const t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestrequeststart",metadata:t}),this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials,requestType:"dash-manifest"},(i,s)=>{if(i){const{requestType:a}=s;i.metadata=er({requestType:a,request:s,error:i})}if(this.requestErrored_(i,s)){this.state==="HAVE_NOTHING"&&(this.started=!1);return}this.trigger({type:"manifestrequestcomplete",metadata:t});const n=s.responseText!==this.mainPlaylistLoader_.mainXml_;if(this.mainPlaylistLoader_.mainXml_=s.responseText,s.responseHeaders&&s.responseHeaders.date?this.mainLoaded_=Date.parse(s.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=$o(this.mainPlaylistLoader_.srcUrl,s),n){this.handleMain_(),this.syncClientServerClock_(()=>e(s,n));return}return e(s,n)})}syncClientServerClock_(e){const t=bC(this.mainPlaylistLoader_.mainXml_);if(t===null)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();if(t.method==="DIRECT")return this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e();this.request=this.vhs_.xhr({uri:qt(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials,requestType:"dash-clock-sync"},(i,s)=>{if(!this.request)return;if(i){const{requestType:a}=s;return this.error.metadata=er({requestType:a,request:s,error:i}),this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()}let n;t.method==="HEAD"?!s.responseHeaders||!s.responseHeaders.date?n=this.mainLoaded_:n=Date.parse(s.responseHeaders.date):n=Date.parse(s.responseText),this.mainPlaylistLoader_.clientOffset_=n-Date.now(),e()})}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){$.clearTimeout(this.mediaRequest_),this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main,t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestparsestart",metadata:t});let i;try{i=eD({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e})}catch(n){this.error=n,this.error.metadata={errorType:te.Error.StreamingDashManifestParserError,error:n},this.trigger("error")}e&&(i=iD(e,i,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=i||e;const s=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];if(s&&s!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=s),(!e||i&&i.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),this.addEventStreamToMetadataTrack_(i),i){const{duration:n,endList:a}=i,o=[];i.playlists.forEach(u=>{o.push({id:u.id,bandwidth:u.attributes.BANDWIDTH,resolution:u.attributes.RESOLUTION,codecs:u.attributes.CODECS})});const l={duration:n,isLive:!a,renditions:o};t.parsedManifest=l,this.trigger({type:"manifestparsecomplete",metadata:t})}return!!i}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&($.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;if(t===0&&(e.media()?t=e.media().targetDuration*1e3:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),typeof t!="number"||t<=0){t<0&&this.logger_(`found invalid minimumUpdatePeriod of ${t}, not setting a timeout`);return}this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=$.setTimeout(()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)},e)}refreshXml_(){this.requestMain_((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=rD(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,i=>{this.refreshMedia_(this.media().id)}))})}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,i=!this.media_||this.media_!==t[e];if(i?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const s=()=>{this.media().endList||(this.mediaUpdateTimeout=$.setTimeout(()=>{this.trigger("mediaupdatetimeout"),s()},Tc(this.media(),!!i)))};s()}this.trigger("loadedplaylist")}addEventStreamToMetadataTrack_(e){if(e&&this.mainPlaylistLoader_.main.eventStream){const t=this.mainPlaylistLoader_.main.eventStream.map(i=>({cueTime:i.start,frames:[{data:i.messageData}]}));this.addMetadataToTextTrack("EventStream",t,this.mainPlaylistLoader_.main.duration)}}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const i in e.contentProtection){const s=e.contentProtection[i].attributes["cenc:default_KID"];s&&t.add(s.replace(/-/g,"").toLowerCase())}return t}}}var bt={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const nD=r=>{const e=new Uint8Array(new ArrayBuffer(r.length));for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e.buffer},oT=function(r){return r.on=r.addEventListener,r.off=r.removeEventListener,r},aD=function(r){try{return URL.createObjectURL(new Blob([r],{type:"application/javascript"}))}catch{const t=new BlobBuilder;return t.append(r),URL.createObjectURL(t.getBlob())}},lT=function(r){return function(){const e=aD(r),t=oT(new Worker(e));t.objURL=e;const i=t.terminate;return t.on=t.addEventListener,t.off=t.removeEventListener,t.terminate=function(){return URL.revokeObjectURL(e),i.call(this)},t}},uT=function(r){return`var browserWorkerPolyFill = ${oT.toString()};
browserWorkerPolyFill(self);
`+r},cT=function(r){return r.toString().replace(/^function.+?{/,"").slice(0,-1)},oD=uT(cT(function(){var r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=function(){this.init=function(){var d={};this.on=function(g,_){d[g]||(d[g]=[]),d[g]=d[g].concat(_)},this.off=function(g,_){var T;return d[g]?(T=d[g].indexOf(_),d[g]=d[g].slice(),d[g].splice(T,1),T>-1):!1},this.trigger=function(g){var _,T,S,b;if(_=d[g],!!_)if(arguments.length===2)for(S=_.length,T=0;T<S;++T)_[T].call(this,arguments[1]);else{for(b=[],T=arguments.length,T=1;T<arguments.length;++T)b.push(arguments[T]);for(S=_.length,T=0;T<S;++T)_[T].apply(this,b)}},this.dispose=function(){d={}}}};e.prototype.pipe=function(d){return this.on("data",function(g){d.push(g)}),this.on("done",function(g){d.flush(g)}),this.on("partialdone",function(g){d.partialFlush(g)}),this.on("endedtimeline",function(g){d.endTimeline(g)}),this.on("reset",function(g){d.reset(g)}),d},e.prototype.push=function(d){this.trigger("data",d)},e.prototype.flush=function(d){this.trigger("done",d)},e.prototype.partialFlush=function(d){this.trigger("partialdone",d)},e.prototype.endTimeline=function(d){this.trigger("endedtimeline",d)},e.prototype.reset=function(d){this.trigger("reset",d)};var t=e,i=Math.pow(2,32),s=function(d){var g=new DataView(d.buffer,d.byteOffset,d.byteLength),_;return g.getBigUint64?(_=g.getBigUint64(0),_<Number.MAX_SAFE_INTEGER?Number(_):_):g.getUint32(0)*i+g.getUint32(4)},n={getUint64:s,MAX_UINT32:i},a=n.MAX_UINT32,o,l,u,c,h,f,p,m,y,v,E,A,x,w,k,F,L,M,C,D,B,H,q,Y,Z,Q,K,z,X,ie,W,ae,de,ge,ce,ve;(function(){var d;if(q={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(d in q)q.hasOwnProperty(d)&&(q[d]=[d.charCodeAt(0),d.charCodeAt(1),d.charCodeAt(2),d.charCodeAt(3)]);Y=new Uint8Array([105,115,111,109]),Q=new Uint8Array([97,118,99,49]),Z=new Uint8Array([0,0,0,1]),K=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),z=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),X={video:K,audio:z},ae=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),W=new Uint8Array([0,0,0,0,0,0,0,0]),de=new Uint8Array([0,0,0,0,0,0,0,0]),ge=de,ce=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),ve=de,ie=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),o=function(d){var g=[],_=0,T,S,b;for(T=1;T<arguments.length;T++)g.push(arguments[T]);for(T=g.length;T--;)_+=g[T].byteLength;for(S=new Uint8Array(_+8),b=new DataView(S.buffer,S.byteOffset,S.byteLength),b.setUint32(0,S.byteLength),S.set(d,4),T=0,_=8;T<g.length;T++)S.set(g[T],_),_+=g[T].byteLength;return S},l=function(){return o(q.dinf,o(q.dref,ae))},u=function(d){return o(q.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,d.audioobjecttype<<3|d.samplingfrequencyindex>>>1,d.samplingfrequencyindex<<7|d.channelcount<<3,6,1,2]))},c=function(){return o(q.ftyp,Y,Z,Y,Q)},F=function(d){return o(q.hdlr,X[d])},h=function(d){return o(q.mdat,d)},k=function(d){var g=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,d.duration>>>24&255,d.duration>>>16&255,d.duration>>>8&255,d.duration&255,85,196,0,0]);return d.samplerate&&(g[12]=d.samplerate>>>24&255,g[13]=d.samplerate>>>16&255,g[14]=d.samplerate>>>8&255,g[15]=d.samplerate&255),o(q.mdhd,g)},w=function(d){return o(q.mdia,k(d),F(d.type),p(d))},f=function(d){return o(q.mfhd,new Uint8Array([0,0,0,0,(d&4278190080)>>24,(d&16711680)>>16,(d&65280)>>8,d&255]))},p=function(d){return o(q.minf,d.type==="video"?o(q.vmhd,ie):o(q.smhd,W),l(),M(d))},m=function(d,g){for(var _=[],T=g.length;T--;)_[T]=D(g[T]);return o.apply(null,[q.moof,f(d)].concat(_))},y=function(d){for(var g=d.length,_=[];g--;)_[g]=A(d[g]);return o.apply(null,[q.moov,E(4294967295)].concat(_).concat(v(d)))},v=function(d){for(var g=d.length,_=[];g--;)_[g]=B(d[g]);return o.apply(null,[q.mvex].concat(_))},E=function(d){var g=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(d&4278190080)>>24,(d&16711680)>>16,(d&65280)>>8,d&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return o(q.mvhd,g)},L=function(d){var g=d.samples||[],_=new Uint8Array(4+g.length),T,S;for(S=0;S<g.length;S++)T=g[S].flags,_[S+4]=T.dependsOn<<4|T.isDependedOn<<2|T.hasRedundancy;return o(q.sdtp,_)},M=function(d){return o(q.stbl,C(d),o(q.stts,ve),o(q.stsc,ge),o(q.stsz,ce),o(q.stco,de))},(function(){var d,g;C=function(_){return o(q.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),_.type==="video"?d(_):g(_))},d=function(_){var T=_.sps||[],S=_.pps||[],b=[],O=[],N,U;for(N=0;N<T.length;N++)b.push((T[N].byteLength&65280)>>>8),b.push(T[N].byteLength&255),b=b.concat(Array.prototype.slice.call(T[N]));for(N=0;N<S.length;N++)O.push((S[N].byteLength&65280)>>>8),O.push(S[N].byteLength&255),O=O.concat(Array.prototype.slice.call(S[N]));if(U=[q.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(_.width&65280)>>8,_.width&255,(_.height&65280)>>8,_.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o(q.avcC,new Uint8Array([1,_.profileIdc,_.profileCompatibility,_.levelIdc,255].concat([T.length],b,[S.length],O))),o(q.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],_.sarRatio){var V=_.sarRatio[0],j=_.sarRatio[1];U.push(o(q.pasp,new Uint8Array([(V&4278190080)>>24,(V&16711680)>>16,(V&65280)>>8,V&255,(j&4278190080)>>24,(j&16711680)>>16,(j&65280)>>8,j&255])))}return o.apply(null,U)},g=function(_){return o(q.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(_.channelcount&65280)>>8,_.channelcount&255,(_.samplesize&65280)>>8,_.samplesize&255,0,0,0,0,(_.samplerate&65280)>>8,_.samplerate&255,0,0]),u(_))}})(),x=function(d){var g=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(d.id&4278190080)>>24,(d.id&16711680)>>16,(d.id&65280)>>8,d.id&255,0,0,0,0,(d.duration&4278190080)>>24,(d.duration&16711680)>>16,(d.duration&65280)>>8,d.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(d.width&65280)>>8,d.width&255,0,0,(d.height&65280)>>8,d.height&255,0,0]);return o(q.tkhd,g)},D=function(d){var g,_,T,S,b,O,N;return g=o(q.tfhd,new Uint8Array([0,0,0,58,(d.id&4278190080)>>24,(d.id&16711680)>>16,(d.id&65280)>>8,d.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),O=Math.floor(d.baseMediaDecodeTime/a),N=Math.floor(d.baseMediaDecodeTime%a),_=o(q.tfdt,new Uint8Array([1,0,0,0,O>>>24&255,O>>>16&255,O>>>8&255,O&255,N>>>24&255,N>>>16&255,N>>>8&255,N&255])),b=92,d.type==="audio"?(T=H(d,b),o(q.traf,g,_,T)):(S=L(d),T=H(d,S.length+b),o(q.traf,g,_,T,S))},A=function(d){return d.duration=d.duration||4294967295,o(q.trak,x(d),w(d))},B=function(d){var g=new Uint8Array([0,0,0,0,(d.id&4278190080)>>24,(d.id&16711680)>>16,(d.id&65280)>>8,d.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return d.type!=="video"&&(g[g.length-1]=0),o(q.trex,g)},(function(){var d,g,_;_=function(T,S){var b=0,O=0,N=0,U=0;return T.length&&(T[0].duration!==void 0&&(b=1),T[0].size!==void 0&&(O=2),T[0].flags!==void 0&&(N=4),T[0].compositionTimeOffset!==void 0&&(U=8)),[0,0,b|O|N|U,1,(T.length&4278190080)>>>24,(T.length&16711680)>>>16,(T.length&65280)>>>8,T.length&255,(S&4278190080)>>>24,(S&16711680)>>>16,(S&65280)>>>8,S&255]},g=function(T,S){var b,O,N,U,V,j;for(U=T.samples||[],S+=20+16*U.length,N=_(U,S),O=new Uint8Array(N.length+U.length*16),O.set(N),b=N.length,j=0;j<U.length;j++)V=U[j],O[b++]=(V.duration&4278190080)>>>24,O[b++]=(V.duration&16711680)>>>16,O[b++]=(V.duration&65280)>>>8,O[b++]=V.duration&255,O[b++]=(V.size&4278190080)>>>24,O[b++]=(V.size&16711680)>>>16,O[b++]=(V.size&65280)>>>8,O[b++]=V.size&255,O[b++]=V.flags.isLeading<<2|V.flags.dependsOn,O[b++]=V.flags.isDependedOn<<6|V.flags.hasRedundancy<<4|V.flags.paddingValue<<1|V.flags.isNonSyncSample,O[b++]=V.flags.degradationPriority&61440,O[b++]=V.flags.degradationPriority&15,O[b++]=(V.compositionTimeOffset&4278190080)>>>24,O[b++]=(V.compositionTimeOffset&16711680)>>>16,O[b++]=(V.compositionTimeOffset&65280)>>>8,O[b++]=V.compositionTimeOffset&255;return o(q.trun,O)},d=function(T,S){var b,O,N,U,V,j;for(U=T.samples||[],S+=20+8*U.length,N=_(U,S),b=new Uint8Array(N.length+U.length*8),b.set(N),O=N.length,j=0;j<U.length;j++)V=U[j],b[O++]=(V.duration&4278190080)>>>24,b[O++]=(V.duration&16711680)>>>16,b[O++]=(V.duration&65280)>>>8,b[O++]=V.duration&255,b[O++]=(V.size&4278190080)>>>24,b[O++]=(V.size&16711680)>>>16,b[O++]=(V.size&65280)>>>8,b[O++]=V.size&255;return o(q.trun,b)},H=function(T,S){return T.type==="audio"?d(T,S):g(T,S)}})();var Me={ftyp:c,mdat:h,moof:m,moov:y,initSegment:function(d){var g=c(),_=y(d),T;return T=new Uint8Array(g.byteLength+_.byteLength),T.set(g),T.set(_,g.byteLength),T}},ke=function(d){var g,_,T=[],S=[];for(S.byteLength=0,S.nalCount=0,S.duration=0,T.byteLength=0,g=0;g<d.length;g++)_=d[g],_.nalUnitType==="access_unit_delimiter_rbsp"?(T.length&&(T.duration=_.dts-T.dts,S.byteLength+=T.byteLength,S.nalCount+=T.length,S.duration+=T.duration,S.push(T)),T=[_],T.byteLength=_.data.byteLength,T.pts=_.pts,T.dts=_.dts):(_.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(T.keyFrame=!0),T.duration=_.dts-T.dts,T.byteLength+=_.data.byteLength,T.push(_));return S.length&&(!T.duration||T.duration<=0)&&(T.duration=S[S.length-1].duration),S.byteLength+=T.byteLength,S.nalCount+=T.length,S.duration+=T.duration,S.push(T),S},Ve=function(d){var g,_,T=[],S=[];for(T.byteLength=0,T.nalCount=0,T.duration=0,T.pts=d[0].pts,T.dts=d[0].dts,S.byteLength=0,S.nalCount=0,S.duration=0,S.pts=d[0].pts,S.dts=d[0].dts,g=0;g<d.length;g++)_=d[g],_.keyFrame?(T.length&&(S.push(T),S.byteLength+=T.byteLength,S.nalCount+=T.nalCount,S.duration+=T.duration),T=[_],T.nalCount=_.length,T.byteLength=_.byteLength,T.pts=_.pts,T.dts=_.dts,T.duration=_.duration):(T.duration+=_.duration,T.nalCount+=_.length,T.byteLength+=_.byteLength,T.push(_));return S.length&&T.duration<=0&&(T.duration=S[S.length-1].duration),S.byteLength+=T.byteLength,S.nalCount+=T.nalCount,S.duration+=T.duration,S.push(T),S},rt=function(d){var g;return!d[0][0].keyFrame&&d.length>1&&(g=d.shift(),d.byteLength-=g.byteLength,d.nalCount-=g.nalCount,d[0][0].dts=g.dts,d[0][0].pts=g.pts,d[0][0].duration+=g.duration),d},Ze=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},Ct=function(d,g){var _=Ze();return _.dataOffset=g,_.compositionTimeOffset=d.pts-d.dts,_.duration=d.duration,_.size=4*d.length,_.size+=d.byteLength,d.keyFrame&&(_.flags.dependsOn=2,_.flags.isNonSyncSample=0),_},ai=function(d,g){var _,T,S,b,O,N=g||0,U=[];for(_=0;_<d.length;_++)for(b=d[_],T=0;T<b.length;T++)O=b[T],S=Ct(O,N),N+=S.size,U.push(S);return U},ct=function(d){var g,_,T,S,b,O,N=0,U=d.byteLength,V=d.nalCount,j=U+4*V,re=new Uint8Array(j),fe=new DataView(re.buffer);for(g=0;g<d.length;g++)for(S=d[g],_=0;_<S.length;_++)for(b=S[_],T=0;T<b.length;T++)O=b[T],fe.setUint32(N,O.data.byteLength),N+=4,re.set(O.data,N),N+=O.data.byteLength;return re},Zi=function(d,g){var _,T=g||0,S=[];return _=Ct(d,T),S.push(_),S},Ee=function(d){var g,_,T=0,S=d.byteLength,b=d.length,O=S+4*b,N=new Uint8Array(O),U=new DataView(N.buffer);for(g=0;g<d.length;g++)_=d[g],U.setUint32(T,_.data.byteLength),T+=4,N.set(_.data,T),T+=_.data.byteLength;return N},nt={groupNalsIntoFrames:ke,groupFramesIntoGops:Ve,extendFirstKeyFrame:rt,generateSampleTable:ai,concatenateNalData:ct,generateSampleTableForFrame:Zi,concatenateNalDataForFrame:Ee},Xe=[33,16,5,32,164,27],yt=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],be=function(d){for(var g=[];d--;)g.push(0);return g},Fe=function(d){return Object.keys(d).reduce(function(g,_){return g[_]=new Uint8Array(d[_].reduce(function(T,S){return T.concat(S)},[])),g},{})},Ne,_i=function(){if(!Ne){var d={96e3:[Xe,[227,64],be(154),[56]],88200:[Xe,[231],be(170),[56]],64e3:[Xe,[248,192],be(240),[56]],48e3:[Xe,[255,192],be(268),[55,148,128],be(54),[112]],44100:[Xe,[255,192],be(268),[55,163,128],be(84),[112]],32e3:[Xe,[255,192],be(268),[55,234],be(226),[112]],24e3:[Xe,[255,192],be(268),[55,255,128],be(268),[111,112],be(126),[224]],16e3:[Xe,[255,192],be(268),[55,255,128],be(268),[111,255],be(269),[223,108],be(195),[1,192]],12e3:[yt,be(268),[3,127,248],be(268),[6,255,240],be(268),[13,255,224],be(268),[27,253,128],be(259),[56]],11025:[yt,be(268),[3,127,248],be(268),[6,255,240],be(268),[13,255,224],be(268),[27,255,192],be(268),[55,175,128],be(108),[112]],8e3:[yt,be(268),[3,121,16],be(47),[7]]};Ne=Fe(d)}return Ne},Vt=9e4,Ri,zt,vi,wi,fs,ps,oi;Ri=function(d){return d*Vt},zt=function(d,g){return d*g},vi=function(d){return d/Vt},wi=function(d,g){return d/g},fs=function(d,g){return Ri(wi(d,g))},ps=function(d,g){return zt(vi(d),g)},oi=function(d,g,_){return vi(_?d:d-g)};var Be={ONE_SECOND_IN_TS:Vt,secondsToVideoTs:Ri,secondsToAudioTs:zt,videoTsToSeconds:vi,audioTsToSeconds:wi,audioTsToVideoTs:fs,videoTsToAudioTs:ps,metadataTsToSeconds:oi},Zr=_i,Os=Be,sa=function(d){var g,_,T=0;for(g=0;g<d.length;g++)_=d[g],T+=_.data.byteLength;return T},ra=function(d,g,_,T){var S,b=0,O=0,N=0,U=0,V,j,re;if(g.length&&(S=Os.audioTsToVideoTs(d.baseMediaDecodeTime,d.samplerate),b=Math.ceil(Os.ONE_SECOND_IN_TS/(d.samplerate/1024)),_&&T&&(O=S-Math.max(_,T),N=Math.floor(O/b),U=N*b),!(N<1||U>Os.ONE_SECOND_IN_TS/2))){for(V=Zr()[d.samplerate],V||(V=g[0].data),j=0;j<N;j++)re=g[0],g.splice(0,0,{data:V,dts:re.dts-b,pts:re.pts-b});return d.baseMediaDecodeTime-=Math.floor(Os.videoTsToAudioTs(U,d.samplerate)),U}},en=function(d,g,_){return g.minSegmentDts>=_?d:(g.minSegmentDts=1/0,d.filter(function(T){return T.dts>=_?(g.minSegmentDts=Math.min(g.minSegmentDts,T.dts),g.minSegmentPts=g.minSegmentDts,!0):!1}))},gs=function(d){var g,_,T=[];for(g=0;g<d.length;g++)_=d[g],T.push({size:_.data.byteLength,duration:1024});return T},na=function(d){var g,_,T=0,S=new Uint8Array(sa(d));for(g=0;g<d.length;g++)_=d[g],S.set(_.data,T),T+=_.data.byteLength;return S},tn={prefixWithSilence:ra,trimAdtsFramesByEarliestDts:en,generateSampleTable:gs,concatenateFrameData:na},aa=Be.ONE_SECOND_IN_TS,R=function(d,g){typeof g.pts=="number"&&(d.timelineStartInfo.pts===void 0&&(d.timelineStartInfo.pts=g.pts),d.minSegmentPts===void 0?d.minSegmentPts=g.pts:d.minSegmentPts=Math.min(d.minSegmentPts,g.pts),d.maxSegmentPts===void 0?d.maxSegmentPts=g.pts:d.maxSegmentPts=Math.max(d.maxSegmentPts,g.pts)),typeof g.dts=="number"&&(d.timelineStartInfo.dts===void 0&&(d.timelineStartInfo.dts=g.dts),d.minSegmentDts===void 0?d.minSegmentDts=g.dts:d.minSegmentDts=Math.min(d.minSegmentDts,g.dts),d.maxSegmentDts===void 0?d.maxSegmentDts=g.dts:d.maxSegmentDts=Math.max(d.maxSegmentDts,g.dts))},P=function(d){delete d.minSegmentDts,delete d.maxSegmentDts,delete d.minSegmentPts,delete d.maxSegmentPts},G=function(d,g){var _,T,S=d.minSegmentDts;return g||(S-=d.timelineStartInfo.dts),_=d.timelineStartInfo.baseMediaDecodeTime,_+=S,_=Math.max(0,_),d.type==="audio"&&(T=d.samplerate/aa,_*=T,_=Math.floor(_)),_},se={clearDtsInfo:P,calculateTrackBaseMediaDecodeTime:G,collectDtsInfo:R},he=4,Ae=128,We=function(d){for(var g=0,_={payloadType:-1,payloadSize:0},T=0,S=0;g<d.byteLength&&d[g]!==Ae;){for(;d[g]===255;)T+=255,g++;for(T+=d[g++];d[g]===255;)S+=255,g++;if(S+=d[g++],!_.payload&&T===he){var b=String.fromCharCode(d[g+3],d[g+4],d[g+5],d[g+6]);if(b==="GA94"){_.payloadType=T,_.payloadSize=S,_.payload=d.subarray(g,g+S);break}else _.payload=void 0}g+=S,T=0,S=0}return _},wt=function(d){return d.payload[0]!==181||(d.payload[1]<<8|d.payload[2])!==49||String.fromCharCode(d.payload[3],d.payload[4],d.payload[5],d.payload[6])!=="GA94"||d.payload[7]!==3?null:d.payload.subarray(8,d.payload.length-1)},Yt=function(d,g){var _=[],T,S,b,O;if(!(g[0]&64))return _;for(S=g[0]&31,T=0;T<S;T++)b=T*3,O={type:g[b+2]&3,pts:d},g[b+2]&4&&(O.ccData=g[b+3]<<8|g[b+4],_.push(O));return _},ki=function(d){for(var g=d.byteLength,_=[],T=1,S,b;T<g-2;)d[T]===0&&d[T+1]===0&&d[T+2]===3?(_.push(T+2),T+=2):T++;if(_.length===0)return d;S=g-_.length,b=new Uint8Array(S);var O=0;for(T=0;T<S;O++,T++)O===_[0]&&(O++,_.shift()),b[T]=d[O];return b},li={parseSei:We,parseUserData:wt,parseCaptionPackets:Yt,discardEmulationPreventionBytes:ki,USER_DATA_REGISTERED_ITU_T_T35:he},Si=t,ui=li,ht=function(d){d=d||{},ht.prototype.init.call(this),this.parse708captions_=typeof d.parse708captions=="boolean"?d.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new tt(0,0),new tt(0,1),new tt(1,0),new tt(1,1)],this.parse708captions_&&(this.cc708Stream_=new Oe({captionServices:d.captionServices})),this.reset(),this.ccStreams_.forEach(function(g){g.on("data",this.trigger.bind(this,"data")),g.on("partialdone",this.trigger.bind(this,"partialdone")),g.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};ht.prototype=new Si,ht.prototype.push=function(d){var g,_,T;if(d.nalUnitType==="sei_rbsp"&&(g=ui.parseSei(d.escapedRBSP),!!g.payload&&g.payloadType===ui.USER_DATA_REGISTERED_ITU_T_T35&&(_=ui.parseUserData(g),!!_))){if(d.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(d.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}T=ui.parseCaptionPackets(d.pts,_),this.captionPackets_=this.captionPackets_.concat(T),this.latestDts_!==d.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=d.dts}},ht.prototype.flushCCStreams=function(d){this.ccStreams_.forEach(function(g){return d==="flush"?g.flush():g.partialFlush()},this)},ht.prototype.flushStream=function(d){if(!this.captionPackets_.length){this.flushCCStreams(d);return}this.captionPackets_.forEach(function(g,_){g.presortIndex=_}),this.captionPackets_.sort(function(g,_){return g.pts===_.pts?g.presortIndex-_.presortIndex:g.pts-_.pts}),this.captionPackets_.forEach(function(g){g.type<2?this.dispatchCea608Packet(g):this.dispatchCea708Packet(g)},this),this.captionPackets_.length=0,this.flushCCStreams(d)},ht.prototype.flush=function(){return this.flushStream("flush")},ht.prototype.partialFlush=function(){return this.flushStream("partialFlush")},ht.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(d){d.reset()})},ht.prototype.dispatchCea608Packet=function(d){this.setsTextOrXDSActive(d)?this.activeCea608Channel_[d.type]=null:this.setsChannel1Active(d)?this.activeCea608Channel_[d.type]=0:this.setsChannel2Active(d)&&(this.activeCea608Channel_[d.type]=1),this.activeCea608Channel_[d.type]!==null&&this.ccStreams_[(d.type<<1)+this.activeCea608Channel_[d.type]].push(d)},ht.prototype.setsChannel1Active=function(d){return(d.ccData&30720)===4096},ht.prototype.setsChannel2Active=function(d){return(d.ccData&30720)===6144},ht.prototype.setsTextOrXDSActive=function(d){return(d.ccData&28928)===256||(d.ccData&30974)===4138||(d.ccData&30974)===6186},ht.prototype.dispatchCea708Packet=function(d){this.parse708captions_&&this.cc708Stream_.push(d)};var ci={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},es=function(d){var g=ci[d]||d;return d&4096&&d===g?"":String.fromCharCode(g)},Pi=function(d){return 32<=d&&d<=127||160<=d&&d<=255},Qe=function(d){this.windowNum=d,this.reset()};Qe.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},Qe.prototype.getText=function(){return this.rows.join(`
`)},Qe.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},Qe.prototype.newLine=function(d){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(d),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},Qe.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},Qe.prototype.addText=function(d){this.rows[this.rowIdx]+=d},Qe.prototype.backspace=function(){if(!this.isEmpty()){var d=this.rows[this.rowIdx];this.rows[this.rowIdx]=d.substr(0,d.length-1)}};var Ms=function(d,g,_){this.serviceNum=d,this.text="",this.currentWindow=new Qe(-1),this.windows=[],this.stream=_,typeof g=="string"&&this.createTextDecoder(g)};Ms.prototype.init=function(d,g){this.startPts=d;for(var _=0;_<8;_++)this.windows[_]=new Qe(_),typeof g=="function"&&(this.windows[_].beforeRowOverflow=g)},Ms.prototype.setCurrentWindow=function(d){this.currentWindow=this.windows[d]},Ms.prototype.createTextDecoder=function(d){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(d)}catch(g){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+d+" encoding. "+g})}};var Oe=function(d){d=d||{},Oe.prototype.init.call(this);var g=this,_=d.captionServices||{},T={},S;Object.keys(_).forEach(b=>{S=_[b],/^SERVICE/.test(b)&&(T[b]=S.encoding)}),this.serviceEncodings=T,this.current708Packet=null,this.services={},this.push=function(b){b.type===3?(g.new708Packet(),g.add708Bytes(b)):(g.current708Packet===null&&g.new708Packet(),g.add708Bytes(b))}};Oe.prototype=new Si,Oe.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},Oe.prototype.add708Bytes=function(d){var g=d.ccData,_=g>>>8,T=g&255;this.current708Packet.ptsVals.push(d.pts),this.current708Packet.data.push(_),this.current708Packet.data.push(T)},Oe.prototype.push708Packet=function(){var d=this.current708Packet,g=d.data,_=null,T=null,S=0,b=g[S++];for(d.seq=b>>6,d.sizeCode=b&63;S<g.length;S++)b=g[S++],_=b>>5,T=b&31,_===7&&T>0&&(b=g[S++],_=b),this.pushServiceBlock(_,S,T),T>0&&(S+=T-1)},Oe.prototype.pushServiceBlock=function(d,g,_){var T,S=g,b=this.current708Packet.data,O=this.services[d];for(O||(O=this.initService(d,S));S<g+_&&S<b.length;S++)T=b[S],Pi(T)?S=this.handleText(S,O):T===24?S=this.multiByteCharacter(S,O):T===16?S=this.extendedCommands(S,O):128<=T&&T<=135?S=this.setCurrentWindow(S,O):152<=T&&T<=159?S=this.defineWindow(S,O):T===136?S=this.clearWindows(S,O):T===140?S=this.deleteWindows(S,O):T===137?S=this.displayWindows(S,O):T===138?S=this.hideWindows(S,O):T===139?S=this.toggleWindows(S,O):T===151?S=this.setWindowAttributes(S,O):T===144?S=this.setPenAttributes(S,O):T===145?S=this.setPenColor(S,O):T===146?S=this.setPenLocation(S,O):T===143?O=this.reset(S,O):T===8?O.currentWindow.backspace():T===12?O.currentWindow.clearText():T===13?O.currentWindow.pendingNewLine=!0:T===14?O.currentWindow.clearText():T===141&&S++},Oe.prototype.extendedCommands=function(d,g){var _=this.current708Packet.data,T=_[++d];return Pi(T)&&(d=this.handleText(d,g,{isExtended:!0})),d},Oe.prototype.getPts=function(d){return this.current708Packet.ptsVals[Math.floor(d/2)]},Oe.prototype.initService=function(d,g){var T="SERVICE"+d,_=this,T,S;return T in this.serviceEncodings&&(S=this.serviceEncodings[T]),this.services[d]=new Ms(d,S,_),this.services[d].init(this.getPts(g),function(b){_.flushDisplayed(b,_.services[d])}),this.services[d]},Oe.prototype.handleText=function(d,g,_){var T=_&&_.isExtended,S=_&&_.isMultiByte,b=this.current708Packet.data,O=T?4096:0,N=b[d],U=b[d+1],V=g.currentWindow,j,re;function fe(oe){return oe.map(_e=>("0"+(_e&255).toString(16)).slice(-2)).join("")}if(S?(re=[N,U],d++):re=[N],g.textDecoder_&&!T)j=g.textDecoder_.decode(new Uint8Array(re));else if(S){const oe=fe(re);j=String.fromCharCode(parseInt(oe,16))}else j=es(O|N);return V.pendingNewLine&&!V.isEmpty()&&V.newLine(this.getPts(d)),V.pendingNewLine=!1,V.addText(j),d},Oe.prototype.multiByteCharacter=function(d,g){var _=this.current708Packet.data,T=_[d+1],S=_[d+2];return Pi(T)&&Pi(S)&&(d=this.handleText(++d,g,{isMultiByte:!0})),d},Oe.prototype.setCurrentWindow=function(d,g){var _=this.current708Packet.data,T=_[d],S=T&7;return g.setCurrentWindow(S),d},Oe.prototype.defineWindow=function(d,g){var _=this.current708Packet.data,T=_[d],S=T&7;g.setCurrentWindow(S);var b=g.currentWindow;return T=_[++d],b.visible=(T&32)>>5,b.rowLock=(T&16)>>4,b.columnLock=(T&8)>>3,b.priority=T&7,T=_[++d],b.relativePositioning=(T&128)>>7,b.anchorVertical=T&127,T=_[++d],b.anchorHorizontal=T,T=_[++d],b.anchorPoint=(T&240)>>4,b.rowCount=T&15,T=_[++d],b.columnCount=T&63,T=_[++d],b.windowStyle=(T&56)>>3,b.penStyle=T&7,b.virtualRowCount=b.rowCount+1,d},Oe.prototype.setWindowAttributes=function(d,g){var _=this.current708Packet.data,T=_[d],S=g.currentWindow.winAttr;return T=_[++d],S.fillOpacity=(T&192)>>6,S.fillRed=(T&48)>>4,S.fillGreen=(T&12)>>2,S.fillBlue=T&3,T=_[++d],S.borderType=(T&192)>>6,S.borderRed=(T&48)>>4,S.borderGreen=(T&12)>>2,S.borderBlue=T&3,T=_[++d],S.borderType+=(T&128)>>5,S.wordWrap=(T&64)>>6,S.printDirection=(T&48)>>4,S.scrollDirection=(T&12)>>2,S.justify=T&3,T=_[++d],S.effectSpeed=(T&240)>>4,S.effectDirection=(T&12)>>2,S.displayEffect=T&3,d},Oe.prototype.flushDisplayed=function(d,g){for(var _=[],T=0;T<8;T++)g.windows[T].visible&&!g.windows[T].isEmpty()&&_.push(g.windows[T].getText());g.endPts=d,g.text=_.join(`

`),this.pushCaption(g),g.startPts=d},Oe.prototype.pushCaption=function(d){d.text!==""&&(this.trigger("data",{startPts:d.startPts,endPts:d.endPts,text:d.text,stream:"cc708_"+d.serviceNum}),d.text="",d.startPts=d.endPts)},Oe.prototype.displayWindows=function(d,g){var _=this.current708Packet.data,T=_[++d],S=this.getPts(d);this.flushDisplayed(S,g);for(var b=0;b<8;b++)T&1<<b&&(g.windows[b].visible=1);return d},Oe.prototype.hideWindows=function(d,g){var _=this.current708Packet.data,T=_[++d],S=this.getPts(d);this.flushDisplayed(S,g);for(var b=0;b<8;b++)T&1<<b&&(g.windows[b].visible=0);return d},Oe.prototype.toggleWindows=function(d,g){var _=this.current708Packet.data,T=_[++d],S=this.getPts(d);this.flushDisplayed(S,g);for(var b=0;b<8;b++)T&1<<b&&(g.windows[b].visible^=1);return d},Oe.prototype.clearWindows=function(d,g){var _=this.current708Packet.data,T=_[++d],S=this.getPts(d);this.flushDisplayed(S,g);for(var b=0;b<8;b++)T&1<<b&&g.windows[b].clearText();return d},Oe.prototype.deleteWindows=function(d,g){var _=this.current708Packet.data,T=_[++d],S=this.getPts(d);this.flushDisplayed(S,g);for(var b=0;b<8;b++)T&1<<b&&g.windows[b].reset();return d},Oe.prototype.setPenAttributes=function(d,g){var _=this.current708Packet.data,T=_[d],S=g.currentWindow.penAttr;return T=_[++d],S.textTag=(T&240)>>4,S.offset=(T&12)>>2,S.penSize=T&3,T=_[++d],S.italics=(T&128)>>7,S.underline=(T&64)>>6,S.edgeType=(T&56)>>3,S.fontStyle=T&7,d},Oe.prototype.setPenColor=function(d,g){var _=this.current708Packet.data,T=_[d],S=g.currentWindow.penColor;return T=_[++d],S.fgOpacity=(T&192)>>6,S.fgRed=(T&48)>>4,S.fgGreen=(T&12)>>2,S.fgBlue=T&3,T=_[++d],S.bgOpacity=(T&192)>>6,S.bgRed=(T&48)>>4,S.bgGreen=(T&12)>>2,S.bgBlue=T&3,T=_[++d],S.edgeRed=(T&48)>>4,S.edgeGreen=(T&12)>>2,S.edgeBlue=T&3,d},Oe.prototype.setPenLocation=function(d,g){var _=this.current708Packet.data,T=_[d],S=g.currentWindow.penLoc;return g.currentWindow.pendingNewLine=!0,T=_[++d],S.row=T&15,T=_[++d],S.column=T&63,d},Oe.prototype.reset=function(d,g){var _=this.getPts(d);return this.flushDisplayed(_,g),this.initService(g.serviceNum,d)};var oa={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},la=function(d){return d===null?"":(d=oa[d]||d,String.fromCharCode(d))},ua=14,NT=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Fs=function(){for(var d=[],g=ua+1;g--;)d.push({text:"",indent:0,offset:0});return d},tt=function(d,g){tt.prototype.init.call(this),this.field_=d||0,this.dataChannel_=g||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(_){var T,S,b,O,N;if(T=_.ccData&32639,T===this.lastControlCode_){this.lastControlCode_=null;return}if((T&61440)===4096?this.lastControlCode_=T:T!==this.PADDING_&&(this.lastControlCode_=null),b=T>>>8,O=T&255,T!==this.PADDING_)if(T===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(T===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(_.pts),this.flushDisplayed(_.pts),S=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=S,this.startPts_=_.pts;else if(T===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(_.pts);else if(T===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(_.pts);else if(T===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(_.pts);else if(T===this.CARRIAGE_RETURN_)this.clearFormatting(_.pts),this.flushDisplayed(_.pts),this.shiftRowsUp_(),this.startPts_=_.pts;else if(T===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1);else if(T===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(_.pts),this.displayed_=Fs();else if(T===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Fs();else if(T===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(_.pts),this.displayed_=Fs()),this.mode_="paintOn",this.startPts_=_.pts;else if(this.isSpecialCharacter(b,O))b=(b&3)<<8,N=la(b|O),this[this.mode_](_.pts,N),this.column_++;else if(this.isExtCharacter(b,O))this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1),b=(b&3)<<8,N=la(b|O),this[this.mode_](_.pts,N),this.column_++;else if(this.isMidRowCode(b,O))this.clearFormatting(_.pts),this[this.mode_](_.pts," "),this.column_++,(O&14)===14&&this.addFormatting(_.pts,["i"]),(O&1)===1&&this.addFormatting(_.pts,["u"]);else if(this.isOffsetControlCode(b,O)){const V=O&3;this.nonDisplayed_[this.row_].offset=V,this.column_+=V}else if(this.isPAC(b,O)){var U=NT.indexOf(T&7968);if(this.mode_==="rollUp"&&(U-this.rollUpRows_+1<0&&(U=this.rollUpRows_-1),this.setRollUp(_.pts,U)),U!==this.row_&&U>=0&&U<=14&&(this.clearFormatting(_.pts),this.row_=U),O&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(_.pts,["u"]),(T&16)===16){const V=(T&14)>>1;this.column_=V*4,this.nonDisplayed_[this.row_].indent+=V}this.isColorPAC(O)&&(O&14)===14&&this.addFormatting(_.pts,["i"])}else this.isNormalChar(b)&&(O===0&&(O=null),N=la(b),N+=la(O),this[this.mode_](_.pts,N),this.column_+=N.length)}};tt.prototype=new Si,tt.prototype.flushDisplayed=function(d){const g=T=>{this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+T+"."})},_=[];this.displayed_.forEach((T,S)=>{if(T&&T.text&&T.text.length){try{T.text=T.text.trim()}catch{g(S)}T.text.length&&_.push({text:T.text,line:S+1,position:10+Math.min(70,T.indent*10)+T.offset*2.5})}else T==null&&g(S)}),_.length&&this.trigger("data",{startPts:this.startPts_,endPts:d,content:_,stream:this.name_})},tt.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Fs(),this.nonDisplayed_=Fs(),this.lastControlCode_=null,this.column_=0,this.row_=ua,this.rollUpRows_=2,this.formatting_=[]},tt.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},tt.prototype.isSpecialCharacter=function(d,g){return d===this.EXT_&&g>=48&&g<=63},tt.prototype.isExtCharacter=function(d,g){return(d===this.EXT_+1||d===this.EXT_+2)&&g>=32&&g<=63},tt.prototype.isMidRowCode=function(d,g){return d===this.EXT_&&g>=32&&g<=47},tt.prototype.isOffsetControlCode=function(d,g){return d===this.OFFSET_&&g>=33&&g<=35},tt.prototype.isPAC=function(d,g){return d>=this.BASE_&&d<this.BASE_+8&&g>=64&&g<=127},tt.prototype.isColorPAC=function(d){return d>=64&&d<=79||d>=96&&d<=127},tt.prototype.isNormalChar=function(d){return d>=32&&d<=127},tt.prototype.setRollUp=function(d,g){if(this.mode_!=="rollUp"&&(this.row_=ua,this.mode_="rollUp",this.flushDisplayed(d),this.nonDisplayed_=Fs(),this.displayed_=Fs()),g!==void 0&&g!==this.row_)for(var _=0;_<this.rollUpRows_;_++)this.displayed_[g-_]=this.displayed_[this.row_-_],this.displayed_[this.row_-_]={text:"",indent:0,offset:0};g===void 0&&(g=this.row_),this.topRow_=g-this.rollUpRows_+1},tt.prototype.addFormatting=function(d,g){this.formatting_=this.formatting_.concat(g);var _=g.reduce(function(T,S){return T+"<"+S+">"},"");this[this.mode_](d,_)},tt.prototype.clearFormatting=function(d){if(this.formatting_.length){var g=this.formatting_.reverse().reduce(function(_,T){return _+"</"+T+">"},"");this.formatting_=[],this[this.mode_](d,g)}},tt.prototype.popOn=function(d,g){var _=this.nonDisplayed_[this.row_].text;_+=g,this.nonDisplayed_[this.row_].text=_},tt.prototype.rollUp=function(d,g){var _=this.displayed_[this.row_].text;_+=g,this.displayed_[this.row_].text=_},tt.prototype.shiftRowsUp_=function(){var d;for(d=0;d<this.topRow_;d++)this.displayed_[d]={text:"",indent:0,offset:0};for(d=this.row_+1;d<ua+1;d++)this.displayed_[d]={text:"",indent:0,offset:0};for(d=this.topRow_;d<this.row_;d++)this.displayed_[d]=this.displayed_[d+1];this.displayed_[this.row_]={text:"",indent:0,offset:0}},tt.prototype.paintOn=function(d,g){var _=this.displayed_[this.row_].text;_+=g,this.displayed_[this.row_].text=_};var Mh={CaptionStream:ht,Cea608Stream:tt,Cea708Stream:Oe},ca={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},BT=t,UT=8589934592,$T=4294967296,Fh="shared",gl=function(d,g){var _=1;for(d>g&&(_=-1);Math.abs(g-d)>$T;)d+=_*UT;return d},ml=function(d){var g,_;ml.prototype.init.call(this),this.type_=d||Fh,this.push=function(T){if(T.type==="metadata"){this.trigger("data",T);return}this.type_!==Fh&&T.type!==this.type_||(_===void 0&&(_=T.dts),T.dts=gl(T.dts,_),T.pts=gl(T.pts,_),g=T.dts,this.trigger("data",T))},this.flush=function(){_=g,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){_=void 0,g=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};ml.prototype=new BT;var Nh={TimestampRolloverStream:ml,handleRollover:gl},VT=(d,g,_)=>{if(!d)return-1;for(var T=_;T<d.length;T++)if(d[T]===g)return T;return-1},GT={typedArrayIndexOf:VT},ha=GT.typedArrayIndexOf,da={Utf8:3},Bh=function(d,g,_){var T,S="";for(T=g;T<_;T++)S+="%"+("00"+d[T].toString(16)).slice(-2);return S},sn=function(d,g,_){return decodeURIComponent(Bh(d,g,_))},rn=function(d,g,_){return unescape(Bh(d,g,_))},nn=function(d){return d[0]<<21|d[1]<<14|d[2]<<7|d[3]},an={APIC:function(d){var g=1,_,T,S="-->";d.data[0]===da.Utf8&&(_=ha(d.data,0,g),!(_<0)&&(d.mimeType=rn(d.data,g,_),g=_+1,d.pictureType=d.data[g],g++,T=ha(d.data,0,g),!(T<0)&&(d.description=sn(d.data,g,T),g=T+1,d.mimeType===S?d.url=rn(d.data,g,d.data.length):d.pictureData=d.data.subarray(g,d.data.length))))},"T*":function(d){d.data[0]===da.Utf8&&(d.value=sn(d.data,1,d.data.length).replace(/\0*$/,""),d.values=d.value.split("\0"))},TXXX:function(d){var g;d.data[0]===da.Utf8&&(g=ha(d.data,0,1),g!==-1&&(d.description=sn(d.data,1,g),d.value=sn(d.data,g+1,d.data.length).replace(/\0*$/,""),d.data=d.value))},"W*":function(d){d.url=rn(d.data,0,d.data.length).replace(/\0.*$/,"")},WXXX:function(d){var g;d.data[0]===da.Utf8&&(g=ha(d.data,0,1),g!==-1&&(d.description=sn(d.data,1,g),d.url=rn(d.data,g+1,d.data.length).replace(/\0.*$/,"")))},PRIV:function(d){var g;for(g=0;g<d.data.length;g++)if(d.data[g]===0){d.owner=rn(d.data,0,g);break}d.privateData=d.data.subarray(g+1),d.data=d.privateData}},HT=function(d){var g,_,T=10,S=0,b=[];if(!(d.length<10||d[0]!==73||d[1]!==68||d[2]!==51)){S=nn(d.subarray(6,10)),S+=10;var O=d[5]&64;O&&(T+=4,T+=nn(d.subarray(10,14)),S-=nn(d.subarray(16,20)));do{if(g=nn(d.subarray(T+4,T+8)),g<1)break;_=String.fromCharCode(d[T],d[T+1],d[T+2],d[T+3]);var N={id:_,data:d.subarray(T+10,T+g+10)};N.key=N.id,an[N.id]?an[N.id](N):N.id[0]==="T"?an["T*"](N):N.id[0]==="W"&&an["W*"](N),b.push(N),T+=10,T+=g}while(T<S);return b}},Uh={parseId3Frames:HT,parseSyncSafeInteger:nn,frameParsers:an},qT=t,jT=ca,ms=Uh,fa;fa=function(d){var g={descriptor:d&&d.descriptor},_=0,T=[],S=0,b;if(fa.prototype.init.call(this),this.dispatchType=jT.METADATA_STREAM_TYPE.toString(16),g.descriptor)for(b=0;b<g.descriptor.length;b++)this.dispatchType+=("00"+g.descriptor[b].toString(16)).slice(-2);this.push=function(O){var N,U,V,j,re,fe;if(O.type==="timed-metadata"){if(O.dataAlignmentIndicator&&(S=0,T.length=0),T.length===0&&(O.data.length<10||O.data[0]!==73||O.data[1]!==68||O.data[2]!==51)){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(T.push(O),S+=O.data.byteLength,T.length===1&&(_=ms.parseSyncSafeInteger(O.data.subarray(6,10)),_+=10),!(S<_)){for(N={data:new Uint8Array(_),frames:[],pts:T[0].pts,dts:T[0].dts},re=0;re<_;)N.data.set(T[0].data.subarray(0,_-re),re),re+=T[0].data.byteLength,S-=T[0].data.byteLength,T.shift();U=10,N.data[5]&64&&(U+=4,U+=ms.parseSyncSafeInteger(N.data.subarray(10,14)),_-=ms.parseSyncSafeInteger(N.data.subarray(16,20)));do{if(V=ms.parseSyncSafeInteger(N.data.subarray(U+4,U+8)),V<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(fe=String.fromCharCode(N.data[U],N.data[U+1],N.data[U+2],N.data[U+3]),j={id:fe,data:N.data.subarray(U+10,U+V+10)},j.key=j.id,ms.frameParsers[j.id]?ms.frameParsers[j.id](j):j.id[0]==="T"?ms.frameParsers["T*"](j):j.id[0]==="W"&&ms.frameParsers["W*"](j),j.owner==="com.apple.streaming.transportStreamTimestamp"){var oe=j.data,_e=(oe[3]&1)<<30|oe[4]<<22|oe[5]<<14|oe[6]<<6|oe[7]>>>2;_e*=4,_e+=oe[7]&3,j.timeStamp=_e,N.pts===void 0&&N.dts===void 0&&(N.pts=j.timeStamp,N.dts=j.timeStamp),this.trigger("timestamp",j)}N.frames.push(j),U+=10,U+=V}while(U<_);this.trigger("data",N)}}}},fa.prototype=new qT;var KT=fa,yl=t,Tl=Mh,Ei=ca,WT=Nh.TimestampRolloverStream,pa,on,ga,rr=188,_l=71;pa=function(){var d=new Uint8Array(rr),g=0;pa.prototype.init.call(this),this.push=function(_){var T=0,S=rr,b;for(g?(b=new Uint8Array(_.byteLength+g),b.set(d.subarray(0,g)),b.set(_,g),g=0):b=_;S<b.byteLength;){if(b[T]===_l&&b[S]===_l){this.trigger("data",b.subarray(T,S)),T+=rr,S+=rr;continue}T++,S++}T<b.byteLength&&(d.set(b.subarray(T),0),g=b.byteLength-T)},this.flush=function(){g===rr&&d[0]===_l&&(this.trigger("data",d),g=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){g=0,this.trigger("reset")}},pa.prototype=new yl,on=function(){var d,g,_,T;on.prototype.init.call(this),T=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,d=function(S,b){var O=0;b.payloadUnitStartIndicator&&(O+=S[O]+1),b.type==="pat"?g(S.subarray(O),b):_(S.subarray(O),b)},g=function(S,b){b.section_number=S[7],b.last_section_number=S[8],T.pmtPid=(S[10]&31)<<8|S[11],b.pmtPid=T.pmtPid},_=function(S,b){var O,N,U,V;if(S[5]&1){for(T.programMapTable={video:null,audio:null,"timed-metadata":{}},O=(S[1]&15)<<8|S[2],N=3+O-4,U=(S[10]&15)<<8|S[11],V=12+U;V<N;){var j=S[V],re=(S[V+1]&31)<<8|S[V+2];j===Ei.H264_STREAM_TYPE&&T.programMapTable.video===null?T.programMapTable.video=re:j===Ei.ADTS_STREAM_TYPE&&T.programMapTable.audio===null?T.programMapTable.audio=re:j===Ei.METADATA_STREAM_TYPE&&(T.programMapTable["timed-metadata"][re]=j),V+=((S[V+3]&15)<<8|S[V+4])+5}b.programMapTable=T.programMapTable}},this.push=function(S){var b={},O=4;if(b.payloadUnitStartIndicator=!!(S[1]&64),b.pid=S[1]&31,b.pid<<=8,b.pid|=S[2],(S[3]&48)>>>4>1&&(O+=S[O]+1),b.pid===0)b.type="pat",d(S.subarray(O),b),this.trigger("data",b);else if(b.pid===this.pmtPid)for(b.type="pmt",d(S.subarray(O),b),this.trigger("data",b);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([S,O,b]):this.processPes_(S,O,b)},this.processPes_=function(S,b,O){O.pid===this.programMapTable.video?O.streamType=Ei.H264_STREAM_TYPE:O.pid===this.programMapTable.audio?O.streamType=Ei.ADTS_STREAM_TYPE:O.streamType=this.programMapTable["timed-metadata"][O.pid],O.type="pes",O.data=S.subarray(b),this.trigger("data",O)}},on.prototype=new yl,on.STREAM_TYPES={h264:27,adts:15},ga=function(){var d=this,g=!1,_={data:[],size:0},T={data:[],size:0},S={data:[],size:0},b,O=function(U,V){var j;const re=U[0]<<16|U[1]<<8|U[2];V.data=new Uint8Array,re===1&&(V.packetLength=6+(U[4]<<8|U[5]),V.dataAlignmentIndicator=(U[6]&4)!==0,j=U[7],j&192&&(V.pts=(U[9]&14)<<27|(U[10]&255)<<20|(U[11]&254)<<12|(U[12]&255)<<5|(U[13]&254)>>>3,V.pts*=4,V.pts+=(U[13]&6)>>>1,V.dts=V.pts,j&64&&(V.dts=(U[14]&14)<<27|(U[15]&255)<<20|(U[16]&254)<<12|(U[17]&255)<<5|(U[18]&254)>>>3,V.dts*=4,V.dts+=(U[18]&6)>>>1)),V.data=U.subarray(9+U[8]))},N=function(U,V,j){var re=new Uint8Array(U.size),fe={type:V},oe=0,_e=0,Le=!1,St;if(!(!U.data.length||U.size<9)){for(fe.trackId=U.data[0].pid,oe=0;oe<U.data.length;oe++)St=U.data[oe],re.set(St.data,_e),_e+=St.data.byteLength;O(re,fe),Le=V==="video"||fe.packetLength<=U.size,(j||Le)&&(U.size=0,U.data.length=0),Le&&d.trigger("data",fe)}};ga.prototype.init.call(this),this.push=function(U){({pat:function(){},pes:function(){var V,j;switch(U.streamType){case Ei.H264_STREAM_TYPE:V=_,j="video";break;case Ei.ADTS_STREAM_TYPE:V=T,j="audio";break;case Ei.METADATA_STREAM_TYPE:V=S,j="timed-metadata";break;default:return}U.payloadUnitStartIndicator&&N(V,j,!0),V.data.push(U),V.size+=U.data.byteLength},pmt:function(){var V={type:"metadata",tracks:[]};b=U.programMapTable,b.video!==null&&V.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+b.video,codec:"avc",type:"video"}),b.audio!==null&&V.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+b.audio,codec:"adts",type:"audio"}),g=!0,d.trigger("data",V)}})[U.type]()},this.reset=function(){_.size=0,_.data.length=0,T.size=0,T.data.length=0,this.trigger("reset")},this.flushStreams_=function(){N(_,"video"),N(T,"audio"),N(S,"timed-metadata")},this.flush=function(){if(!g&&b){var U={type:"metadata",tracks:[]};b.video!==null&&U.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+b.video,codec:"avc",type:"video"}),b.audio!==null&&U.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+b.audio,codec:"adts",type:"audio"}),d.trigger("data",U)}g=!1,this.flushStreams_(),this.trigger("done")}},ga.prototype=new yl;var $h={PAT_PID:0,MP2T_PACKET_LENGTH:rr,TransportPacketStream:pa,TransportParseStream:on,ElementaryStream:ga,TimestampRolloverStream:WT,CaptionStream:Tl.CaptionStream,Cea608Stream:Tl.Cea608Stream,Cea708Stream:Tl.Cea708Stream,MetadataStream:KT};for(var vl in Ei)Ei.hasOwnProperty(vl)&&($h[vl]=Ei[vl]);var zT=$h,YT=t,XT=Be.ONE_SECOND_IN_TS,ma,Vh=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];ma=function(d){var g,_=0;ma.prototype.init.call(this),this.skipWarn_=function(T,S){this.trigger("log",{level:"warn",message:`adts skiping bytes ${T} to ${S} in frame ${_} outside syncword`})},this.push=function(T){var S=0,b,O,N,U,V;if(d||(_=0),T.type==="audio"){g&&g.length?(N=g,g=new Uint8Array(N.byteLength+T.data.byteLength),g.set(N),g.set(T.data,N.byteLength)):g=T.data;for(var j;S+7<g.length;){if(g[S]!==255||(g[S+1]&246)!==240){typeof j!="number"&&(j=S),S++;continue}if(typeof j=="number"&&(this.skipWarn_(j,S),j=null),O=(~g[S+1]&1)*2,b=(g[S+3]&3)<<11|g[S+4]<<3|(g[S+5]&224)>>5,U=((g[S+6]&3)+1)*1024,V=U*XT/Vh[(g[S+2]&60)>>>2],g.byteLength-S<b)break;this.trigger("data",{pts:T.pts+_*V,dts:T.dts+_*V,sampleCount:U,audioobjecttype:(g[S+2]>>>6&3)+1,channelcount:(g[S+2]&1)<<2|(g[S+3]&192)>>>6,samplerate:Vh[(g[S+2]&60)>>>2],samplingfrequencyindex:(g[S+2]&60)>>>2,samplesize:16,data:g.subarray(S+7+O,S+b)}),_++,S+=b}typeof j=="number"&&(this.skipWarn_(j,S),j=null),g=g.subarray(S)}},this.flush=function(){_=0,this.trigger("done")},this.reset=function(){g=void 0,this.trigger("reset")},this.endTimeline=function(){g=void 0,this.trigger("endedtimeline")}},ma.prototype=new YT;var QT=ma,Gh;Gh=function(d){var g=d.byteLength,_=0,T=0;this.length=function(){return 8*g},this.bitsAvailable=function(){return 8*g+T},this.loadWord=function(){var S=d.byteLength-g,b=new Uint8Array(4),O=Math.min(4,g);if(O===0)throw new Error("no bytes available");b.set(d.subarray(S,S+O)),_=new DataView(b.buffer).getUint32(0),T=O*8,g-=O},this.skipBits=function(S){var b;T>S?(_<<=S,T-=S):(S-=T,b=Math.floor(S/8),S-=b*8,g-=b,this.loadWord(),_<<=S,T-=S)},this.readBits=function(S){var b=Math.min(T,S),O=_>>>32-b;return T-=b,T>0?_<<=b:g>0&&this.loadWord(),b=S-b,b>0?O<<b|this.readBits(b):O},this.skipLeadingZeros=function(){var S;for(S=0;S<T;++S)if((_&2147483648>>>S)!==0)return _<<=S,T-=S,S;return this.loadWord(),S+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var S=this.skipLeadingZeros();return this.readBits(S+1)-1},this.readExpGolomb=function(){var S=this.readUnsignedExpGolomb();return 1&S?1+S>>>1:-1*(S>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var JT=Gh,Hh=t,ZT=JT,ya,Ta,qh;Ta=function(){var d=0,g,_;Ta.prototype.init.call(this),this.push=function(T){var S;_?(S=new Uint8Array(_.byteLength+T.data.byteLength),S.set(_),S.set(T.data,_.byteLength),_=S):_=T.data;for(var b=_.byteLength;d<b-3;d++)if(_[d+2]===1){g=d+5;break}for(;g<b;)switch(_[g]){case 0:if(_[g-1]!==0){g+=2;break}else if(_[g-2]!==0){g++;break}d+3!==g-2&&this.trigger("data",_.subarray(d+3,g-2));do g++;while(_[g]!==1&&g<b);d=g-2,g+=3;break;case 1:if(_[g-1]!==0||_[g-2]!==0){g+=3;break}this.trigger("data",_.subarray(d+3,g-2)),d=g-2,g+=3;break;default:g+=3;break}_=_.subarray(d),g-=d,d=0},this.reset=function(){_=null,d=0,this.trigger("reset")},this.flush=function(){_&&_.byteLength>3&&this.trigger("data",_.subarray(d+3)),_=null,d=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},Ta.prototype=new Hh,qh={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},ya=function(){var d=new Ta,g,_,T,S,b,O,N;ya.prototype.init.call(this),g=this,this.push=function(U){U.type==="video"&&(_=U.trackId,T=U.pts,S=U.dts,d.push(U))},d.on("data",function(U){var V={trackId:_,pts:T,dts:S,data:U,nalUnitTypeCode:U[0]&31};switch(V.nalUnitTypeCode){case 5:V.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:V.nalUnitType="sei_rbsp",V.escapedRBSP=b(U.subarray(1));break;case 7:V.nalUnitType="seq_parameter_set_rbsp",V.escapedRBSP=b(U.subarray(1)),V.config=O(V.escapedRBSP);break;case 8:V.nalUnitType="pic_parameter_set_rbsp";break;case 9:V.nalUnitType="access_unit_delimiter_rbsp";break}g.trigger("data",V)}),d.on("done",function(){g.trigger("done")}),d.on("partialdone",function(){g.trigger("partialdone")}),d.on("reset",function(){g.trigger("reset")}),d.on("endedtimeline",function(){g.trigger("endedtimeline")}),this.flush=function(){d.flush()},this.partialFlush=function(){d.partialFlush()},this.reset=function(){d.reset()},this.endTimeline=function(){d.endTimeline()},N=function(U,V){var j=8,re=8,fe,oe;for(fe=0;fe<U;fe++)re!==0&&(oe=V.readExpGolomb(),re=(j+oe+256)%256),j=re===0?j:re},b=function(U){for(var V=U.byteLength,j=[],re=1,fe,oe;re<V-2;)U[re]===0&&U[re+1]===0&&U[re+2]===3?(j.push(re+2),re+=2):re++;if(j.length===0)return U;fe=V-j.length,oe=new Uint8Array(fe);var _e=0;for(re=0;re<fe;_e++,re++)_e===j[0]&&(_e++,j.shift()),oe[re]=U[_e];return oe},O=function(U){var V=0,j=0,re=0,fe=0,oe,_e,Le,St,Xt,Ts,pn,gn,mn,yn,Ra,et=[1,1],Tn,xi;if(oe=new ZT(U),_e=oe.readUnsignedByte(),St=oe.readUnsignedByte(),Le=oe.readUnsignedByte(),oe.skipUnsignedExpGolomb(),qh[_e]&&(Xt=oe.readUnsignedExpGolomb(),Xt===3&&oe.skipBits(1),oe.skipUnsignedExpGolomb(),oe.skipUnsignedExpGolomb(),oe.skipBits(1),oe.readBoolean()))for(Ra=Xt!==3?8:12,xi=0;xi<Ra;xi++)oe.readBoolean()&&(xi<6?N(16,oe):N(64,oe));if(oe.skipUnsignedExpGolomb(),Ts=oe.readUnsignedExpGolomb(),Ts===0)oe.readUnsignedExpGolomb();else if(Ts===1)for(oe.skipBits(1),oe.skipExpGolomb(),oe.skipExpGolomb(),pn=oe.readUnsignedExpGolomb(),xi=0;xi<pn;xi++)oe.skipExpGolomb();if(oe.skipUnsignedExpGolomb(),oe.skipBits(1),gn=oe.readUnsignedExpGolomb(),mn=oe.readUnsignedExpGolomb(),yn=oe.readBits(1),yn===0&&oe.skipBits(1),oe.skipBits(1),oe.readBoolean()&&(V=oe.readUnsignedExpGolomb(),j=oe.readUnsignedExpGolomb(),re=oe.readUnsignedExpGolomb(),fe=oe.readUnsignedExpGolomb()),oe.readBoolean()&&oe.readBoolean()){switch(Tn=oe.readUnsignedByte(),Tn){case 1:et=[1,1];break;case 2:et=[12,11];break;case 3:et=[10,11];break;case 4:et=[16,11];break;case 5:et=[40,33];break;case 6:et=[24,11];break;case 7:et=[20,11];break;case 8:et=[32,11];break;case 9:et=[80,33];break;case 10:et=[18,11];break;case 11:et=[15,11];break;case 12:et=[64,33];break;case 13:et=[160,99];break;case 14:et=[4,3];break;case 15:et=[3,2];break;case 16:et=[2,1];break;case 255:{et=[oe.readUnsignedByte()<<8|oe.readUnsignedByte(),oe.readUnsignedByte()<<8|oe.readUnsignedByte()];break}}et&&et[0]/et[1]}return{profileIdc:_e,levelIdc:Le,profileCompatibility:St,width:(gn+1)*16-V*2-j*2,height:(2-yn)*(mn+1)*16-re*2-fe*2,sarRatio:et}}},ya.prototype=new Hh;var e_={H264Stream:ya},t_=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],jh=function(d,g){var _=d[g+6]<<21|d[g+7]<<14|d[g+8]<<7|d[g+9],T=d[g+5],S=(T&16)>>4;return _=_>=0?_:0,S?_+20:_+10},Kh=function(d,g){return d.length-g<10||d[g]!==73||d[g+1]!==68||d[g+2]!==51?g:(g+=jh(d,g),Kh(d,g))},i_=function(d){var g=Kh(d,0);return d.length>=g+2&&(d[g]&255)===255&&(d[g+1]&240)===240&&(d[g+1]&22)===16},Wh=function(d){return d[0]<<21|d[1]<<14|d[2]<<7|d[3]},s_=function(d,g,_){var T,S="";for(T=g;T<_;T++)S+="%"+("00"+d[T].toString(16)).slice(-2);return S},r_=function(d,g,_){return unescape(s_(d,g,_))},n_=function(d,g){var _=(d[g+5]&224)>>5,T=d[g+4]<<3,S=d[g+3]&6144;return S|T|_},a_=function(d,g){return d[g]===73&&d[g+1]===68&&d[g+2]===51?"timed-metadata":d[g]&!0&&(d[g+1]&240)===240?"audio":null},o_=function(d){for(var g=0;g+5<d.length;){if(d[g]!==255||(d[g+1]&246)!==240){g++;continue}return t_[(d[g+2]&60)>>>2]}return null},l_=function(d){var g,_,T,S;g=10,d[5]&64&&(g+=4,g+=Wh(d.subarray(10,14)));do{if(_=Wh(d.subarray(g+4,g+8)),_<1)return null;if(S=String.fromCharCode(d[g],d[g+1],d[g+2],d[g+3]),S==="PRIV"){T=d.subarray(g+10,g+_+10);for(var b=0;b<T.byteLength;b++)if(T[b]===0){var O=r_(T,0,b);if(O==="com.apple.streaming.transportStreamTimestamp"){var N=T.subarray(b+1),U=(N[3]&1)<<30|N[4]<<22|N[5]<<14|N[6]<<6|N[7]>>>2;return U*=4,U+=N[7]&3,U}break}}g+=10,g+=_}while(g<d.byteLength);return null},Sl={isLikelyAacData:i_,parseId3TagSize:jh,parseAdtsSize:n_,parseType:a_,parseSampleRate:o_,parseAacTimestamp:l_},u_=t,zh=Sl,_a;_a=function(){var d=new Uint8Array,g=0;_a.prototype.init.call(this),this.setTimestamp=function(_){g=_},this.push=function(_){var T=0,S=0,b,O,N,U;for(d.length?(U=d.length,d=new Uint8Array(_.byteLength+U),d.set(d.subarray(0,U)),d.set(_,U)):d=_;d.length-S>=3;){if(d[S]===73&&d[S+1]===68&&d[S+2]===51){if(d.length-S<10||(T=zh.parseId3TagSize(d,S),S+T>d.length))break;O={type:"timed-metadata",data:d.subarray(S,S+T)},this.trigger("data",O),S+=T;continue}else if((d[S]&255)===255&&(d[S+1]&240)===240){if(d.length-S<7||(T=zh.parseAdtsSize(d,S),S+T>d.length))break;N={type:"audio",data:d.subarray(S,S+T),pts:g,dts:g},this.trigger("data",N),S+=T;continue}S++}b=d.length-S,b>0?d=d.subarray(S):d=new Uint8Array},this.reset=function(){d=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){d=new Uint8Array,this.trigger("endedtimeline")}},_a.prototype=new u_;var c_=_a,h_=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],d_=h_,f_=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],p_=f_,va=t,ln=Me,un=nt,Sa=tn,bi=se,ts=zT,Ea=Be,Yh=QT,g_=e_.H264Stream,m_=c_,y_=Sl.isLikelyAacData,T_=Be.ONE_SECOND_IN_TS,Xh=d_,Qh=p_,ba,cn,xa,Ns,__=function(d,g){g.stream=d,this.trigger("log",g)},Jh=function(d,g){for(var _=Object.keys(g),T=0;T<_.length;T++){var S=_[T];S==="headOfPipeline"||!g[S].on||g[S].on("log",__.bind(d,S))}},Zh=function(d,g){var _;if(d.length!==g.length)return!1;for(_=0;_<d.length;_++)if(d[_]!==g[_])return!1;return!0},ed=function(d,g,_,T,S,b){var O=_-g,N=T-g,U=S-_;return{start:{dts:d,pts:d+O},end:{dts:d+N,pts:d+U},prependedContentDuration:b,baseMediaDecodeTime:d}};cn=function(d,g){var _=[],T,S=0,b=0,O=1/0;g=g||{},T=g.firstSequenceNumber||0,cn.prototype.init.call(this),this.push=function(N){bi.collectDtsInfo(d,N),d&&Xh.forEach(function(U){d[U]=N[U]}),_.push(N)},this.setEarliestDts=function(N){S=N},this.setVideoBaseMediaDecodeTime=function(N){O=N},this.setAudioAppendStart=function(N){b=N},this.flush=function(){var N,U,V,j,re,fe,oe;if(_.length===0){this.trigger("done","AudioSegmentStream");return}N=Sa.trimAdtsFramesByEarliestDts(_,d,S),d.baseMediaDecodeTime=bi.calculateTrackBaseMediaDecodeTime(d,g.keepOriginalTimestamps),oe=Sa.prefixWithSilence(d,N,b,O),d.samples=Sa.generateSampleTable(N),V=ln.mdat(Sa.concatenateFrameData(N)),_=[],U=ln.moof(T,[d]),j=new Uint8Array(U.byteLength+V.byteLength),T++,j.set(U),j.set(V,U.byteLength),bi.clearDtsInfo(d),re=Math.ceil(T_*1024/d.samplerate),N.length&&(fe=N.length*re,this.trigger("segmentTimingInfo",ed(Ea.audioTsToVideoTs(d.baseMediaDecodeTime,d.samplerate),N[0].dts,N[0].pts,N[0].dts+fe,N[0].pts+fe,oe||0)),this.trigger("timingInfo",{start:N[0].pts,end:N[0].pts+fe})),this.trigger("data",{track:d,boxes:j}),this.trigger("done","AudioSegmentStream")},this.reset=function(){bi.clearDtsInfo(d),_=[],this.trigger("reset")}},cn.prototype=new va,ba=function(d,g){var _,T=[],S=[],b,O;g=g||{},_=g.firstSequenceNumber||0,ba.prototype.init.call(this),delete d.minPTS,this.gopCache_=[],this.push=function(N){bi.collectDtsInfo(d,N),N.nalUnitType==="seq_parameter_set_rbsp"&&!b&&(b=N.config,d.sps=[N.data],Qh.forEach(function(U){d[U]=b[U]},this)),N.nalUnitType==="pic_parameter_set_rbsp"&&!O&&(O=N.data,d.pps=[N.data]),T.push(N)},this.flush=function(){for(var N,U,V,j,re,fe,oe=0,_e,Le;T.length&&T[0].nalUnitType!=="access_unit_delimiter_rbsp";)T.shift();if(T.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(N=un.groupNalsIntoFrames(T),V=un.groupFramesIntoGops(N),V[0][0].keyFrame||(U=this.getGopForFusion_(T[0],d),U?(oe=U.duration,V.unshift(U),V.byteLength+=U.byteLength,V.nalCount+=U.nalCount,V.pts=U.pts,V.dts=U.dts,V.duration+=U.duration):V=un.extendFirstKeyFrame(V)),S.length){var St;if(g.alignGopsAtEnd?St=this.alignGopsAtEnd_(V):St=this.alignGopsAtStart_(V),!St){this.gopCache_.unshift({gop:V.pop(),pps:d.pps,sps:d.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),T=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}bi.clearDtsInfo(d),V=St}bi.collectDtsInfo(d,V),d.samples=un.generateSampleTable(V),re=ln.mdat(un.concatenateNalData(V)),d.baseMediaDecodeTime=bi.calculateTrackBaseMediaDecodeTime(d,g.keepOriginalTimestamps),this.trigger("processedGopsInfo",V.map(function(Xt){return{pts:Xt.pts,dts:Xt.dts,byteLength:Xt.byteLength}})),_e=V[0],Le=V[V.length-1],this.trigger("segmentTimingInfo",ed(d.baseMediaDecodeTime,_e.dts,_e.pts,Le.dts+Le.duration,Le.pts+Le.duration,oe)),this.trigger("timingInfo",{start:V[0].pts,end:V[V.length-1].pts+V[V.length-1].duration}),this.gopCache_.unshift({gop:V.pop(),pps:d.pps,sps:d.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),T=[],this.trigger("baseMediaDecodeTime",d.baseMediaDecodeTime),this.trigger("timelineStartInfo",d.timelineStartInfo),j=ln.moof(_,[d]),fe=new Uint8Array(j.byteLength+re.byteLength),_++,fe.set(j),fe.set(re,j.byteLength),this.trigger("data",{track:d,boxes:fe}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),T=[],this.gopCache_.length=0,S.length=0,this.trigger("reset")},this.resetStream_=function(){bi.clearDtsInfo(d),b=void 0,O=void 0},this.getGopForFusion_=function(N){var U=45e3,V=1/0,j,re,fe,oe,_e;for(_e=0;_e<this.gopCache_.length;_e++)oe=this.gopCache_[_e],fe=oe.gop,!(!(d.pps&&Zh(d.pps[0],oe.pps[0]))||!(d.sps&&Zh(d.sps[0],oe.sps[0])))&&(fe.dts<d.timelineStartInfo.dts||(j=N.dts-fe.dts-fe.duration,j>=-1e4&&j<=U&&(!re||V>j)&&(re=oe,V=j)));return re?re.gop:null},this.alignGopsAtStart_=function(N){var U,V,j,re,fe,oe,_e,Le;for(fe=N.byteLength,oe=N.nalCount,_e=N.duration,U=V=0;U<S.length&&V<N.length&&(j=S[U],re=N[V],j.pts!==re.pts);){if(re.pts>j.pts){U++;continue}V++,fe-=re.byteLength,oe-=re.nalCount,_e-=re.duration}return V===0?N:V===N.length?null:(Le=N.slice(V),Le.byteLength=fe,Le.duration=_e,Le.nalCount=oe,Le.pts=Le[0].pts,Le.dts=Le[0].dts,Le)},this.alignGopsAtEnd_=function(N){var U,V,j,re,fe,oe;for(U=S.length-1,V=N.length-1,fe=null,oe=!1;U>=0&&V>=0;){if(j=S[U],re=N[V],j.pts===re.pts){oe=!0;break}if(j.pts>re.pts){U--;continue}U===S.length-1&&(fe=V),V--}if(!oe&&fe===null)return null;var _e;if(oe?_e=V:_e=fe,_e===0)return N;var Le=N.slice(_e),St=Le.reduce(function(Xt,Ts){return Xt.byteLength+=Ts.byteLength,Xt.duration+=Ts.duration,Xt.nalCount+=Ts.nalCount,Xt},{byteLength:0,duration:0,nalCount:0});return Le.byteLength=St.byteLength,Le.duration=St.duration,Le.nalCount=St.nalCount,Le.pts=Le[0].pts,Le.dts=Le[0].dts,Le},this.alignGopsWith=function(N){S=N}},ba.prototype=new va,Ns=function(d,g){this.numberOfTracks=0,this.metadataStream=g,d=d||{},typeof d.remux<"u"?this.remuxTracks=!!d.remux:this.remuxTracks=!0,typeof d.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=d.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,Ns.prototype.init.call(this),this.push=function(_){if(_.content||_.text)return this.pendingCaptions.push(_);if(_.frames)return this.pendingMetadata.push(_);this.pendingTracks.push(_.track),this.pendingBytes+=_.boxes.byteLength,_.track.type==="video"&&(this.videoTrack=_.track,this.pendingBoxes.push(_.boxes)),_.track.type==="audio"&&(this.audioTrack=_.track,this.pendingBoxes.unshift(_.boxes))}},Ns.prototype=new va,Ns.prototype.flush=function(d){var g=0,_={captions:[],captionStreams:{},metadata:[],info:{}},T,S,b,O=0,N;if(this.pendingTracks.length<this.numberOfTracks){if(d!=="VideoSegmentStream"&&d!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(O=this.videoTrack.timelineStartInfo.pts,Qh.forEach(function(U){_.info[U]=this.videoTrack[U]},this)):this.audioTrack&&(O=this.audioTrack.timelineStartInfo.pts,Xh.forEach(function(U){_.info[U]=this.audioTrack[U]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?_.type=this.pendingTracks[0].type:_.type="combined",this.emittedTracks+=this.pendingTracks.length,b=ln.initSegment(this.pendingTracks),_.initSegment=new Uint8Array(b.byteLength),_.initSegment.set(b),_.data=new Uint8Array(this.pendingBytes),N=0;N<this.pendingBoxes.length;N++)_.data.set(this.pendingBoxes[N],g),g+=this.pendingBoxes[N].byteLength;for(N=0;N<this.pendingCaptions.length;N++)T=this.pendingCaptions[N],T.startTime=Ea.metadataTsToSeconds(T.startPts,O,this.keepOriginalTimestamps),T.endTime=Ea.metadataTsToSeconds(T.endPts,O,this.keepOriginalTimestamps),_.captionStreams[T.stream]=!0,_.captions.push(T);for(N=0;N<this.pendingMetadata.length;N++)S=this.pendingMetadata[N],S.cueTime=Ea.metadataTsToSeconds(S.pts,O,this.keepOriginalTimestamps),_.metadata.push(S);for(_.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",_),N=0;N<_.captions.length;N++)T=_.captions[N],this.trigger("caption",T);for(N=0;N<_.metadata.length;N++)S=_.metadata[N],this.trigger("id3Frame",S)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},Ns.prototype.setRemux=function(d){this.remuxTracks=d},xa=function(d){var g=this,_=!0,T,S;xa.prototype.init.call(this),d=d||{},this.baseMediaDecodeTime=d.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var b={};this.transmuxPipeline_=b,b.type="aac",b.metadataStream=new ts.MetadataStream,b.aacStream=new m_,b.audioTimestampRolloverStream=new ts.TimestampRolloverStream("audio"),b.timedMetadataTimestampRolloverStream=new ts.TimestampRolloverStream("timed-metadata"),b.adtsStream=new Yh,b.coalesceStream=new Ns(d,b.metadataStream),b.headOfPipeline=b.aacStream,b.aacStream.pipe(b.audioTimestampRolloverStream).pipe(b.adtsStream),b.aacStream.pipe(b.timedMetadataTimestampRolloverStream).pipe(b.metadataStream).pipe(b.coalesceStream),b.metadataStream.on("timestamp",function(O){b.aacStream.setTimestamp(O.timeStamp)}),b.aacStream.on("data",function(O){O.type!=="timed-metadata"&&O.type!=="audio"||b.audioSegmentStream||(S=S||{timelineStartInfo:{baseMediaDecodeTime:g.baseMediaDecodeTime},codec:"adts",type:"audio"},b.coalesceStream.numberOfTracks++,b.audioSegmentStream=new cn(S,d),b.audioSegmentStream.on("log",g.getLogTrigger_("audioSegmentStream")),b.audioSegmentStream.on("timingInfo",g.trigger.bind(g,"audioTimingInfo")),b.adtsStream.pipe(b.audioSegmentStream).pipe(b.coalesceStream),g.trigger("trackinfo",{hasAudio:!!S,hasVideo:!!T}))}),b.coalesceStream.on("data",this.trigger.bind(this,"data")),b.coalesceStream.on("done",this.trigger.bind(this,"done")),Jh(this,b)},this.setupTsPipeline=function(){var b={};this.transmuxPipeline_=b,b.type="ts",b.metadataStream=new ts.MetadataStream,b.packetStream=new ts.TransportPacketStream,b.parseStream=new ts.TransportParseStream,b.elementaryStream=new ts.ElementaryStream,b.timestampRolloverStream=new ts.TimestampRolloverStream,b.adtsStream=new Yh,b.h264Stream=new g_,b.captionStream=new ts.CaptionStream(d),b.coalesceStream=new Ns(d,b.metadataStream),b.headOfPipeline=b.packetStream,b.packetStream.pipe(b.parseStream).pipe(b.elementaryStream).pipe(b.timestampRolloverStream),b.timestampRolloverStream.pipe(b.h264Stream),b.timestampRolloverStream.pipe(b.adtsStream),b.timestampRolloverStream.pipe(b.metadataStream).pipe(b.coalesceStream),b.h264Stream.pipe(b.captionStream).pipe(b.coalesceStream),b.elementaryStream.on("data",function(O){var N;if(O.type==="metadata"){for(N=O.tracks.length;N--;)!T&&O.tracks[N].type==="video"?(T=O.tracks[N],T.timelineStartInfo.baseMediaDecodeTime=g.baseMediaDecodeTime):!S&&O.tracks[N].type==="audio"&&(S=O.tracks[N],S.timelineStartInfo.baseMediaDecodeTime=g.baseMediaDecodeTime);T&&!b.videoSegmentStream&&(b.coalesceStream.numberOfTracks++,b.videoSegmentStream=new ba(T,d),b.videoSegmentStream.on("log",g.getLogTrigger_("videoSegmentStream")),b.videoSegmentStream.on("timelineStartInfo",function(U){S&&!d.keepOriginalTimestamps&&(S.timelineStartInfo=U,b.audioSegmentStream.setEarliestDts(U.dts-g.baseMediaDecodeTime))}),b.videoSegmentStream.on("processedGopsInfo",g.trigger.bind(g,"gopInfo")),b.videoSegmentStream.on("segmentTimingInfo",g.trigger.bind(g,"videoSegmentTimingInfo")),b.videoSegmentStream.on("baseMediaDecodeTime",function(U){S&&b.audioSegmentStream.setVideoBaseMediaDecodeTime(U)}),b.videoSegmentStream.on("timingInfo",g.trigger.bind(g,"videoTimingInfo")),b.h264Stream.pipe(b.videoSegmentStream).pipe(b.coalesceStream)),S&&!b.audioSegmentStream&&(b.coalesceStream.numberOfTracks++,b.audioSegmentStream=new cn(S,d),b.audioSegmentStream.on("log",g.getLogTrigger_("audioSegmentStream")),b.audioSegmentStream.on("timingInfo",g.trigger.bind(g,"audioTimingInfo")),b.audioSegmentStream.on("segmentTimingInfo",g.trigger.bind(g,"audioSegmentTimingInfo")),b.adtsStream.pipe(b.audioSegmentStream).pipe(b.coalesceStream)),g.trigger("trackinfo",{hasAudio:!!S,hasVideo:!!T})}}),b.coalesceStream.on("data",this.trigger.bind(this,"data")),b.coalesceStream.on("id3Frame",function(O){O.dispatchType=b.metadataStream.dispatchType,g.trigger("id3Frame",O)}),b.coalesceStream.on("caption",this.trigger.bind(this,"caption")),b.coalesceStream.on("done",this.trigger.bind(this,"done")),Jh(this,b)},this.setBaseMediaDecodeTime=function(b){var O=this.transmuxPipeline_;d.keepOriginalTimestamps||(this.baseMediaDecodeTime=b),S&&(S.timelineStartInfo.dts=void 0,S.timelineStartInfo.pts=void 0,bi.clearDtsInfo(S),O.audioTimestampRolloverStream&&O.audioTimestampRolloverStream.discontinuity()),T&&(O.videoSegmentStream&&(O.videoSegmentStream.gopCache_=[]),T.timelineStartInfo.dts=void 0,T.timelineStartInfo.pts=void 0,bi.clearDtsInfo(T),O.captionStream.reset()),O.timestampRolloverStream&&O.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(b){S&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(b)},this.setRemux=function(b){var O=this.transmuxPipeline_;d.remux=b,O&&O.coalesceStream&&O.coalesceStream.setRemux(b)},this.alignGopsWith=function(b){T&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(b)},this.getLogTrigger_=function(b){var O=this;return function(N){N.stream=b,O.trigger("log",N)}},this.push=function(b){if(_){var O=y_(b);O&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!O&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),_=!1}this.transmuxPipeline_.headOfPipeline.push(b)},this.flush=function(){_=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},xa.prototype=new va;var v_={Transmuxer:xa},S_=function(d){return d>>>0},E_=function(d){return("00"+d.toString(16)).slice(-2)},Aa={toUnsigned:S_,toHexString:E_},b_=function(d){var g="";return g+=String.fromCharCode(d[0]),g+=String.fromCharCode(d[1]),g+=String.fromCharCode(d[2]),g+=String.fromCharCode(d[3]),g},td=b_,x_=Aa.toUnsigned,A_=td,id=function(d,g){var _=[],T,S,b,O,N;if(!g.length)return null;for(T=0;T<d.byteLength;)S=x_(d[T]<<24|d[T+1]<<16|d[T+2]<<8|d[T+3]),b=A_(d.subarray(T+4,T+8)),O=S>1?T+S:d.byteLength,b===g[0]&&(g.length===1?_.push(d.subarray(T+8,O)):(N=id(d.subarray(T+8,O),g.slice(1)),N.length&&(_=_.concat(N)))),T=O;return _},El=id,C_=Aa.toUnsigned,I_=n.getUint64,D_=function(d){var g={version:d[0],flags:new Uint8Array(d.subarray(1,4))};return g.version===1?g.baseMediaDecodeTime=I_(d.subarray(4)):g.baseMediaDecodeTime=C_(d[4]<<24|d[5]<<16|d[6]<<8|d[7]),g},bl=D_,L_=function(d){var g=new DataView(d.buffer,d.byteOffset,d.byteLength),_={version:d[0],flags:new Uint8Array(d.subarray(1,4)),trackId:g.getUint32(4)},T=_.flags[2]&1,S=_.flags[2]&2,b=_.flags[2]&8,O=_.flags[2]&16,N=_.flags[2]&32,U=_.flags[0]&65536,V=_.flags[0]&131072,j;return j=8,T&&(j+=4,_.baseDataOffset=g.getUint32(12),j+=4),S&&(_.sampleDescriptionIndex=g.getUint32(j),j+=4),b&&(_.defaultSampleDuration=g.getUint32(j),j+=4),O&&(_.defaultSampleSize=g.getUint32(j),j+=4),N&&(_.defaultSampleFlags=g.getUint32(j)),U&&(_.durationIsEmpty=!0),!T&&V&&(_.baseDataOffsetIsMoof=!0),_},sd=L_,R_=function(d){return{isLeading:(d[0]&12)>>>2,dependsOn:d[0]&3,isDependedOn:(d[1]&192)>>>6,hasRedundancy:(d[1]&48)>>>4,paddingValue:(d[1]&14)>>>1,isNonSyncSample:d[1]&1,degradationPriority:d[2]<<8|d[3]}},w_=R_,rd=w_,k_=function(d){var g={version:d[0],flags:new Uint8Array(d.subarray(1,4)),samples:[]},_=new DataView(d.buffer,d.byteOffset,d.byteLength),T=g.flags[2]&1,S=g.flags[2]&4,b=g.flags[1]&1,O=g.flags[1]&2,N=g.flags[1]&4,U=g.flags[1]&8,V=_.getUint32(4),j=8,re;for(T&&(g.dataOffset=_.getInt32(j),j+=4),S&&V&&(re={flags:rd(d.subarray(j,j+4))},j+=4,b&&(re.duration=_.getUint32(j),j+=4),O&&(re.size=_.getUint32(j),j+=4),U&&(g.version===1?re.compositionTimeOffset=_.getInt32(j):re.compositionTimeOffset=_.getUint32(j),j+=4),g.samples.push(re),V--);V--;)re={},b&&(re.duration=_.getUint32(j),j+=4),O&&(re.size=_.getUint32(j),j+=4),N&&(re.flags=rd(d.subarray(j,j+4)),j+=4),U&&(g.version===1?re.compositionTimeOffset=_.getInt32(j):re.compositionTimeOffset=_.getUint32(j),j+=4),g.samples.push(re);return g},nd=k_,ad={tfdt:bl,trun:nd},od={parseTfdt:ad.tfdt,parseTrun:ad.trun},P_=function(d){for(var g=0,_=String.fromCharCode(d[g]),T="";_!=="\0";)T+=_,g++,_=String.fromCharCode(d[g]);return T+=_,T},O_={uint8ToCString:P_},Ca=O_.uint8ToCString,M_=n.getUint64,F_=function(d){var g=4,_=d[0],T,S,b,O,N,U,V,j;if(_===0){T=Ca(d.subarray(g)),g+=T.length,S=Ca(d.subarray(g)),g+=S.length;var re=new DataView(d.buffer);b=re.getUint32(g),g+=4,N=re.getUint32(g),g+=4,U=re.getUint32(g),g+=4,V=re.getUint32(g),g+=4}else if(_===1){var re=new DataView(d.buffer);b=re.getUint32(g),g+=4,O=M_(d.subarray(g)),g+=8,U=re.getUint32(g),g+=4,V=re.getUint32(g),g+=4,T=Ca(d.subarray(g)),g+=T.length,S=Ca(d.subarray(g)),g+=S.length}j=new Uint8Array(d.subarray(g,d.byteLength));var fe={scheme_id_uri:T,value:S,timescale:b||1,presentation_time:O,presentation_time_delta:N,event_duration:U,id:V,message_data:j};return B_(_,fe)?fe:void 0},N_=function(d,g,_,T){return d||d===0?d/g:T+_/g},B_=function(d,g){var _=g.scheme_id_uri!=="\0",T=d===0&&ld(g.presentation_time_delta)&&_,S=d===1&&ld(g.presentation_time)&&_;return!(d>1)&&T||S},ld=function(d){return d!==void 0||d!==null},U_={parseEmsgBox:F_,scaleTime:N_},hn;typeof window<"u"?hn=window:typeof r<"u"?hn=r:typeof self<"u"?hn=self:hn={};var ud=hn,Ia=Aa.toUnsigned,dn=Aa.toHexString,pt=El,nr=td,xl=U_,$_=sd,V_=nd,G_=bl,H_=n.getUint64,cd,hd,dd,fd,pd,Al,gd,Cl=ud,q_=Uh.parseId3Frames;cd=function(d){var g={},_=pt(d,["moov","trak"]);return _.reduce(function(T,S){var b,O,N,U,V;return b=pt(S,["tkhd"])[0],!b||(O=b[0],N=O===0?12:20,U=Ia(b[N]<<24|b[N+1]<<16|b[N+2]<<8|b[N+3]),V=pt(S,["mdia","mdhd"])[0],!V)?null:(O=V[0],N=O===0?12:20,T[U]=Ia(V[N]<<24|V[N+1]<<16|V[N+2]<<8|V[N+3]),T)},g)},hd=function(d,g){var _;_=pt(g,["moof","traf"]);var T=_.reduce(function(S,b){var O=pt(b,["tfhd"])[0],N=Ia(O[4]<<24|O[5]<<16|O[6]<<8|O[7]),U=d[N]||9e4,V=pt(b,["tfdt"])[0],j=new DataView(V.buffer,V.byteOffset,V.byteLength),re;V[0]===1?re=H_(V.subarray(4,12)):re=j.getUint32(4);let fe;return typeof re=="bigint"?fe=re/Cl.BigInt(U):typeof re=="number"&&!isNaN(re)&&(fe=re/U),fe<Number.MAX_SAFE_INTEGER&&(fe=Number(fe)),fe<S&&(S=fe),S},1/0);return typeof T=="bigint"||isFinite(T)?T:0},dd=function(d,g){var _=pt(g,["moof","traf"]),T=0,S=0,b;if(_&&_.length){var O=pt(_[0],["tfhd"])[0],N=pt(_[0],["trun"])[0],U=pt(_[0],["tfdt"])[0];if(O){var V=$_(O);b=V.trackId}if(U){var j=G_(U);T=j.baseMediaDecodeTime}if(N){var re=V_(N);re.samples&&re.samples.length&&(S=re.samples[0].compositionTimeOffset||0)}}var fe=d[b]||9e4;typeof T=="bigint"&&(S=Cl.BigInt(S),fe=Cl.BigInt(fe));var oe=(T+S)/fe;return typeof oe=="bigint"&&oe<Number.MAX_SAFE_INTEGER&&(oe=Number(oe)),oe},fd=function(d){var g=pt(d,["moov","trak"]),_=[];return g.forEach(function(T){var S=pt(T,["mdia","hdlr"]),b=pt(T,["tkhd"]);S.forEach(function(O,N){var U=nr(O.subarray(8,12)),V=b[N],j,re,fe;U==="vide"&&(j=new DataView(V.buffer,V.byteOffset,V.byteLength),re=j.getUint8(0),fe=re===0?j.getUint32(12):j.getUint32(20),_.push(fe))})}),_},Al=function(d){var g=d[0],_=g===0?12:20;return Ia(d[_]<<24|d[_+1]<<16|d[_+2]<<8|d[_+3])},pd=function(d){var g=pt(d,["moov","trak"]),_=[];return g.forEach(function(T){var S={},b=pt(T,["tkhd"])[0],O,N;b&&(O=new DataView(b.buffer,b.byteOffset,b.byteLength),N=O.getUint8(0),S.id=N===0?O.getUint32(12):O.getUint32(20));var U=pt(T,["mdia","hdlr"])[0];if(U){var V=nr(U.subarray(8,12));V==="vide"?S.type="video":V==="soun"?S.type="audio":S.type=V}var j=pt(T,["mdia","minf","stbl","stsd"])[0];if(j){var re=j.subarray(8);S.codec=nr(re.subarray(4,8));var fe=pt(re,[S.codec])[0],oe,_e;fe&&(/^[asm]vc[1-9]$/i.test(S.codec)?(oe=fe.subarray(78),_e=nr(oe.subarray(4,8)),_e==="avcC"&&oe.length>11?(S.codec+=".",S.codec+=dn(oe[9]),S.codec+=dn(oe[10]),S.codec+=dn(oe[11])):S.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(S.codec)?(oe=fe.subarray(28),_e=nr(oe.subarray(4,8)),_e==="esds"&&oe.length>20&&oe[19]!==0?(S.codec+="."+dn(oe[19]),S.codec+="."+dn(oe[20]>>>2&63).replace(/^0/,"")):S.codec="mp4a.40.2"):S.codec=S.codec.toLowerCase())}var Le=pt(T,["mdia","mdhd"])[0];Le&&(S.timescale=Al(Le)),_.push(S)}),_},gd=function(d,g=0){var _=pt(d,["emsg"]);return _.map(T=>{var S=xl.parseEmsgBox(new Uint8Array(T)),b=q_(S.message_data);return{cueTime:xl.scaleTime(S.presentation_time,S.timescale,S.presentation_time_delta,g),duration:xl.scaleTime(S.event_duration,S.timescale),frames:b}})};var fn={findBox:pt,parseType:nr,timescale:cd,startTime:hd,compositionStartTime:dd,videoTrackIds:fd,tracks:pd,getTimescaleFromMediaHeader:Al,getEmsgID3:gd};const{parseTrun:j_}=od,{findBox:md}=fn;var yd=ud,K_=function(d){var g=md(d,["moof","traf"]),_=md(d,["mdat"]),T=[];return _.forEach(function(S,b){var O=g[b];T.push({mdat:S,traf:O})}),T},W_=function(d,g,_){var T=g,S=_.defaultSampleDuration||0,b=_.defaultSampleSize||0,O=_.trackId,N=[];return d.forEach(function(U){var V=j_(U),j=V.samples;j.forEach(function(re){re.duration===void 0&&(re.duration=S),re.size===void 0&&(re.size=b),re.trackId=O,re.dts=T,re.compositionTimeOffset===void 0&&(re.compositionTimeOffset=0),typeof T=="bigint"?(re.pts=T+yd.BigInt(re.compositionTimeOffset),T+=yd.BigInt(re.duration)):(re.pts=T+re.compositionTimeOffset,T+=re.duration)}),N=N.concat(j)}),N},Td={getMdatTrafPairs:K_,parseSamples:W_},z_=li.discardEmulationPreventionBytes,Y_=Mh.CaptionStream,Il=El,X_=bl,Q_=sd,{getMdatTrafPairs:J_,parseSamples:Z_}=Td,ev=function(d,g){for(var _=d,T=0;T<g.length;T++){var S=g[T];if(_<S.size)return S;_-=S.size}return null},tv=function(d,g,_){var T=new DataView(d.buffer,d.byteOffset,d.byteLength),S={logs:[],seiNals:[]},b,O,N,U;for(O=0;O+4<d.length;O+=N)if(N=T.getUint32(O),O+=4,!(N<=0))switch(d[O]&31){case 6:var V=d.subarray(O+1,O+1+N),j=ev(O,g);if(b={nalUnitType:"sei_rbsp",size:N,data:V,escapedRBSP:z_(V),trackId:_},j)b.pts=j.pts,b.dts=j.dts,U=j;else if(U)b.pts=U.pts,b.dts=U.dts;else{S.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+O+" for trackId "+_+". See mux.js#223."});break}S.seiNals.push(b);break}return S},iv=function(d,g){var _={},T=J_(d);return T.forEach(function(S){var b=S.mdat,O=S.traf,N=Il(O,["tfhd"]),U=Q_(N[0]),V=U.trackId,j=Il(O,["tfdt"]),re=j.length>0?X_(j[0]).baseMediaDecodeTime:0,fe=Il(O,["trun"]),oe,_e;g===V&&fe.length>0&&(oe=Z_(fe,re,U),_e=tv(b,oe,V),_[V]||(_[V]={seiNals:[],logs:[]}),_[V].seiNals=_[V].seiNals.concat(_e.seiNals),_[V].logs=_[V].logs.concat(_e.logs))}),_},sv=function(d,g,_){var T;if(g===null)return null;T=iv(d,g);var S=T[g]||{};return{seiNals:S.seiNals,logs:S.logs,timescale:_}},rv=function(){var d=!1,g,_,T,S,b,O;this.isInitialized=function(){return d},this.init=function(N){g=new Y_,d=!0,O=N?N.isPartial:!1,g.on("data",function(U){U.startTime=U.startPts/S,U.endTime=U.endPts/S,b.captions.push(U),b.captionStreams[U.stream]=!0}),g.on("log",function(U){b.logs.push(U)})},this.isNewInit=function(N,U){return N&&N.length===0||U&&typeof U=="object"&&Object.keys(U).length===0?!1:T!==N[0]||S!==U[T]},this.parse=function(N,U,V){var j;if(this.isInitialized()){if(!U||!V)return null;if(this.isNewInit(U,V))T=U[0],S=V[T];else if(T===null||!S)return _.push(N),null}else return null;for(;_.length>0;){var re=_.shift();this.parse(re,U,V)}return j=sv(N,T,S),j&&j.logs&&(b.logs=b.logs.concat(j.logs)),j===null||!j.seiNals?b.logs.length?{logs:b.logs,captions:[],captionStreams:[]}:null:(this.pushNals(j.seiNals),this.flushStream(),b)},this.pushNals=function(N){if(!this.isInitialized()||!N||N.length===0)return null;N.forEach(function(U){g.push(U)})},this.flushStream=function(){if(!this.isInitialized())return null;O?g.partialFlush():g.flush()},this.clearParsedCaptions=function(){b.captions=[],b.captionStreams={},b.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;g.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){_=[],T=null,S=null,b?this.clearParsedCaptions():b={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},nv=rv;const{parseTfdt:av}=od,ys=El,{getTimescaleFromMediaHeader:ov}=fn,{parseSamples:lv,getMdatTrafPairs:uv}=Td;var _d=function(){let d=9e4;this.init=function(g){const _=ys(g,["moov","trak","mdia","mdhd"])[0];_&&(d=ov(_))},this.parseSegment=function(g){const _=[],T=uv(g);let S=0;return T.forEach(function(b){const O=b.mdat,N=b.traf,U=ys(N,["tfdt"])[0],V=ys(N,["tfhd"])[0],j=ys(N,["trun"]);if(U&&(S=av(U).baseMediaDecodeTime),j.length&&V){const re=lv(j,S,V);let fe=0;re.forEach(function(oe){const _e="utf-8",Le=new TextDecoder(_e),St=O.slice(fe,fe+oe.size);if(ys(St,["vtte"])[0]){fe+=oe.size;return}ys(St,["vttc"]).forEach(function(pn){const gn=ys(pn,["payl"])[0],mn=ys(pn,["sttg"])[0],yn=oe.pts/d,Ra=(oe.pts+oe.duration)/d;let et,Tn;if(gn)try{et=Le.decode(gn)}catch(xi){console.error(xi)}if(mn)try{Tn=Le.decode(mn)}catch(xi){console.error(xi)}oe.duration&&et&&_.push({cueText:et,start:yn,end:Ra,settings:Tn})}),fe+=oe.size})}}),_}},Dl=ca,vd=function(d){var g=d[1]&31;return g<<=8,g|=d[2],g},Da=function(d){return!!(d[1]&64)},La=function(d){var g=0;return(d[3]&48)>>>4>1&&(g+=d[4]+1),g},cv=function(d,g){var _=vd(d);return _===0?"pat":_===g?"pmt":g?"pes":null},hv=function(d){var g=Da(d),_=4+La(d);return g&&(_+=d[_]+1),(d[_+10]&31)<<8|d[_+11]},dv=function(d){var g={},_=Da(d),T=4+La(d);if(_&&(T+=d[T]+1),!!(d[T+5]&1)){var S,b,O;S=(d[T+1]&15)<<8|d[T+2],b=3+S-4,O=(d[T+10]&15)<<8|d[T+11];for(var N=12+O;N<b;){var U=T+N;g[(d[U+1]&31)<<8|d[U+2]]=d[U],N+=((d[U+3]&15)<<8|d[U+4])+5}return g}},fv=function(d,g){var _=vd(d),T=g[_];switch(T){case Dl.H264_STREAM_TYPE:return"video";case Dl.ADTS_STREAM_TYPE:return"audio";case Dl.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},pv=function(d){var g=Da(d);if(!g)return null;var _=4+La(d);if(_>=d.byteLength)return null;var T=null,S;return S=d[_+7],S&192&&(T={},T.pts=(d[_+9]&14)<<27|(d[_+10]&255)<<20|(d[_+11]&254)<<12|(d[_+12]&255)<<5|(d[_+13]&254)>>>3,T.pts*=4,T.pts+=(d[_+13]&6)>>>1,T.dts=T.pts,S&64&&(T.dts=(d[_+14]&14)<<27|(d[_+15]&255)<<20|(d[_+16]&254)<<12|(d[_+17]&255)<<5|(d[_+18]&254)>>>3,T.dts*=4,T.dts+=(d[_+18]&6)>>>1)),T},Ll=function(d){switch(d){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},gv=function(d){for(var g=4+La(d),_=d.subarray(g),T=0,S=0,b=!1,O;S<_.byteLength-3;S++)if(_[S+2]===1){T=S+5;break}for(;T<_.byteLength;)switch(_[T]){case 0:if(_[T-1]!==0){T+=2;break}else if(_[T-2]!==0){T++;break}S+3!==T-2&&(O=Ll(_[S+3]&31),O==="slice_layer_without_partitioning_rbsp_idr"&&(b=!0));do T++;while(_[T]!==1&&T<_.length);S=T-2,T+=3;break;case 1:if(_[T-1]!==0||_[T-2]!==0){T+=3;break}O=Ll(_[S+3]&31),O==="slice_layer_without_partitioning_rbsp_idr"&&(b=!0),S=T-2,T+=3;break;default:T+=3;break}return _=_.subarray(S),T-=S,S=0,_&&_.byteLength>3&&(O=Ll(_[S+3]&31),O==="slice_layer_without_partitioning_rbsp_idr"&&(b=!0)),b},mv={parseType:cv,parsePat:hv,parsePmt:dv,parsePayloadUnitStartIndicator:Da,parsePesType:fv,parsePesTime:pv,videoPacketContainsKeyFrame:gv},Sd=ca,ar=Nh.handleRollover,Ge={};Ge.ts=mv,Ge.aac=Sl;var Bs=Be.ONE_SECOND_IN_TS,Mt=188,Oi=71,yv=function(d,g){for(var _=0,T=Mt,S,b;T<d.byteLength;){if(d[_]===Oi&&d[T]===Oi){switch(S=d.subarray(_,T),b=Ge.ts.parseType(S,g.pid),b){case"pat":g.pid=Ge.ts.parsePat(S);break;case"pmt":var O=Ge.ts.parsePmt(S);g.table=g.table||{},Object.keys(O).forEach(function(N){g.table[N]=O[N]});break}_+=Mt,T+=Mt;continue}_++,T++}},Ed=function(d,g,_){for(var T=0,S=Mt,b,O,N,U,V,j=!1;S<=d.byteLength;){if(d[T]===Oi&&(d[S]===Oi||S===d.byteLength)){if(b=d.subarray(T,S),O=Ge.ts.parseType(b,g.pid),O==="pes"&&(N=Ge.ts.parsePesType(b,g.table),U=Ge.ts.parsePayloadUnitStartIndicator(b),N==="audio"&&U&&(V=Ge.ts.parsePesTime(b),V&&(V.type="audio",_.audio.push(V),j=!0))),j)break;T+=Mt,S+=Mt;continue}T++,S++}for(S=d.byteLength,T=S-Mt,j=!1;T>=0;){if(d[T]===Oi&&(d[S]===Oi||S===d.byteLength)){if(b=d.subarray(T,S),O=Ge.ts.parseType(b,g.pid),O==="pes"&&(N=Ge.ts.parsePesType(b,g.table),U=Ge.ts.parsePayloadUnitStartIndicator(b),N==="audio"&&U&&(V=Ge.ts.parsePesTime(b),V&&(V.type="audio",_.audio.push(V),j=!0))),j)break;T-=Mt,S-=Mt;continue}T--,S--}},Tv=function(d,g,_){for(var T=0,S=Mt,b,O,N,U,V,j,re,fe,oe=!1,_e={data:[],size:0};S<d.byteLength;){if(d[T]===Oi&&d[S]===Oi){switch(b=d.subarray(T,S),O=Ge.ts.parseType(b,g.pid),O){case"pes":if(N=Ge.ts.parsePesType(b,g.table),U=Ge.ts.parsePayloadUnitStartIndicator(b),N==="video"&&(U&&!oe&&(V=Ge.ts.parsePesTime(b),V&&(V.type="video",_.video.push(V),oe=!0)),!_.firstKeyFrame)){if(U&&_e.size!==0){for(j=new Uint8Array(_e.size),re=0;_e.data.length;)fe=_e.data.shift(),j.set(fe,re),re+=fe.byteLength;if(Ge.ts.videoPacketContainsKeyFrame(j)){var Le=Ge.ts.parsePesTime(j);Le?(_.firstKeyFrame=Le,_.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}_e.size=0}_e.data.push(b),_e.size+=b.byteLength}break}if(oe&&_.firstKeyFrame)break;T+=Mt,S+=Mt;continue}T++,S++}for(S=d.byteLength,T=S-Mt,oe=!1;T>=0;){if(d[T]===Oi&&d[S]===Oi){if(b=d.subarray(T,S),O=Ge.ts.parseType(b,g.pid),O==="pes"&&(N=Ge.ts.parsePesType(b,g.table),U=Ge.ts.parsePayloadUnitStartIndicator(b),N==="video"&&U&&(V=Ge.ts.parsePesTime(b),V&&(V.type="video",_.video.push(V),oe=!0))),oe)break;T-=Mt,S-=Mt;continue}T--,S--}},_v=function(d,g){if(d.audio&&d.audio.length){var _=g;(typeof _>"u"||isNaN(_))&&(_=d.audio[0].dts),d.audio.forEach(function(b){b.dts=ar(b.dts,_),b.pts=ar(b.pts,_),b.dtsTime=b.dts/Bs,b.ptsTime=b.pts/Bs})}if(d.video&&d.video.length){var T=g;if((typeof T>"u"||isNaN(T))&&(T=d.video[0].dts),d.video.forEach(function(b){b.dts=ar(b.dts,T),b.pts=ar(b.pts,T),b.dtsTime=b.dts/Bs,b.ptsTime=b.pts/Bs}),d.firstKeyFrame){var S=d.firstKeyFrame;S.dts=ar(S.dts,T),S.pts=ar(S.pts,T),S.dtsTime=S.dts/Bs,S.ptsTime=S.pts/Bs}}},vv=function(d){for(var g=!1,_=0,T=null,S=null,b=0,O=0,N;d.length-O>=3;){var U=Ge.aac.parseType(d,O);switch(U){case"timed-metadata":if(d.length-O<10){g=!0;break}if(b=Ge.aac.parseId3TagSize(d,O),b>d.length){g=!0;break}S===null&&(N=d.subarray(O,O+b),S=Ge.aac.parseAacTimestamp(N)),O+=b;break;case"audio":if(d.length-O<7){g=!0;break}if(b=Ge.aac.parseAdtsSize(d,O),b>d.length){g=!0;break}T===null&&(N=d.subarray(O,O+b),T=Ge.aac.parseSampleRate(N)),_++,O+=b;break;default:O++;break}if(g)return null}if(T===null||S===null)return null;var V=Bs/T,j={audio:[{type:"audio",dts:S,pts:S},{type:"audio",dts:S+_*1024*V,pts:S+_*1024*V}]};return j},Sv=function(d){var g={pid:null,table:null},_={};yv(d,g);for(var T in g.table)if(g.table.hasOwnProperty(T)){var S=g.table[T];switch(S){case Sd.H264_STREAM_TYPE:_.video=[],Tv(d,g,_),_.video.length===0&&delete _.video;break;case Sd.ADTS_STREAM_TYPE:_.audio=[],Ed(d,g,_),_.audio.length===0&&delete _.audio;break}}return _},Ev=function(d,g){var _=Ge.aac.isLikelyAacData(d),T;return _?T=vv(d):T=Sv(d),!T||!T.audio&&!T.video?null:(_v(T,g),T)},bv={inspect:Ev,parseAudioPes_:Ed};const xv=function(d,g){g.on("data",function(_){const T=_.initSegment;_.initSegment={data:T.buffer,byteOffset:T.byteOffset,byteLength:T.byteLength};const S=_.data;_.data=S.buffer,d.postMessage({action:"data",segment:_,byteOffset:S.byteOffset,byteLength:S.byteLength},[_.data])}),g.on("done",function(_){d.postMessage({action:"done"})}),g.on("gopInfo",function(_){d.postMessage({action:"gopInfo",gopInfo:_})}),g.on("videoSegmentTimingInfo",function(_){const T={start:{decode:Be.videoTsToSeconds(_.start.dts),presentation:Be.videoTsToSeconds(_.start.pts)},end:{decode:Be.videoTsToSeconds(_.end.dts),presentation:Be.videoTsToSeconds(_.end.pts)},baseMediaDecodeTime:Be.videoTsToSeconds(_.baseMediaDecodeTime)};_.prependedContentDuration&&(T.prependedContentDuration=Be.videoTsToSeconds(_.prependedContentDuration)),d.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:T})}),g.on("audioSegmentTimingInfo",function(_){const T={start:{decode:Be.videoTsToSeconds(_.start.dts),presentation:Be.videoTsToSeconds(_.start.pts)},end:{decode:Be.videoTsToSeconds(_.end.dts),presentation:Be.videoTsToSeconds(_.end.pts)},baseMediaDecodeTime:Be.videoTsToSeconds(_.baseMediaDecodeTime)};_.prependedContentDuration&&(T.prependedContentDuration=Be.videoTsToSeconds(_.prependedContentDuration)),d.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:T})}),g.on("id3Frame",function(_){d.postMessage({action:"id3Frame",id3Frame:_})}),g.on("caption",function(_){d.postMessage({action:"caption",caption:_})}),g.on("trackinfo",function(_){d.postMessage({action:"trackinfo",trackInfo:_})}),g.on("audioTimingInfo",function(_){d.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:Be.videoTsToSeconds(_.start),end:Be.videoTsToSeconds(_.end)}})}),g.on("videoTimingInfo",function(_){d.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:Be.videoTsToSeconds(_.start),end:Be.videoTsToSeconds(_.end)}})}),g.on("log",function(_){d.postMessage({action:"log",log:_})})};class bd{constructor(g,_){this.options=_||{},this.self=g,this.init()}init(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new v_.Transmuxer(this.options),xv(this.self,this.transmuxer)}pushMp4Captions(g){this.captionParser||(this.captionParser=new nv,this.captionParser.init());const _=new Uint8Array(g.data,g.byteOffset,g.byteLength),T=this.captionParser.parse(_,g.trackIds,g.timescales);this.self.postMessage({action:"mp4Captions",captions:T&&T.captions||[],logs:T&&T.logs||[],data:_.buffer},[_.buffer])}initMp4WebVttParser(g){this.webVttParser||(this.webVttParser=new _d);const _=new Uint8Array(g.data,g.byteOffset,g.byteLength);this.webVttParser.init(_)}getMp4WebVttText(g){this.webVttParser||(this.webVttParser=new _d);const _=new Uint8Array(g.data,g.byteOffset,g.byteLength),T=this.webVttParser.parseSegment(_);this.self.postMessage({action:"getMp4WebVttText",mp4VttCues:T||[],data:_.buffer},[_.buffer])}probeMp4StartTime({timescales:g,data:_}){const T=fn.startTime(g,_);this.self.postMessage({action:"probeMp4StartTime",startTime:T,data:_},[_.buffer])}probeMp4Tracks({data:g}){const _=fn.tracks(g);this.self.postMessage({action:"probeMp4Tracks",tracks:_,data:g},[g.buffer])}probeEmsgID3({data:g,offset:_}){const T=fn.getEmsgID3(g,_);this.self.postMessage({action:"probeEmsgID3",id3Frames:T,emsgData:g},[g.buffer])}probeTs({data:g,baseStartTime:_}){const T=typeof _=="number"&&!isNaN(_)?_*Be.ONE_SECOND_IN_TS:void 0,S=bv.inspect(g,T);let b=null;S&&(b={hasVideo:S.video&&S.video.length===2||!1,hasAudio:S.audio&&S.audio.length===2||!1},b.hasVideo&&(b.videoStart=S.video[0].ptsTime),b.hasAudio&&(b.audioStart=S.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:b,data:g},[g.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(g){const _=new Uint8Array(g.data,g.byteOffset,g.byteLength);this.transmuxer.push(_)}reset(){this.transmuxer.reset()}setTimestampOffset(g){const _=g.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(Be.secondsToVideoTs(_)))}setAudioAppendStart(g){this.transmuxer.setAudioAppendStart(Math.ceil(Be.secondsToVideoTs(g.appendStart)))}setRemux(g){this.transmuxer.setRemux(g.remux)}flush(g){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(g){this.transmuxer.alignGopsWith(g.gopsToAlignWith.slice())}}self.onmessage=function(d){if(d.data.action==="init"&&d.data.options){this.messageHandlers=new bd(self,d.data.options);return}this.messageHandlers||(this.messageHandlers=new bd(self)),d.data&&d.data.action&&d.data.action!=="init"&&this.messageHandlers[d.data.action]&&this.messageHandlers[d.data.action](d.data)}}));var lD=lT(oD);const uD=(r,e,t)=>{const{type:i,initSegment:s,captions:n,captionStreams:a,metadata:o,videoFrameDtsTime:l,videoFramePtsTime:u}=r.data.segment;e.buffer.push({captions:n,captionStreams:a,metadata:o});const c=r.data.segment.boxes||{data:r.data.segment.data},h={type:i,data:new Uint8Array(c.data,c.data.byteOffset,c.data.byteLength),initSegment:new Uint8Array(s.data,s.byteOffset,s.byteLength)};typeof l<"u"&&(h.videoFrameDtsTime=l),typeof u<"u"&&(h.videoFramePtsTime=u),t(h)},cD=({transmuxedData:r,callback:e})=>{r.buffer=[],e(r)},hD=(r,e)=>{e.gopInfo=r.data.gopInfo},hT=r=>{const{transmuxer:e,bytes:t,audioAppendStart:i,gopsToAlignWith:s,remux:n,onData:a,onTrackInfo:o,onAudioTimingInfo:l,onVideoTimingInfo:u,onVideoSegmentTimingInfo:c,onAudioSegmentTimingInfo:h,onId3:f,onCaptions:p,onDone:m,onEndedTimeline:y,onTransmuxerLog:v,isEndOfTimeline:E,segment:A,triggerSegmentEventFn:x}=r,w={buffer:[]};let k=E;const F=M=>{e.currentTransmux===r&&(M.data.action==="data"&&uD(M,w,a),M.data.action==="trackinfo"&&o(M.data.trackInfo),M.data.action==="gopInfo"&&hD(M,w),M.data.action==="audioTimingInfo"&&l(M.data.audioTimingInfo),M.data.action==="videoTimingInfo"&&u(M.data.videoTimingInfo),M.data.action==="videoSegmentTimingInfo"&&c(M.data.videoSegmentTimingInfo),M.data.action==="audioSegmentTimingInfo"&&h(M.data.audioSegmentTimingInfo),M.data.action==="id3Frame"&&f([M.data.id3Frame],M.data.id3Frame.dispatchType),M.data.action==="caption"&&p(M.data.caption),M.data.action==="endedtimeline"&&(k=!1,y()),M.data.action==="log"&&v(M.data.log),M.data.type==="transmuxed"&&(k||(e.onmessage=null,cD({transmuxedData:w,callback:m}),dT(e))))},L=()=>{const M={message:"Received an error message from the transmuxer worker",metadata:{errorType:te.Error.StreamingFailedToTransmuxSegment,segmentInfo:js({segment:A})}};m(null,M)};if(e.onmessage=F,e.onerror=L,i&&e.postMessage({action:"setAudioAppendStart",appendStart:i}),Array.isArray(s)&&e.postMessage({action:"alignGopsWith",gopsToAlignWith:s}),typeof n<"u"&&e.postMessage({action:"setRemux",remux:n}),t.byteLength){const M=t instanceof ArrayBuffer?t:t.buffer,C=t instanceof ArrayBuffer?0:t.byteOffset;x({type:"segmenttransmuxingstart",segment:A}),e.postMessage({action:"push",data:M,byteOffset:C,byteLength:t.byteLength},[M])}E&&e.postMessage({action:"endTimeline"}),e.postMessage({action:"flush"})},dT=r=>{r.currentTransmux=null,r.transmuxQueue.length&&(r.currentTransmux=r.transmuxQueue.shift(),typeof r.currentTransmux=="function"?r.currentTransmux():hT(r.currentTransmux))},rg=(r,e)=>{r.postMessage({action:e}),dT(r)},fT=(r,e)=>{if(!e.currentTransmux){e.currentTransmux=r,rg(e,r);return}e.transmuxQueue.push(rg.bind(null,e,r))},dD=r=>{fT("reset",r)},fD=r=>{fT("endTimeline",r)},pT=r=>{if(!r.transmuxer.currentTransmux){r.transmuxer.currentTransmux=r,hT(r);return}r.transmuxer.transmuxQueue.push(r)},pD=r=>{const e=new lD;e.currentTransmux=null,e.transmuxQueue=[];const t=e.terminate;return e.terminate=()=>(e.currentTransmux=null,e.transmuxQueue.length=0,t.call(e)),e.postMessage({action:"init",options:r}),e};var ku={reset:dD,endTimeline:fD,transmux:pT,createTransmuxer:pD};const wr=function(r){const e=r.transmuxer,t=r.endAction||r.action,i=r.callback,s=mt({},r,{endAction:null,transmuxer:null,callback:null}),n=a=>{a.data.action===t&&(e.removeEventListener("message",n),a.data.data&&(a.data.data=new Uint8Array(a.data.data,r.byteOffset||0,r.byteLength||a.data.data.byteLength),r.data&&(r.data=a.data.data)),i(a.data))};if(e.addEventListener("message",n),r.data){const a=r.data instanceof ArrayBuffer;s.byteOffset=a?0:r.data.byteOffset,s.byteLength=r.data.byteLength;const o=[a?r.data:r.data.buffer];e.postMessage(s,o)}else e.postMessage(s)},Wi={FAILURE:2,TIMEOUT:-101,ABORTED:-102},gT="wvtt",Ec=r=>{r.forEach(e=>{e.abort()})},gD=r=>({bandwidth:r.bandwidth,bytesReceived:r.bytesReceived||0,roundTripTime:r.roundTripTime||0}),mD=r=>{const e=r.target,i={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-e.requestTime||0};return i.bytesReceived=r.loaded,i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3),i},Ph=(r,e)=>{const{requestType:t}=e,i=er({requestType:t,request:e,error:r});return e.timedout?{status:e.status,message:"HLS request timed-out at URL: "+e.uri,code:Wi.TIMEOUT,xhr:e,metadata:i}:e.aborted?{status:e.status,message:"HLS request aborted at URL: "+e.uri,code:Wi.ABORTED,xhr:e,metadata:i}:r?{status:e.status,message:"HLS request errored at URL: "+e.uri,code:Wi.FAILURE,xhr:e,metadata:i}:e.responseType==="arraybuffer"&&e.response.byteLength===0?{status:e.status,message:"Empty HLS response at URL: "+e.uri,code:Wi.FAILURE,xhr:e,metadata:i}:null},ng=(r,e,t,i)=>(s,n)=>{const a=n.response,o=Ph(s,n);if(o)return t(o,r);if(a.byteLength!==16)return t({status:n.status,message:"Invalid HLS key at URL: "+n.uri,code:Wi.FAILURE,xhr:n},r);const l=new DataView(a),u=new Uint32Array([l.getUint32(0),l.getUint32(4),l.getUint32(8),l.getUint32(12)]);for(let h=0;h<e.length;h++)e[h].bytes=u;const c={uri:n.uri};return i({type:"segmentkeyloadcomplete",segment:r,keyInfo:c}),t(null,r)},yD=(r,e)=>{e===gT&&r.transmuxer.postMessage({action:"initMp4WebVttParser",data:r.map.bytes})},TD=(r,e,t)=>{e===gT&&wr({action:"getMp4WebVttText",data:r.bytes,transmuxer:r.transmuxer,callback:({data:i,mp4VttCues:s})=>{r.bytes=i,t(null,r,{mp4VttCues:s})}})},mT=(r,e)=>{const t=ih(r.map.bytes);if(t!=="mp4"){const i=r.map.resolvedUri||r.map.uri,s=t||"unknown";return e({internal:!0,message:`Found unsupported ${s} container for initialization segment at URL: ${i}`,code:Wi.FAILURE,metadata:{mediaType:s}})}wr({action:"probeMp4Tracks",data:r.map.bytes,transmuxer:r.transmuxer,callback:({tracks:i,data:s})=>(r.map.bytes=s,i.forEach(function(n){r.map.tracks=r.map.tracks||{},!r.map.tracks[n.type]&&(r.map.tracks[n.type]=n,typeof n.id=="number"&&n.timescale&&(r.map.timescales=r.map.timescales||{},r.map.timescales[n.id]=n.timescale),n.type==="text"&&yD(r,n.codec))}),e(null))})},_D=({segment:r,finishProcessingFn:e,triggerSegmentEventFn:t})=>(i,s)=>{const n=Ph(i,s);if(n)return e(n,r);const a=new Uint8Array(s.response);if(t({type:"segmentloaded",segment:r}),r.map.key)return r.map.encryptedBytes=a,e(null,r);r.map.bytes=a,mT(r,function(o){if(o)return o.xhr=s,o.status=s.status,e(o,r);e(null,r)})},vD=({segment:r,finishProcessingFn:e,responseType:t,triggerSegmentEventFn:i})=>(s,n)=>{const a=Ph(s,n);if(a)return e(a,r);i({type:"segmentloaded",segment:r});const o=t==="arraybuffer"||!n.responseText?n.response:nD(n.responseText.substring(r.lastReachedChar||0));return r.stats=gD(n),r.key?r.encryptedBytes=new Uint8Array(o):r.bytes=new Uint8Array(o),e(null,r)},SD=({segment:r,bytes:e,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:n,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:f,triggerSegmentEventFn:p})=>{const m=r.map&&r.map.tracks||{},y=!!(m.audio&&m.video);let v=i.bind(null,r,"audio","start");const E=i.bind(null,r,"audio","end");let A=i.bind(null,r,"video","start");const x=i.bind(null,r,"video","end"),w=()=>pT({bytes:e,transmuxer:r.transmuxer,audioAppendStart:r.audioAppendStart,gopsToAlignWith:r.gopsToAlignWith,remux:y,onData:k=>{k.type=k.type==="combined"?"video":k.type,c(r,k)},onTrackInfo:k=>{t&&(y&&(k.isMuxed=!0),t(r,k))},onAudioTimingInfo:k=>{v&&typeof k.start<"u"&&(v(k.start),v=null),E&&typeof k.end<"u"&&E(k.end)},onVideoTimingInfo:k=>{A&&typeof k.start<"u"&&(A(k.start),A=null),x&&typeof k.end<"u"&&x(k.end)},onVideoSegmentTimingInfo:k=>{const F={pts:{start:k.start.presentation,end:k.end.presentation},dts:{start:k.start.decode,end:k.end.decode}};p({type:"segmenttransmuxingtiminginfoavailable",segment:r,timingInfo:F}),s(k)},onAudioSegmentTimingInfo:k=>{const F={pts:{start:k.start.pts,end:k.end.pts},dts:{start:k.start.dts,end:k.end.dts}};p({type:"segmenttransmuxingtiminginfoavailable",segment:r,timingInfo:F}),n(k)},onId3:(k,F)=>{a(r,k,F)},onCaptions:k=>{o(r,[k])},isEndOfTimeline:l,onEndedTimeline:()=>{u()},onTransmuxerLog:f,onDone:(k,F)=>{h&&(k.type=k.type==="combined"?"video":k.type,p({type:"segmenttransmuxingcomplete",segment:r}),h(F,r,k))},segment:r,triggerSegmentEventFn:p});wr({action:"probeTs",transmuxer:r.transmuxer,data:e,baseStartTime:r.baseStartTime,callback:k=>{r.bytes=e=k.data;const F=k.result;F&&(t(r,{hasAudio:F.hasAudio,hasVideo:F.hasVideo,isMuxed:y}),t=null),w()}})},yT=({segment:r,bytes:e,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:n,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:f,triggerSegmentEventFn:p})=>{let m=new Uint8Array(e);if(GC(m)){r.isFmp4=!0;const{tracks:y}=r.map;if(y.text&&(!y.audio||!y.video)){c(r,{data:m,type:"text"}),TD(r,y.text.codec,h);return}const E={isFmp4:!0,hasVideo:!!y.video,hasAudio:!!y.audio};y.audio&&y.audio.codec&&y.audio.codec!=="enca"&&(E.audioCodec=y.audio.codec),y.video&&y.video.codec&&y.video.codec!=="encv"&&(E.videoCodec=y.video.codec),y.video&&y.audio&&(E.isMuxed=!0),t(r,E);const A=(x,w)=>{c(r,{data:m,type:E.hasAudio&&!E.isMuxed?"audio":"video"}),w&&w.length&&a(r,w),x&&x.length&&o(r,x),h(null,r,{})};wr({action:"probeMp4StartTime",timescales:r.map.timescales,data:m,transmuxer:r.transmuxer,callback:({data:x,startTime:w})=>{e=x.buffer,r.bytes=m=x,E.hasAudio&&!E.isMuxed&&i(r,"audio","start",w),E.hasVideo&&i(r,"video","start",w),wr({action:"probeEmsgID3",data:m,transmuxer:r.transmuxer,offset:w,callback:({emsgData:k,id3Frames:F})=>{if(e=k.buffer,r.bytes=m=k,!y.video||!k.byteLength||!r.transmuxer){A(void 0,F);return}wr({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:r.transmuxer,data:m,timescales:r.map.timescales,trackIds:[y.video.id],callback:L=>{e=L.data.buffer,r.bytes=m=L.data,L.logs.forEach(function(M){f($e(M,{stream:"mp4CaptionParser"}))}),A(L.captions,F)}})}})}});return}if(!r.transmuxer){h(null,r,{});return}if(typeof r.container>"u"&&(r.container=ih(m)),r.container!=="ts"&&r.container!=="aac"){t(r,{hasAudio:!1,hasVideo:!1}),h(null,r,{});return}SD({segment:r,bytes:e,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:n,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:f,triggerSegmentEventFn:p})},TT=function({id:r,key:e,encryptedBytes:t,decryptionWorker:i,segment:s,doneFn:n},a){const o=u=>{if(u.data.source===r){i.removeEventListener("message",o);const c=u.data.decrypted;a(new Uint8Array(c.bytes,c.byteOffset,c.byteLength))}};i.onerror=()=>{const u="An error occurred in the decryption worker",c=js({segment:s}),h={message:u,metadata:{error:new Error(u),errorType:te.Error.StreamingFailedToDecryptSegment,segmentInfo:c,keyInfo:{uri:s.key.resolvedUri||s.map.key.resolvedUri}}};n(h,s)},i.addEventListener("message",o);let l;e.bytes.slice?l=e.bytes.slice():l=new Uint32Array(Array.prototype.slice.call(e.bytes)),i.postMessage(iT({source:r,encrypted:t,key:l,iv:e.iv}),[t.buffer,l.buffer])},ED=({decryptionWorker:r,segment:e,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:n,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:f,triggerSegmentEventFn:p})=>{p({type:"segmentdecryptionstart"}),TT({id:e.requestId,key:e.key,encryptedBytes:e.encryptedBytes,decryptionWorker:r,segment:e,doneFn:h},m=>{e.bytes=m,p({type:"segmentdecryptioncomplete",segment:e}),yT({segment:e,bytes:e.bytes,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:n,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:f,triggerSegmentEventFn:p})})},bD=({activeXhrs:r,decryptionWorker:e,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:n,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:f,triggerSegmentEventFn:p})=>{let m=0,y=!1;return(v,E)=>{if(!y){if(v)return y=!0,Ec(r),h(v,E);if(m+=1,m===r.length){const A=function(){if(E.encryptedBytes)return ED({decryptionWorker:e,segment:E,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:n,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:f,triggerSegmentEventFn:p});yT({segment:E,bytes:E.bytes,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:n,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:h,onTransmuxerLog:f,triggerSegmentEventFn:p})};if(E.endOfAllRequests=Date.now(),E.map&&E.map.encryptedBytes&&!E.map.bytes)return p({type:"segmentdecryptionstart",segment:E}),TT({decryptionWorker:e,id:E.requestId+"-init",encryptedBytes:E.map.encryptedBytes,key:E.map.key,segment:E,doneFn:h},x=>{E.map.bytes=x,p({type:"segmentdecryptioncomplete",segment:E}),mT(E,w=>{if(w)return Ec(r),h(w,E);A()})});A()}}}},xD=({loadendState:r,abortFn:e})=>t=>{t.target.aborted&&e&&!r.calledAbortFn&&(e(),r.calledAbortFn=!0)},AD=({segment:r,progressFn:e,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:n,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c})=>h=>{if(!h.target.aborted)return r.stats=$e(r.stats,mD(h)),!r.stats.firstBytesReceivedAt&&r.stats.bytesReceived&&(r.stats.firstBytesReceivedAt=Date.now()),e(h,r)},CD=({xhr:r,xhrOptions:e,decryptionWorker:t,segment:i,abortFn:s,progressFn:n,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:c,captionsFn:h,isEndOfTimeline:f,endedTimelineFn:p,dataFn:m,doneFn:y,onTransmuxerLog:v,triggerSegmentEventFn:E})=>{const A=[],x=bD({activeXhrs:A,decryptionWorker:t,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:c,captionsFn:h,isEndOfTimeline:f,endedTimelineFn:p,dataFn:m,doneFn:y,onTransmuxerLog:v,triggerSegmentEventFn:E});if(i.key&&!i.key.bytes){const M=[i.key];i.map&&!i.map.bytes&&i.map.key&&i.map.key.resolvedUri===i.key.resolvedUri&&M.push(i.map.key);const C=$e(e,{uri:i.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),D=ng(i,M,x,E),B={uri:i.key.resolvedUri};E({type:"segmentkeyloadstart",segment:i,keyInfo:B});const H=r(C,D);A.push(H)}if(i.map&&!i.map.bytes){if(i.map.key&&(!i.key||i.key.resolvedUri!==i.map.key.resolvedUri)){const H=$e(e,{uri:i.map.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),q=ng(i,[i.map.key],x,E),Y={uri:i.map.key.resolvedUri};E({type:"segmentkeyloadstart",segment:i,keyInfo:Y});const Z=r(H,q);A.push(Z)}const C=$e(e,{uri:i.map.resolvedUri,responseType:"arraybuffer",headers:vc(i.map),requestType:"segment-media-initialization"}),D=_D({segment:i,finishProcessingFn:x,triggerSegmentEventFn:E});E({type:"segmentloadstart",segment:i});const B=r(C,D);A.push(B)}const w=$e(e,{uri:i.part&&i.part.resolvedUri||i.resolvedUri,responseType:"arraybuffer",headers:vc(i),requestType:"segment"}),k=vD({segment:i,finishProcessingFn:x,responseType:w.responseType,triggerSegmentEventFn:E});E({type:"segmentloadstart",segment:i});const F=r(w,k);F.addEventListener("progress",AD({segment:i,progressFn:n,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:c,captionsFn:h,isEndOfTimeline:f,endedTimelineFn:p,dataFn:m})),A.push(F);const L={};return A.forEach(M=>{M.addEventListener("loadend",xD({loadendState:L,abortFn:s}))}),()=>Ec(A)},Ja=Ti("PlaylistSelector"),ag=function(r){if(!r||!r.playlist)return;const e=r.playlist;return JSON.stringify({id:e.id,bandwidth:r.bandwidth,width:r.width,height:r.height,codecs:e.attributes&&e.attributes.CODECS||""})},kr=function(r,e){if(!r)return"";const t=$.getComputedStyle(r);return t?t[e]:""},Pr=function(r,e){const t=r.slice();r.sort(function(i,s){const n=e(i,s);return n===0?t.indexOf(i)-t.indexOf(s):n})},Oh=function(r,e){let t,i;return r.attributes.BANDWIDTH&&(t=r.attributes.BANDWIDTH),t=t||$.Number.MAX_VALUE,e.attributes.BANDWIDTH&&(i=e.attributes.BANDWIDTH),i=i||$.Number.MAX_VALUE,t-i},ID=function(r,e){let t,i;return r.attributes.RESOLUTION&&r.attributes.RESOLUTION.width&&(t=r.attributes.RESOLUTION.width),t=t||$.Number.MAX_VALUE,e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(i=e.attributes.RESOLUTION.width),i=i||$.Number.MAX_VALUE,t===i&&r.attributes.BANDWIDTH&&e.attributes.BANDWIDTH?r.attributes.BANDWIDTH-e.attributes.BANDWIDTH:t-i};let _T=function(r){const{main:e,bandwidth:t,playerWidth:i,playerHeight:s,playerObjectFit:n,limitRenditionByPlayerDimensions:a,playlistController:o}=r;if(!e)return;const l={bandwidth:t,width:i,height:s,limitRenditionByPlayerDimensions:a};let u=e.playlists;jt.isAudioOnly(e)&&(u=o.getAudioTrackPlaylists_(),l.audioOnly=!0);let c=u.map(L=>{let M;const C=L.attributes&&L.attributes.RESOLUTION&&L.attributes.RESOLUTION.width,D=L.attributes&&L.attributes.RESOLUTION&&L.attributes.RESOLUTION.height;return M=L.attributes&&L.attributes.BANDWIDTH,M=M||$.Number.MAX_VALUE,{bandwidth:M,width:C,height:D,playlist:L}});Pr(c,(L,M)=>L.bandwidth-M.bandwidth),c=c.filter(L=>!jt.isIncompatible(L.playlist));let h=c.filter(L=>jt.isEnabled(L.playlist));h.length||(h=c.filter(L=>!jt.isDisabled(L.playlist)));const f=h.filter(L=>L.bandwidth*bt.BANDWIDTH_VARIANCE<t);let p=f[f.length-1];const m=f.filter(L=>L.bandwidth===p.bandwidth)[0];if(a===!1){const L=m||h[0]||c[0];if(L&&L.playlist){let M="sortedPlaylistReps";return m&&(M="bandwidthBestRep"),h[0]&&(M="enabledPlaylistReps"),Ja(`choosing ${ag(L)} using ${M} with options`,l),L.playlist}return Ja("could not choose a playlist with options",l),null}const y=f.filter(L=>L.width&&L.height);Pr(y,(L,M)=>L.width-M.width);const v=y.filter(L=>L.width===i&&L.height===s);p=v[v.length-1];const E=v.filter(L=>L.bandwidth===p.bandwidth)[0];let A,x,w;E||(A=y.filter(L=>n==="cover"?L.width>i&&L.height>s:L.width>i||L.height>s),x=A.filter(L=>L.width===A[0].width&&L.height===A[0].height),p=x[x.length-1],w=x.filter(L=>L.bandwidth===p.bandwidth)[0]);let k;if(o.leastPixelDiffSelector){const L=y.map(M=>(M.pixelDiff=Math.abs(M.width-i)+Math.abs(M.height-s),M));Pr(L,(M,C)=>M.pixelDiff===C.pixelDiff?C.bandwidth-M.bandwidth:M.pixelDiff-C.pixelDiff),k=L[0]}const F=k||w||E||m||h[0]||c[0];if(F&&F.playlist){let L="sortedPlaylistReps";return k?L="leastPixelDiffRep":w?L="resolutionPlusOneRep":E?L="resolutionBestRep":m?L="bandwidthBestRep":h[0]&&(L="enabledPlaylistReps"),Ja(`choosing ${ag(F)} using ${L} with options`,l),F.playlist}return Ja("could not choose a playlist with options",l),null};const og=function(){let r=this.useDevicePixelRatio&&$.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(r=this.customPixelRatio),_T({main:this.playlists.main,bandwidth:this.systemBandwidth,playerWidth:parseInt(kr(this.tech_.el(),"width"),10)*r,playerHeight:parseInt(kr(this.tech_.el(),"height"),10)*r,playerObjectFit:this.usePlayerObjectFit?kr(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})},DD=function(r){let e=-1,t=-1;if(r<0||r>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){let i=this.useDevicePixelRatio&&$.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(i=this.customPixelRatio),e<0&&(e=this.systemBandwidth,t=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==t&&(e=r*this.systemBandwidth+(1-r)*e,t=this.systemBandwidth),_T({main:this.playlists.main,bandwidth:e,playerWidth:parseInt(kr(this.tech_.el(),"width"),10)*i,playerHeight:parseInt(kr(this.tech_.el(),"height"),10)*i,playerObjectFit:this.usePlayerObjectFit?kr(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})}},LD=function(r){const{main:e,currentTime:t,bandwidth:i,duration:s,segmentDuration:n,timeUntilRebuffer:a,currentTimeline:o,syncController:l}=r,u=e.playlists.filter(m=>!jt.isIncompatible(m));let c=u.filter(jt.isEnabled);c.length||(c=u.filter(m=>!jt.isDisabled(m)));const f=c.filter(jt.hasAttribute.bind(null,"BANDWIDTH")).map(m=>{const v=l.getSyncPoint(m,s,o,t)?1:2,A=jt.estimateSegmentRequestTime(n,i,m)*v-a;return{playlist:m,rebufferingImpact:A}}),p=f.filter(m=>m.rebufferingImpact<=0);return Pr(p,(m,y)=>Oh(y.playlist,m.playlist)),p.length?p[0]:(Pr(f,(m,y)=>m.rebufferingImpact-y.rebufferingImpact),f[0]||null)},RD=function(){const r=this.playlists.main.playlists.filter(jt.isEnabled);return Pr(r,(t,i)=>Oh(t,i)),r.filter(t=>!!Nn(this.playlists.main,t).video)[0]||null},wD=r=>{let e=0,t;return r.bytes&&(t=new Uint8Array(r.bytes),r.segments.forEach(i=>{t.set(i,e),e+=i.byteLength})),t};function vT(r){try{return new URL(r).pathname.split("/").slice(-2).join("/")}catch{return""}}const kD=function(r,e,t){if(!r[t]){e.trigger({type:"usage",name:"vhs-608"});let i=t;/^cc708_/.test(t)&&(i="SERVICE"+t.split("_")[1]);const s=e.textTracks().getTrackById(i);if(s)r[t]=s;else{const n=e.options_.vhs&&e.options_.vhs.captionServices||{};let a=t,o=t,l=!1;const u=n[i];u&&(a=u.label,o=u.language,l=u.default),r[t]=e.addRemoteTextTrack({kind:"captions",id:i,default:l,label:a,language:o},!1).track}}},PD=function({inbandTextTracks:r,captionArray:e,timestampOffset:t}){if(!e)return;const i=$.WebKitDataCue||$.VTTCue;e.forEach(s=>{const n=s.stream;s.content?s.content.forEach(a=>{const o=new i(s.startTime+t,s.endTime+t,a.text);o.line=a.line,o.align="left",o.position=a.position,o.positionAlign="line-left",r[n].addCue(o)}):r[n].addCue(new i(s.startTime+t,s.endTime+t,s.text))})},OD=function(r){Object.defineProperties(r.frame,{id:{get(){return te.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),r.value.key}},value:{get(){return te.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),r.value.data}},privateData:{get(){return te.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),r.value.data}}})},MD=({inbandTextTracks:r,metadataArray:e,timestampOffset:t,videoDuration:i})=>{if(!e)return;const s=$.WebKitDataCue||$.VTTCue,n=r.metadataTrack_;if(!n||(e.forEach(c=>{const h=c.cueTime+t;typeof h!="number"||$.isNaN(h)||h<0||!(h<1/0)||!c.frames||!c.frames.length||c.frames.forEach(f=>{const p=new s(h,h,f.value||f.url||f.data||"");p.frame=f,p.value=f,OD(p),n.addCue(p)})}),!n.cues||!n.cues.length))return;const a=n.cues,o=[];for(let c=0;c<a.length;c++)a[c]&&o.push(a[c]);const l=o.reduce((c,h)=>{const f=c[h.startTime]||[];return f.push(h),c[h.startTime]=f,c},{}),u=Object.keys(l).sort((c,h)=>Number(c)-Number(h));u.forEach((c,h)=>{const f=l[c],p=isFinite(i)?i:c,m=Number(u[h+1])||p;f.forEach(y=>{y.endTime=m})})},FD={id:"ID",class:"CLASS",startDate:"START-DATE",duration:"DURATION",endDate:"END-DATE",endOnNext:"END-ON-NEXT",plannedDuration:"PLANNED-DURATION",scte35Out:"SCTE35-OUT",scte35In:"SCTE35-IN"},ND=new Set(["id","class","startDate","duration","endDate","endOnNext","startTime","endTime","processDateRange"]),BD=({inbandTextTracks:r,dateRanges:e})=>{const t=r.metadataTrack_;if(!t)return;const i=$.WebKitDataCue||$.VTTCue;e.forEach(s=>{for(const n of Object.keys(s)){if(ND.has(n))continue;const a=new i(s.startTime,s.endTime,"");a.id=s.id,a.type="com.apple.quicktime.HLS",a.value={key:FD[n],data:s[n]},(n==="scte35Out"||n==="scte35In")&&(a.value.data=new Uint8Array(a.value.data.match(/[\da-f]{2}/gi)).buffer),t.addCue(a)}s.processDateRange()})},lg=(r,e,t)=>{r.metadataTrack_||(r.metadataTrack_=t.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,te.browser.IS_ANY_SAFARI||(r.metadataTrack_.inBandMetadataTrackDispatchType=e))},Dn=function(r,e,t){let i,s;if(t&&t.cues)for(i=t.cues.length;i--;)s=t.cues[i],s.startTime>=r&&s.endTime<=e&&t.removeCue(s)},UD=function(r){const e=r.cues;if(!e)return;const t={};for(let i=e.length-1;i>=0;i--){const s=e[i],n=`${s.startTime}-${s.endTime}-${s.text}`;t[n]?r.removeCue(s):t[n]=s}},$D=(r,e,t)=>{if(typeof e>"u"||e===null||!r.length)return[];const i=Math.ceil((e-t+3)*Ws.ONE_SECOND_IN_TS);let s;for(s=0;s<r.length&&!(r[s].pts>i);s++);return r.slice(s)},VD=(r,e,t)=>{if(!e.length)return r;if(t)return e.slice();const i=e[0].pts;let s=0;for(s;s<r.length&&!(r[s].pts>=i);s++);return r.slice(0,s).concat(e)},GD=(r,e,t,i)=>{const s=Math.ceil((e-i)*Ws.ONE_SECOND_IN_TS),n=Math.ceil((t-i)*Ws.ONE_SECOND_IN_TS),a=r.slice();let o=r.length;for(;o--&&!(r[o].pts<=n););if(o===-1)return a;let l=o+1;for(;l--&&!(r[l].pts<=s););return l=Math.max(l,0),a.splice(l,o-l+1),a},HD=function(r,e){if(!r&&!e||!r&&e||r&&!e)return!1;if(r===e)return!0;const t=Object.keys(r).sort(),i=Object.keys(e).sort();if(t.length!==i.length)return!1;for(let s=0;s<t.length;s++){const n=t[s];if(n!==i[s]||r[n]!==e[n])return!1}return!0},qD=function(r,e,t){e=e||[];const i=[];let s=0;for(let n=0;n<e.length;n++){const a=e[n];if(r===a.timeline&&(i.push(n),s+=a.duration,s>t))return n}return i.length===0?0:i[i.length-1]},xn=1,jD=500,ug=r=>typeof r=="number"&&isFinite(r),Za=1/60,KD=(r,e,t)=>r!=="main"||!e||!t?null:!t.hasAudio&&!t.hasVideo?"Neither audio nor video found in segment.":e.hasVideo&&!t.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!e.hasVideo&&t.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null,WD=(r,e,t)=>{let i=e-bt.BACK_BUFFER_LENGTH;r.length&&(i=Math.max(i,r.start(0)));const s=e-t;return Math.min(s,i)},gr=r=>{const{startOfSegment:e,duration:t,segment:i,part:s,playlist:{mediaSequence:n,id:a,segments:o=[]},mediaIndex:l,partIndex:u,timeline:c}=r,h=o.length-1;let f="mediaIndex/partIndex increment";r.getMediaInfoForTime?f=`getMediaInfoForTime (${r.getMediaInfoForTime})`:r.isSyncRequest&&(f="getSyncSegmentCandidate (isSyncRequest)"),r.independent&&(f+=` with independent ${r.independent}`);const p=typeof u=="number",m=r.segment.uri?"segment":"pre-segment",y=p?By({preloadSegment:i})-1:0;return`${m} [${n+l}/${n+h}]`+(p?` part [${u}/${y}]`:"")+` segment start/end [${i.start} => ${i.end}]`+(p?` part start/end [${s.start} => ${s.end}]`:"")+` startOfSegment [${e}] duration [${t}] timeline [${c}] selected by [${f}] playlist [${a}]`},cg=r=>`${r}TimingInfo`,zD=({segmentTimeline:r,currentTimeline:e,startOfSegment:t,buffered:i,overrideCheck:s})=>!s&&r===e?null:r<e?t:i.length?i.end(i.length-1):t,bc=({timelineChangeController:r,currentTimeline:e,segmentTimeline:t,loaderType:i,audioDisabled:s})=>{if(e===t)return!1;if(i==="audio"){const n=r.lastTimelineChange({type:"main"});return!n||n.to!==t}if(i==="main"&&s){const n=r.pendingTimelineChange({type:"audio"});return!(n&&n.to===t)}return!1},YD=r=>{if(!r)return!1;const e=r.pendingTimelineChange({type:"audio"}),t=r.pendingTimelineChange({type:"main"}),i=e&&t,s=i&&e.to!==t.to;return!!(i&&e.from!==-1&&t.from!==-1&&s)},XD=r=>{const e=r.timelineChangeController_.pendingTimelineChange({type:"audio"}),t=r.timelineChangeController_.pendingTimelineChange({type:"main"});return e&&t&&e.to<t.to},bs=r=>{const e=r.pendingSegment_;if(!e)return;if(bc({timelineChangeController:r.timelineChangeController_,currentTimeline:r.currentTimeline_,segmentTimeline:e.timeline,loaderType:r.loaderType_,audioDisabled:r.audioDisabled_})&&YD(r.timelineChangeController_)){if(XD(r)){r.timelineChangeController_.trigger("audioTimelineBehind");return}r.timelineChangeController_.trigger("fixBadTimelineChange")}},QD=r=>{let e=0;return["video","audio"].forEach(function(t){const i=r[`${t}TimingInfo`];if(!i)return;const{start:s,end:n}=i;let a;typeof s=="bigint"||typeof n=="bigint"?a=$.BigInt(n)-$.BigInt(s):typeof s=="number"&&typeof n=="number"&&(a=n-s),typeof a<"u"&&a>e&&(e=a)}),typeof e=="bigint"&&e<Number.MAX_SAFE_INTEGER&&(e=Number(e)),e},hg=({segmentDuration:r,maxDuration:e})=>r?Math.round(r)>e+ji:!1,JD=(r,e)=>{if(e!=="hls")return null;const t=QD({audioTimingInfo:r.audioTimingInfo,videoTimingInfo:r.videoTimingInfo});if(!t)return null;const i=r.playlist.targetDuration,s=hg({segmentDuration:t,maxDuration:i*2}),n=hg({segmentDuration:t,maxDuration:i}),a=`Segment with index ${r.mediaIndex} from playlist ${r.playlist.id} has a duration of ${t} when the reported duration is ${r.duration} and the target duration is ${i}. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1`;return s||n?{severity:s?"warn":"info",message:a}:null},js=({type:r,segment:e})=>{if(!e)return;const t=!!(e.key||e.map&&e.map.ke),i=!!(e.map&&!e.map.bytes),s=e.startOfSegment===void 0?e.start:e.startOfSegment;return{type:r||e.type,uri:e.resolvedUri||e.uri,start:s,duration:e.duration,isEncrypted:t,isMediaInitialization:i}};class xc extends te.EventTarget{constructor(e,t={}){if(super(),!e)throw new TypeError("Initialization settings are required");if(typeof e.currentTime!="function")throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.addMetadataToTextTrack=e.addMetadataToTextTrack,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.shouldForceTimestampOffsetAfterResync_=!1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=!1,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",()=>{this.isEndOfStream_()||(this.ended_=!1)}),this.fetchAtBuffer_=!1,this.logger_=Ti(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(i){i!==this.state_&&(this.logger_(`${this.state_} -> ${i}`),this.state_=i,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():bs(this)}),this.sourceUpdater_.on("codecschange",i=>{this.trigger(mt({type:"codecschange"},i))}),this.loaderType_==="main"&&this.timelineChangeController_.on("pendingtimelinechange",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():bs(this)}),this.loaderType_==="audio"&&this.timelineChangeController_.on("timelinechange",i=>{this.trigger(mt({type:"timelinechange"},i)),this.hasEnoughInfoToLoad_()?this.processLoadQueue_():bs(this),this.hasEnoughInfoToAppend_()?this.processCallQueue_():bs(this)})}get mediaSequenceSync_(){return this.syncController_.getMediaSequenceSync(this.loaderType_)}createTransmuxer_(){return ku.createTransmuxer({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&$.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){if(this.state!=="WAITING"){this.pendingSegment_&&(this.pendingSegment_=null),this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_);return}this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,$.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return this.state==="APPENDING"&&!this.pendingSegment_?(this.state="READY",!0):!this.pendingSegment_||this.pendingSegment_.requestId!==e}error(e){return typeof e<"u"&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&ku.reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return At();if(this.loaderType_==="main"){const{hasAudio:t,hasVideo:i,isMuxed:s}=e;if(i&&t&&!this.audioDisabled_&&!s)return this.sourceUpdater_.buffered();if(i)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,t=!1){if(!e)return null;const i=Vo(e);let s=this.initSegments_[i];return t&&!s&&e.bytes&&(this.initSegments_[i]=s={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),s||e}segmentKey(e,t=!1){if(!e)return null;const i=sT(e);let s=this.keyCache_[i];this.cacheEncryptionKeys_&&t&&!s&&e.bytes&&(this.keyCache_[i]=s={resolvedUri:e.resolvedUri,bytes:e.bytes});const n={resolvedUri:(s||e).resolvedUri};return s&&(n.bytes=s.bytes),n}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),!!this.playlist_){if(this.state==="INIT"&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||this.state!=="READY"&&this.state!=="INIT"||(this.state="READY")}}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,t={}){if(!e||this.playlist_&&this.playlist_.endList&&e.endList&&this.playlist_.uri===e.uri)return;const i=this.playlist_,s=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,this.state==="INIT"&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},this.loaderType_==="main"&&this.syncController_.setDateTimeMappingForStart(e));let n=null;if(i&&(i.id?n=i.id:i.uri&&(n=i.uri)),this.logger_(`playlist update [${n} => ${e.id||e.uri}]`),this.mediaSequenceSync_&&(this.mediaSequenceSync_.update(e,this.currentTime_()),this.logger_(`Playlist update:
currentTime: ${this.currentTime_()}
bufferedEnd: ${Ru(this.buffered_())}
`,this.mediaSequenceSync_.diagnostics)),this.trigger("syncinfoupdate"),this.state==="INIT"&&this.couldBeginLoading_())return this.init_();if(!i||i.uri!==e.uri){this.mediaIndex!==null&&(!e.endList&&typeof e.partTargetDuration=="number"?this.resetLoader():this.resyncLoader()),this.currentMediaInfo_=void 0,this.trigger("playlistupdate");return}const a=e.mediaSequence-i.mediaSequence;if(this.logger_(`live window shift [${a}]`),this.mediaIndex!==null)if(this.mediaIndex-=a,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const o=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!o.parts||!o.parts.length||!o.parts[this.partIndex])){const l=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=l}}s&&(s.mediaIndex-=a,s.mediaIndex<0?(s.mediaIndex=null,s.partIndex=null):(s.mediaIndex>=0&&(s.segment=e.segments[s.mediaIndex]),s.partIndex>=0&&s.segment.parts&&(s.part=s.segment.parts[s.partIndex]))),this.syncController_.saveExpiredSegmentInfo(i,e)}pause(){this.checkBufferTimeout_&&($.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return this.checkBufferTimeout_===null}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.mediaSequenceSync_&&this.mediaSequenceSync_.resetAppendedStatus(),this.resyncLoader()}resyncLoader(){this.transmuxer_&&ku.reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1;const e=this.currentMediaInfo_&&this.currentMediaInfo_.isFmp4;this.sourceType_==="hls"&&!e&&(this.shouldForceTimestampOffsetAfterResync_=!0),this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t,i=()=>{},s=!1){if(t===1/0&&(t=this.duration_()),t<=e){this.logger_("skipping remove because end ${end} is <= start ${start}");return}if(!this.sourceUpdater_||!this.getMediaInfo_()){this.logger_("skipping remove because no source updater or starting media info");return}let n=1;const a=()=>{n--,n===0&&i()};(s||!this.audioDisabled_)&&(n++,this.sourceUpdater_.removeAudio(e,t,a)),(s||this.loaderType_==="main")&&(this.gopBuffer_=GD(this.gopBuffer_,e,t,this.timeMapping_),n++,this.sourceUpdater_.removeVideo(e,t,a));for(const o in this.inbandTextTracks_)Dn(e,t,this.inbandTextTracks_[o]);Dn(e,t,this.segmentMetadataTrack_),a()}monitorBuffer_(){this.checkBufferTimeout_&&$.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=$.setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){this.state==="READY"&&this.fillBuffer_(),this.checkBufferTimeout_&&$.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=$.setTimeout(this.monitorBufferTick_.bind(this),jD)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();if(!e)return;const t={segmentInfo:js({type:this.loaderType_,segment:e})};this.trigger({type:"segmentselected",metadata:t}),typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e)}isEndOfStream_(e=this.mediaIndex,t=this.playlist_,i=this.partIndex){if(!t||!this.mediaSource_)return!1;const s=typeof e=="number"&&t.segments[e],n=e+1===t.segments.length,a=!s||!s.parts||i+1===s.parts.length;return t.endList&&this.mediaSource_.readyState==="open"&&n&&a}chooseNextRequest_(){const e=this.buffered_(),t=Ru(e)||0,i=Lh(e,this.currentTime_()),s=!this.hasPlayed_()&&i>=1,n=i>=this.goalBufferLength_(),a=this.playlist_.segments;if(!a.length||s||n)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_(),this.loaderType_);const o={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:!this.syncPoint_};if(o.isSyncRequest)o.mediaIndex=qD(this.currentTimeline_,a,t),this.logger_(`choose next request. Can not find sync point. Fallback to media Index: ${o.mediaIndex}`);else if(this.mediaIndex!==null){const f=a[this.mediaIndex],p=typeof this.partIndex=="number"?this.partIndex:-1;o.startOfSegment=f.end?f.end:t,f.parts&&f.parts[p+1]?(o.mediaIndex=this.mediaIndex,o.partIndex=p+1):o.mediaIndex=this.mediaIndex+1}else{let f,p,m;const y=this.fetchAtBuffer_?t:this.currentTime_();if(this.mediaSequenceSync_&&this.logger_(`chooseNextRequest_ request after Quality Switch:
For TargetTime: ${y}.
CurrentTime: ${this.currentTime_()}
BufferedEnd: ${t}
Fetch At Buffer: ${this.fetchAtBuffer_}
`,this.mediaSequenceSync_.diagnostics),this.mediaSequenceSync_&&this.mediaSequenceSync_.isReliable){const v=this.getSyncInfoFromMediaSequenceSync_(y);if(!v){const E="No sync info found while using media sequence sync";return this.error({message:E,metadata:{errorType:te.Error.StreamingFailedToSelectNextSegment,error:new Error(E)}}),this.logger_("chooseNextRequest_ - no sync info found using media sequence sync"),null}this.logger_(`chooseNextRequest_ mediaSequence syncInfo (${v.start} --> ${v.end})`),f=v.segmentIndex,p=v.partIndex,m=v.start}else{this.logger_("chooseNextRequest_ - fallback to a regular segment selection algorithm, based on a syncPoint.");const v=jt.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:y,startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});f=v.segmentIndex,p=v.partIndex,m=v.startTime}o.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${y}`:`currentTime ${y}`,o.mediaIndex=f,o.startOfSegment=m,o.partIndex=p,this.logger_(`choose next request. Playlist switched and we have a sync point. Media Index: ${o.mediaIndex} `)}const l=a[o.mediaIndex];let u=l&&typeof o.partIndex=="number"&&l.parts&&l.parts[o.partIndex];if(!l||typeof o.partIndex=="number"&&!u)return null;typeof o.partIndex!="number"&&l.parts&&(o.partIndex=0,u=l.parts[0]);const c=this.vhs_.playlists&&this.vhs_.playlists.main&&this.vhs_.playlists.main.independentSegments||this.playlist_.independentSegments;if(!i&&u&&!c&&!u.independent)if(o.partIndex===0){const f=a[o.mediaIndex-1],p=f.parts&&f.parts.length&&f.parts[f.parts.length-1];p&&p.independent&&(o.mediaIndex-=1,o.partIndex=f.parts.length-1,o.independent="previous segment")}else l.parts[o.partIndex-1].independent&&(o.partIndex-=1,o.independent="previous part");const h=this.mediaSource_&&this.mediaSource_.readyState==="ended";return o.mediaIndex>=a.length-1&&h&&!this.seeking_()?null:(this.shouldForceTimestampOffsetAfterResync_&&(this.shouldForceTimestampOffsetAfterResync_=!1,o.forceTimestampOffset=!0,this.logger_("choose next request. Force timestamp offset after loader resync")),this.generateSegmentInfo_(o))}getSyncInfoFromMediaSequenceSync_(e){if(!this.mediaSequenceSync_)return null;const t=Math.max(e,this.mediaSequenceSync_.start);e!==t&&this.logger_(`getSyncInfoFromMediaSequenceSync_. Pulled target time from ${e} to ${t}`);const i=this.mediaSequenceSync_.getSyncInfoForTime(t);if(!i)return null;if(!i.isAppended)return i;const s=this.mediaSequenceSync_.getSyncInfoForTime(i.end);return s?(s.isAppended&&this.logger_("getSyncInfoFromMediaSequenceSync_: We encounter unexpected scenario where next media sequence sync info is also appended!"),s):null}generateSegmentInfo_(e){const{independent:t,playlist:i,mediaIndex:s,startOfSegment:n,isSyncRequest:a,partIndex:o,forceTimestampOffset:l,getMediaInfoForTime:u}=e,c=i.segments[s],h=typeof o=="number"&&c.parts[o],f={requestId:"segment-loader-"+Math.random(),uri:h&&h.resolvedUri||c.resolvedUri,mediaIndex:s,partIndex:h?o:null,isSyncRequest:a,startOfSegment:n,playlist:i,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:c.timeline,duration:h&&h.duration||c.duration,segment:c,part:h,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:u,independent:t},p=typeof l<"u"?l:this.isPendingTimestampOffset_;f.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:c.timeline,currentTimeline:this.currentTimeline_,startOfSegment:n,buffered:this.buffered_(),overrideCheck:p});const m=Ru(this.sourceUpdater_.audioBuffered());return typeof m=="number"&&(f.audioAppendStart=m-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(f.gopsToAlignWith=$D(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),f}timestampOffsetForSegment_(e){return zD(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH||Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),i=e.bandwidth,s=this.pendingSegment_.duration,n=jt.estimateSegmentRequestTime(s,i,this.playlist_,e.bytesReceived),a=mI(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(n<=a)return;const o=LD({main:this.vhs_.playlists.main,currentTime:t,bandwidth:i,duration:this.duration_(),segmentDuration:s,timeUntilRebuffer:a,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!o)return;const u=n-a-o.rebufferingImpact;let c=.5;a<=ji&&(c=1),!(!o.playlist||o.playlist.uri===this.playlist_.uri||u<c)&&(this.bandwidth=o.playlist.attributes.BANDWIDTH*bt.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${gr(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),!this.checkForAbort_(t.requestId)&&this.trigger("progress")}handleTrackInfo_(e,t){const{hasAudio:i,hasVideo:s}=t,n={segmentInfo:js({type:this.loaderType_,segment:e}),trackInfo:{hasAudio:i,hasVideo:s}};this.trigger({type:"segmenttransmuxingtrackinfoavailable",metadata:n}),this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)&&(this.checkForIllegalMediaSwitch(t)||(t=t||{},HD(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),!this.checkForAbort_(e.requestId)&&(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()?this.processCallQueue_():bs(this))))}handleTimingInfo_(e,t,i,s){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const n=this.pendingSegment_,a=cg(t);n[a]=n[a]||{},n[a][i]=s,this.logger_(`timinginfo: ${t} - ${i} - ${s}`),this.hasEnoughInfoToAppend_()?this.processCallQueue_():bs(this)}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(t.length===0){this.logger_("SegmentLoader received no captions from a caption event");return}if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));return}const s=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),n={};t.forEach(a=>{n[a.stream]=n[a.stream]||{startTime:1/0,captions:[],endTime:0};const o=n[a.stream];o.startTime=Math.min(o.startTime,a.startTime+s),o.endTime=Math.max(o.endTime,a.endTime+s),o.captions.push(a)}),Object.keys(n).forEach(a=>{const{startTime:o,endTime:l,captions:u}=n[a],c=this.inbandTextTracks_;this.logger_(`adding cues from ${o} -> ${l} for ${a}`),kD(c,this.vhs_.tech_,a),Dn(o,l,c[a]),PD({captionArray:u,inbandTextTracks:c,timestampOffset:s})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,i){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,i));return}this.addMetadataToTextTrack(i,t,this.duration_())}processMetadataQueue_(){this.metadataQueue_.id3.forEach(e=>e()),this.metadataQueue_.caption.forEach(e=>e()),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach(t=>t())}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach(t=>t())}hasEnoughInfoToLoad_(){if(this.loaderType_!=="audio")return!0;const e=this.pendingSegment_;return e?this.getCurrentMediaInfo_()?!bc({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}):!0:!1}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready()||this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:i,hasVideo:s,isMuxed:n}=t;return!(s&&!e.videoTimingInfo||i&&!this.audioDisabled_&&!n&&!e.audioTimingInfo||bc({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_()){bs(this),this.callQueue_.push(this.handleData_.bind(this,e,t));return}const i=this.pendingSegment_;if(this.setTimeMapping_(i.timeline),this.updateMediaSecondsLoaded_(i.part||i.segment),this.mediaSource_.readyState!=="closed"){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),i.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),i.isFmp4=e.isFmp4,i.timingInfo=i.timingInfo||{},i.isFmp4)this.trigger("fmp4"),i.timingInfo.start=i[cg(t.type)].start;else{const s=this.getCurrentMediaInfo_(),n=this.loaderType_==="main"&&s&&s.hasVideo;let a;n&&(a=i.videoTimingInfo.start),i.timingInfo.start=this.trueSegmentStart_({currentStart:i.timingInfo.start,playlist:i.playlist,mediaIndex:i.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:n,firstVideoFrameTimeForData:a,videoTimingInfo:i.videoTimingInfo,audioTimingInfo:i.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(i,t.type),this.updateSourceBufferTimestampOffset_(i),i.isSyncRequest){this.updateTimingInfoEnd_(i),this.syncController_.saveSegmentTimingInfo({segmentInfo:i,shouldSaveTimelineMapping:this.loaderType_==="main"});const s=this.chooseNextRequest_();if(s.mediaIndex!==i.mediaIndex||s.partIndex!==i.partIndex){this.logger_("sync segment was incorrect, not appending");return}this.logger_("sync segment was correct, appending")}i.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(i,t)}}updateAppendInitSegmentStatus(e,t){this.loaderType_==="main"&&typeof e.timestampOffset=="number"&&!e.changedTimestampOffset&&(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:t,map:i,playlist:s}){if(i){const n=Vo(i);if(this.activeInitSegmentId_===n)return null;t=this.initSegmentForMap(i,!0).bytes,this.activeInitSegmentId_=n}return t&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=s,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,t):null}handleQuotaExceededError_({segmentInfo:e,type:t,bytes:i},s){const n=this.sourceUpdater_.audioBuffered(),a=this.sourceUpdater_.videoBuffered();n.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+zs(n).join(", ")),a.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+zs(a).join(", "));const o=n.length?n.start(0):0,l=n.length?n.end(n.length-1):0,u=a.length?a.start(0):0,c=a.length?a.end(a.length-1):0;if(l-o<=xn&&c-u<=xn){this.logger_(`On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ${i.byteLength}, audio buffer: ${zs(n).join(", ")}, video buffer: ${zs(a).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),this.trigger("error");return}this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:t,bytes:i}));const f=this.currentTime_()-xn;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${f}`),this.remove(0,f,()=>{this.logger_(`On QUOTA_EXCEEDED_ERR, retrying append in ${xn}s`),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=$.setTimeout(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()},xn*1e3)},!0)}handleAppendError_({segmentInfo:e,type:t,bytes:i},s){if(s){if(s.code===Yy){this.handleQuotaExceededError_({segmentInfo:e,type:t,bytes:i});return}this.logger_("Received non QUOTA_EXCEEDED_ERR on append",s),this.error({message:`${t} append of ${i.length}b failed for segment #${e.mediaIndex} in playlist ${e.playlist.id}`,metadata:{errorType:te.Error.StreamingFailedToAppendSegment}}),this.trigger("appenderror")}}appendToSourceBuffer_({segmentInfo:e,type:t,initSegment:i,data:s,bytes:n}){if(!n){const o=[s];let l=s.byteLength;i&&(o.unshift(i),l+=i.byteLength),n=wD({bytes:l,segments:o})}const a={segmentInfo:js({type:this.loaderType_,segment:e})};this.trigger({type:"segmentappendstart",metadata:a}),this.sourceUpdater_.appendBuffer({segmentInfo:e,type:t,bytes:n},this.handleAppendError_.bind(this,{segmentInfo:e,type:t,bytes:n}))}handleSegmentTimingInfo_(e,t,i){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const s=this.pendingSegment_.segment,n=`${e}TimingInfo`;s[n]||(s[n]={}),s[n].transmuxerPrependedSeconds=i.prependedContentDuration||0,s[n].transmuxedPresentationStart=i.start.presentation,s[n].transmuxedDecodeStart=i.start.decode,s[n].transmuxedPresentationEnd=i.end.presentation,s[n].transmuxedDecodeEnd=i.end.decode,s[n].baseMediaDecodeTime=i.baseMediaDecodeTime}appendData_(e,t){const{type:i,data:s}=t;if(!s||!s.byteLength||i==="audio"&&this.audioDisabled_)return;const n=this.getInitSegmentAndUpdateState_({type:i,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:i,initSegment:n,data:s})}loadSegment_(e){if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),typeof e.timestampOffset=="number"&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_()){bs(this),this.loadQueue_.push(()=>{const t=mt({},e,{forceTimestampOffset:!0});mt(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)});return}this.updateTransmuxerAndRequestSegment_(e)}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),i=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),s=this.mediaIndex!==null,n=e.timeline!==this.currentTimeline_&&e.timeline>0,a=i||s&&n;this.logger_(`Requesting
${vT(e.uri)}
${gr(e)}`),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=CD({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:a,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:o,level:l,stream:u})=>{this.logger_(`${gr(e)} logged from transmuxer stream ${u} as a ${l}: ${o}`)},triggerSegmentEventFn:({type:o,segment:l,keyInfo:u,trackInfo:c,timingInfo:h})=>{const p={segmentInfo:js({segment:l})};u&&(p.keyInfo=u),c&&(p.trackInfo=c),h&&(p.timingInfo=h),this.trigger({type:o,metadata:p})}})}trimBackBuffer_(e){const t=WD(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,i=e.part,s=e.segment.key||e.segment.map&&e.segment.map.key,n=e.segment.map&&!e.segment.map.bytes,a={resolvedUri:i?i.resolvedUri:t.resolvedUri,byterange:i?i.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part,type:this.loaderType_,start:e.startOfSegment,duration:e.duration,isEncrypted:s,isMediaInitialization:n},o=e.playlist.segments[e.mediaIndex-1];if(o&&o.timeline===t.timeline&&(o.videoTimingInfo?a.baseStartTime=o.videoTimingInfo.transmuxedDecodeEnd:o.audioTimingInfo&&(a.baseStartTime=o.audioTimingInfo.transmuxedDecodeEnd)),t.key){const l=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);a.key=this.segmentKey(t.key),a.key.iv=l}return t.map&&(a.map=this.initSegmentForMap(t.map)),a}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){if(this.pendingSegment_.byteLength=t.bytesReceived,e<Za){this.logger_(`Ignoring segment's bandwidth because its duration of ${e} is less than the min to record ${Za}`);return}const i={bandwidthInfo:{from:this.bandwidth,to:t.bandwidth}};this.trigger({type:"bandwidthupdated",metadata:i}),this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,i){if(this.callQueue_.length){this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,i));return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_||t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===Wi.ABORTED)return;if(this.pause(),e.code===Wi.TIMEOUT){this.handleTimeout_();return}this.mediaRequestsErrored+=1,this.error(e),this.trigger("error");return}const s=this.pendingSegment_;this.saveBandwidthRelatedStats_(s.duration,t.stats),s.endOfAllRequests=t.endOfAllRequests,i.gopInfo&&(this.gopBuffer_=VD(this.gopBuffer_,i.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(s)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);t!==null&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){typeof e.start=="number"&&typeof e.end=="number"?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return e===null?!1:this.loaderType_==="main"&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset()}trueSegmentStart_({currentStart:e,playlist:t,mediaIndex:i,firstVideoFrameTimeForData:s,currentVideoTimestampOffset:n,useVideoTimingInfo:a,videoTimingInfo:o,audioTimingInfo:l}){if(typeof e<"u")return e;if(!a)return l.start;const u=t.segments[i-1];return i===0||!u||typeof u.start>"u"||u.end!==s+n?s:o.start}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t){this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),this.trigger("error");return}const{hasAudio:i,hasVideo:s,isMuxed:n}=t,a=this.loaderType_==="main"&&s,o=!this.audioDisabled_&&i&&!n;if(e.waitingOnAppends=0,!e.hasAppendedData_){!e.timingInfo&&typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),this.checkAppendsDone_(e);return}a&&e.waitingOnAppends++,o&&e.waitingOnAppends++,a&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),o&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,e.waitingOnAppends===0&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=KD(this.loaderType_,this.getCurrentMediaInfo_(),e);return t?(this.error({message:t,playlistExclusionDuration:1/0}),this.trigger("error"),!0):!1}updateSourceBufferTimestampOffset_(e){if(e.timestampOffset===null||typeof e.timingInfo.start!="number"||e.changedTimestampOffset||this.loaderType_!=="main")return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:t,timingInfo:i}){return this.useDtsForTimestampOffset_?e&&typeof e.transmuxedDecodeStart=="number"?e.transmuxedDecodeStart:t&&typeof t.transmuxedDecodeStart=="number"?t.transmuxedDecodeStart:i.start:i.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),s=this.loaderType_==="main"&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;s&&(e.timingInfo.end=typeof s.end=="number"?s.end:s.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_){const l={segmentInfo:js({type:this.loaderType_,segment:this.pendingSegment_})};this.trigger({type:"appendsdone",metadata:l})}if(!this.pendingSegment_){this.state="READY",this.paused()||this.monitorBuffer_();return}const e=this.pendingSegment_;e.part&&e.part.syncInfo?e.part.syncInfo.markAppended():e.segment.syncInfo&&e.segment.syncInfo.markAppended(),this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:this.loaderType_==="main"});const t=JD(e,this.sourceType_);if(t&&(t.severity==="warn"?te.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_)){this.logger_(`Throwing away un-appended sync request ${gr(e)}`);return}this.logger_(`Appended ${gr(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),this.loaderType_==="main"&&!this.audioDisabled_&&this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const i=e.segment,s=e.part,n=i.end&&this.currentTime_()-i.end>e.playlist.targetDuration*3,a=s&&s.end&&this.currentTime_()-s.end>e.playlist.partTargetDuration*3;if(n||a){this.logger_(`bad ${n?"segment":"part"} ${gr(e)}`),this.resetEverything();return}this.mediaIndex!==null&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<Za){this.logger_(`Ignoring segment's throughput because its duration of ${e.duration} is less than the min to record ${Za}`);return}const t=this.throughput.rate,i=Date.now()-e.endOfAllRequests+1,s=Math.floor(e.byteLength/i*8*1e3);this.throughput.rate+=(s-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,i=t.start,s=t.end;if(!ug(i)||!ug(s))return;Dn(i,s,this.segmentMetadataTrack_);const n=$.WebKitDataCue||$.VTTCue,a={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,programDateTime:t.programDateTime,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:i,end:s},o=JSON.stringify(a),l=new n(i,s,o);l.value=a,this.segmentMetadataTrack_.addCue(l)}}function cs(){}const ST=function(r){return typeof r!="string"?r:r.replace(/./,e=>e.toUpperCase())},ZD=["video","audio"],Ac=(r,e)=>{const t=e[`${r}Buffer`];return t&&t.updating||e.queuePending[r]},eL=(r,e)=>{for(let t=0;t<e.length;t++){const i=e[t];if(i.type==="mediaSource")return null;if(i.type===r)return t}return null},Or=(r,e)=>{if(e.queue.length===0)return;let t=0,i=e.queue[t];if(i.type==="mediaSource"){!e.updating()&&e.mediaSource.readyState!=="closed"&&(e.queue.shift(),i.action(e),i.doneFn&&i.doneFn(),Or("audio",e),Or("video",e));return}if(r!=="mediaSource"&&!(!e.ready()||e.mediaSource.readyState==="closed"||Ac(r,e))){if(i.type!==r){if(t=eL(r,e.queue),t===null)return;i=e.queue[t]}if(e.queue.splice(t,1),e.queuePending[r]=i,i.action(r,e),!i.doneFn){e.queuePending[r]=null,Or(r,e);return}}},ET=(r,e)=>{const t=e[`${r}Buffer`],i=ST(r);t&&(t.removeEventListener("updateend",e[`on${i}UpdateEnd_`]),t.removeEventListener("error",e[`on${i}Error_`]),e.codecs[r]=null,e[`${r}Buffer`]=null)},Vi=(r,e)=>r&&e&&Array.prototype.indexOf.call(r.sourceBuffers,e)!==-1,Qt={appendBuffer:(r,e,t)=>(i,s)=>{const n=s[`${i}Buffer`];if(Vi(s.mediaSource,n)){s.logger_(`Appending segment ${e.mediaIndex}'s ${r.length} bytes to ${i}Buffer`);try{n.appendBuffer(r)}catch(a){s.logger_(`Error with code ${a.code} `+(a.code===Yy?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${e.mediaIndex} to ${i}Buffer`),s.queuePending[i]=null,t(a)}}},remove:(r,e)=>(t,i)=>{const s=i[`${t}Buffer`];if(Vi(i.mediaSource,s)){i.logger_(`Removing ${r} to ${e} from ${t}Buffer`);try{s.remove(r,e)}catch{i.logger_(`Remove ${r} to ${e} from ${t}Buffer failed`)}}},timestampOffset:r=>(e,t)=>{const i=t[`${e}Buffer`];Vi(t.mediaSource,i)&&(t.logger_(`Setting ${e}timestampOffset to ${r}`),i.timestampOffset=r)},callback:r=>(e,t)=>{r()},endOfStream:r=>e=>{if(e.mediaSource.readyState==="open"){e.logger_(`Calling mediaSource endOfStream(${r||""})`);try{e.mediaSource.endOfStream(r)}catch(t){te.log.warn("Failed to call media source endOfStream",t)}}},duration:r=>e=>{e.logger_(`Setting mediaSource duration to ${r}`);try{e.mediaSource.duration=r}catch(t){te.log.warn("Failed to set media source duration",t)}},abort:()=>(r,e)=>{if(e.mediaSource.readyState!=="open")return;const t=e[`${r}Buffer`];if(Vi(e.mediaSource,t)){e.logger_(`calling abort on ${r}Buffer`);try{t.abort()}catch(i){te.log.warn(`Failed to abort on ${r}Buffer`,i)}}},addSourceBuffer:(r,e)=>t=>{const i=ST(r),s=Nr(e);t.logger_(`Adding ${r}Buffer with codec ${e} to mediaSource`);const n=t.mediaSource.addSourceBuffer(s);n.addEventListener("updateend",t[`on${i}UpdateEnd_`]),n.addEventListener("error",t[`on${i}Error_`]),t.codecs[r]=e,t[`${r}Buffer`]=n},removeSourceBuffer:r=>e=>{const t=e[`${r}Buffer`];if(ET(r,e),!!Vi(e.mediaSource,t)){e.logger_(`Removing ${r}Buffer with codec ${e.codecs[r]} from mediaSource`);try{e.mediaSource.removeSourceBuffer(t)}catch(i){te.log.warn(`Failed to removeSourceBuffer ${r}Buffer`,i)}}},changeType:r=>(e,t)=>{const i=t[`${e}Buffer`],s=Nr(r);if(!Vi(t.mediaSource,i))return;const n=r.substring(0,r.indexOf(".")),a=t.codecs[e];if(a.substring(0,a.indexOf("."))===n)return;const l={codecsChangeInfo:{from:a,to:r}};t.trigger({type:"codecschange",metadata:l}),t.logger_(`changing ${e}Buffer codec from ${a} to ${r}`);try{i.changeType(s),t.codecs[e]=r}catch(u){l.errorType=te.Error.StreamingCodecsChangeError,l.error=u,u.metadata=l,t.error_=u,t.trigger("error"),te.log.warn(`Failed to changeType on ${e}Buffer`,u)}}},Jt=({type:r,sourceUpdater:e,action:t,doneFn:i,name:s})=>{e.queue.push({type:r,action:t,doneFn:i,name:s}),Or(r,e)},dg=(r,e)=>t=>{const i=e[`${r}Buffered`](),s=fI(i);if(e.logger_(`received "updateend" event for ${r} Source Buffer: `,s),e.queuePending[r]){const n=e.queuePending[r].doneFn;e.queuePending[r]=null,n&&n(e[`${r}Error_`])}Or(r,e)};class bT extends te.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>Or("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=Ti("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=dg("video",this),this.onAudioUpdateEnd_=dg("audio",this),this.onVideoError_=t=>{this.videoError_=t},this.onAudioError_=t=>{this.audioError_=t},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){Jt({type:"mediaSource",sourceUpdater:this,action:Qt.addSourceBuffer(e,t),name:"addSourceBuffer"})}abort(e){Jt({type:e,sourceUpdater:this,action:Qt.abort(e),name:"abort"})}removeSourceBuffer(e){if(!this.canRemoveSourceBuffer()){te.log.error("removeSourceBuffer is not supported!");return}Jt({type:"mediaSource",sourceUpdater:this,action:Qt.removeSourceBuffer(e),name:"removeSourceBuffer"})}canRemoveSourceBuffer(){return!te.browser.IS_FIREFOX&&$.MediaSource&&$.MediaSource.prototype&&typeof $.MediaSource.prototype.removeSourceBuffer=="function"}static canChangeType(){return $.SourceBuffer&&$.SourceBuffer.prototype&&typeof $.SourceBuffer.prototype.changeType=="function"}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){if(!this.canChangeType()){te.log.error("changeType is not supported!");return}Jt({type:e,sourceUpdater:this,action:Qt.changeType(t),name:"changeType"})}addOrChangeSourceBuffers(e){if(!e||typeof e!="object"||Object.keys(e).length===0)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(t=>{const i=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,i);this.canChangeType()&&this.changeType(t,i)})}appendBuffer(e,t){const{segmentInfo:i,type:s,bytes:n}=e;if(this.processedAppend_=!0,s==="audio"&&this.videoBuffer&&!this.videoAppendQueued_){this.delayedAudioAppendQueue_.push([e,t]),this.logger_(`delayed audio append of ${n.length} until video append`);return}const a=t;if(Jt({type:s,sourceUpdater:this,action:Qt.appendBuffer(n,i||{mediaIndex:-1},a),doneFn:t,name:"appendBuffer"}),s==="video"){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const o=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${o.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,o.forEach(l=>{this.appendBuffer.apply(this,l)})}}audioBuffered(){return Vi(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:At()}videoBuffered(){return Vi(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:At()}buffered(){const e=Vi(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=Vi(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():gI(this.audioBuffered(),this.videoBuffered())}setDuration(e,t=cs){Jt({type:"mediaSource",sourceUpdater:this,action:Qt.duration(e),name:"duration",doneFn:t})}endOfStream(e=null,t=cs){typeof e!="string"&&(e=void 0),Jt({type:"mediaSource",sourceUpdater:this,action:Qt.endOfStream(e),name:"endOfStream",doneFn:t})}removeAudio(e,t,i=cs){if(!this.audioBuffered().length||this.audioBuffered().end(0)===0){i();return}Jt({type:"audio",sourceUpdater:this,action:Qt.remove(e,t),doneFn:i,name:"remove"})}removeVideo(e,t,i=cs){if(!this.videoBuffered().length||this.videoBuffered().end(0)===0){i();return}Jt({type:"video",sourceUpdater:this,action:Qt.remove(e,t),doneFn:i,name:"remove"})}updating(){return!!(Ac("audio",this)||Ac("video",this))}audioTimestampOffset(e){return typeof e<"u"&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(Jt({type:"audio",sourceUpdater:this,action:Qt.timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return typeof e<"u"&&this.videoBuffer&&this.videoTimestampOffset_!==e&&(Jt({type:"video",sourceUpdater:this,action:Qt.timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&Jt({type:"audio",sourceUpdater:this,action:Qt.callback(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&Jt({type:"video",sourceUpdater:this,action:Qt.callback(e),name:"callback"})}dispose(){this.trigger("dispose"),ZD.forEach(e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`](()=>ET(e,this))}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const fg=r=>decodeURIComponent(escape(String.fromCharCode.apply(null,r))),tL=r=>{const e=new Uint8Array(r);return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")},pg=new Uint8Array(`

`.split("").map(r=>r.charCodeAt(0)));class iL extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class sL extends xc{constructor(e,t={}){super(e,t),this.mediaSource_=null,this.subtitlesTrack_=null,this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return At();const e=this.subtitlesTrack_.cues,t=e[0].startTime,i=e[e.length-1].startTime;return At([[t,i]])}initSegmentForMap(e,t=!1){if(!e)return null;const i=Vo(e);let s=this.initSegments_[i];if(t&&!s&&e.bytes){const n=pg.byteLength+e.bytes.byteLength,a=new Uint8Array(n);a.set(e.bytes),a.set(pg,e.bytes.byteLength),this.initSegments_[i]=s={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:a}}return s||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return typeof e>"u"?this.subtitlesTrack_:(this.subtitlesTrack_=e,this.state==="INIT"&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}remove(e,t){Dn(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(this.syncController_.timestampOffsetForTimeline(e.timeline)===null){const t=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};this.syncController_.one("timestampoffset",t),this.state="WAITING_ON_TIMELINE";return}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,i){if(!this.subtitlesTrack_){this.state="READY";return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_){this.state="READY",this.mediaRequestsAborted+=1;return}if(e){e.code===Wi.TIMEOUT&&this.handleTimeout_(),e.code===Wi.ABORTED?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,this.stopForError(e);return}const s=this.pendingSegment_,n=i.mp4VttCues&&i.mp4VttCues.length;n&&(s.mp4VttCues=i.mp4VttCues),this.saveBandwidthRelatedStats_(s.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const a=s.segment;if(a.map&&(a.map.bytes=t.map.bytes),s.bytes=t.bytes,typeof $.WebVTT!="function"&&typeof this.loadVttJs=="function"){this.state="WAITING_ON_VTTJS",this.loadVttJs().then(()=>this.segmentRequestFinished_(e,t,i),()=>this.stopForError({message:"Error loading vtt.js"}));return}a.requested=!0;try{this.parseVTTCues_(s)}catch(o){this.stopForError({message:o.message,metadata:{errorType:te.Error.StreamingVttParserError,error:o}});return}if(n||this.updateTimeMapping_(s,this.syncController_.timelines[s.timeline],this.playlist_),s.cues.length?s.timingInfo={start:s.cues[0].startTime,end:s.cues[s.cues.length-1].endTime}:s.timingInfo={start:s.startOfSegment,end:s.startOfSegment+s.duration},s.isSyncRequest){this.trigger("syncinfoupdate"),this.pendingSegment_=null,this.state="READY";return}s.byteLength=s.bytes.byteLength,this.mediaSecondsLoaded+=a.duration,s.cues.forEach(o=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new $.VTTCue(o.startTime,o.endTime,o.text):o)}),UD(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(e,t){const i=e&&e.type==="vtt",s=t&&t.type==="text";i&&s&&super.handleData_(e,t)}updateTimingInfoEnd_(){}parseMp4VttCues_(e){const t=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();e.mp4VttCues.forEach(i=>{const s=i.start+t,n=i.end+t,a=new $.VTTCue(s,n,i.cueText);i.settings&&i.settings.split(" ").forEach(o=>{const l=o.split(":"),u=l[0],c=l[1];a[u]=isNaN(c)?c:Number(c)}),e.cues.push(a)})}parseVTTCues_(e){let t,i=!1;if(typeof $.WebVTT!="function")throw new iL;if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},e.mp4VttCues){this.parseMp4VttCues_(e);return}typeof $.TextDecoder=="function"?t=new $.TextDecoder("utf8"):(t=$.WebVTT.StringDecoder(),i=!0);const s=new $.WebVTT.Parser($,$.vttjs,t);if(s.oncue=e.cues.push.bind(e.cues),s.ontimestampmap=a=>{e.timestampmap=a},s.onparsingerror=a=>{te.log.warn("Error encountered when parsing cues: "+a.message)},e.segment.map){let a=e.segment.map.bytes;i&&(a=fg(a)),s.parse(a)}let n=e.bytes;i&&(n=fg(n)),s.parse(n),s.flush()}updateTimeMapping_(e,t,i){const s=e.segment;if(!t)return;if(!e.cues.length){s.empty=!0;return}const{MPEGTS:n,LOCAL:a}=e.timestampmap,l=n/Ws.ONE_SECOND_IN_TS-a+t.mapping;if(e.cues.forEach(u=>{const c=u.endTime-u.startTime,h=this.handleRollover_(u.startTime+l,t.time);u.startTime=Math.max(h,0),u.endTime=Math.max(h+c,0)}),!i.syncInfo){const u=e.cues[0].startTime,c=e.cues[e.cues.length-1].startTime;i.syncInfo={mediaSequence:i.mediaSequence+e.mediaIndex,time:Math.min(u,c-s.duration)}}}handleRollover_(e,t){if(t===null)return e;let i=e*Ws.ONE_SECOND_IN_TS;const s=t*Ws.ONE_SECOND_IN_TS;let n;for(s<i?n=-8589934592:n=8589934592;Math.abs(i-s)>4294967296;)i+=n;return i/Ws.ONE_SECOND_IN_TS}}const rL=function(r,e){const t=r.cues;for(let i=0;i<t.length;i++){const s=t[i];if(e>=s.adStartTime&&e<=s.adEndTime)return s}return null},nL=function(r,e,t=0){if(!r.segments)return;let i=t,s;for(let n=0;n<r.segments.length;n++){const a=r.segments[n];if(s||(s=rL(e,i+a.duration/2)),s){if("cueIn"in a){s.endTime=i,s.adEndTime=i,i+=a.duration,s=null;continue}if(i<s.endTime){i+=a.duration;continue}s.endTime+=a.duration}else if("cueOut"in a&&(s=new $.VTTCue(i,i+a.duration,a.cueOut),s.adStartTime=i,s.adEndTime=i+parseFloat(a.cueOut),e.addCue(s)),"cueOutCont"in a){const[o,l]=a.cueOutCont.split("/").map(parseFloat);s=new $.VTTCue(i,i+a.duration,""),s.adStartTime=i-o,s.adEndTime=s.adStartTime+l,e.addCue(s)}i+=a.duration}};class gg{constructor({start:e,end:t,segmentIndex:i,partIndex:s=null,appended:n=!1}){this.start_=e,this.end_=t,this.segmentIndex_=i,this.partIndex_=s,this.appended_=n}isInRange(e){return e>=this.start&&e<this.end}markAppended(){this.appended_=!0}resetAppendedStatus(){this.appended_=!1}get isAppended(){return this.appended_}get start(){return this.start_}get end(){return this.end_}get segmentIndex(){return this.segmentIndex_}get partIndex(){return this.partIndex_}}class aL{constructor(e,t=[]){this.segmentSyncInfo_=e,this.partsSyncInfo_=t}get segmentSyncInfo(){return this.segmentSyncInfo_}get partsSyncInfo(){return this.partsSyncInfo_}get hasPartsSyncInfo(){return this.partsSyncInfo_.length>0}resetAppendStatus(){this.segmentSyncInfo_.resetAppendedStatus(),this.partsSyncInfo_.forEach(e=>e.resetAppendedStatus())}}class xT{constructor(){this.storage_=new Map,this.diagnostics_="",this.isReliable_=!1,this.start_=-1/0,this.end_=1/0}get start(){return this.start_}get end(){return this.end_}get diagnostics(){return this.diagnostics_}get isReliable(){return this.isReliable_}resetAppendedStatus(){this.storage_.forEach(e=>e.resetAppendStatus())}update(e,t){const{mediaSequence:i,segments:s}=e;if(this.isReliable_=this.isReliablePlaylist_(i,s),!!this.isReliable_)return this.updateStorage_(s,i,this.calculateBaseTime_(i,s,t))}getSyncInfoForTime(e){for(const{segmentSyncInfo:t,partsSyncInfo:i}of this.storage_.values())if(i.length){for(const s of i)if(s.isInRange(e))return s}else if(t.isInRange(e))return t;return null}getSyncInfoForMediaSequence(e){return this.storage_.get(e)}updateStorage_(e,t,i){const s=new Map;let n=`
`,a=i,o=t;this.start_=a,e.forEach((l,u)=>{const c=this.storage_.get(o),h=a,f=h+l.duration,p=!!(c&&c.segmentSyncInfo&&c.segmentSyncInfo.isAppended),m=new gg({start:h,end:f,appended:p,segmentIndex:u});l.syncInfo=m;let y=a;const v=(l.parts||[]).map((E,A)=>{const x=y,w=y+E.duration,k=!!(c&&c.partsSyncInfo&&c.partsSyncInfo[A]&&c.partsSyncInfo[A].isAppended),F=new gg({start:x,end:w,appended:k,segmentIndex:u,partIndex:A});return y=w,n+=`Media Sequence: ${o}.${A} | Range: ${x} --> ${w} | Appended: ${k}
`,E.syncInfo=F,F});s.set(o,new aL(m,v)),n+=`${vT(l.resolvedUri)} | Media Sequence: ${o} | Range: ${h} --> ${f} | Appended: ${p}
`,o++,a=f}),this.end_=a,this.storage_=s,this.diagnostics_=n}calculateBaseTime_(e,t,i){if(!this.storage_.size)return 0;if(this.storage_.has(e))return this.storage_.get(e).segmentSyncInfo.start;const s=Math.min(...this.storage_.keys());if(e<s){const n=s-e;let a=this.storage_.get(s).segmentSyncInfo.start;for(let o=0;o<n;o++){const l=t[o];a-=l.duration}return a}return i}isReliablePlaylist_(e,t){return e!=null&&Array.isArray(t)&&t.length}}class mg extends xT{constructor(e){super(),this.parent_=e}calculateBaseTime_(e,t,i){if(!this.storage_.size){const s=this.parent_.getSyncInfoForMediaSequence(e);return s?s.segmentSyncInfo.start:0}return super.calculateBaseTime_(e,t,i)}}const oL=86400,Pu=[{name:"VOD",run:(r,e,t,i,s)=>t!==1/0?{time:0,segmentIndex:0,partIndex:null}:null},{name:"MediaSequence",run:(r,e,t,i,s,n)=>{const a=r.getMediaSequenceSync(n);if(!a||!a.isReliable)return null;const o=a.getSyncInfoForTime(s);return o?{time:o.start,partIndex:o.partIndex,segmentIndex:o.segmentIndex}:null}},{name:"ProgramDateTime",run:(r,e,t,i,s)=>{if(!Object.keys(r.timelineToDatetimeMappings).length)return null;let n=null,a=null;const o=gc(e);s=s||0;for(let l=0;l<o.length;l++){const u=e.endList||s===0?l:o.length-(l+1),c=o[u],h=c.segment,f=r.timelineToDatetimeMappings[h.timeline];if(!f||!h.dateTimeObject)continue;let m=h.dateTimeObject.getTime()/1e3+f;if(h.parts&&typeof c.partIndex=="number")for(let v=0;v<c.partIndex;v++)m+=h.parts[v].duration;const y=Math.abs(s-m);if(a!==null&&(y===0||a<y))break;a=y,n={time:m,segmentIndex:c.segmentIndex,partIndex:c.partIndex}}return n}},{name:"Segment",run:(r,e,t,i,s)=>{let n=null,a=null;s=s||0;const o=gc(e);for(let l=0;l<o.length;l++){const u=e.endList||s===0?l:o.length-(l+1),c=o[u],h=c.segment,f=c.part&&c.part.start||h&&h.start;if(h.timeline===i&&typeof f<"u"){const p=Math.abs(s-f);if(a!==null&&a<p)break;(!n||a===null||a>=p)&&(a=p,n={time:f,segmentIndex:c.segmentIndex,partIndex:c.partIndex})}}return n}},{name:"Discontinuity",run:(r,e,t,i,s)=>{let n=null;if(s=s||0,e.discontinuityStarts&&e.discontinuityStarts.length){let a=null;for(let o=0;o<e.discontinuityStarts.length;o++){const l=e.discontinuityStarts[o],u=e.discontinuitySequence+o+1,c=r.discontinuities[u];if(c){const h=Math.abs(s-c.time);if(a!==null&&a<h)break;(!n||a===null||a>=h)&&(a=h,n={time:c.time,segmentIndex:l,partIndex:null})}}}return n}},{name:"Playlist",run:(r,e,t,i,s)=>e.syncInfo?{time:e.syncInfo.time,segmentIndex:e.syncInfo.mediaSequence-e.mediaSequence,partIndex:null}:null}];class lL extends te.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={};const t=new xT,i=new mg(t),s=new mg(t);this.mediaSequenceStorage_={main:t,audio:i,vtt:s},this.logger_=Ti("SyncController")}getMediaSequenceSync(e){return this.mediaSequenceStorage_[e]||null}getSyncPoint(e,t,i,s,n){if(t!==1/0)return Pu.find(({name:l})=>l==="VOD").run(this,e,t);const a=this.runStrategies_(e,t,i,s,n);if(!a.length)return null;for(const o of a){const{syncPoint:l,strategy:u}=o,{segmentIndex:c,time:h}=l;if(c<0)continue;const f=e.segments[c],p=h,m=p+f.duration;if(this.logger_(`Strategy: ${u}. Current time: ${s}. selected segment: ${c}. Time: [${p} -> ${m}]}`),s>=p&&s<m)return this.logger_("Found sync point with exact match: ",l),l}return this.selectSyncPoint_(a,{key:"time",value:s})}getExpiredTime(e,t){if(!e||!e.segments)return null;const i=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!i.length)return null;const s=this.selectSyncPoint_(i,{key:"segmentIndex",value:0});return s.segmentIndex>0&&(s.time*=-1),Math.abs(s.time+Fn({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:s.segmentIndex,endIndex:0}))}runStrategies_(e,t,i,s,n){const a=[];for(let o=0;o<Pu.length;o++){const l=Pu[o],u=l.run(this,e,t,i,s,n);u&&(u.strategy=l.name,a.push({strategy:l.name,syncPoint:u}))}return a}selectSyncPoint_(e,t){let i=e[0].syncPoint,s=Math.abs(e[0].syncPoint[t.key]-t.value),n=e[0].strategy;for(let a=1;a<e.length;a++){const o=Math.abs(e[a].syncPoint[t.key]-t.value);o<s&&(s=o,i=e[a].syncPoint,n=e[a].strategy)}return this.logger_(`syncPoint for [${t.key}: ${t.value}] chosen with strategy [${n}]: [time:${i.time}, segmentIndex:${i.segmentIndex}`+(typeof i.partIndex=="number"?`,partIndex:${i.partIndex}`:"")+"]"),i}saveExpiredSegmentInfo(e,t){const i=t.mediaSequence-e.mediaSequence;if(i>oL){te.log.warn(`Not saving expired segment info. Media sequence gap ${i} is too large.`);return}for(let s=i-1;s>=0;s--){const n=e.segments[s];if(n&&typeof n.start<"u"){t.syncInfo={mediaSequence:e.mediaSequence+s,time:n.start},this.logger_(`playlist refresh sync: [time:${t.syncInfo.time}, mediaSequence: ${t.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],i=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-i}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:t}){const i=this.calculateSegmentTimeMapping_(e,e.timingInfo,t),s=e.segment;i&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:s.start}));const n=s.dateTimeObject;s.discontinuity&&t&&n&&(this.timelineToDatetimeMappings[s.timeline]=-(n.getTime()/1e3))}timestampOffsetForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].time}mappingForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,i){const s=e.segment,n=e.part;let a=this.timelines[e.timeline],o,l;if(typeof e.timestampOffset=="number")a={time:e.startOfSegment,mapping:e.startOfSegment-t.start},i&&(this.timelines[e.timeline]=a,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: [time: ${a.time}] [mapping: ${a.mapping}]`)),o=e.startOfSegment,l=t.end+a.mapping;else if(a)o=t.start+a.mapping,l=t.end+a.mapping;else return!1;return n&&(n.start=o,n.end=l),(!s.start||o<s.start)&&(s.start=o),s.end=l,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,i=e.segment;if(i.discontinuity)this.discontinuities[i.timeline]={time:i.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let s=0;s<t.discontinuityStarts.length;s++){const n=t.discontinuityStarts[s],a=t.discontinuitySequence+s+1,o=n-e.mediaIndex,l=Math.abs(o);if(!this.discontinuities[a]||this.discontinuities[a].accuracy>l){let u;o<0?u=i.start-Fn({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:n}):u=i.end+Fn({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:n}),this.discontinuities[a]={time:u,accuracy:l}}}}dispose(){this.trigger("dispose"),this.off()}}class uL extends te.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:t,to:i}){return typeof t=="number"&&typeof i=="number"&&(this.pendingTimelineChanges_[e]={type:e,from:t,to:i},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:t,to:i}){if(typeof t=="number"&&typeof i=="number"){this.lastTimelineChanges_[e]={type:e,from:t,to:i},delete this.pendingTimelineChanges_[e];const s={timelineChangeInfo:{from:t,to:i}};this.trigger({type:"timelinechange",metadata:s})}return this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const cL=uT(cT(function(){var r=(function(){function y(){this.listeners={}}var v=y.prototype;return v.on=function(A,x){this.listeners[A]||(this.listeners[A]=[]),this.listeners[A].push(x)},v.off=function(A,x){if(!this.listeners[A])return!1;var w=this.listeners[A].indexOf(x);return this.listeners[A]=this.listeners[A].slice(0),this.listeners[A].splice(w,1),w>-1},v.trigger=function(A){var x=this.listeners[A];if(x)if(arguments.length===2)for(var w=x.length,k=0;k<w;++k)x[k].call(this,arguments[1]);else for(var F=Array.prototype.slice.call(arguments,1),L=x.length,M=0;M<L;++M)x[M].apply(this,F)},v.dispose=function(){this.listeners={}},v.pipe=function(A){this.on("data",function(x){A.push(x)})},y})();function e(y){return y.subarray(0,y.byteLength-y[y.byteLength-1])}const t=function(){const y=[[[],[],[],[],[]],[[],[],[],[],[]]],v=y[0],E=y[1],A=v[4],x=E[4];let w,k,F;const L=[],M=[];let C,D,B,H,q,Y;for(w=0;w<256;w++)M[(L[w]=w<<1^(w>>7)*283)^w]=w;for(k=F=0;!A[k];k^=C||1,F=M[F]||1)for(H=F^F<<1^F<<2^F<<3^F<<4,H=H>>8^H&255^99,A[k]=H,x[H]=k,B=L[D=L[C=L[k]]],Y=B*16843009^D*65537^C*257^k*16843008,q=L[H]*257^H*16843008,w=0;w<4;w++)v[w][k]=q=q<<24^q>>>8,E[w][H]=Y=Y<<24^Y>>>8;for(w=0;w<5;w++)v[w]=v[w].slice(0),E[w]=E[w].slice(0);return y};let i=null;class s{constructor(v){i||(i=t()),this._tables=[[i[0][0].slice(),i[0][1].slice(),i[0][2].slice(),i[0][3].slice(),i[0][4].slice()],[i[1][0].slice(),i[1][1].slice(),i[1][2].slice(),i[1][3].slice(),i[1][4].slice()]];let E,A,x;const w=this._tables[0][4],k=this._tables[1],F=v.length;let L=1;if(F!==4&&F!==6&&F!==8)throw new Error("Invalid aes key size");const M=v.slice(0),C=[];for(this._key=[M,C],E=F;E<4*F+28;E++)x=M[E-1],(E%F===0||F===8&&E%F===4)&&(x=w[x>>>24]<<24^w[x>>16&255]<<16^w[x>>8&255]<<8^w[x&255],E%F===0&&(x=x<<8^x>>>24^L<<24,L=L<<1^(L>>7)*283)),M[E]=M[E-F]^x;for(A=0;E;A++,E--)x=M[A&3?E:E-4],E<=4||A<4?C[A]=x:C[A]=k[0][w[x>>>24]]^k[1][w[x>>16&255]]^k[2][w[x>>8&255]]^k[3][w[x&255]]}decrypt(v,E,A,x,w,k){const F=this._key[1];let L=v^F[0],M=x^F[1],C=A^F[2],D=E^F[3],B,H,q;const Y=F.length/4-2;let Z,Q=4;const K=this._tables[1],z=K[0],X=K[1],ie=K[2],W=K[3],ae=K[4];for(Z=0;Z<Y;Z++)B=z[L>>>24]^X[M>>16&255]^ie[C>>8&255]^W[D&255]^F[Q],H=z[M>>>24]^X[C>>16&255]^ie[D>>8&255]^W[L&255]^F[Q+1],q=z[C>>>24]^X[D>>16&255]^ie[L>>8&255]^W[M&255]^F[Q+2],D=z[D>>>24]^X[L>>16&255]^ie[M>>8&255]^W[C&255]^F[Q+3],Q+=4,L=B,M=H,C=q;for(Z=0;Z<4;Z++)w[(3&-Z)+k]=ae[L>>>24]<<24^ae[M>>16&255]<<16^ae[C>>8&255]<<8^ae[D&255]^F[Q++],B=L,L=M,M=C,C=D,D=B}}class n extends r{constructor(){super(r),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(v){this.jobs.push(v),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const a=function(y){return y<<24|(y&65280)<<8|(y&16711680)>>8|y>>>24},o=function(y,v,E){const A=new Int32Array(y.buffer,y.byteOffset,y.byteLength>>2),x=new s(Array.prototype.slice.call(v)),w=new Uint8Array(y.byteLength),k=new Int32Array(w.buffer);let F,L,M,C,D,B,H,q,Y;for(F=E[0],L=E[1],M=E[2],C=E[3],Y=0;Y<A.length;Y+=4)D=a(A[Y]),B=a(A[Y+1]),H=a(A[Y+2]),q=a(A[Y+3]),x.decrypt(D,B,H,q,k,Y),k[Y]=a(k[Y]^F),k[Y+1]=a(k[Y+1]^L),k[Y+2]=a(k[Y+2]^M),k[Y+3]=a(k[Y+3]^C),F=D,L=B,M=H,C=q;return w};class l{constructor(v,E,A,x){const w=l.STEP,k=new Int32Array(v.buffer),F=new Uint8Array(v.byteLength);let L=0;for(this.asyncStream_=new n,this.asyncStream_.push(this.decryptChunk_(k.subarray(L,L+w),E,A,F)),L=w;L<k.length;L+=w)A=new Uint32Array([a(k[L-4]),a(k[L-3]),a(k[L-2]),a(k[L-1])]),this.asyncStream_.push(this.decryptChunk_(k.subarray(L,L+w),E,A,F));this.asyncStream_.push(function(){x(null,e(F))})}static get STEP(){return 32e3}decryptChunk_(v,E,A,x){return function(){const w=o(v,E,A);x.set(w,v.byteOffset)}}}var u=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c;typeof window<"u"?c=window:typeof u<"u"?c=u:typeof self<"u"?c=self:c={};var h=c,f=function(v){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(v):v&&v.buffer instanceof ArrayBuffer},p=h.BigInt||Number;p("0x1"),p("0x100"),p("0x10000"),p("0x1000000"),p("0x100000000"),p("0x10000000000"),p("0x1000000000000"),p("0x100000000000000"),p("0x10000000000000000"),(function(){var y=new Uint16Array([65484]),v=new Uint8Array(y.buffer,y.byteOffset,y.byteLength);return v[0]===255?"big":v[0]===204?"little":"unknown"})();const m=function(y){const v={};return Object.keys(y).forEach(E=>{const A=y[E];f(A)?v[E]={bytes:A.buffer,byteOffset:A.byteOffset,byteLength:A.byteLength}:v[E]=A}),v};self.onmessage=function(y){const v=y.data,E=new Uint8Array(v.encrypted.bytes,v.encrypted.byteOffset,v.encrypted.byteLength),A=new Uint32Array(v.key.bytes,v.key.byteOffset,v.key.byteLength/4),x=new Uint32Array(v.iv.bytes,v.iv.byteOffset,v.iv.byteLength/4);new l(E,A,x,function(w,k){self.postMessage(m({source:v.source,decrypted:k}),[k.buffer])})}}));var hL=lT(cL);const dL=r=>{let e=r.default?"main":"alternative";return r.characteristics&&r.characteristics.indexOf("public.accessibility.describes-video")>=0&&(e="main-desc"),e},AT=(r,e)=>{r.abort(),r.pause(),e&&e.activePlaylistLoader&&(e.activePlaylistLoader.pause(),e.activePlaylistLoader=null)},Cc=(r,e)=>{e.activePlaylistLoader=r,r.load()},fL=(r,e)=>()=>{const{segmentLoaders:{[r]:t,main:i},mediaTypes:{[r]:s}}=e,n=s.activeTrack(),a=s.getActiveGroup(),o=s.activePlaylistLoader,l=s.lastGroup_;if(!(a&&l&&a.id===l.id)&&(s.lastGroup_=a,s.lastTrack_=n,AT(t,s),!(!a||a.isMainPlaylist))){if(!a.playlistLoader){o&&i.resetEverything();return}t.resyncLoader(),Cc(a.playlistLoader,s)}},pL=(r,e)=>()=>{const{segmentLoaders:{[r]:t},mediaTypes:{[r]:i}}=e;i.lastGroup_=null,t.abort(),t.pause()},gL=(r,e)=>()=>{const{mainPlaylistLoader:t,segmentLoaders:{[r]:i,main:s},mediaTypes:{[r]:n}}=e,a=n.activeTrack(),o=n.getActiveGroup(),l=n.activePlaylistLoader,u=n.lastTrack_;if(!(u&&a&&u.id===a.id)&&(n.lastGroup_=o,n.lastTrack_=a,AT(i,n),!!o)){if(o.isMainPlaylist){if(!a||!u||a.id===u.id)return;const c=e.vhs.playlistController_,h=c.selectPlaylist();if(c.media()===h)return;n.logger_(`track change. Switching main audio from ${u.id} to ${a.id}`),t.pause(),s.resetEverything(),c.fastQualityChange_(h);return}if(r==="AUDIO"){if(!o.playlistLoader){s.setAudio(!0),s.resetEverything();return}i.setAudio(!0),s.setAudio(!1)}if(l===o.playlistLoader){Cc(o.playlistLoader,n);return}i.track&&i.track(a),i.resetEverything(),Cc(o.playlistLoader,n)}},Go={AUDIO:(r,e)=>()=>{const{mediaTypes:{[r]:t},excludePlaylist:i}=e,s=t.activeTrack(),n=t.activeGroup(),a=(n.filter(l=>l.default)[0]||n[0]).id,o=t.tracks[a];if(s===o){i({error:{message:"Problem encountered loading the default audio track."}});return}te.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const l in t.tracks)t.tracks[l].enabled=t.tracks[l]===o;t.onTrackChanged()},SUBTITLES:(r,e)=>()=>{const{mediaTypes:{[r]:t}}=e;te.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");const i=t.activeTrack();i&&(i.mode="disabled"),t.onTrackChanged()}},yg={AUDIO:(r,e,t)=>{if(!e)return;const{tech:i,requestOptions:s,segmentLoaders:{[r]:n}}=t;e.on("loadedmetadata",()=>{const a=e.media();n.playlist(a,s),(!i.paused()||a.endList&&i.preload()!=="none")&&n.load()}),e.on("loadedplaylist",()=>{n.playlist(e.media(),s),i.paused()||n.load()}),e.on("error",Go[r](r,t))},SUBTITLES:(r,e,t)=>{const{tech:i,requestOptions:s,segmentLoaders:{[r]:n},mediaTypes:{[r]:a}}=t;e.on("loadedmetadata",()=>{const o=e.media();n.playlist(o,s),n.track(a.activeTrack()),(!i.paused()||o.endList&&i.preload()!=="none")&&n.load()}),e.on("loadedplaylist",()=>{n.playlist(e.media(),s),i.paused()||n.load()}),e.on("error",Go[r](r,t))}},mL={AUDIO:(r,e)=>{const{vhs:t,sourceType:i,segmentLoaders:{[r]:s},requestOptions:n,main:{mediaGroups:a},mediaTypes:{[r]:{groups:o,tracks:l,logger_:u}},mainPlaylistLoader:c}=e,h=ia(c.main);(!a[r]||Object.keys(a[r]).length===0)&&(a[r]={main:{default:{default:!0}}},h&&(a[r].main.default.playlists=c.main.playlists));for(const f in a[r]){o[f]||(o[f]=[]);for(const p in a[r][f]){let m=a[r][f][p],y;if(h?(u(`AUDIO group '${f}' label '${p}' is a main playlist`),m.isMainPlaylist=!0,y=null):i==="vhs-json"&&m.playlists?y=new vr(m.playlists[0],t,n):m.resolvedUri?y=new vr(m.resolvedUri,t,n):m.playlists&&i==="dash"?y=new Sc(m.playlists[0],t,n,c):y=null,m=$e({id:p,playlistLoader:y},m),yg[r](r,m.playlistLoader,e),o[f].push(m),typeof l[p]>"u"){const v=new te.AudioTrack({id:p,kind:dL(m),enabled:!1,language:m.language,default:m.default,label:p});l[p]=v}}}s.on("error",Go[r](r,e))},SUBTITLES:(r,e)=>{const{tech:t,vhs:i,sourceType:s,segmentLoaders:{[r]:n},requestOptions:a,main:{mediaGroups:o},mediaTypes:{[r]:{groups:l,tracks:u}},mainPlaylistLoader:c}=e;for(const h in o[r]){l[h]||(l[h]=[]);for(const f in o[r][h]){if(!i.options_.useForcedSubtitles&&o[r][h][f].forced)continue;let p=o[r][h][f],m;if(s==="hls")m=new vr(p.resolvedUri,i,a);else if(s==="dash"){if(!p.playlists.filter(v=>v.excludeUntil!==1/0).length)return;m=new Sc(p.playlists[0],i,a,c)}else s==="vhs-json"&&(m=new vr(p.playlists?p.playlists[0]:p.resolvedUri,i,a));if(p=$e({id:f,playlistLoader:m},p),yg[r](r,p.playlistLoader,e),l[h].push(p),typeof u[f]>"u"){const y=t.addRemoteTextTrack({id:f,kind:"subtitles",default:p.default&&p.autoselect,language:p.language,label:f},!1).track;u[f]=y}}}n.on("error",Go[r](r,e))},"CLOSED-CAPTIONS":(r,e)=>{const{tech:t,main:{mediaGroups:i},mediaTypes:{[r]:{groups:s,tracks:n}}}=e;for(const a in i[r]){s[a]||(s[a]=[]);for(const o in i[r][a]){const l=i[r][a][o];if(!/^(?:CC|SERVICE)/.test(l.instreamId))continue;const u=t.options_.vhs&&t.options_.vhs.captionServices||{};let c={label:o,language:l.language,instreamId:l.instreamId,default:l.default&&l.autoselect};if(u[c.instreamId]&&(c=$e(c,u[c.instreamId])),c.default===void 0&&delete c.default,s[a].push($e({id:o},l)),typeof n[o]>"u"){const h=t.addRemoteTextTrack({id:c.instreamId,kind:"captions",default:c.default,language:c.language,label:c.label},!1).track;n[o]=h}}}}},CT=(r,e)=>{for(let t=0;t<r.length;t++)if(kh(e,r[t])||r[t].playlists&&CT(r[t].playlists,e))return!0;return!1},yL=(r,e)=>t=>{const{mainPlaylistLoader:i,mediaTypes:{[r]:{groups:s}}}=e,n=i.media();if(!n)return null;let a=null;n.attributes[r]&&(a=s[n.attributes[r]]);const o=Object.keys(s);if(!a)if(r==="AUDIO"&&o.length>1&&ia(e.main))for(let l=0;l<o.length;l++){const u=s[o[l]];if(CT(u,n)){a=u;break}}else s.main?a=s.main:o.length===1&&(a=s[o[0]]);return typeof t>"u"?a:t===null||!a?null:a.filter(l=>l.id===t.id)[0]||null},TL={AUDIO:(r,e)=>()=>{const{mediaTypes:{[r]:{tracks:t}}}=e;for(const i in t)if(t[i].enabled)return t[i];return null},SUBTITLES:(r,e)=>()=>{const{mediaTypes:{[r]:{tracks:t}}}=e;for(const i in t)if(t[i].mode==="showing"||t[i].mode==="hidden")return t[i];return null}},_L=(r,{mediaTypes:e})=>()=>{const t=e[r].activeTrack();return t?e[r].activeGroup(t):null},vL=r=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(u=>{mL[u](u,r)});const{mediaTypes:e,mainPlaylistLoader:t,tech:i,vhs:s,segmentLoaders:{["AUDIO"]:n,main:a}}=r;["AUDIO","SUBTITLES"].forEach(u=>{e[u].activeGroup=yL(u,r),e[u].activeTrack=TL[u](u,r),e[u].onGroupChanged=fL(u,r),e[u].onGroupChanging=pL(u,r),e[u].onTrackChanged=gL(u,r),e[u].getActiveGroup=_L(u,r)});const o=e.AUDIO.activeGroup();if(o){const u=(o.filter(h=>h.default)[0]||o[0]).id;e.AUDIO.tracks[u].enabled=!0,e.AUDIO.onGroupChanged(),e.AUDIO.onTrackChanged(),e.AUDIO.getActiveGroup().playlistLoader?(a.setAudio(!1),n.setAudio(!0)):a.setAudio(!0)}t.on("mediachange",()=>{["AUDIO","SUBTITLES"].forEach(u=>e[u].onGroupChanged())}),t.on("mediachanging",()=>{["AUDIO","SUBTITLES"].forEach(u=>e[u].onGroupChanging())});const l=()=>{e.AUDIO.onTrackChanged(),i.trigger({type:"usage",name:"vhs-audio-change"})};i.audioTracks().addEventListener("change",l),i.remoteTextTracks().addEventListener("change",e.SUBTITLES.onTrackChanged),s.on("dispose",()=>{i.audioTracks().removeEventListener("change",l),i.remoteTextTracks().removeEventListener("change",e.SUBTITLES.onTrackChanged)}),i.clearTracks("audio");for(const u in e.AUDIO.tracks)i.audioTracks().addTrack(e.AUDIO.tracks[u])},SL=()=>{const r={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{r[e]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:cs,activeTrack:cs,getActiveGroup:cs,onGroupChanged:cs,onTrackChanged:cs,lastTrack_:null,logger_:Ti(`MediaGroups[${e}]`)}}),r};class Tg{constructor(){this.priority_=[],this.pathwayClones_=new Map}set version(e){e===1&&(this.version_=e)}set ttl(e){this.ttl_=e||300}set reloadUri(e){e&&(this.reloadUri_=qt(this.reloadUri_,e))}set priority(e){e&&e.length&&(this.priority_=e)}set pathwayClones(e){e&&e.length&&(this.pathwayClones_=new Map(e.map(t=>[t.ID,t])))}get version(){return this.version_}get ttl(){return this.ttl_}get reloadUri(){return this.reloadUri_}get priority(){return this.priority_}get pathwayClones(){return this.pathwayClones_}}class EL extends te.EventTarget{constructor(e,t){super(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=!1,this.availablePathways_=new Set,this.steeringManifest=new Tg,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.currentPathwayClones=new Map,this.nextPathwayClones=new Map,this.excludedSteeringManifestURLs=new Set,this.logger_=Ti("Content Steering"),this.xhr_=e,this.getBandwidth_=t}assignTagProperties(e,t){this.manifestType_=t.serverUri?"HLS":"DASH";const i=t.serverUri||t.serverURL;if(!i){this.logger_(`steering manifest URL is ${i}, cannot request steering manifest.`),this.trigger("error");return}if(i.startsWith("data:")){this.decodeDataUriManifest_(i.substring(i.indexOf(",")+1));return}this.steeringManifest.reloadUri=qt(e,i),this.defaultPathway=t.pathwayId||t.defaultServiceLocation,this.queryBeforeStart=t.queryBeforeStart,this.proxyServerUrl_=t.proxyServerURL,this.defaultPathway&&!this.queryBeforeStart&&this.trigger("content-steering")}requestSteeringManifest(e){const t=this.steeringManifest.reloadUri;if(!t)return;const i=e?t:this.getRequestURI(t);if(!i){this.logger_("No valid content steering manifest URIs. Stopping content steering."),this.trigger("error"),this.dispose();return}const s={contentSteeringInfo:{uri:i}};this.trigger({type:"contentsteeringloadstart",metadata:s}),this.request_=this.xhr_({uri:i,requestType:"content-steering-manifest"},(n,a)=>{if(n){if(a.status===410){this.logger_(`manifest request 410 ${n}.`),this.logger_(`There will be no more content steering requests to ${i} this session.`),this.excludedSteeringManifestURLs.add(i);return}if(a.status===429){const u=a.responseHeaders["retry-after"];this.logger_(`manifest request 429 ${n}.`),this.logger_(`content steering will retry in ${u} seconds.`),this.startTTLTimeout_(parseInt(u,10));return}this.logger_(`manifest failed to load ${n}.`),this.startTTLTimeout_();return}this.trigger({type:"contentsteeringloadcomplete",metadata:s});let o;try{o=JSON.parse(this.request_.responseText)}catch(u){const c={errorType:te.Error.StreamingContentSteeringParserError,error:u};this.trigger({type:"error",metadata:c})}this.assignSteeringProperties_(o);const l={contentSteeringInfo:s.contentSteeringInfo,contentSteeringManifest:{version:this.steeringManifest.version,reloadUri:this.steeringManifest.reloadUri,priority:this.steeringManifest.priority}};this.trigger({type:"contentsteeringparsed",metadata:l}),this.startTTLTimeout_()})}setProxyServerUrl_(e){const t=new $.URL(e),i=new $.URL(this.proxyServerUrl_);return i.searchParams.set("url",encodeURI(t.toString())),this.setSteeringParams_(i.toString())}decodeDataUriManifest_(e){const t=JSON.parse($.atob(e));this.assignSteeringProperties_(t)}setSteeringParams_(e){const t=new $.URL(e),i=this.getPathway(),s=this.getBandwidth_();if(i){const n=`_${this.manifestType_}_pathway`;t.searchParams.set(n,i)}if(s){const n=`_${this.manifestType_}_throughput`;t.searchParams.set(n,s)}return t.toString()}assignSteeringProperties_(e){if(this.steeringManifest.version=e.VERSION,!this.steeringManifest.version){this.logger_(`manifest version is ${e.VERSION}, which is not supported.`),this.trigger("error");return}this.steeringManifest.ttl=e.TTL,this.steeringManifest.reloadUri=e["RELOAD-URI"],this.steeringManifest.priority=e["PATHWAY-PRIORITY"]||e["SERVICE-LOCATION-PRIORITY"],this.steeringManifest.pathwayClones=e["PATHWAY-CLONES"],this.nextPathwayClones=this.steeringManifest.pathwayClones,this.availablePathways_.size||(this.logger_("There are no available pathways for content steering. Ending content steering."),this.trigger("error"),this.dispose());const i=(s=>{for(const n of s)if(this.availablePathways_.has(n))return n;return[...this.availablePathways_][0]})(this.steeringManifest.priority);this.currentPathway!==i&&(this.currentPathway=i,this.trigger("content-steering"))}getPathway(){return this.currentPathway||this.defaultPathway}getRequestURI(e){if(!e)return null;const t=s=>this.excludedSteeringManifestURLs.has(s);if(this.proxyServerUrl_){const s=this.setProxyServerUrl_(e);if(!t(s))return s}const i=this.setSteeringParams_(e);return t(i)?null:i}startTTLTimeout_(e=this.steeringManifest.ttl){const t=e*1e3;this.ttlTimeout_=$.setTimeout(()=>{this.requestSteeringManifest()},t)}clearTTLTimeout_(){$.clearTimeout(this.ttlTimeout_),this.ttlTimeout_=null}abort(){this.request_&&this.request_.abort(),this.request_=null}dispose(){this.off("content-steering"),this.off("error"),this.abort(),this.clearTTLTimeout_(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=null,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.excludedSteeringManifestURLs=new Set,this.availablePathways_=new Set,this.steeringManifest=new Tg}addAvailablePathway(e){e&&this.availablePathways_.add(e)}clearAvailablePathways(){this.availablePathways_.clear()}excludePathway(e){return this.availablePathways_.delete(e)}didDASHTagChange(e,t){return!t&&this.steeringManifest.reloadUri||t&&(qt(e,t.serverURL)!==this.steeringManifest.reloadUri||t.defaultServiceLocation!==this.defaultPathway||t.queryBeforeStart!==this.queryBeforeStart||t.proxyServerURL!==this.proxyServerUrl_)}getAvailablePathways(){return this.availablePathways_}}const bL=(r,e)=>{let t=null;return(...i)=>{clearTimeout(t),t=setTimeout(()=>{r.apply(null,i)},e)}},xL=10;let ns;const AL=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],CL=function(r){return this.audioSegmentLoader_[r]+this.mainSegmentLoader_[r]},IL=function({currentPlaylist:r,buffered:e,currentTime:t,nextPlaylist:i,bufferLowWaterLine:s,bufferHighWaterLine:n,duration:a,bufferBasedABR:o,log:l}){if(!i)return te.log.warn("We received no playlist to switch to. Please check your stream."),!1;const u=`allowing switch ${r&&r.id||"null"} -> ${i.id}`;if(!r)return l(`${u} as current playlist is not set`),!0;if(i.id===r.id)return!1;const c=!!_r(e,t).length;if(!r.endList)return!c&&typeof r.partTargetDuration=="number"?(l(`not ${u} as current playlist is live llhls, but currentTime isn't in buffered.`),!1):(l(`${u} as current playlist is live`),!0);const h=Lh(e,t),f=o?bt.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:bt.MAX_BUFFER_LOW_WATER_LINE;if(a<f)return l(`${u} as duration < max low water line (${a} < ${f})`),!0;const p=i.attributes.BANDWIDTH,m=r.attributes.BANDWIDTH;if(p<m&&(!o||h<n)){let y=`${u} as next bandwidth < current bandwidth (${p} < ${m})`;return o&&(y+=` and forwardBuffer < bufferHighWaterLine (${h} < ${n})`),l(y),!0}if((!o||p>m)&&h>=s){let y=`${u} as forwardBuffer >= bufferLowWaterLine (${h} >= ${s})`;return o&&(y+=` and next bandwidth > current bandwidth (${p} > ${m})`),l(y),!0}return l(`not ${u} as no switching criteria met`),!1};class DL extends te.EventTarget{constructor(e){super(),this.fastQualityChange_=bL(this.fastQualityChange_.bind(this),100);const{src:t,withCredentials:i,tech:s,bandwidth:n,externVhs:a,useCueTags:o,playlistExclusionDuration:l,enableLowInitialPlaylist:u,sourceType:c,cacheEncryptionKeys:h,bufferBasedABR:f,leastPixelDiffSelector:p,captionServices:m,experimentalUseMMS:y}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:v}=e;(v===null||typeof v>"u")&&(v=1/0),ns=a,this.bufferBasedABR=!!f,this.leastPixelDiffSelector=!!p,this.withCredentials=i,this.tech_=s,this.vhs_=s.vhs,this.player_=e.player_,this.sourceType_=c,this.useCueTags_=o,this.playlistExclusionDuration=l,this.maxPlaylistRetries=v,this.enableLowInitialPlaylist=u,this.usingManagedMediaSource_=!1,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:i,maxPlaylistRetries:v,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=SL(),y&&$.ManagedMediaSource?(this.tech_.el_.disableRemotePlayback=!0,this.mediaSource=new $.ManagedMediaSource,this.usingManagedMediaSource_=!0,te.log("Using ManagedMediaSource")):$.MediaSource&&(this.mediaSource=new $.MediaSource),this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.load=this.load.bind(this),this.pause=this.pause.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.mediaSource.addEventListener("startstreaming",this.load),this.mediaSource.addEventListener("endstreaming",this.pause),this.seekable_=At(),this.hasPlayed_=!1,this.syncController_=new lL(e),this.segmentMetadataTrack_=s.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.segmentMetadataTrack_.mode="hidden",this.decrypter_=new hL,this.sourceUpdater_=new bT(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new uL,this.keyStatusMap_=new Map;const E={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:m,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:n,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:h,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings,addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)};this.mainPlaylistLoader_=this.sourceType_==="dash"?new Sc(t,this.vhs_,$e(this.requestOptions_,{addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)})):new vr(t,this.vhs_,$e(this.requestOptions_,{addDateRangesToTextTrack:this.addDateRangesToTextTrack_.bind(this)})),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new xc($e(E,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new xc($e(E,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new sL($e(E,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise((w,k)=>{function F(){s.off("vttjserror",L),w()}function L(){s.off("vttjsloaded",F),k()}s.one("vttjsloaded",F),s.one("vttjserror",L),s.addWebVttScript_()})}),e);const A=()=>this.mainSegmentLoader_.bandwidth;this.contentSteeringController_=new EL(this.vhs_.xhr,A),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",()=>this.startABRTimer_()),this.tech_.on("pause",()=>this.stopABRTimer_()),this.tech_.on("play",()=>this.startABRTimer_())),AL.forEach(w=>{this[w+"_"]=CL.bind(this,w)}),this.logger_=Ti("pc"),this.triggeredFmp4Usage=!1,this.tech_.preload()==="none"?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const x=this.tech_.preload()==="none"?"play":"loadstart";this.tech_.one(x,()=>{const w=Date.now();this.tech_.one("loadeddata",()=>{this.timeToLoadedData__=Date.now()-w,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends})})}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return e===-1||t===-1?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,i){const s=this.media(),n=s&&(s.id||s.uri),a=e&&(e.id||e.uri);if(n&&n!==a){this.logger_(`switch media ${n} -> ${a} from ${t}`);const o={renditionInfo:{id:a,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS},cause:t};this.trigger({type:"renditionselected",metadata:o}),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${t}`})}this.mainPlaylistLoader_.media(e,i)}switchMediaForDASHContentSteering_(){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{const t=this.mediaTypes_[e],i=t?t.activeGroup():null,s=this.contentSteeringController_.getPathway();if(i&&s){const a=(i.length?i[0].playlists:i.playlists).filter(o=>o.attributes.serviceLocation===s);a.length&&this.mediaTypes_[e].activePlaylistLoader.media(a[0])}})}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=$.setInterval(()=>this.checkABR_(),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||($.clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const i=e.mediaGroups.AUDIO,s=Object.keys(i);let n;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)n=this.mediaTypes_.AUDIO.activeTrack();else{const o=i.main||s.length&&i[s[0]];for(const l in o)if(o[l].default){n={label:l};break}}if(!n)return t;const a=[];for(const o in i)if(i[o][n.label]){const l=i[o][n.label];if(l.playlists&&l.playlists.length)a.push.apply(a,l.playlists);else if(l.uri)a.push(l);else if(e.playlists.length)for(let u=0;u<e.playlists.length;u++){const c=e.playlists[u];c.attributes&&c.attributes.AUDIO&&c.attributes.AUDIO===o&&a.push(c)}}return a.length?a:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",()=>{const t=this.mainPlaylistLoader_.media(),i=t.targetDuration*1.5*1e3;mc(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=i,t.endList&&this.tech_.preload()!=="none"&&(this.mainSegmentLoader_.playlist(t,this.requestOptions_),this.mainSegmentLoader_.load()),vL({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),t),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",()=>{this.trigger("selectedinitialmedia")})}),this.mainPlaylistLoader_.on("loadedplaylist",()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let t=this.mainPlaylistLoader_.media();if(!t){this.attachContentSteeringListeners_(),this.initContentSteeringController_(),this.excludeUnsupportedVariants_();let i;if(this.enableLowInitialPlaylist&&(i=this.selectInitialPlaylist()),i||(i=this.selectPlaylist()),!i||!this.shouldSwitchToMedia_(i)||(this.initialMedia_=i,this.switchMedia_(this.initialMedia_,"initial"),!(this.sourceType_==="vhs-json"&&this.initialMedia_.segments)))return;t=this.initialMedia_}this.handleUpdatedMediaPlaylist(t)}),this.mainPlaylistLoader_.on("error",()=>{const t=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:t.playlist,error:t})}),this.mainPlaylistLoader_.on("mediachanging",()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()}),this.mainPlaylistLoader_.on("mediachange",()=>{const t=this.mainPlaylistLoader_.media(),i=t.targetDuration*1.5*1e3;mc(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=i,this.sourceType_==="dash"&&this.mainPlaylistLoader_.isPaused&&this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(t,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_?this.runFastQualitySwitch_():this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})}),this.mainPlaylistLoader_.on("playlistunchanged",()=>{const t=this.mainPlaylistLoader_.media();if(t.lastExcludeReason_==="playlist-unchanged")return;this.stuckAtPlaylistEnd_(t)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))}),this.mainPlaylistLoader_.on("renditiondisabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})}),this.mainPlaylistLoader_.on("renditionenabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})}),["manifestrequeststart","manifestrequestcomplete","manifestparsestart","manifestparsecomplete","playlistrequeststart","playlistrequestcomplete","playlistparsestart","playlistparsecomplete","renditiondisabled","renditionenabled"].forEach(t=>{this.mainPlaylistLoader_.on(t,i=>{this.player_.trigger(mt({},i))})})}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_&&this.runFastQualitySwitch_(),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const i=e.mediaGroups||{};let s=!0;const n=Object.keys(i.AUDIO);for(const a in i.AUDIO)for(const o in i.AUDIO[a])i.AUDIO[a][o].uri||(s=!1);s&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(i.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),ns.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),n.length&&Object.keys(i.AUDIO[n[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,i=this.tech_.currentTime(),s=this.bufferLowWaterLine(),n=this.bufferHighWaterLine(),a=this.tech_.buffered();return IL({buffered:a,currentTime:i,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:s,bufferHighWaterLine:n,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()}),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",()=>{this.trigger("progress")}),this.mainSegmentLoader_.on("error",()=>{const i=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:i.playlist,error:i})}),this.mainSegmentLoader_.on("appenderror",()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("ended",()=>{this.logger_("main segment loader ended"),this.onEndOfStream()}),this.timelineChangeController_.on("audioTimelineBehind",()=>{const i=this.audioSegmentLoader_.pendingSegment_;if(!i||!i.segment||!i.segment.syncInfo)return;const s=i.segment.syncInfo.end+.01;this.tech_.setCurrentTime(s)}),this.timelineChangeController_.on("fixBadTimelineChange",()=>{this.logger_("Fix bad timeline change. Restarting al segment loaders..."),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}),this.mainSegmentLoader_.on("earlyabort",i=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:xL}))});const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const i=this.getCodecsOrExclude_();i&&this.sourceUpdater_.addOrChangeSourceBuffers(i)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()}),["segmentselected","segmentloadstart","segmentloaded","segmentkeyloadstart","segmentkeyloadcomplete","segmentdecryptionstart","segmentdecryptioncomplete","segmenttransmuxingstart","segmenttransmuxingcomplete","segmenttransmuxingtrackinfoavailable","segmenttransmuxingtiminginfoavailable","segmentappendstart","appendsdone","bandwidthupdated","timelinechange","codecschange"].forEach(i=>{this.mainSegmentLoader_.on(i,s=>{this.player_.trigger(mt({},s))}),this.audioSegmentLoader_.on(i,s=>{this.player_.trigger(mt({},s))}),this.subtitleSegmentLoader_.on(i,s=>{this.player_.trigger(mt({},s))})})}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}pause(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}fastQualityChange_(e=this.selectPlaylist()){if(e&&e===this.mainPlaylistLoader_.media()){this.logger_("skipping fastQualityChange because new media is same as old");return}this.switchMedia_(e,"fast-quality"),this.waitingForFastQualityPlaylistReceived_=!0}runFastQualitySwitch_(){this.waitingForFastQualityPlaylistReceived_=!1,this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();if(this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0))return this.tech_.setCurrentTime(e.end(e.length-1))}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList||e.start){const t=this.seekable();if(!t.length)return!1;const i=t.end(0);let s=i;if(e.start){const n=e.start.timeOffset;if(n<0){const a=this.mainPlaylistLoader_.main,o=ns.Playlist.liveEdgeDelay(a,e),l=i+o;s=Math.max(Math.min(l+n,i),t.start(0))}else s=Math.min(i,n)}this.trigger("firstplay"),this.tech_.setCurrentTime(s)}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();typeof e<"u"&&typeof e.then=="function"&&e.then(null,t=>{})}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();!t||t.hasVideo?e=e&&this.audioSegmentLoader_.ended_:e=this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const i=this.syncController_.getExpiredTime(e,this.duration());if(i===null)return!1;const s=ns.Playlist.playlistEnd(e,i),n=this.tech_.currentTime(),a=this.tech_.buffered();if(!a.length)return s-n<=Ki;const o=a.end(a.length-1);return o-n<=Ki&&s-o<=Ki}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:t={},playlistExclusionDuration:i}){if(e=e||this.mainPlaylistLoader_.media(),i=i||t.playlistExclusionDuration||this.playlistExclusionDuration,!e){this.error=t,this.mediaSource.readyState!=="open"?this.trigger("error"):this.sourceUpdater_.endOfStream("network");return}e.playlistErrors_++;const s=this.mainPlaylistLoader_.main.playlists,n=s.filter(pl),a=n.length===1&&n[0]===e;if(s.length===1&&i!==1/0)return te.log.warn(`Problem encountered with playlist ${e.id}. Trying again since it is the only playlist.`),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(a);if(a){if(this.main().contentSteering){const m=this.pathwayAttribute_(e),y=this.contentSteeringController_.steeringManifest.ttl*1e3;this.contentSteeringController_.excludePathway(m),this.excludeThenChangePathway_(),setTimeout(()=>{this.contentSteeringController_.addAvailablePathway(m)},y);return}let p=!1;s.forEach(m=>{if(m===e)return;const y=m.excludeUntil;typeof y<"u"&&y!==1/0&&(p=!0,delete m.excludeUntil)}),p&&(te.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let o;e.playlistErrors_>this.maxPlaylistRetries?o=1/0:o=Date.now()+i*1e3,e.excludeUntil=o,t.reason&&(e.lastExcludeReason_=t.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const l=this.selectPlaylist();if(!l){this.error="Playback cannot continue. No available working or supported playlists.",this.trigger("error");return}const u=t.internal?this.logger_:te.log.warn,c=t.message?" "+t.message:"";u(`${t.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.${c} Switching to playlist ${l.id}.`),l.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),l.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const h=l.targetDuration/2*1e3||5*1e3,f=typeof l.lastRequest=="number"&&Date.now()-l.lastRequest<=h;return this.switchMedia_(l,"exclude",a||f)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const i=[],s=e==="all";(s||e==="main")&&i.push(this.mainPlaylistLoader_);const n=[];(s||e==="audio")&&n.push("AUDIO"),(s||e==="subtitle")&&(n.push("CLOSED-CAPTIONS"),n.push("SUBTITLES")),n.forEach(a=>{const o=this.mediaTypes_[a]&&this.mediaTypes_[a].activePlaylistLoader;o&&i.push(o)}),["main","audio","subtitle"].forEach(a=>{const o=this[`${a}SegmentLoader_`];o&&(e===a||e==="all")&&i.push(o)}),i.forEach(a=>t.forEach(o=>{typeof a[o]=="function"&&a[o]()}))}setCurrentTime(e){const t=_r(this.tech_.buffered(),e);if(!(this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media())||!this.mainPlaylistLoader_.media().segments)return 0;if(t&&t.length)return e;this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:ns.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}getSeekableRange_(e,t){const i=e.media();if(!i)return null;const s=this.syncController_.getMediaSequenceSync(t);if(s&&s.isReliable){const o=s.start,l=s.end;if(!isFinite(o)||!isFinite(l))return null;const u=ns.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,i),c=Math.max(o,l-u);return At([[o,c]])}const n=this.syncController_.getExpiredTime(i,this.duration());if(n===null)return null;const a=ns.Playlist.seekable(i,n,ns.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,i));return a.length?a:null}computeFinalSeekable_(e,t){if(!t)return e;const i=e.start(0),s=e.end(0),n=t.start(0),a=t.end(0);return n>s||i>a?e:At([[Math.max(i,n),Math.min(s,a)]])}onSyncInfoUpdate_(){if(!this.mainPlaylistLoader_)return;const e=this.getSeekableRange_(this.mainPlaylistLoader_,"main");if(!e)return;let t;if(this.mediaTypes_.AUDIO.activePlaylistLoader&&(t=this.getSeekableRange_(this.mediaTypes_.AUDIO.activePlaylistLoader,"audio"),!t))return;const i=this.seekable_;if(this.seekable_=this.computeFinalSeekable_(e,t),!this.seekable_||i&&i.length&&this.seekable_.length&&i.start(0)===this.seekable_.start(0)&&i.end(0)===this.seekable_.end(0))return;this.logger_(`seekable updated [${Fy(this.seekable_)}]`);const s={seekableRanges:this.seekable_};this.trigger({type:"seekablerangeschanged",metadata:s}),this.tech_.trigger("seekablechanged")}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),this.mediaSource.readyState!=="open"){this.updateDuration_=this.updateDuration.bind(this,e),this.mediaSource.addEventListener("sourceopen",this.updateDuration_);return}if(e){const s=this.seekable();if(!s.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<s.end(s.length-1))&&this.sourceUpdater_.setDuration(s.end(s.length-1));return}const t=this.tech_.buffered();let i=ns.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(i=Math.max(i,t.end(t.length-1))),this.mediaSource.duration!==i&&this.sourceUpdater_.setDuration(i)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.contentSteeringController_.dispose(),this.keyStatusMap_.clear(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(e=>{const t=this.mediaTypes_[e].groups;for(const i in t)t[i].forEach(s=>{s.playlistLoader&&s.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),i=e?!!this.audioSegmentLoader_.getCurrentMediaInfo_():!0;return!(!t||!i)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const i=Nn(this.main(),t),s={},n=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(s.video=i.video||e.main.videoCodec||mA),e.main.isMuxed&&(s.video+=`,${i.audio||e.main.audioCodec||op}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||n)&&(s.audio=i.audio||e.main.audioCodec||e.audio.audioCodec||op,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!s.audio&&!s.video){this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});return}const a=(u,c)=>u?kn(c,this.usingManagedMediaSource_):fu(c),o={};let l;if(["video","audio"].forEach(function(u){if(s.hasOwnProperty(u)&&!a(e[u].isFmp4,s[u])){const c=e[u].isFmp4?"browser":"muxer";o[c]=o[c]||[],o[c].push(s[u]),u==="audio"&&(l=c)}}),n&&l&&t.attributes.AUDIO){const u=t.attributes.AUDIO;this.main().playlists.forEach(c=>{(c.attributes&&c.attributes.AUDIO)===u&&c!==t&&(c.excludeUntil=1/0)}),this.logger_(`excluding audio group ${u} as ${l} does not support codec(s): "${s.audio}"`)}if(Object.keys(o).length){const u=Object.keys(o).reduce((c,h)=>(c&&(c+=", "),c+=`${h} does not support codec(s): "${o[h].join(",")}"`,c),"")+".";this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:u},playlistExclusionDuration:1/0});return}if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const u=[];if(["video","audio"].forEach(c=>{const h=(Ui(this.sourceUpdater_.codecs[c]||"")[0]||{}).type,f=(Ui(s[c]||"")[0]||{}).type;h&&f&&h.toLowerCase()!==f.toLowerCase()&&u.push(`"${this.sourceUpdater_.codecs[c]}" -> "${s[c]}"`)}),u.length){this.excludePlaylist({playlistToExclude:t,error:{message:`Codec switching not supported: ${u.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0});return}}return s}tryToCreateSourceBuffers_(){if(this.mediaSource.readyState!=="open"||this.sourceUpdater_.hasCreatedSourceBuffers()||!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach(i=>{const s=e[i];if(t.indexOf(s.id)!==-1)return;t.push(s.id);const n=Nn(this.main,s),a=[];n.audio&&!fu(n.audio)&&!kn(n.audio,this.usingManagedMediaSource_)&&a.push(`audio codec ${n.audio}`),n.video&&!fu(n.video)&&!kn(n.video,this.usingManagedMediaSource_)&&a.push(`video codec ${n.video}`),n.text&&n.text==="stpp.ttml.im1t"&&a.push(`text codec ${n.text}`),a.length&&(s.excludeUntil=1/0,this.logger_(`excluding ${s.id} for unsupported: ${a.join(", ")}`))})}excludeIncompatibleVariants_(e){const t=[],i=this.main().playlists,s=Yn(Ui(e)),n=eg(s),a=s.video&&Ui(s.video)[0]||null,o=s.audio&&Ui(s.audio)[0]||null;Object.keys(i).forEach(l=>{const u=i[l];if(t.indexOf(u.id)!==-1||u.excludeUntil===1/0)return;t.push(u.id);const c=[],h=Nn(this.mainPlaylistLoader_.main,u),f=eg(h);if(!(!h.audio&&!h.video)){if(f!==n&&c.push(`codec count "${f}" !== "${n}"`),!this.sourceUpdater_.canChangeType()){const p=h.video&&Ui(h.video)[0]||null,m=h.audio&&Ui(h.audio)[0]||null;p&&a&&p.type.toLowerCase()!==a.type.toLowerCase()&&c.push(`video codec "${p.type}" !== "${a.type}"`),m&&o&&m.type.toLowerCase()!==o.type.toLowerCase()&&c.push(`audio codec "${m.type}" !== "${o.type}"`)}c.length&&(u.excludeUntil=1/0,this.logger_(`excluding ${u.id}: ${c.join(" && ")}`))}})}updateAdCues_(e){let t=0;const i=this.seekable();i.length&&(t=i.start(0)),nL(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=bt.GOAL_BUFFER_LENGTH,i=bt.GOAL_BUFFER_LENGTH_RATE,s=Math.max(t,bt.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*i,s)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=bt.BUFFER_LOW_WATER_LINE,i=bt.BUFFER_LOW_WATER_LINE_RATE,s=Math.max(t,bt.MAX_BUFFER_LOW_WATER_LINE),n=Math.max(t,bt.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*i,this.bufferBasedABR?n:s)}bufferHighWaterLine(){return bt.BUFFER_HIGH_WATER_LINE}addDateRangesToTextTrack_(e){lg(this.inbandTextTracks_,"com.apple.streaming",this.tech_),BD({inbandTextTracks:this.inbandTextTracks_,dateRanges:e})}addMetadataToTextTrack(e,t,i){const s=this.sourceUpdater_.videoBuffer?this.sourceUpdater_.videoTimestampOffset():this.sourceUpdater_.audioTimestampOffset();lg(this.inbandTextTracks_,e,this.tech_),MD({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:s,videoDuration:i})}pathwayAttribute_(e){return e.attributes["PATHWAY-ID"]||e.attributes.serviceLocation}initContentSteeringController_(){const e=this.main();if(e.contentSteering){for(const t of e.playlists)this.contentSteeringController_.addAvailablePathway(this.pathwayAttribute_(t));if(this.contentSteeringController_.assignTagProperties(e.uri,e.contentSteering),this.contentSteeringController_.queryBeforeStart){this.contentSteeringController_.requestSteeringManifest(!0);return}this.tech_.one("canplay",()=>{this.contentSteeringController_.requestSteeringManifest()})}}resetContentSteeringController_(){this.contentSteeringController_.clearAvailablePathways(),this.contentSteeringController_.dispose(),this.initContentSteeringController_()}attachContentSteeringListeners_(){this.contentSteeringController_.on("content-steering",this.excludeThenChangePathway_.bind(this)),["contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"].forEach(t=>{this.contentSteeringController_.on(t,i=>{this.trigger(mt({},i))})}),this.sourceType_==="dash"&&this.mainPlaylistLoader_.on("loadedplaylist",()=>{const t=this.main();(this.contentSteeringController_.didDASHTagChange(t.uri,t.contentSteering)||(()=>{const n=this.contentSteeringController_.getAvailablePathways(),a=[];for(const o of t.playlists){const l=o.attributes.serviceLocation;if(l&&(a.push(l),!n.has(l)))return!0}return!!(!a.length&&n.size)})())&&this.resetContentSteeringController_()})}excludeThenChangePathway_(){const e=this.contentSteeringController_.getPathway();if(!e)return;this.handlePathwayClones_();const i=this.main().playlists,s=new Set;let n=!1;Object.keys(i).forEach(a=>{const o=i[a],l=this.pathwayAttribute_(o),u=l&&e!==l;o.excludeUntil===1/0&&o.lastExcludeReason_==="content-steering"&&!u&&(delete o.excludeUntil,delete o.lastExcludeReason_,n=!0);const h=!o.excludeUntil&&o.excludeUntil!==1/0;!s.has(o.id)&&u&&h&&(s.add(o.id),o.excludeUntil=1/0,o.lastExcludeReason_="content-steering",this.logger_(`excluding ${o.id} for ${o.lastExcludeReason_}`))}),this.contentSteeringController_.manifestType_==="DASH"&&Object.keys(this.mediaTypes_).forEach(a=>{const o=this.mediaTypes_[a];if(o.activePlaylistLoader){const l=o.activePlaylistLoader.media_;l&&l.attributes.serviceLocation!==e&&(n=!0)}}),n&&this.changeSegmentPathway_()}handlePathwayClones_(){const t=this.main().playlists,i=this.contentSteeringController_.currentPathwayClones,s=this.contentSteeringController_.nextPathwayClones;if(i&&i.size||s&&s.size){for(const[a,o]of i.entries())s.get(a)||(this.mainPlaylistLoader_.updateOrDeleteClone(o),this.contentSteeringController_.excludePathway(a));for(const[a,o]of s.entries()){const l=i.get(a);if(!l){t.filter(c=>c.attributes["PATHWAY-ID"]===o["BASE-ID"]).forEach(c=>{this.mainPlaylistLoader_.addClonePathway(o,c)}),this.contentSteeringController_.addAvailablePathway(a);continue}this.equalPathwayClones_(l,o)||(this.mainPlaylistLoader_.updateOrDeleteClone(o,!0),this.contentSteeringController_.addAvailablePathway(a))}this.contentSteeringController_.currentPathwayClones=new Map(JSON.parse(JSON.stringify([...s])))}}equalPathwayClones_(e,t){if(e["BASE-ID"]!==t["BASE-ID"]||e.ID!==t.ID||e["URI-REPLACEMENT"].HOST!==t["URI-REPLACEMENT"].HOST)return!1;const i=e["URI-REPLACEMENT"].PARAMS,s=t["URI-REPLACEMENT"].PARAMS;for(const n in i)if(i[n]!==s[n])return!1;for(const n in s)if(i[n]!==s[n])return!1;return!0}changeSegmentPathway_(){const e=this.selectPlaylist();this.pauseLoading(),this.contentSteeringController_.manifestType_==="DASH"&&this.switchMediaForDASHContentSteering_(),this.switchMedia_(e,"content-steering")}excludeNonUsablePlaylistsByKeyId_(){if(!this.mainPlaylistLoader_||!this.mainPlaylistLoader_.main)return;let e=0;const t="non-usable";this.mainPlaylistLoader_.main.playlists.forEach(i=>{const s=this.mainPlaylistLoader_.getKeyIdSet(i);!s||!s.size||s.forEach(n=>{const a="usable",o=this.keyStatusMap_.has(n)&&this.keyStatusMap_.get(n)===a,l=i.lastExcludeReason_===t&&i.excludeUntil===1/0;o?o&&l&&(delete i.excludeUntil,delete i.lastExcludeReason_,this.logger_(`enabling playlist ${i.id} because key ID ${n} is ${a}`)):(i.excludeUntil!==1/0&&i.lastExcludeReason_!==t&&(i.excludeUntil=1/0,i.lastExcludeReason_=t,this.logger_(`excluding playlist ${i.id} because the key ID ${n} doesn't exist in the keyStatusMap or is not ${a}`)),e++)})}),e>=this.mainPlaylistLoader_.main.playlists.length&&this.mainPlaylistLoader_.main.playlists.forEach(i=>{const s=i&&i.attributes&&i.attributes.RESOLUTION&&i.attributes.RESOLUTION.height<720,n=i.excludeUntil===1/0&&i.lastExcludeReason_===t;s&&n&&(delete i.excludeUntil,te.log.warn(`enabling non-HD playlist ${i.id} because all playlists were excluded due to ${t} key IDs`))})}addKeyStatus_(e,t){const n=(typeof e=="string"?e:tL(e)).slice(0,32).toLowerCase();this.logger_(`KeyStatus '${t}' with key ID ${n} added to the keyStatusMap`),this.keyStatusMap_.set(n,t)}updatePlaylistByKeyStatus(e,t){this.addKeyStatus_(e,t),this.waitingForFastQualityPlaylistReceived_||this.excludeNonUsableThenChangePlaylist_(),this.mainPlaylistLoader_.off("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this)),this.mainPlaylistLoader_.on("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this))}excludeNonUsableThenChangePlaylist_(){this.excludeNonUsablePlaylistsByKeyId_(),this.fastQualityChange_()}}const LL=(r,e,t)=>i=>{const s=r.main.playlists[e],n=wh(s),a=pl(s);if(typeof i>"u")return a;i?delete s.disabled:s.disabled=!0;const o={renditionInfo:{id:e,bandwidth:s.attributes.BANDWIDTH,resolution:s.attributes.RESOLUTION,codecs:s.attributes.CODECS},cause:"fast-quality"};return i!==a&&!n&&(i?(t(s),r.trigger({type:"renditionenabled",metadata:o})):r.trigger({type:"renditiondisabled",metadata:o})),i};class RL{constructor(e,t,i){const{playlistController_:s}=e,n=s.fastQualityChange_.bind(s);if(t.attributes){const a=t.attributes.RESOLUTION;this.width=a&&a.width,this.height=a&&a.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}this.codecs=Nn(s.main(),t),this.playlist=t,this.id=i,this.enabled=LL(e.playlists,t.id,n)}}const wL=function(r){r.representations=()=>{const e=r.playlistController_.main(),t=ia(e)?r.playlistController_.getAudioTrackPlaylists_():e.playlists;return t?t.filter(i=>!wh(i)).map((i,s)=>new RL(r,i,i.id)):[]}},_g=["seeking","seeked","pause","playing","error"];class kL extends te.EventTarget{constructor(e){super(),this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.playedRanges_=[],this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=Ti("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),i=()=>this.monitorCurrentTime_(),s=()=>this.techWaiting_(),n=()=>this.resetTimeUpdate_(),a=this.playlistController_,o=["main","subtitle","audio"],l={};o.forEach(c=>{l[c]={reset:()=>this.resetSegmentDownloads_(c),updateend:()=>this.checkSegmentDownloads_(c)},a[`${c}SegmentLoader_`].on("appendsdone",l[c].updateend),a[`${c}SegmentLoader_`].on("playlistupdate",l[c].reset),this.tech_.on(["seeked","seeking"],l[c].reset)});const u=c=>{["main","audio"].forEach(h=>{a[`${h}SegmentLoader_`][c]("appended",this.seekingAppendCheck_)})};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),u("off"))},this.clearSeekingAppendCheck_=()=>u("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),u("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",s),this.tech_.on(_g,n),this.tech_.on("canplay",i),this.tech_.one("play",t),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",s),this.tech_.off(_g,n),this.tech_.off("canplay",i),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),o.forEach(c=>{a[`${c}SegmentLoader_`].off("appendsdone",l[c].updateend),a[`${c}SegmentLoader_`].off("playlistupdate",l[c].reset),this.tech_.off(["seeked","seeking"],l[c].reset)}),this.checkCurrentTimeTimeout_&&$.clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&$.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=$.setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,i=t[`${e}SegmentLoader_`],s=i.buffered_(),n=yI(this[`${e}Buffered_`],s);if(this[`${e}Buffered_`]=s,n){const a={bufferedRanges:s};t.trigger({type:"bufferedrangeschanged",metadata:a}),this.resetSegmentDownloads_(e);return}this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:i.playlist_&&i.playlist_.id,buffered:zs(s)}),!(this[`${e}StalledDownloads_`]<10)&&(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),e!=="subtitle"&&t.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0}))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+Ki>=t.end(t.length-1)))return this.techWaiting_();if(this.consecutiveUpdates>=5&&e===this.lastRecordedTime)this.consecutiveUpdates++,this.waiting_();else if(e===this.lastRecordedTime)this.consecutiveUpdates++;else{this.playedRanges_.push(At([this.lastRecordedTime,e]));const i={playedRanges:this.playedRanges_};this.playlistController_.trigger({type:"playedrangeschanged",metadata:i}),this.consecutiveUpdates=0,this.lastRecordedTime=e}}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const t=this.seekable(),i=this.tech_.currentTime(),s=this.afterSeekableWindow_(t,i,this.media(),this.allowSeeksWithinUnsafeLiveWindow);let n;if(s&&(n=t.end(t.length-1)),this.beforeSeekableWindow_(t,i)){const m=t.start(0);n=m+(m===t.end(0)?0:Ki)}if(typeof n<"u")return this.logger_(`Trying to seek outside of seekable at time ${i} with seekable range ${Fy(t)}. Seeking to ${n}.`),this.tech_.setCurrentTime(n),!0;const a=this.playlistController_.sourceUpdater_,o=this.tech_.buffered(),l=a.audioBuffer?a.audioBuffered():null,u=a.videoBuffer?a.videoBuffered():null,c=this.media(),h=c.partTargetDuration?c.partTargetDuration:(c.targetDuration-ji)*2,f=[l,u];for(let m=0;m<f.length;m++){if(!f[m])continue;if(Lh(f[m],i)<h)return!1}const p=Qa(o,i);return p.length===0?!1:(n=p.start(0)+Ki,this.logger_(`Buffered region starts (${p.start(0)})  just beyond seek point (${i}). Seeking to ${n}.`),this.tech_.setCurrentTime(n),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),i=_r(t,e);if(i.length&&e+3<=i.end(0)){this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region [${i.start(0)} -> ${i.end(0)}]. Attempting to resume playback by seeking to the current time.`),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"});return}}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const o=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${t}. Seeking to live point (seekable end) ${o}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(o),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const i=this.tech_.vhs.playlistController_.sourceUpdater_,s=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:i.audioBuffered(),videoBuffered:i.videoBuffered(),currentTime:t}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const a=Qa(s,t);return a.length>0?(this.logger_(`Stopped at ${t} and seeking to ${a.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(t),!0):!1}afterSeekableWindow_(e,t,i,s=!1){if(!e.length)return!1;let n=e.end(e.length-1)+Ki;const a=!i.endList,o=typeof i.partTargetDuration=="number";return a&&(o||s)&&(n=e.end(e.length-1)+i.targetDuration*3),t>n}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:t,currentTime:i}){if(!e)return;let s;if(e.length&&t.length){const n=_r(e,i-3),a=_r(e,i),o=_r(t,i);o.length&&!a.length&&n.length&&(s={start:n.end(0),end:o.end(0)})}else Qa(e,i).length||(s=this.gapFromVideoUnderflow_(e,i));return s?(this.logger_(`Encountered a gap in video from ${s.start} to ${s.end}. Seeking to current time ${i}`),!0):!1}skipTheGap_(e){const t=this.tech_.buffered(),i=this.tech_.currentTime(),s=Qa(t,i);if(this.resetTimeUpdate_(),s.length===0||i!==e)return;this.logger_("skipTheGap_:","currentTime:",i,"scheduled currentTime:",e,"nextRange start:",s.start(0)),this.tech_.setCurrentTime(s.start(0)+ji);const n={gapInfo:{from:i,to:s.start(0)}};this.playlistController_.trigger({type:"gapjumped",metadata:n}),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"})}gapFromVideoUnderflow_(e,t){const i=pI(e);for(let s=0;s<i.length;s++){const n=i.start(s),a=i.end(s);if(t-n<4&&t-n>2)return{start:n,end:a}}return null}}const PL={errorInterval:30,getSource(r){const t=this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource();return r(t)}},IT=function(r,e){let t=0,i=0;const s=$e(PL,e);r.ready(()=>{r.trigger({type:"usage",name:"vhs-error-reload-initialized"})});const n=function(){i&&r.currentTime(i)},a=function(c){c!=null&&(i=r.duration()!==1/0&&r.currentTime()||0,r.one("loadedmetadata",n),r.src(c),r.trigger({type:"usage",name:"vhs-error-reload"}),r.play())},o=function(){if(Date.now()-t<s.errorInterval*1e3){r.trigger({type:"usage",name:"vhs-error-reload-canceled"});return}if(!s.getSource||typeof s.getSource!="function"){te.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}return t=Date.now(),s.getSource.call(r,a)},l=function(){r.off("loadedmetadata",n),r.off("error",o),r.off("dispose",l)},u=function(c){l(),IT(r,c)};r.on("error",o),r.on("dispose",l),r.reloadSourceOnError=u},OL=function(r){IT(this,r)};var DT="3.17.3",ML="7.1.0",FL="1.3.1",NL="7.2.0",BL="4.0.2";const lt={PlaylistLoader:vr,Playlist:jt,utils:HI,STANDARD_PLAYLIST_SELECTOR:og,INITIAL_PLAYLIST_SELECTOR:RD,lastBandwidthSelector:og,movingAverageBandwidthSelector:DD,comparePlaylistBandwidth:Oh,comparePlaylistResolution:ID,xhr:tT()};Object.keys(bt).forEach(r=>{Object.defineProperty(lt,r,{get(){return te.log.warn(`using Vhs.${r} is UNSAFE be sure you know what you are doing`),bt[r]},set(e){if(te.log.warn(`using Vhs.${r} is UNSAFE be sure you know what you are doing`),typeof e!="number"||e<0){te.log.warn(`value of Vhs.${r} must be greater than or equal to 0`);return}bt[r]=e}})});const LT="videojs-vhs",RT=function(r,e){const t=e.media();let i=-1;for(let s=0;s<r.length;s++)if(r[s].id===t.id){i=s;break}r.selectedIndex_=i,r.trigger({selectedIndex:i,type:"change"})},UL=function(r,e){e.representations().forEach(t=>{r.addQualityLevel(t)}),RT(r,e.playlists)};lt.canPlaySource=function(){return te.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const $L=(r,e,t)=>{if(!r)return r;let i={};e&&e.attributes&&e.attributes.CODECS&&(i=Yn(Ui(e.attributes.CODECS))),t&&t.attributes&&t.attributes.CODECS&&(i.audio=t.attributes.CODECS);const s=Nr(i.video),n=Nr(i.audio),a={};for(const o in r)a[o]={},n&&(a[o].audioContentType=n),s&&(a[o].videoContentType=s),e.contentProtection&&e.contentProtection[o]&&e.contentProtection[o].pssh&&(a[o].pssh=e.contentProtection[o].pssh),typeof r[o]=="string"&&(a[o].url=r[o]);return $e(r,a)},VL=(r,e)=>r.reduce((t,i)=>{if(!i.contentProtection)return t;const s=e.reduce((n,a)=>{const o=i.contentProtection[a];return o&&o.pssh&&(n[a]={pssh:o.pssh}),n},{});return Object.keys(s).length&&t.push(s),t},[]),GL=({player:r,sourceKeySystems:e,audioMedia:t,mainPlaylists:i})=>{if(!r.eme.initializeMediaKeys)return Promise.resolve();const s=t?i.concat([t]):i,n=VL(s,Object.keys(e)),a=[],o=[];return n.forEach(l=>{o.push(new Promise((u,c)=>{r.tech_.one("keysessioncreated",u)})),a.push(new Promise((u,c)=>{r.eme.initializeMediaKeys({keySystems:l},h=>{if(h){c(h);return}u()})}))}),Promise.race([Promise.all(a),Promise.race(o)])},HL=({player:r,sourceKeySystems:e,media:t,audioMedia:i})=>{const s=$L(e,t,i);return s?(r.currentSource().keySystems=s,s&&!r.eme?(te.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1):!0):!1},wT=()=>{if(!$.localStorage)return null;const r=$.localStorage.getItem(LT);if(!r)return null;try{return JSON.parse(r)}catch{return null}},qL=r=>{if(!$.localStorage)return!1;let e=wT();e=e?$e(e,r):r;try{$.localStorage.setItem(LT,JSON.stringify(e))}catch{return!1}return e},jL=r=>r.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")===0?JSON.parse(r.substring(r.indexOf(",")+1)):r,kT=(r,e)=>{r._requestCallbackSet||(r._requestCallbackSet=new Set),r._requestCallbackSet.add(e)},PT=(r,e)=>{r._responseCallbackSet||(r._responseCallbackSet=new Set),r._responseCallbackSet.add(e)},OT=(r,e)=>{r._requestCallbackSet&&(r._requestCallbackSet.delete(e),r._requestCallbackSet.size||delete r._requestCallbackSet)},MT=(r,e)=>{r._responseCallbackSet&&(r._responseCallbackSet.delete(e),r._responseCallbackSet.size||delete r._responseCallbackSet)};lt.supportsNativeHls=(function(){if(!ue||!ue.createElement)return!1;const r=ue.createElement("video");return te.getTech("Html5").isSupported()?["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(r.canPlayType(t))}):!1})();lt.supportsNativeDash=(function(){return!ue||!ue.createElement||!te.getTech("Html5").isSupported()?!1:/maybe|probably/i.test(ue.createElement("video").canPlayType("application/dash+xml"))})();lt.supportsTypeNatively=r=>r==="hls"?lt.supportsNativeHls:r==="dash"?lt.supportsNativeDash:!1;lt.isSupported=function(){return te.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};lt.xhr.onRequest=function(r){kT(lt.xhr,r)};lt.xhr.onResponse=function(r){PT(lt.xhr,r)};lt.xhr.offRequest=function(r){OT(lt.xhr,r)};lt.xhr.offResponse=function(r){MT(lt.xhr,r)};const KL=te.getComponent("Component");class FT extends KL{constructor(e,t,i){if(super(t,i.vhs),typeof i.initialBandwidth=="number"&&(this.options_.bandwidth=i.initialBandwidth),this.logger_=Ti("VhsHandler"),t.options_&&t.options_.playerId){const s=te.getPlayer(t.options_.playerId);this.player_=s}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(ue,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],s=>{const n=ue.fullscreenElement||ue.webkitFullscreenElement||ue.mozFullScreenElement||ue.msFullscreenElement;n&&n.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()}),this.on(this.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=!1;return}this.setCurrentTime(this.tech_.currentTime())}),this.on(this.tech_,"error",function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()}),this.on(this.tech_,"play",this.play)}setOptions_(e={}){if(this.options_=$e(this.options_,e),this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions!==!1,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.usePlayerObjectFit=this.options_.usePlayerObjectFit||!1,this.options_.useBandwidthFromLocalStorage=typeof this.source_.useBandwidthFromLocalStorage<"u"?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useForcedSubtitles=this.options_.useForcedSubtitles||!1,this.options_.useNetworkInformationApi=typeof this.options_.useNetworkInformationApi<"u"?this.options_.useNetworkInformationApi:!0,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=this.options_.llhls!==!1,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,typeof this.options_.playlistExclusionDuration!="number"&&(this.options_.playlistExclusionDuration=60),typeof this.options_.bandwidth!="number"&&this.options_.useBandwidthFromLocalStorage){const i=wT();i&&i.bandwidth&&(this.options_.bandwidth=i.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),i&&i.throughput&&(this.options_.throughput=i.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}typeof this.options_.bandwidth!="number"&&(this.options_.bandwidth=bt.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===bt.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","usePlayerObjectFit","customPixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useForcedSubtitles","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach(i=>{typeof this.source_[i]<"u"&&(this.options_[i]=this.source_[i])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio,this.usePlayerObjectFit=this.options_.usePlayerObjectFit;const t=this.options_.customPixelRatio;typeof t=="number"&&t>=0&&(this.customPixelRatio=t)}setOptions(e={}){this.setOptions_(e)}src(e,t){if(!e)return;this.setOptions_(),this.options_.src=jL(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=lt,this.options_.sourceType=s0(t),this.options_.seekTo=n=>{this.tech_.setCurrentTime(n)},this.options_.player_=this.player_,this.playlistController_=new DL(this.options_);const i=$e({liveRangeSafeTimeDelta:Ki},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new kL(i),this.attachStreamingEventListeners_(),this.playlistController_.on("error",()=>{const n=te.players[this.tech_.options_.playerId];let a=this.playlistController_.error;typeof a=="object"&&!a.code?a.code=3:typeof a=="string"&&(a={message:a,code:3}),n.error(a)});const s=this.options_.bufferBasedABR?lt.movingAverageBandwidthSelector(.55):lt.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):s.bind(this),this.playlistController_.selectInitialPlaylist=lt.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(n){this.playlistController_.selectPlaylist=n.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(n){this.playlistController_.mainSegmentLoader_.throughput.rate=n,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let n=this.playlistController_.mainSegmentLoader_.bandwidth;const a=$.navigator.connection||$.navigator.mozConnection||$.navigator.webkitConnection,o=1e7;if(this.options_.useNetworkInformationApi&&a){const l=a.downlink*1e3*1e3;l>=o&&n>=o?n=Math.max(n,l):n=l}return n},set(n){this.playlistController_.mainSegmentLoader_.bandwidth=n,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const n=1/(this.bandwidth||1);let a;return this.throughput>0?a=1/this.throughput:a=0,Math.floor(1/(n+a))},set(){te.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>zs(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>zs(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",()=>{this.options_.useBandwidthFromLocalStorage&&qL({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})}),this.playlistController_.on("selectedinitialmedia",()=>{wL(this)}),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",()=>{this.setupEme_()}),this.on(this.playlistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.playlistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=$.URL.createObjectURL(this.playlistController_.mediaSource),(te.browser.IS_ANY_SAFARI||te.browser.IS_IOS)&&this.options_.overrideNative&&this.options_.sourceType==="hls"&&typeof this.tech_.addSourceElement=="function"?(this.tech_.addSourceElement(this.mediaSourceUrl_),this.tech_.addSourceElement(this.source_.src)):this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),GL({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then(()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()}).catch(t=>{this.logger_("error while creating EME key session",t),this.player_.error({message:"Failed to initialize media keys for EME",code:3})})}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=HL({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});if(this.player_.tech_.on("keystatuschange",i=>{this.playlistController_.updatePlaylistByKeyStatus(i.keyId,i.status)}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),!t){this.playlistController_.sourceUpdater_.initializedEme();return}this.createKeySessions_()}setupQualityLevels_(){const e=te.players[this.tech_.options_.playerId];!e||!e.qualityLevels||this.qualityLevels_||(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",()=>{UL(this.qualityLevels_,this)}),this.playlists.on("mediachange",()=>{RT(this.qualityLevels_,this.playlists)}))}static version(){return{"@videojs/http-streaming":DT,"mux.js":ML,"mpd-parser":FL,"m3u8-parser":NL,"aes-decrypter":BL}}version(){return this.constructor.version()}canChangeType(){return bT.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&$.URL.revokeObjectURL&&($.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return XI({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t,i=!0,s=2){return aT({programTime:e,playlist:this.playlistController_.media(),retryCount:s,pauseAfterSeek:i,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}setupXhrHooks_(){this.xhr.onRequest=e=>{kT(this.xhr,e)},this.xhr.onResponse=e=>{PT(this.xhr,e)},this.xhr.offRequest=e=>{OT(this.xhr,e)},this.xhr.offResponse=e=>{MT(this.xhr,e)},this.player_.trigger("xhr-hooks-ready")}attachStreamingEventListeners_(){const e=["seekablerangeschanged","bufferedrangeschanged","contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"],t=["gapjumped","playedrangeschanged"];e.forEach(i=>{this.playlistController_.on(i,s=>{this.player_.trigger(mt({},s))})}),t.forEach(i=>{this.playbackWatcher_.on(i,s=>{this.player_.trigger(mt({},s))})})}}const Ho={name:"videojs-http-streaming",VERSION:DT,canHandleSource(r,e={}){const t=$e(te.options,e);return!t.vhs.experimentalUseMMS&&!kn("avc1.4d400d,mp4a.40.2",!1)?!1:Ho.canPlayType(r.type,t)},handleSource(r,e,t={}){const i=$e(te.options,t);return e.vhs=new FT(r,e,i),e.vhs.xhr=tT(),e.vhs.setupXhrHooks_(),e.vhs.src(r.src,r.type),e.vhs},canPlayType(r,e){const t=s0(r);if(!t)return"";const i=Ho.getOverrideNative(e);return!lt.supportsTypeNatively(t)||i?"maybe":""},getOverrideNative(r={}){const{vhs:e={}}=r,t=!(te.browser.IS_ANY_SAFARI||te.browser.IS_IOS),{overrideNative:i=t}=e;return i}},WL=()=>kn("avc1.4d400d,mp4a.40.2",!0);WL()&&te.getTech("Html5").registerSourceHandler(Ho,0);te.VhsHandler=FT;te.VhsSourceHandler=Ho;te.Vhs=lt;te.use||te.registerComponent("Vhs",lt);te.options.vhs=te.options.vhs||{};(!te.getPlugin||!te.getPlugin("reloadSourceOnError"))&&te.registerPlugin("reloadSourceOnError",OL);const zL=vg({__name:"VideoPlayer.client",props:{type:{},src:{}},setup(r){const e=r,t=Ou(null);let i=null,s=null;function n(){i&&(i.destroy(),i=null),s&&(s.dispose(),s=null),t.value&&(t.value.pause?.(),t.value.removeAttribute("src"),t.value.load?.())}async function a(){if(await Ov(),!t.value)return;const o=t.value;if(e.type==="hls"){if(o.canPlayType("application/vnd.apple.mpegurl")){o.src=e.src;return}ls.isSupported()?(i=new ls({enableWorker:!0,lowLatencyMode:!0}),i.loadSource(e.src),i.attachMedia(o)):console.warn("HLS not supported in this browser.")}else s=te(o,{controls:!0,fluid:!0,preload:"metadata",sources:[{src:e.src,type:"video/mp4"}]})}return wv(a),kv(()=>[e.type,e.src],async()=>{n(),await a()}),Pv(n),(o,l)=>(Ks(),Sr("div",null,[r.type==="hls"?(Ks(),Sr("video",{key:0,ref_key:"videoEl",ref:t,controls:"",playsinline:"",preload:"metadata",style:{width:"100%","border-radius":"16px",background:"#000"}},null,512)):(Ks(),Sr("video",{key:1,ref_key:"videoEl",ref:t,class:"video-js vjs-big-play-centered",controls:"",playsinline:"",preload:"metadata",style:{width:"100%","border-radius":"16px"}},null,512))]))}}),YL={class:"page"},XL={key:0},QL={style:{display:"flex","align-items":"center","justify-content":"space-between",gap:"12px"}},JL={style:{"font-weight":"900","font-size":"18px"}},ZL={key:1},cR=vg({__name:"[id]",setup(r){const e=Ou("VPN"),t=Mv(),i=Ou(""),s=t.params.id;function n(h){}const a=Av.find(h=>h.id===s);function o(h){console.log("ad click:",h.id,h.title)}const l=Fv();function u(h){const f=new Set(xd.map(p=>typeof p=="string"?p:p.name||p.label||p.id));!h.to&&!h.link&&f.has(h.label)&&l.push({path:"/",query:{c:h.label}})}function c(){if(typeof window<"u"&&window.history.length>1){l.back();return}l.push("/")}return(h,f)=>{const p=Cv,m=Iv;return Ks(),Sr("div",YL,[wa(Rv,{modelValue:hi(i),"onUpdate:modelValue":f[0]||(f[0]=y=>Ad(i)?i.value=y:null),placeholder:"",onSearch:n,brandTo:"/"},null,8,["modelValue"]),hi(a)?(Ks(),Sr("div",XL,[f[2]||(f[2]=or("div",{class:"banner"}," demo.streaming.com",-1)),wa(p,{items:hi(xd),active:hi(e),"onUpdate:active":f[1]||(f[1]=y=>Ad(e)?e.value=y:null),onNav:u},null,8,["items","active"]),wa(m,{items:hi(Dv),onClick:o},null,8,["items"]),or("div",QL,[or("div",JL,Cd(hi(a).title),1),or("button",{class:"btn",style:{padding:"8px 10px"},onClick:c},"")]),f[3]||(f[3]=or("div",{style:{"margin-top":"10px",color:"#666","font-size":"13px","line-height":"1.7"}},null,-1)),hi(a)?(Ks(),Nv(zL,{key:hi(a).type+"|"+hi(a).src,type:hi(a).type,src:hi(a).src},null,8,["type","src"])):Bv("",!0),or("p",null,Cd(hi(a).description),1)])):(Ks(),Sr("div",ZL,"  ")),wa(Lv)])}}});export{cR as default};
